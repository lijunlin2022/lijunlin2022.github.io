"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[515],{6157:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>i});var t=e(5893),a=e(1151);const o={},s="graphql",l={id:"nestjs/graphql",title:"graphql",description:"\u5b89\u88c5",source:"@site/docs/08-nestjs/01-graphql.md",sourceDirName:"08-nestjs",slug:"/nestjs/graphql",permalink:"/docs/nestjs/graphql",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"nestjs",permalink:"/docs/category/nestjs"},next:{title:"oss",permalink:"/docs/nestjs/oss"}},c={},i=[];function p(n){const r={code:"code",h1:"h1",p:"p",pre:"pre",...(0,a.a)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h1,{id:"graphql",children:"graphql"}),"\n",(0,t.jsx)(r.p,{children:"\u5b89\u88c5"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"pnpm i @apollo/client -S\n"})}),"\n",(0,t.jsx)(r.p,{children:"\u5f15\u5165 gql \u65b9\u6cd5\uff0c\u5b9a\u4e49 Query \u548c Mutation \u4e24\u4e2a\u5b57\u7b26\u4e32\u3002"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"import { gql } from '@apollo/client'\r\n\r\nexport const FIND = gql`\r\n  query find($id: String!) {\r\n    find(id: $id) {\r\n      avatar\r\n      tel\r\n    }\r\n  }\r\n`\r\n\r\nexport const UPDATE = gql`\r\n  mutation update($id: String!, $params: UserInput!) {\r\n    update(id: $id, params: $params)\r\n  }\r\n`\n"})}),"\n",(0,t.jsx)(r.p,{children:"\u4f7f\u7528 @apollo/client \u63d0\u4f9b\u7684\u4e24\u4e2a hooks, useQuery \u548c useMutation"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:"import React, { useState } from 'react'\r\nimport { useQuery, useMutation } from '@apollo/client'\r\nimport { FIND, UPDATE } from './graphql/Demo'\r\n\r\nfunction Demo() {\r\n  const [avatar, setAvatar] = useState('')\r\n  const [tel, setTel] = useState('')\r\n\r\n  const { loading, data } = useQuery(FIND, {\r\n    variables: {\r\n      id: '2b130fa8-78bf-4540-93ba-5b0960b62a76',\r\n    },\r\n  })\r\n\r\n  const [update] = useMutation(UPDATE)\r\n\r\n  const changeAvatarHandler = (v: React.ChangeEvent<HTMLInputElement>) => {\r\n    setAvatar(v.target.value)\r\n  }\r\n\r\n  const changeTelHandler = (v: React.ChangeEvent<HTMLInputElement>) => {\r\n    setTel(v.target.value)\r\n  }\r\n\r\n  const clickHandler = () => {\r\n    update({\r\n      variables: {\r\n        id: '2b130fa8-78bf-4540-93ba-5b0960b62a76',\r\n        params: {\r\n          avatar,\r\n          tel,\r\n        },\r\n      },\r\n    })\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <p>data: {JSON.stringify(data)}</p>\r\n      <p>loading: {`${loading}`}</p>\r\n      <p>\r\n        avatar:\r\n        <input type=\"text\" onChange={changeAvatarHandler} />\r\n      </p>\r\n      <p>\r\n        telephone:\r\n        <input type=\"text\" onChange={changeTelHandler} />\r\n      </p>\r\n      <button onClick={clickHandler}>\u66f4\u65b0</button>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Demo\n"})}),"\n",(0,t.jsx)(r.p,{children:"\u5b9a\u4e49\u4e00\u4e2a\u7528\u4e8e\u53d1\u9001\u7f51\u7edc\u8bf7\u6c42\u7684 client"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"import { ApolloClient, InMemoryCache } from '@apollo/client'\r\n\r\nexport const client = new ApolloClient({\r\n  uri: 'http://localhost:3000/graphql',\r\n  cache: new InMemoryCache()\r\n})\n"})}),"\n",(0,t.jsx)(r.p,{children:"\u5229\u7528\u63d0\u4f9b\u7684 ApolloProvider \u5305\u88f9 React \u7684\u6839\u7ec4\u4ef6\u3002"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:"import React from 'react'\r\nimport ReactDOM from 'react-dom/client'\r\nimport { ApolloProvider } from '@apollo/client'\r\nimport App from './App.tsx'\r\nimport './index.css'\r\nimport { client } from './utils/Apollo.ts'\r\n\r\nReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(\r\n  <React.StrictMode>\r\n    <ApolloProvider client={client}>\r\n      <App />\r\n    </ApolloProvider>\r\n  </React.StrictMode>,\r\n)\n"})}),"\n",(0,t.jsx)(r.p,{children:"\u81f3\u6b64\uff0c\u5927\u529f\u544a\u6210\u3002"})]})}function d(n={}){const{wrapper:r}={...(0,a.a)(),...n.components};return r?(0,t.jsx)(r,{...n,children:(0,t.jsx)(p,{...n})}):p(n)}},1151:(n,r,e)=>{e.d(r,{Z:()=>l,a:()=>s});var t=e(7294);const a={},o=t.createContext(a);function s(n){const r=t.useContext(o);return t.useMemo((function(){return"function"==typeof n?n(r):{...r,...n}}),[r,n])}function l(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:s(n.components),t.createElement(o.Provider,{value:r},n.children)}}}]);