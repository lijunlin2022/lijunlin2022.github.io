"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7050],{85333:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>l,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var t=n(85893),r=n(11151);const i={},c="sms",o={id:"nestjs/sms",title:"sms",description:"\u6211\u4eec\u5f00\u53d1\u4e00\u4e2a\u4ea7\u54c1\u65f6\uff0c\u5f80\u5f80\u9700\u8981\u7528\u5230\u77ed\u4fe1\u9a8c\u8bc1\u7801\u529f\u80fd\uff0c\u4e3a\u6b64\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u300c\u963f\u91cc\u4e91\u77ed\u4fe1\u670d\u52a1\u300d\u3002",source:"@site/docs/08-nestjs/03-sms.md",sourceDirName:"08-nestjs",slug:"/nestjs/sms",permalink:"/docs/nestjs/sms",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"oss",permalink:"/docs/nestjs/oss"},next:{title:"\u6570\u636e\u7ed3\u6784\u548c\u63a7\u5236\u7ed3\u6784",permalink:"/docs/python/data-structure-and-control-structure"}},a={},d=[{value:"\u4f7f\u7528\u6d4b\u8bd5\u6a21\u677f",id:"\u4f7f\u7528\u6d4b\u8bd5\u6a21\u677f",level:2},{value:"\u7f16\u5199\u8c03\u7528\u7684 API \u7684\u4ee3\u7801",id:"\u7f16\u5199\u8c03\u7528\u7684-api-\u7684\u4ee3\u7801",level:2},{value:"\u8bbf\u95ee\u63a7\u5236",id:"\u8bbf\u95ee\u63a7\u5236",level:2}];function m(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",img:"img",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"sms",children:"sms"}),"\n",(0,t.jsx)(s.p,{children:"\u6211\u4eec\u5f00\u53d1\u4e00\u4e2a\u4ea7\u54c1\u65f6\uff0c\u5f80\u5f80\u9700\u8981\u7528\u5230\u77ed\u4fe1\u9a8c\u8bc1\u7801\u529f\u80fd\uff0c\u4e3a\u6b64\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u300c\u963f\u91cc\u4e91\u77ed\u4fe1\u670d\u52a1\u300d\u3002"}),"\n",(0,t.jsxs)(s.p,{children:["\u53ef\u4ee5\u8bbf\u95ee ",(0,t.jsx)(s.a,{href:"https://dysms.console.aliyun.com/overview",children:"\u963f\u91cc\u4e91\u77ed\u4fe1\u670d\u52a1"}),"\u3002"]}),"\n",(0,t.jsx)(s.h2,{id:"\u4f7f\u7528\u6d4b\u8bd5\u6a21\u677f",children:"\u4f7f\u7528\u6d4b\u8bd5\u6a21\u677f"}),"\n",(0,t.jsx)(s.p,{children:"\u9009\u62e9\u300c\u901a\u8fc7 API \u53d1\u77ed\u4fe1\u300d->\u300c\u514d\u7b7e\u540d/\u6a21\u677f\u5ba1\u6838\u7684 API \u53d1\u9001\u6d4b\u8bd5\u300d"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{src:n(46904).Z+"",width:"1373",height:"801"})}),"\n",(0,t.jsx)(s.p,{children:"\u4e3a\u4e86\u5feb\u901f\u4e0a\u624b\u963f\u91cc\u4e91\u77ed\u4fe1\u670d\u52a1\uff0c\u6211\u4eec\u5728\u7ed1\u5b9a\u6d4b\u8bd5\u624b\u673a\u53f7\u540e\uff0c\u53ef\u4ee5\u5148\u4e0d\u9009\u62e9\u7533\u8bf7\u6a21\u677f\uff0c\u800c\u662f\u5148\u4f7f\u7528\u300c\u3010\u4e13\u7528\u3011\u6d4b\u8bd5\u7b7e\u540d/\u6a21\u677f\u300d\u3002"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{src:n(41324).Z+"",width:"1500",height:"726"})}),"\n",(0,t.jsx)(s.p,{children:"\u4e4b\u540e\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u70b9\u51fb\u8c03\u7528\uff0c\u770b\u770b\u662f\u5426\u6709\u9a8c\u8bc1\u7801\u53d1\u9001\u5230\u6211\u4eec\u7684\u624b\u673a\u4e0a\u3002"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{src:n(47635).Z+"",width:"1437",height:"937"})}),"\n",(0,t.jsx)(s.h2,{id:"\u7f16\u5199\u8c03\u7528\u7684-api-\u7684\u4ee3\u7801",children:"\u7f16\u5199\u8c03\u7528\u7684 API \u7684\u4ee3\u7801"}),"\n",(0,t.jsx)(s.p,{children:"\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u300cSDK \u793a\u4f8b\u300d\uff0c\u67e5\u770b\u76f8\u5173\u8bed\u8a00\u7684\u4f8b\u5b50\uff0c\u56e0\u4e3a\u6211\u4f7f\u7528\u7684\u662f Nest.js\uff0c\u6240\u4ee5\u9009\u62e9 TypeScript\u3002"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{src:n(15279).Z+"",width:"1849",height:"937"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import { Injectable } from '@nestjs/common';\r\nimport Dysmsapi20170525, * as $Dysmsapi20170525 from '@alicloud/dysmsapi20170525';\r\nimport * as $OpenApi from '@alicloud/openapi-client';\r\nimport Util, * as $Util from '@alicloud/tea-util';\r\nimport {\r\n  aliyunAccessKeyId,\r\n  aliyunAccessKeySecret,\r\n  signName,\r\n  templateCode,\r\n} from 'src/password.config';\r\nimport { getRandomCode } from 'src/shared/utils';\r\n\r\n@Injectable()\r\nexport class SMSService {\r\n  async sendVerificationCode(tel: string): Promise<string> {\r\n    const code = getRandomCode(4);\r\n    const config = new $OpenApi.Config({\r\n      accessKeyId: aliyunAccessKeyId,\r\n      accessKeySecret: aliyunAccessKeySecret,\r\n    });\r\n    config.endpoint = 'dysmsapi.aliyuncs.com';\r\n    const client = new Dysmsapi20170525(config);\r\n    const sendSmsRequest = new $Dysmsapi20170525.SendSmsRequest({\r\n      signName: signName,\r\n      templateCode: templateCode,\r\n      phoneNumbers: tel,\r\n      templateParam: `{\"code\":\"${code}\"}`,\r\n    });\r\n    const runtime = new $Util.RuntimeOptions({});\r\n    try {\r\n      await client.sendSmsWithOptions(sendSmsRequest, runtime);\r\n    } catch (error) {\r\n      Util.assertAsString(error.message);\r\n    }\r\n    return code;\r\n  }\r\n}\n"})}),"\n",(0,t.jsx)(s.h2,{id:"\u8bbf\u95ee\u63a7\u5236",children:"\u8bbf\u95ee\u63a7\u5236"}),"\n",(0,t.jsx)(s.p,{children:"\u4e4b\u540e\u6211\u4eec\u9700\u8981\u5230\u963f\u91cc\u4e91\u8bbf\u95ee\u63a7\u5236\uff0c\u4e3a\u6211\u4eec\u7684\u8eab\u4efd\u6dfb\u52a0\u6743\u9650\u3002"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.img,{src:n(95013).Z+"",width:"1851",height:"435"}),"\r\n",(0,t.jsx)(s.img,{src:n(39368).Z+"",width:"1819",height:"868"})]}),"\n",(0,t.jsx)(s.p,{children:"\u8c03\u7528\u4ee3\u7801\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u6536\u5230\u77ed\u4fe1\u4e86\u3002"})]})}function l(e={}){const{wrapper:s}={...(0,r.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(m,{...e})}):m(e)}},46904:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/sms1-0ad18851e099397f1a0d963ded3ca0ef.png"},41324:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/sms2-9d2b0f8c61f2640eeab302d78772e943.png"},47635:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/sms3-bc4198b42a988cfb7c7adb9a315fe92c.png"},15279:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/sms4-bf97a8ee76190e8cd31799e6ed76e3b6.png"},95013:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/sms5-2e9196d1017272f9337067b2c0c3f4c6.png"},39368:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/sms6-6a1803e528343b99dcf76749e74622a7.png"},11151:(e,s,n)=>{n.d(s,{Z:()=>o,a:()=>c});var t=n(67294);const r={},i=t.createContext(r);function c(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);