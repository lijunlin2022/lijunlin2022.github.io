"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["1222"],{86:function(e,s,n){n.r(s),n.d(s,{default:()=>h});var r=n("5893"),i=n("65");let t=n.p+"static/image/sms6.6680bfe1.png",a=n.p+"static/image/sms5.1732b98a.png",c=n.p+"static/image/sms4.c368a064.png",d=n.p+"static/image/sms3.e6382c70.png",l=n.p+"static/image/sms2.f375f788.png",m=n.p+"static/image/sms1.216f906b.png";function o(e){let s=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",img:"img",pre:"pre",code:"code"},(0,i.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.h1,{id:"sms",children:["sms",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#sms",children:"#"})]}),"\n",(0,r.jsx)(s.p,{children:"我们开发一个产品时，往往需要用到短信验证码功能，为此我们可以选择「阿里云短信服务」。"}),"\n",(0,r.jsxs)(s.p,{children:["可以访问 ",(0,r.jsx)(s.a,{href:"https://dysms.console.aliyun.com/overview",target:"_blank",rel:"noopener noreferrer",children:"阿里云短信服务"}),"。"]}),"\n",(0,r.jsxs)(s.h2,{id:"使用测试模板",children:["使用测试模板",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#使用测试模板",children:"#"})]}),"\n",(0,r.jsx)(s.p,{children:"选择「通过 API 发短信」->「免签名/模板审核的 API 发送测试」"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)("img",{src:m,alt:""})}),"\n",(0,r.jsx)(s.p,{children:"为了快速上手阿里云短信服务，我们在绑定测试手机号后，可以先不选择申请模板，而是先使用「【专用】测试签名/模板」。"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)("img",{src:l,alt:""})}),"\n",(0,r.jsx)(s.p,{children:"之后我们可以直接点击调用，看看是否有验证码发送到我们的手机上。"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)("img",{src:d,alt:""})}),"\n",(0,r.jsxs)(s.h2,{id:"编写调用的-api-的代码",children:["编写调用的 API 的代码",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#编写调用的-api-的代码",children:"#"})]}),"\n",(0,r.jsx)(s.p,{children:"我们可以选择「SDK 示例」，查看相关语言的例子，因为我使用的是 Nest.js，所以选择 TypeScript。"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)("img",{src:c,alt:""})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"import { Injectable } from '@nestjs/common';\r\nimport Dysmsapi20170525, * as $Dysmsapi20170525 from '@alicloud/dysmsapi20170525';\r\nimport * as $OpenApi from '@alicloud/openapi-client';\r\nimport Util, * as $Util from '@alicloud/tea-util';\r\nimport {\r\n  aliyunAccessKeyId,\r\n  aliyunAccessKeySecret,\r\n  signName,\r\n  templateCode,\r\n} from 'src/password.config';\r\nimport { getRandomCode } from 'src/shared/utils';\r\n\r\n@Injectable()\r\nexport class SMSService {\r\n  async sendVerificationCode(tel: string): Promise<string> {\r\n    const code = getRandomCode(4);\r\n    const config = new $OpenApi.Config({\r\n      accessKeyId: aliyunAccessKeyId,\r\n      accessKeySecret: aliyunAccessKeySecret,\r\n    });\r\n    config.endpoint = 'dysmsapi.aliyuncs.com';\r\n    const client = new Dysmsapi20170525(config);\r\n    const sendSmsRequest = new $Dysmsapi20170525.SendSmsRequest({\r\n      signName: signName,\r\n      templateCode: templateCode,\r\n      phoneNumbers: tel,\r\n      templateParam: `{\"code\":\"${code}\"}`,\r\n    });\r\n    const runtime = new $Util.RuntimeOptions({});\r\n    try {\r\n      await client.sendSmsWithOptions(sendSmsRequest, runtime);\r\n    } catch (error) {\r\n      Util.assertAsString(error.message);\r\n    }\r\n    return code;\r\n  }\r\n}\n"})}),"\n",(0,r.jsxs)(s.h2,{id:"访问控制",children:["访问控制",(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#访问控制",children:"#"})]}),"\n",(0,r.jsx)(s.p,{children:"之后我们需要到阿里云访问控制，为我们的身份添加权限。"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)("img",{src:a,alt:""}),"\r\n",(0,r.jsx)("img",{src:t,alt:""})]}),"\n",(0,r.jsx)(s.p,{children:"调用代码后，我们就可以直接收到短信了。"})]})}function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,i.ah)(),e.components);return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}let h=p;p.__RSPRESS_PAGE_META={},p.__RSPRESS_PAGE_META["docs%2Fnestjs%2F03-sms.md"]={toc:[{text:"使用测试模板",id:"使用测试模板",depth:2},{text:"编写调用的 API 的代码",id:"编写调用的-api-的代码",depth:2},{text:"访问控制",id:"访问控制",depth:2}],title:"sms",frontmatter:{}}}}]);