"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["1222"],{60086:function(e,n,s){s.r(n),s.d(n,{default:()=>u});var r=s("85893"),i=s("50065"),t=s("95895");let a=s.p+"static/image/sms1.216f906b.png",c=s.p+"static/image/sms2.f375f788.png",d=s.p+"static/image/sms3.e6382c70.png",m=s.p+"static/image/sms4.c368a064.png",l=s.p+"static/image/sms5.1732b98a.png",o=s.p+"static/image/sms6.6680bfe1.png";function p(e){let n=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",img:"img",pre:"pre",code:"code"},(0,i.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h1,{id:"sms",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sms",children:"#"}),"sms"]}),"\n",(0,r.jsx)(t.Z,{defaultLocale:"zh-CN"}),"\n",(0,r.jsx)(n.p,{children:"我们开发一个产品时，往往需要用到短信验证码功能，为此我们可以选择「阿里云短信服务」。"}),"\n",(0,r.jsxs)(n.p,{children:["可以访问 ",(0,r.jsx)(n.a,{href:"https://dysms.console.aliyun.com/overview",target:"_blank",rel:"noopener noreferrer",children:"阿里云短信服务"}),"。"]}),"\n",(0,r.jsxs)(n.h2,{id:"使用测试模板",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#使用测试模板",children:"#"}),"使用测试模板"]}),"\n",(0,r.jsx)(n.p,{children:"选择「通过 API 发短信」->「免签名/模板审核的 API 发送测试」"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:a})}),"\n",(0,r.jsx)(n.p,{children:"为了快速上手阿里云短信服务，我们在绑定测试手机号后，可以先不选择申请模板，而是先使用「【专用】测试签名/模板」。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:c})}),"\n",(0,r.jsx)(n.p,{children:"之后我们可以直接点击调用，看看是否有验证码发送到我们的手机上。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:d})}),"\n",(0,r.jsxs)(n.h2,{id:"编写调用的-api-的代码",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#编写调用的-api-的代码",children:"#"}),"编写调用的 API 的代码"]}),"\n",(0,r.jsx)(n.p,{children:"我们可以选择「SDK 示例」，查看相关语言的例子，因为我使用的是 Nest.js，所以选择 TypeScript。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:m})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",meta:"",children:"import { Injectable } from '@nestjs/common';\r\nimport Dysmsapi20170525, * as $Dysmsapi20170525 from '@alicloud/dysmsapi20170525';\r\nimport * as $OpenApi from '@alicloud/openapi-client';\r\nimport Util, * as $Util from '@alicloud/tea-util';\r\nimport {\r\n  aliyunAccessKeyId,\r\n  aliyunAccessKeySecret,\r\n  signName,\r\n  templateCode,\r\n} from 'src/password.config';\r\nimport { getRandomCode } from 'src/shared/utils';\r\n\r\n@Injectable()\r\nexport class SMSService {\r\n  async sendVerificationCode(tel: string): Promise<string> {\r\n    const code = getRandomCode(4);\r\n    const config = new $OpenApi.Config({\r\n      accessKeyId: aliyunAccessKeyId,\r\n      accessKeySecret: aliyunAccessKeySecret,\r\n    });\r\n    config.endpoint = 'dysmsapi.aliyuncs.com';\r\n    const client = new Dysmsapi20170525(config);\r\n    const sendSmsRequest = new $Dysmsapi20170525.SendSmsRequest({\r\n      signName: signName,\r\n      templateCode: templateCode,\r\n      phoneNumbers: tel,\r\n      templateParam: `{\"code\":\"${code}\"}`,\r\n    });\r\n    const runtime = new $Util.RuntimeOptions({});\r\n    try {\r\n      await client.sendSmsWithOptions(sendSmsRequest, runtime);\r\n    } catch (error) {\r\n      Util.assertAsString(error.message);\r\n    }\r\n    return code;\r\n  }\r\n}\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"访问控制",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#访问控制",children:"#"}),"访问控制"]}),"\n",(0,r.jsx)(n.p,{children:"之后我们需要到阿里云访问控制，为我们的身份添加权限。"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.img,{src:l}),"\r\n",(0,r.jsx)(n.img,{src:o})]}),"\n",(0,r.jsx)(n.p,{children:"调用代码后，我们就可以直接收到短信了。"})]})}function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,r.jsx)(n,Object.assign({},e,{children:(0,r.jsx)(p,e)})):p(e)}let u=h;h.__RSPRESS_PAGE_META={},h.__RSPRESS_PAGE_META["docs%2Fnestjs%2F03-sms.md"]={toc:[{id:"使用测试模板",text:"使用测试模板",depth:2},{id:"编写调用的-api-的代码",text:"编写调用的 API 的代码",depth:2},{id:"访问控制",text:"访问控制",depth:2}],title:"sms",frontmatter:{}}},95895:function(e,n,s){s.d(n,{Z:function(){return d}});var r=s(85893),i=s(67294),t=s(45687);s(6175);let a={"zh-CN":e=>`预计阅读时间: ${e.minutes>=1?`${Math.ceil(e.minutes)} 分钟`:"小于 1 分钟"}`,"en-US":e=>`Estimated reading time: ${e.minutes>=1?`${Math.ceil(e.minutes)} minutes`:"less than 1 minute"}`};function c(e,n,s){let r=Object.keys(a).includes(n)?n:s;return a[r](e)}let d=e=>{let{defaultLocale:n="en-US"}=e,s=(0,t.Vi)().page.readingTimeData,a=(0,t.Jr)(),d=(0,t.e7)(),[m,l]=(0,i.useState)(c(s,a,n));return(0,i.useEffect)(()=>{l(c(s,a,n))},[a,s]),(0,r.jsx)("span",{"data-dark":String(d),className:"rp-reading-time",children:m})}}}]);