"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["1702"],{9956:function(e,n,r){r.r(n),r.d(n,{default:function(){return l}});var t=r(85893),i=r(50065),c=r(95895);function s(e){let n=Object.assign({h1:"h1",a:"a",p:"p",ul:"ul",li:"li",pre:"pre",code:"code"},(0,i.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.h1,{id:"宕机恢复",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#宕机恢复",children:"#"}),"宕机恢复"]}),"\n",(0,t.jsx)(c.Z,{defaultLocale:"zh-CN"}),"\n",(0,t.jsx)(n.p,{children:"recover 可以让进入宕机状态的 goruntine 恢复执行。"}),"\n",(0,t.jsx)(n.p,{children:"它仅在 defer 语句中有效，其他情况下调用 recover 返回 nil 并且没有其他影响。"}),"\n",(0,t.jsx)(n.p,{children:"通常来说，不应该对进入 panic 宕机的程序做任何处理，但有时，需要我们可以从宕机中恢复，至少我们可以在程序崩溃前，做一些操作，举个例子，当 web 服务器遇到不可预料的严重问题时，在崩溃前应该将所有的连接关闭，如果不做任何处理，会使得客户端一直处于等待状态，如果 web 服务器还在开发阶段，服务器甚至可以将异常信息反馈到客户端，帮助调试"}),"\n",(0,t.jsx)(n.p,{children:"panic 和 recover 的组合有如下特性："}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"有 panic 没 recover，程序宕机。"}),"\n",(0,t.jsx)(n.li,{children:"有 panic 也有 recover，程序不会宕机，执行完对应的 defer 后，从宕机点退出当前函数后继续执行。"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",meta:"",children:'func ProtectRun(entry func()) {\r\n  defer func() {\r\n    err := recover()\r\n    fmt.Println("error:", err)\r\n  }()\r\n  entry()\r\n}\r\n\r\nfunc main() {\r\n  fmt.Println("运行前")\r\n  // 故意造成空指针访问错误\r\n  ProtectRun(func() {\r\n    fmt.Println("赋值宕机前")\r\n    var a *int\r\n    *a = 1\r\n    fmt.Println("赋值宕机后")\r\n  })\r\n  fmt.Println("运行后")\r\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"上述函数打印结果为："}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{meta:"",children:"运行前\r\n赋值宕机前\r\nerror: runtime error: invalid memory address or nil pointer dereference  \r\n运行后\n"})}),"\n",(0,t.jsx)(n.p,{children:"也就是说，go 函数宕机后，退出了 ProtectRun() 并继续执行。"})]})}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,t.jsx)(n,Object.assign({},e,{children:(0,t.jsx)(s,e)})):s(e)}let l=a;a.__RSPRESS_PAGE_META={},a.__RSPRESS_PAGE_META["docs%2Fgo%2F14-recover.md"]={toc:[],title:"宕机恢复",frontmatter:{}}},95895:function(e,n,r){r.d(n,{Z:function(){return l}});var t=r(85893),i=r(67294),c=r(45687);r(6175);let s={"zh-CN":e=>`预计阅读时间: ${e.minutes>=1?`${Math.ceil(e.minutes)} 分钟`:"小于 1 分钟"}`,"en-US":e=>`Estimated reading time: ${e.minutes>=1?`${Math.ceil(e.minutes)} minutes`:"less than 1 minute"}`};function a(e,n,r){let t=Object.keys(s).includes(n)?n:r;return s[t](e)}let l=e=>{let{defaultLocale:n="en-US"}=e,r=(0,c.Vi)().page.readingTimeData,s=(0,c.Jr)(),l=(0,c.e7)(),[d,u]=(0,i.useState)(a(r,s,n));return(0,i.useEffect)(()=>{u(a(r,s,n))},[s,r]),(0,t.jsx)("span",{"data-dark":String(l),className:"rp-reading-time",children:d})}}}]);