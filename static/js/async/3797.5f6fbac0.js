"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["3797"],{1049:function(n,e,r){r.r(e),r.d(e,{default:()=>j});var s=r("5893"),i=r("65");let c=r.p+"static/image/back.b364c218.gif",d=r.p+"static/image/loop.7fb7a782.png",t=r.p+"static/image/up.2243b699.png",a=r.p+"static/image/scroll-number.ea71ca14.gif",l=r.p+"static/image/pdd.d0536964.gif";function h(n){let e=Object.assign({h1:"h1",a:"a",p:"p",img:"img",h2:"h2",ul:"ul",li:"li",details:"details",summary:"summary",pre:"pre",code:"code",h3:"h3"},(0,i.ah)(),n.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e.h1,{id:"仿拼多多领红包金额数字移动如何实现",children:["仿拼多多领红包、金额数字移动如何实现？",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#仿拼多多领红包金额数字移动如何实现",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"拼多多现金大转盘领取红包后，小数部分有一个数字移动的效果，这个效果怎么做呢？"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:l,alt:""})}),"\n",(0,s.jsx)(e.p,{children:"本文我会告诉你数字移动的原理，并用 React 实现一个 Demo，效果如下："}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:a,alt:""})}),"\n",(0,s.jsx)(e.p,{children:"拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。"}),"\n",(0,s.jsxs)(e.h2,{id:"滚动原理",children:["滚动原理",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#滚动原理",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"不难想到，数字移动，实质是一串数字列表，在容器内部向上移动。下图就展示了数字从 0 变为 2，又从 2 变为 4 的过程："}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:t,alt:""})}),"\n",(0,s.jsx)(e.p,{children:"但是，金额数字比较特殊，它是可以进位的。举例来说，39.5 变为 39.9 时，小数部分由 5 到 9 需要向上移动；39.9 变为 40.2 时，小数部分由 9 变到 2 时也需要向上移动。"}),"\n",(0,s.jsx)(e.p,{children:"为了做到这个效果，我们需要每次滚动结束之后，重新设置一整串数字。"}),"\n",(0,s.jsx)(e.p,{children:"同样是从 0 变为 2，又从 2 变为 4。下图不同的是，数字变为 2 时，它下方的数字变为了 3、4、5、6、7、8、9、0、1；数字变为 4 时，它下方的数字变为了 5、6、7、8、9、0、1、2、3。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:d,alt:""})}),"\n",(0,s.jsxs)(e.h2,{id:"关键布局",children:["关键布局",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#关键布局",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"了解原理后，我们开始写元素布局。关键布局有 2 个元素："}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"选择框，它可以确认下一个将要变成的数字，我们用它来模拟领取红包之后、金额变化的情况。"}),"\n",(0,s.jsx)(e.li,{children:"数字盒子，它包括三部分，带 overflow: hidden 的外层盒子，包裹数字并向上滚动的内层盒子，以及一个个数字。"}),"\n"]}),"\n",(0,s.jsxs)("details",{children:[(0,s.jsx)("summary",{children:"点击查看代码"}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-jsx",children:'const App = function () {\r\n  const [options] = useState([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])\r\n  const [nums, setNums] = useState([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])\r\n\r\n  return (\r\n    <main>\r\n      <div className="select-box">\r\n        <span>改变数字：</span>\r\n        <select>\r\n          {\r\n            options.map(v => (\r\n              <option key={v}>{v}</option>\r\n            ))\r\n          }\r\n        </select>\r\n      </div>\r\n      <div className="num-box">\r\n        <div>\r\n          {\r\n            nums.map(v => (\r\n              <div className="num" key={v}>{v}</div>\r\n            ))\r\n          }\r\n        </div>\r\n      </div>\r\n    </main>\r\n  )\r\n};\n'})})]}),"\n",(0,s.jsxs)(e.h2,{id:"关键逻辑",children:["关键逻辑",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#关键逻辑",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"数字移动的关键逻辑有 3 个："}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"重置数字数组"}),"\n",(0,s.jsx)(e.li,{children:"计算移动距离"}),"\n",(0,s.jsx)(e.li,{children:"开启关闭动画"}),"\n"]}),"\n",(0,s.jsxs)(e.h3,{id:"重置数字数组",children:["重置数字数组",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#重置数字数组",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"你之前已经知道，如果数组首位是 2，它下面的数字就是 3、4、5、6、7、8、9、0、1。要获取完整的数组，我们可以分为两个步骤："}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"首先，数组首位背后的数字依次加 1，这样数字就变为了 3、4、5、6、7、8、9、10、11；"}),"\n",(0,s.jsx)(e.li,{children:"然后，所有大于 9 的数字都减去 10，这样数字就变为了 3、4、5、6、7、8、9、0、1。"}),"\n"]}),"\n",(0,s.jsxs)("details",{children:[(0,s.jsx)("summary",{children:"点击查看代码"}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"const getNewNums = (next) => {\r\n  const newNums = []\r\n  for (let i = next; i < next + 10; i++) {\r\n    const item = i > 9 ? (i - 10) : i\r\n    newNums.push(item)\r\n  }\r\n  return newNums\r\n}\n"})})]}),"\n",(0,s.jsxs)(e.h3,{id:"计算移动距离",children:["计算移动距离",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#计算移动距离",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"你可以用 current 表示当前的数字，next 表示需要变成的数字。计算移动距离时，需要分两种情况考虑："}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["next 大于 current 时，只需要移动 ",(0,s.jsx)(e.code,{children:"next - current"})," 个数字即可；"]}),"\n",(0,s.jsxs)(e.li,{children:["next 小于 current 时，需要先移动 ",(0,s.jsx)(e.code,{children:"10 - next"})," 个数字，再移动 current 个数字即可。"]}),"\n"]}),"\n",(0,s.jsxs)("details",{children:[(0,s.jsx)("summary",{children:"点击查看代码"}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"const calculateDistance = (current, next) => {\r\n  const height = 40\r\n  let diff = next - current\r\n  if (next < current) {\r\n    diff = 10 - current + next\r\n  }\r\n  return -(diff * height)\r\n}\n"})})]}),"\n",(0,s.jsxs)(e.h3,{id:"开启关闭动画",children:["开启关闭动画",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#开启关闭动画",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"不难想到，我们数字移动的动画是使用 translateY 和 transition 实现。当数字移动时，我们把 translateY 设置为 calculateDistance 的结果；当移动结束、重置数组时，我们需要把 translateY 设置为 0。"}),"\n",(0,s.jsx)(e.p,{children:"整个过程中，如果我们一直开启动画，效果会是数字先向上移动，再向下移动，这并不符合预期。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:c,alt:""})}),"\n",(0,s.jsx)(e.p,{children:"因此，我们需要在数字开始移动时开启动画，数字结束移动后、重置数组前关闭动画。"}),"\n",(0,s.jsxs)("details",{children:[(0,s.jsx)("summary",{children:"点击查看代码"}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-jsx",children:"const App = function () {\r\n  // ... 省略\r\n  const numBoxRef = useRef()\r\n\r\n  const onChange = (e) => {\r\n    // 开启动画\r\n    numBoxRef.current.style.transition = `all 1s`\r\n    // ... 省略\r\n  }\r\n\r\n  const onTransitionEnd = () => {\r\n    // 关闭动画\r\n    numBoxRef.current.style.transition = ''\r\n    // ... 省略\r\n  }\r\n\r\n  return (\r\n    <main>{/* ... 省略 */}</main>\r\n  )\r\n};\n"})})]}),"\n",(0,s.jsxs)(e.h2,{id:"完整代码",children:["完整代码",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#完整代码",children:"#"})]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["codesandbox: ",(0,s.jsx)(e.a,{href:"https://codesandbox.io/p/sandbox/basic-scroll-number-4k65c7",target:"_blank",rel:"noopener noreferrer",children:"https://codesandbox.io/p/sandbox/basic-scroll-number-4k65c7"})]}),"\n",(0,s.jsxs)(e.li,{children:["码上掘金：",(0,s.jsx)(e.a,{href:"https://code.juejin.cn/pen/7430439231253643273",target:"_blank",rel:"noopener noreferrer",children:"https://code.juejin.cn/pen/7430439231253643273"})]}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"总结",children:["总结",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"本文介绍了类似拼多多的金额数字滚动如何实现，其中有三个关键点，分别是重置数字数组、计算移动距离和开启关闭动画。"}),"\n",(0,s.jsx)(e.p,{children:"拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。"})]})}function x(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,i.ah)(),n.components);return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(h,{...n})}):h(n)}let j=x;x.__RSPRESS_PAGE_META={},x.__RSPRESS_PAGE_META["blog%2F2024-10-27-scroll-number%2Findex.mdx"]={toc:[{text:"滚动原理",id:"滚动原理",depth:2},{text:"关键布局",id:"关键布局",depth:2},{text:"关键逻辑",id:"关键逻辑",depth:2},{text:"重置数字数组",id:"重置数字数组",depth:3},{text:"计算移动距离",id:"计算移动距离",depth:3},{text:"开启关闭动画",id:"开启关闭动画",depth:3},{text:"完整代码",id:"完整代码",depth:2},{text:"总结",id:"总结",depth:2}],title:"仿拼多多领红包、金额数字移动如何实现？",frontmatter:{}}}}]);