"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["9912"],{36656:function(e,n,r){r.r(n),r.d(n,{default:()=>c});var s=r("85893"),i=r("50065");let t=r.p+"static/image/mdbook1.0edb16ea.png",l=r.p+"static/image/mdbook2.99f3d018.png",a=r.p+"static/image/mdbook3.55df836a.png",d=r.p+"static/image/mdbook4.ae03f808.png";function o(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",ol:"ol",li:"li",img:"img",code:"code",pre:"pre"},(0,i.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"mdbook",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#mdbook",children:"#"}),"mdbook"]}),"\n",(0,s.jsxs)(n.h2,{id:"github-pages",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#github-pages",children:"#"}),"GitHub Pages"]}),"\n",(0,s.jsx)(n.p,{children:"通过使用 GitHub Actions 的 workflow（工作流）的模板，我们可以快速部署网站到 github.io 域名下。"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"GitHub 仓库中，选择 Settings -> Pages -> GitHub Actions -> browse all workflows"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"点击 Pages 右侧的 View all 按钮"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:l})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"选择 mdBook，点击 Configure 按钮"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:a})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsx)(n.li,{children:"之后 GitHub 会自动创建一个 yml 文件"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:d})}),"\n",(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsxs)(n.li,{children:["我们可以将整个仓库克隆到本地，按照 ",(0,s.jsx)(n.a,{href:"https://rust-lang.github.io/mdBook/",target:"_blank",rel:"noopener noreferrer",children:"mdBook 官方指南"})," 的指导书写 Markdown 文件。当我们提交后，会自动触发 GitHub Actions 将网站部署到 GitHub Pages 下。"]}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"github-issues",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#github-issues",children:"#"}),"GitHub Issues"]}),"\n",(0,s.jsxs)(n.p,{children:["mdBook 本身并不支持评论，但我们可以使用 ",(0,s.jsx)(n.a,{href:"https://utteranc.es/",target:"_blank",rel:"noopener noreferrer",children:"utterances"})," 这个评论插件，很方便快捷地添加评论功能。"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["在 GitHub 新建一个用于评论的仓库。比如我单独新建了一个 ",(0,s.jsx)(n.a,{href:"https://github.com/lijunlin2022/blog-issues",target:"_blank",rel:"noopener noreferrer",children:"blog-issues"})]}),"\n",(0,s.jsxs)(n.li,{children:["访问 ",(0,s.jsx)(n.a,{href:"https://github.com/apps/utterances",target:"_blank",rel:"noopener noreferrer",children:"utterances 的配置界面"})," ，点击 ",(0,s.jsx)(n.code,{children:"Configure"}),"，然后选择用于评论的仓库。"]}),"\n",(0,s.jsxs)(n.li,{children:["在 mdBook 的 Markdown 文件底部，加入一段 script 代码。我们只需要填写 ",(0,s.jsx)(n.code,{children:"repo"}),"（仓库名）和 ",(0,s.jsx)(n.code,{children:"issue-term"}),"（issue 分组，可以直接写文章名）。"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",meta:"",children:'<script\r\n  src="https://utteranc.es/client.js"\r\n  repo="lijunlin2022/blog-issues"\r\n  issue-term="mdbook-github-issues"\r\n  theme="github-light"\r\n  crossorigin="anonymous"\r\n  async\r\n>\r\n<\/script>\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"中文搜索",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#中文搜索",children:"#"}),"中文搜索"]}),"\n",(0,s.jsx)(n.p,{children:"mdBook 生成的文档和书记，默认只支持英文搜索，其实我们只需要几个简单的配置，就可以让 mdBook 生成的 HTML 支持中文搜索。"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"新建一个和 src 同级的文件夹 assets。"}),"\n",(0,s.jsxs)(n.li,{children:["将 ",(0,s.jsx)(n.a,{href:"https://gist.github.com/lijunlin2022/1a9d90b078422192b51392c92e3a9dba",target:"_blank",rel:"noopener noreferrer",children:"fzf.umd.js"})," 和 ",(0,s.jsx)(n.a,{href:"https://gist.github.com/lijunlin2022/1a9d90b078422192b51392c92e3a9dba",target:"_blank",rel:"noopener noreferrer",children:"elasticlunr.js"})," 文件放到 assets 目录下。"]}),"\n",(0,s.jsx)(n.li,{children:"在 book.toml 的配置中添加配置"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{meta:"",children:'[output.html]\r\nadditional-js = ["assets/fzf.umd.js", "assets/elasticlunr.js"]\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"mermaid",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#mermaid",children:"#"}),"mermaid"]}),"\n",(0,s.jsx)(n.p,{children:"mdbook 默认并不支持使用 mermaid 画图。我们可以通过安装插件的方式，让 mdbook 支持这个功能。"}),"\n",(0,s.jsx)(n.p,{children:"（1）安装 mdbook-mermaid"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{meta:"",children:"cargo install mdbook-mermaid\n"})}),"\n",(0,s.jsx)(n.p,{children:"（2）在 book.toml 中可以添加如下配置。"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",meta:"",children:'[preprocessor.mermaid]\r\ncommand = "mdbook-mermaid"\r\n\r\n[output.html]\r\nadditional-js = ["assets/mermaid.min.js", "assets/mermaid-init.js"]\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/badboy/mdbook-mermaid",target:"_blank",rel:"noopener noreferrer",children:"mdbook-mermaid"})," 是一个开源插件。"]}),"\n",(0,s.jsx)(n.p,{children:"（3）拷贝 mermaid 到与 src 同级的 assets 文件夹中。"}),"\n",(0,s.jsx)(n.p,{children:"mermaid-init.js 用来初始化 mermaid，内容为："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",meta:"",children:"mermaid.initialize({ startOnLoad: true });\n"})}),"\n",(0,s.jsxs)(n.p,{children:["至于 mermaid.min.js，可以去 ",(0,s.jsx)(n.a,{href:"https://mermaid.js.org/",target:"_blank",rel:"noopener noreferrer",children:"mermaid 官网"}),"，找到它的 ",(0,s.jsx)(n.a,{href:"https://cdn.jsdelivr.net/npm/mermaid@10.2.0/dist/mermaid.min.js",target:"_blank",rel:"noopener noreferrer",children:"CDN 地址"})," 拷贝。"]}),"\n",(0,s.jsxs)(n.p,{children:["之后重新运行 ",(0,s.jsx)(n.code,{children:"mdbook serve"})," 命令，就可以看到 mdbook 已经支持 mermaid 画图功能了。"]}),"\n",(0,s.jsx)(n.p,{children:"(4) 更新部署脚本"}),"\n",(0,s.jsx)(n.p,{children:"如果你和我一样，使用的是 GitHub Pages 部署博客，那么你需要更改 yml。"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yml",meta:"",children:"jobs:\r\n  # Build job\r\n  build:\r\n    runs-on: ubuntu-latest\r\n    env:\r\n      MDBOOK_VERSION: 0.4.21\r\n    steps:\r\n      - uses: actions/checkout@v3\r\n      - name: Install mdBook\r\n        run: |\r\n          curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf -y | sh\r\n          rustup update\r\n          cargo install --version ${MDBOOK_VERSION} mdbook\r\n          cargo install mdbook-mermaid\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"404",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#404",children:"#"}),"404"]}),"\n",(0,s.jsx)(n.p,{children:"我们可以给网站设置 404 页面，这样当用户访问到网站不存在的链接时，会跳转到 404 页面，提高用户的体验。"}),"\n",(0,s.jsx)(n.p,{children:"默认情况下，mdBook 只需要在 src 目录下添加 404.md，404 页面便会显示 404.md 的内容。"}),"\n",(0,s.jsx)(n.p,{children:"我们也可以通过修改 book.toml 中的配置，改变 404 页面的路径："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",meta:"",children:'[output.html]\r\ninput-404 = "404.md"\n'})}),"\n",(0,s.jsx)(n.p,{children:"除此之外，我们还需要设置 site-url，site-url 一般设置为网站的根路径，确保 404 页面也能正常获取脚本和样式文件。"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",meta:"",children:'[output.html]\r\nsite-url = "https://lijunlin2022.github.io/blog/"\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"sitemap",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#sitemap",children:"#"}),"sitemap"]}),"\n",(0,s.jsxs)(n.p,{children:["如果我们能够给搜索引擎提供 ",(0,s.jsx)(n.a,{href:"https://developers.google.com/search/docs/crawling-indexing/sitemaps/build-sitemap?hl=zh-cn",target:"_blank",rel:"noopener noreferrer",children:"sitemap.xml"}),"，那么它抓取 mdbook 生成的网站就会更加快速。"]}),"\n",(0,s.jsx)(n.p,{children:"目前 mdbook 没有提供生成 sitemap.xml 的插件，但是我们可以使用 node.js 的插件。"}),"\n",(0,s.jsxs)(n.p,{children:["这里我选中了一款插件，名叫 ",(0,s.jsx)(n.a,{href:"https://github.com/zerodevx/static-sitemap-cli",target:"_blank",rel:"noopener noreferrer",children:"static-sitemap-cli"}),"。"]}),"\n",(0,s.jsx)(n.p,{children:"我们只需要简单的两个步骤，就可以生成自己的 sitemap.xml。"}),"\n",(0,s.jsx)(n.p,{children:"（1）安装 static-sitemap-cli"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{meta:"",children:"npm install static-sitemap-cli\n"})}),"\n",(0,s.jsx)(n.p,{children:"（2）生成站点地图到 book 文件夹下"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{meta:"",children:"npx sscli --base https://lijunlin2022.github.io/blog/ -r book\n"})}),"\n",(0,s.jsx)(n.p,{children:"这样便完成了。"}),"\n",(0,s.jsx)(n.p,{children:"不过，我的最终目的是，每当我有新博客提交时，都会自动更新 sitemap.xml 并部署，因此我需要改造一下原有的 yml 文件。"}),"\n",(0,s.jsxs)(n.p,{children:["具体可以参考 ",(0,s.jsx)(n.a,{href:"https://github.com/lijunlin2022/blog/blob/main/.github/workflows/mdbook.yml",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/lijunlin2022/blog/blob/main/.github/workflows/mdbook.yml"}),"。"]}),"\n",(0,s.jsxs)(n.p,{children:["以我的博客为例，访问 ",(0,s.jsx)(n.a,{href:"https://lijunlin2022.github.io/blog/sitemap.xml",target:"_blank",rel:"noopener noreferrer",children:"https://lijunlin2022.github.io/blog/sitemap.xml"})," 便可以看到 sitemap.xml 文件了。"]})]})}function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(o,e)})):o(e)}let c=h;h.__RSPRESS_PAGE_META={},h.__RSPRESS_PAGE_META["zh%2Fdocs%2Fmdbook%2Findex.md"]={toc:[{id:"github-pages",text:"GitHub Pages",depth:2},{id:"github-issues",text:"GitHub Issues",depth:2},{id:"中文搜索",text:"中文搜索",depth:2},{id:"mermaid",text:"mermaid",depth:2},{id:"404",text:"404",depth:2},{id:"sitemap",text:"sitemap",depth:2}],title:"mdbook",frontmatter:{}}}}]);