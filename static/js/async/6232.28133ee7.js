"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["6232"],{96489:function(r,e,n){n.r(e),n.d(e,{default:function(){return c}});var i=n(85893),t=n(50065),s=n(95895);function a(r){let e=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",code:"code",pre:"pre"},(0,t.ah)(),r.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(e.h1,{id:"错误",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#错误",children:"#"}),"错误"]}),"\n",(0,i.jsx)(s.Z,{defaultLocale:"zh-CN"}),"\n",(0,i.jsxs)(e.h2,{id:"错误处理",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#错误处理",children:"#"}),"错误处理"]}),"\n",(0,i.jsx)(e.p,{children:"一般如果 go 语言的函数可能发生错误，那么它会有两个返回值，第一个返回值是正常返回值，第二个返回值就是错误。"}),"\n",(0,i.jsxs)(e.p,{children:["如果发生错误时，第二个返回值不再时 ",(0,i.jsx)(e.code,{children:"nil"}),"，而是一个错误类型的数据，需要我们加以处理。"]}),"\n",(0,i.jsx)(e.p,{children:"比如打开文件时，文件可能打开失败。"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",meta:"",children:'func main() {\r\n  f, err := os.OpenFile("./song.txt", os.O_WRONLY|os.O_CREATE, 0666)\r\n  if err != nil {\r\n    fmt.Println("文件打开失败")\r\n    return\r\n  }\r\n  defer f.Close()\r\n}\n'})}),"\n",(0,i.jsxs)(e.h2,{id:"自定义错误",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#自定义错误",children:"#"}),"自定义错误"]}),"\n",(0,i.jsxs)(e.p,{children:["如果编写一个函数，函数内部可能发生错误，你最好让函数的返回值中也包含错误。为此，你需要用到 ",(0,i.jsx)(e.code,{children:"errors.New()"})," 来创建错误。"]}),"\n",(0,i.jsx)(e.p,{children:"比如创建一个除法函数，你需要考虑除数为 0 时发生错误的情况。"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",meta:"",children:'var errDivByZero = errors.New("除数不能为 0")\r\n\r\nfunc div(dividend, divisor int) (int, error) {\r\n  if divisor == 0 {\r\n    return 0, errDivByZero\r\n  }\r\n\r\n  return dividend / divisor, nil\r\n}\r\n\r\nfunc main() {\r\n  res, err := div(1, 0)\r\n  if err != nil {\r\n    fmt.Println(err) // 除数不能为 0\r\n    return\r\n  }\r\n  fmt.Println(res)\r\n}\n'})}),"\n",(0,i.jsxs)(e.h2,{id:"自定义信息更丰富的错误",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#自定义信息更丰富的错误",children:"#"}),"自定义信息更丰富的错误"]}),"\n",(0,i.jsxs)(e.p,{children:["使用 ",(0,i.jsx)(e.code,{children:"errors.New()"})," 创建的字符串信息，无法携带更多信息。但很多时候，为了方便排查报错，你可以自定义结构体实现错误接口。"]}),"\n",(0,i.jsx)(e.p,{children:"比如创建一个解析文件错误，你需要告诉用户出错的文件名和行号。"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",meta:"",children:'type ParseError struct {\r\n  Filename string\r\n  Line     int\r\n}\r\n\r\nfunc (e *ParseError) Error() string {\r\n  return fmt.Sprintf("%s:%d", e.Filename, e.Line)\r\n}\r\n\r\nfunc newParserError(filename string, line int) error {\r\n  return &ParseError{filename, line}\r\n}\r\n\r\nfunc main() {\r\n  e := newParserError("song.txt", 1)\r\n\r\n  // 通过 error 接口查看错误描述\r\n  fmt.Println(e.Error())\r\n\r\n  // 根据接口具体的类型，获取详细错误信息\r\n\r\n  switch detail := e.(type) {\r\n  case *ParseError:\r\n    fmt.Printf("Filename: %s Line: %d\\n", detail.Filename, detail.Line)\r\n  default:\r\n    fmt.Println("other error")\r\n  }\r\n}\n'})})]})}function d(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,t.ah)(),r.components);return e?(0,i.jsx)(e,Object.assign({},r,{children:(0,i.jsx)(a,r)})):a(r)}let c=d;d.__RSPRESS_PAGE_META={},d.__RSPRESS_PAGE_META["docs%2Fgo%2F12-error.md"]={toc:[{id:"错误处理",text:"错误处理",depth:2},{id:"自定义错误",text:"自定义错误",depth:2},{id:"自定义信息更丰富的错误",text:"自定义信息更丰富的错误",depth:2}],title:"错误",frontmatter:{}}},95895:function(r,e,n){n.d(e,{Z:function(){return c}});var i=n(85893),t=n(67294),s=n(45687);n(6175);let a={"zh-CN":r=>`预计阅读时间: ${r.minutes>=1?`${Math.ceil(r.minutes)} 分钟`:"小于 1 分钟"}`,"en-US":r=>`Estimated reading time: ${r.minutes>=1?`${Math.ceil(r.minutes)} minutes`:"less than 1 minute"}`};function d(r,e,n){let i=Object.keys(a).includes(e)?e:n;return a[i](r)}let c=r=>{let{defaultLocale:e="en-US"}=r,n=(0,s.Vi)().page.readingTimeData,a=(0,s.Jr)(),c=(0,s.e7)(),[l,h]=(0,t.useState)(d(n,a,e));return(0,t.useEffect)(()=>{h(d(n,a,e))},[a,n]),(0,i.jsx)("span",{"data-dark":String(c),className:"rp-reading-time",children:l})}}}]);