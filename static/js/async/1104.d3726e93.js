"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["1104"],{4983:function(n,e,i){i.r(e),i.d(e,{default:()=>o});var r=i("5893"),t=i("65");let s=i.p+"static/image/no-overflow-with-comment.4e823473.png",c=i.p+"static/image/block-out.73df8587.png",d=i.p+"static/image/loop-notice.94ca7aa4.gif",l=i.p+"static/image/toutiao.cfe195a6.gif";function h(n){let e=Object.assign({h1:"h1",a:"a",p:"p",img:"img",h2:"h2",ul:"ul",li:"li",code:"code",pre:"pre"},(0,t.ah)(),n.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(e.h1,{id:"仿今日头条h5-循环播放的通知栏如何实现",children:["仿今日头条，H5 循环播放的通知栏如何实现？",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#仿今日头条h5-循环播放的通知栏如何实现",children:"#"})]}),"\n",(0,r.jsx)(e.p,{children:"我们在各大 App 活动页面，经常会看到循环播放的通知栏。比如春节期间，我就在今日头条 App 中看到了如下通知：「春节期间，部分商品受物流影响延迟发货，请耐心等待，祝你新春快乐！」。"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)("img",{src:l,alt:""})}),"\n",(0,r.jsx)(e.p,{children:"那么，这种循环播放的通知栏如何实现呢？本文我会先介绍它的布局、再介绍它的逻辑，并给出完整的代码。最终我实现的效果如下："}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)("img",{src:d,alt:""})}),"\n",(0,r.jsx)(e.p,{children:"拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。"}),"\n",(0,r.jsxs)(e.h2,{id:"布局代码",children:["布局代码",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#布局代码",children:"#"})]}),"\n",(0,r.jsx)(e.p,{children:"我们先看布局，如下图所示，循环播放的布局不是普通的左中右布局。可以看到，当文字向左移动时，左边的通知 Icon 和右边的留白会把文字挡住一部分。"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)("img",{src:c,alt:""})}),"\n",(0,r.jsx)(e.p,{children:"为了实现这样的效果，我们给容器 box 设置一个相对定位，并把 box 中的 HTML 代码分为三部分："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"第一部分是 content，它包裹着需要循环播放的文字；"}),"\n",(0,r.jsxs)(e.li,{children:["第二部分是 left，它是左边的通知 Icon，我们给它设置绝对定位和 ",(0,r.jsx)(e.code,{children:"left: 0;"}),"；"]}),"\n",(0,r.jsxs)(e.li,{children:["第三部分是 right，它是右边的留白，我们给它设置绝对定位和 ",(0,r.jsx)(e.code,{children:"right: 0;"}),"。"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-html",children:'<div class="box">\r\n  <div class="content">\r\n    \x3c!-- ... 省略 --\x3e\r\n  </div>\r\n  <div class="left">\uD83D\uDD14</div>\r\n  <div class="right"></div>\r\n</div>\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-css",children:".box {\r\n  position: relative;\r\n  overflow: hidden;\r\n  /* ... 省略 */\r\n}\r\n.left {\r\n  position: absolute;\r\n  left: 0;\r\n  /* ... 省略 */\r\n}\r\n.right {\r\n  position: absolute;\r\n  right: 0;\r\n  /* ... 省略 */\r\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"现在我们来看包裹文字的 content。content 内部包裹了三段一模一样的文字 notice，每段 notice 之间还有一个 space 元素作为间距。"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-html",children:'\x3c!-- ... 省略 --\x3e\r\n<div id="content">\r\n  <div class="notice">春节期间，部分商品...</div>\r\n  <div class="space"></div>\r\n  <div class="notice">春节期间，部分商品...</div>\r\n  <div class="space"></div>\r\n  <div class="notice">春节期间，部分商品...</div>\r\n</div>\r\n\x3c!-- ... 省略 --\x3e\n'})}),"\n",(0,r.jsx)(e.p,{children:"为什么要放置三段一模一样的文字呢？这和循环播放的逻辑有关。"}),"\n",(0,r.jsxs)(e.h2,{id:"逻辑代码",children:["逻辑代码",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#逻辑代码",children:"#"})]}),"\n",(0,r.jsx)(e.p,{children:"我们并没有实现真正的循环播放，而是欺骗了用户的视觉。如下图所示："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"播放通知时，content 从 0 开始向左移动。"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["向左移动 ",(0,r.jsx)(e.code,{children:"2 * noticeWidth + spaceWidth"})," 时，继续向左移动便会露馅。因为第 3 段文字后不会有第 4 段文字。"]}),"\n",(0,r.jsxs)(e.p,{children:["如果我们把 content 向左移动的距离强行从 ",(0,r.jsx)(e.code,{children:"2 * noticeWidth + spaceWidth"})," 改为 ",(0,r.jsx)(e.code,{children:"noticeWidth"}),"，不难看出，用户在 box 可视区域内看到的情况基本一致的。"]}),"\n",(0,r.jsxs)(e.p,{children:["然后 content 继续向左移动，向左移动的距离大于等于 ",(0,r.jsx)(e.code,{children:"2 * noticeWidth + spaceWidth"})," 时，就把距离重新设为 ",(0,r.jsx)(e.code,{children:"noticeWidth"}),"。循环往复，就能欺骗用户视觉，让用户认为 content 能无休无止向左移动。"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)("img",{src:s,alt:""})}),"\n",(0,r.jsx)(e.p,{children:"欺骗视觉的代码如下："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"我们通过修改 translateX，让 content 不断地向左移动，每次向左移动 1.5px；"}),"\n",(0,r.jsxs)(e.li,{children:["当 ",(0,r.jsx)(e.code,{children:"translateX >= noticeWidth * 2 + spaceWidth"})," 时，我们又会把 translateX 强制设为 ",(0,r.jsx)(e.code,{children:"noticeWidth"}),"；"]}),"\n",(0,r.jsx)(e.li,{children:"为了保证移动动画更丝滑，我们并没有采用 setInterval，而是使用 requestAnimationFrame。"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:'const content = document.getElementById("content");\r\nconst notice = document.getElementsByClassName("notice");\r\nconst space = document.getElementsByClassName("space");\r\nconst noticeWidth = notice[0].offsetWidth;\r\nconst spaceWidth = space[0].offsetWidth;\r\n\r\nlet translateX = 0;\r\nfunction move() {\r\n  translateX += 1.5;\r\n  if (translateX >= noticeWidth * 2 + spaceWidth) {\r\n    translateX = noticeWidth;\r\n  }\r\n  content.style.transform = `translateX(${-translateX}px)`;\r\n  requestAnimationFrame(move);\r\n}\r\n\r\nmove();\n'})}),"\n",(0,r.jsxs)(e.h2,{id:"完整代码",children:["完整代码",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#完整代码",children:"#"})]}),"\n",(0,r.jsx)(e.p,{children:"完整代码如下，你可以在 codepen 或者码上掘金上查看。"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["codepen: ",(0,r.jsx)(e.a,{href:"https://codepen.io/lijunlin2022/pen/rNgMrwg",target:"_blank",rel:"noopener noreferrer",children:(0,r.jsx)(e.a,{href:"https://codepen.io/lijunlin2022/pen/rNgMrwg",target:"_blank",rel:"noopener noreferrer",children:"https://codepen.io/lijunlin2022/pen/rNgMrwg"})})]}),"\n",(0,r.jsxs)(e.li,{children:["码上掘金: ",(0,r.jsx)(e.a,{href:"https://code.juejin.cn/pen/7373131233506623538",target:"_blank",rel:"noopener noreferrer",children:(0,r.jsx)(e.a,{href:"https://code.juejin.cn/pen/7373131233506623538",target:"_blank",rel:"noopener noreferrer",children:"https://code.juejin.cn/pen/7373131233506623538"})})]}),"\n"]}),"\n",(0,r.jsxs)(e.h2,{id:"总结",children:["总结",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,r.jsx)(e.p,{children:"本文我介绍了如何用 H5 实现循环播放的通知栏："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"布局方面，我们需要用绝对定位的通知 Icon、留白挡住循环文字的左侧和右侧；此外，循环播放的文字我们额外复制 2 份。"}),"\n",(0,r.jsxs)(e.li,{children:["逻辑方面，通知栏向左移动 ",(0,r.jsx)(e.code,{children:"2 * noticeWidth + spaceWidth"})," 后，我们需要强制把通知栏向左移动的距离从 ",(0,r.jsx)(e.code,{children:"2 * noticeWidth + spaceWidth"})," 变为 ",(0,r.jsx)(e.code,{children:"noticeWidth"}),"，以此来欺骗用户视觉。"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。"})]})}function a(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,t.ah)(),n.components);return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(h,{...n})}):h(n)}let o=a;a.__RSPRESS_PAGE_META={},a.__RSPRESS_PAGE_META["blog%2F2024%2F05%2F26%2Findex.md"]={toc:[{text:"布局代码",id:"布局代码",depth:2},{text:"逻辑代码",id:"逻辑代码",depth:2},{text:"完整代码",id:"完整代码",depth:2},{text:"总结",id:"总结",depth:2}],title:"仿今日头条，H5 循环播放的通知栏如何实现？",frontmatter:{}}}}]);