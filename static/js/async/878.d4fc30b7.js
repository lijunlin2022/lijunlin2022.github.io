"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["878"],{7839:function(n,r,e){e.r(r),e.d(r,{default:()=>g});var i=e("5893"),c=e("65");let s=e.p+"static/image/base-rotate.a52e1913.gif",d=e.p+"static/image/rotate.67336c1f.gif",t=e.p+"static/image/rect-to-circle.f84099f7.png",l=e.p+"static/image/6-rect.bedcb6b4.png",a=e.p+"static/image/2-rect.7c07ce10.png",A=e.p+"static/image/lottery-turntable.9f89e7d4.gif",h=e.p+"static/image/pdd.03e78799.gif";function o(n){let r=Object.assign({h1:"h1",a:"a",p:"p",img:"img",h2:"h2",ul:"ul",li:"li",code:"code",pre:"pre",h3:"h3",h4:"h4"},(0,c.ah)(),n.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.h1,{id:"仿拼多多现金大转盘h5-抽奖转盘如何实现",children:["仿拼多多现金大转盘，H5 抽奖转盘如何实现？",(0,i.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#仿拼多多现金大转盘h5-抽奖转盘如何实现",children:"#"})]}),"\n",(0,i.jsx)(r.p,{children:"电商应用中我们常常看到抽奖转盘活动，比如拼多多的「抽奖大转盘」：点击中央的抽奖按钮，转盘开始旋转，一段时间后指针停止在奖品上。"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)("img",{src:h,alt:""})}),"\n",(0,i.jsx)(r.p,{children:"这个效果如果用 H5 应该怎么实现呢？"}),"\n",(0,i.jsx)(r.p,{children:"本文我会先说明如何实现转盘布局，再介绍如何让转盘旋转，接着解释如何控制中奖概率，最后给出完整的代码，并做一个总结。最终效果如下："}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)("img",{src:A,alt:""})}),"\n",(0,i.jsx)(r.p,{children:"拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。"}),"\n",(0,i.jsxs)(r.h2,{id:"css-旋转相关的语法",children:["CSS 旋转相关的语法",(0,i.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#css-旋转相关的语法",children:"#"})]}),"\n",(0,i.jsx)(r.p,{children:"实现转盘布局之前，我们先来复习 CSS 与旋转有关的语法。"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"transform"})," 的 ",(0,i.jsx)(r.code,{children:"rotate()"})," 函数可以控制旋转角度。比如 ",(0,i.jsx)(r.code,{children:"transform: rotate(60deg);"})," 是顺时针旋转 60 度，",(0,i.jsx)(r.code,{children:"transform: rotate(-60deg);"})," 是逆时针旋转 60 度。"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"transform-origin"})," 可以控制旋转中心。比如 ",(0,i.jsx)(r.code,{children:"transform-origin: right bottom;"})," 是以元素右下角为旋转中心。"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"举个例子，下面代码中 item0 和 item1 两个矩形以自己的右下角为中心，逆时针旋转了 0 度和 60 度。"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-html",children:'<style>\r\n  .item0 {\r\n    ...\r\n    transform-origin: right bottom;\r\n    transform: rotate(-0deg);\r\n  }\r\n  .item1 {\r\n    ...\r\n    transform-origin: right bottom;\r\n    transform: rotate(-60deg);\r\n  }\r\n</style>\r\n<div id="box">\r\n  <div class="item0"></div>\r\n  <div class="item1"></div>\r\n</div>\n'})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)("img",{src:a,alt:""})}),"\n",(0,i.jsxs)(r.h2,{id:"转盘的布局",children:["转盘的布局",(0,i.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#转盘的布局",children:"#"})]}),"\n",(0,i.jsxs)(r.h3,{id:"有问题的思路",children:["有问题的思路",(0,i.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#有问题的思路",children:"#"})]}),"\n",(0,i.jsx)(r.p,{children:"复习完语法，你可能会想 6 个矩形围着自己右下角旋转，似乎能实现转盘布局。"}),"\n",(0,i.jsxs)(r.p,{children:["代码如下，其中 ",(0,i.jsx)(r.code,{children:"--i"})," 和 ",(0,i.jsx)(r.code,{children:"--clr"})," 是 CSS 的变量，方便我们计算角度、获取颜色。"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-html",children:'<style>\r\n  ...\r\n  .item {\r\n    ...\r\n    background-color: var(--clr);\r\n    transform-origin: right bottom;\r\n    transform: rotate(calc(60deg * var(--i)));\r\n  }\r\n</style>\r\n<div id="box">\r\n  <div class="item" style="--i:0;--clr:#ff7875;"></div>\r\n  <div class="item" style="--i:-1;--clr:#ff9c6e;"></div>\r\n  <div class="item" style="--i:-2;--clr:#ffc069;"></div>\r\n  <div class="item" style="--i:-3;--clr:#d3f261;"></div>\r\n  <div class="item" style="--i:-4;--clr:#95de64;"></div>\r\n  <div class="item" style="--i:-5;--clr:#5cdbd3;"></div>\r\n</div>\n'})}),"\n",(0,i.jsx)(r.p,{children:"但这种思路是有问题的，如图所示，6 个矩形依次逆时针旋转，会导致第 5 个矩形覆盖在第 0 个矩形上，无法实现转盘布局。"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)("img",{src:l,alt:""})}),"\n",(0,i.jsxs)(r.h3,{id:"正确的思路",children:["正确的思路",(0,i.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#正确的思路",children:"#"})]}),"\n",(0,i.jsx)(r.p,{children:"6 个矩形依次逆时针旋转的思路虽然有问题，但也能给我们一些启发。"}),"\n",(0,i.jsx)(r.p,{children:"我们把 6 个矩形拆成左、右两部分："}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["左边是 3 个矩形，以矩形右下角为中心逆时针旋转 0 度、60 度和 120 度，再加上 ",(0,i.jsx)(r.code,{children:"overflow: hidden;"})," 就得到左半圆。"]}),"\n",(0,i.jsxs)(r.li,{children:["右边是 3 个矩形，以矩形左下角为中心顺时针旋转 0 度、60 度和 120 度，再加上 ",(0,i.jsx)(r.code,{children:"overflow: hidden;"})," 就得到右半圆。"]}),"\n",(0,i.jsx)(r.li,{children:"拼接左右两个半圆，就得到一个完整的转盘。"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)("img",{src:t,alt:""})}),"\n",(0,i.jsx)(r.p,{children:"关键代码如下："}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-html",children:'<style>\r\n  .left .item {\r\n    ...\r\n    background-color: var(--clr);\r\n    transform-origin: right bottom;\r\n    transform: rotate(calc(60deg * var(--i)));\r\n  }\r\n  .right .item {\r\n    ...\r\n    background-color: var(--clr);\r\n    transform-origin: left bottom;\r\n    transform: rotate(calc(60deg * var(--i)));\r\n  }\r\n</style>\r\n<div id="box">\r\n  <div class="left">\r\n    <div class="item" style="--i:0;--clr:#ff7875;"></div>\r\n    <div class="item" style="--i:-1;--clr:#ff9c6e;"></div>\r\n    <div class="item" style="--i:-2;--clr:#ffc069;"></div>\r\n  </div>\r\n  <div class="right">\r\n    <div class="item" style="--i:0;--clr:#d3f261;"></div>\r\n    <div class="item" style="--i:1;--clr:#95de64;"></div>\r\n    <div class="item" style="--i:2;--clr:#5cdbd3;"></div>\r\n  </div>\r\n</div>\n'})}),"\n",(0,i.jsxs)(r.h2,{id:"转盘的旋转",children:["转盘的旋转",(0,i.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#转盘的旋转",children:"#"})]}),"\n",(0,i.jsx)(r.p,{children:"我们已知晓转盘的布局如何实现，至于中央按钮和奖品都可以用绝对定位实现，这里我就不再详细说明。一起来看看如何控制转盘的旋转。"}),"\n",(0,i.jsxs)(r.h3,{id:"旋转的原理",children:["旋转的原理",(0,i.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#旋转的原理",children:"#"})]}),"\n",(0,i.jsxs)(r.p,{children:["控制转盘旋转很简单，我们只旋转外层的容器 box 即可。如下图所示，在 Chrome 元素控制台中，我们逐渐增加 ",(0,i.jsx)(r.code,{children:"transform: rotate(0deg)"})," 的取值，就实现了转盘的顺时针旋转。"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)("img",{src:d,alt:""})}),"\n",(0,i.jsx)(r.p,{children:"需要注意的是，当容器 box 旋转时，会带动着中央按钮 btn 一起旋转。为了实现 box 旋转而 btn 保持不变的效果，box 顺时针旋转多少度，我们就需要让中央按钮逆时针旋转多少度。因此后续旋转的 js 代码中，我们会有如下代码："}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:"box.style.transform = `rotate(${begin}deg)`\r\n// translate(-50%, -50%) 是为了让绝对定位的中央按钮居中\r\nbtn.style.transform = `translate(-50%, -50%) rotate(${-begin}deg)`\n"})}),"\n",(0,i.jsxs)(r.h3,{id:"基础代码",children:["基础代码",(0,i.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#基础代码",children:"#"})]}),"\n",(0,i.jsx)(r.p,{children:"现在我给出基础的旋转代码："}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:"const box = document.getElementById('box'),\r\n  btn = document.getElementById('btn')\r\n\r\nbtn.addEventListener('click', () => {\r\n  const randomIndex = parseInt(Math.random() * 6)\r\n  run(randomIndex * 60 + 30)\r\n})\r\n\r\nlet timer = null\r\nfunction run(angle) {\r\n  let begin = 0\r\n  let base = 1800\r\n  timer = setInterval(function () {\r\n    const finalAngle = base + angle\r\n    if (begin >= finalAngle) {\r\n      clearInterval(timer)\r\n    }\r\n    box.style.transform = `rotate(${begin}deg)`\r\n    btn.style.transform = `translate(-50%, -50%) rotate(${-begin}deg)`\r\n    begin += 30\r\n  }, 16)\r\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:"代码主要分为 2 部分，第 1 部分绑定 btn 点击事件，第 2 部分控制 box 和 btn 的旋转。"}),"\n",(0,i.jsx)(r.p,{children:"我们先看第 1 部分，这部分我们会先获取一个 0 ~ 5 的随机下标 randomIndex，利用 randomIndex * 60 来计算旋转的角度（一个奖品扇形区域是 60 度）。之所以要再加上 30 度，是因为我们希望旋转结束之后，指针指向中奖区域的中轴线。"}),"\n",(0,i.jsx)(r.p,{children:"再看第 2 部分，我们设置了 1800 度的基础角度 base（因为 1800 = 360 * 5，也就是至少要旋转 5 圈后才会停止）。又设置了一个计时器，每过 16 秒就旋转 30 度，直到超过目标度数后才停止旋转。"}),"\n",(0,i.jsx)(r.p,{children:"代码的效果如下："}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)("img",{src:s,alt:""})}),"\n",(0,i.jsxs)(r.h3,{id:"改善体验",children:["改善体验",(0,i.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#改善体验",children:"#"})]}),"\n",(0,i.jsx)(r.p,{children:"基础旋转代码虽然实现了效果，但体验还有待改善。主要有两点需要优化。"}),"\n",(0,i.jsxs)(r.h4,{id:"旋转时按钮不能被再次点击",children:["旋转时，按钮不能被再次点击",(0,i.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#旋转时按钮不能被再次点击",children:"#"})]}),"\n",(0,i.jsx)(r.p,{children:"开始旋转时，此时按钮应该不能被再次点击。只有旋转结束后，按钮才能被再次点击，因此我们需要增加一个点击锁 clickLock。关键代码如下："}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:"...\r\nlet clickLock = false\r\n\r\nbtn.addEventListener('click', () => {\r\n  if (clickLock) {\r\n    return\r\n  }\r\n  ...\r\n})\r\n\r\nlet timer = null\r\nfunction run(angle) {\r\n  ...\r\n  clickLock = true\r\n  timer = setInterval(function () {\r\n    ...\r\n    if (begin >= finalAngle) {\r\n      clickLock = false\r\n      clearInterval(timer)\r\n    }\r\n    ...\r\n  }, 10)\r\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:"开始时 clickLock 为 false，转盘旋转时 clickLock 会被置为 true，停止旋转时 clickLock 会被置为 false。这样转盘旋转期间，如果用户继续点击按钮，点击事件会被拦截、不再触发旋转函数 run。"}),"\n",(0,i.jsxs)(r.h4,{id:"旋转时速度需要越来越慢",children:["旋转时，速度需要越来越慢",(0,i.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#旋转时速度需要越来越慢",children:"#"})]}),"\n",(0,i.jsx)(r.p,{children:"基础代码实现的转盘，转盘旋转的速度是恒定的。当旋转结束时，转盘会瞬间停止，这会让用户感觉很突兀。正常来说，转盘的旋转速度应该越来越慢。"}),"\n",(0,i.jsx)(r.p,{children:"旋转速度越来越慢，可以用旋转的角度越来越小简介实现，越来越小的旋转角度可以用下面的公式计算："}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"step = (final - current) * ratio\n"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"current 是已经旋转的角度。"}),"\n",(0,i.jsx)(r.li,{children:"step 是在 current 基础上，下一次转动需要增加的角度。"}),"\n",(0,i.jsx)(r.li,{children:"ratio 是一个比例。"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"从公式中可以看出，随着 current 越来越大，step 会越来越小，也就是下一次转动的角度会越来越小。"}),"\n",(0,i.jsx)(r.p,{children:"我们把公式写成代码，假设每 16ms 需要旋转一定角度，最终要旋转 1800 度："}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:"let current = 0\r\nconst final = 1800\r\nconst ratio = 0.5\r\nlet timer = setInterval(function () {\r\n  if (current >= final) {\r\n    clearInterval(timer)\r\n  }\r\n  const step = (final - current) * ratio\r\n  console.log(step)\r\n  current +=  Math.ceil(step)\r\n}, 16)\n"})}),"\n",(0,i.jsx)(r.p,{children:"此段代码的打印的 step 如下，不难看出 step 变得越来越小了。"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)("img",{src:"data:image/png;base64,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",alt:""})}),"\n",(0,i.jsx)(r.p,{children:"上述代码可以应用到基础代码中，从而让转盘的旋转速度越来越慢。"}),"\n",(0,i.jsxs)(r.h2,{id:"中奖的概率",children:["中奖的概率",(0,i.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#中奖的概率",children:"#"})]}),"\n",(0,i.jsx)(r.p,{children:"之前旋转角度，我们是先获取了 0 ~ 5 之间的一个随机下标（此下标就是奖品的下标），然后计算了旋转角度。这时每个奖品的中奖概率都是 20%。"}),"\n",(0,i.jsx)(r.p,{children:"但抽奖一般都需要控制中奖的概率，这个该怎么实现呢？"}),"\n",(0,i.jsx)(r.p,{children:"在抽奖转盘中，我们可以利用权重的方式控制抽奖概率。"}),"\n",(0,i.jsx)(r.p,{children:"假设我们有 6 个奖项，需要控制奖品 0 ~ 奖品 4 的中奖概率都是 1%，而奖品 5 的中奖概率是 95%，我们应该如何做呢？"}),"\n",(0,i.jsx)(r.p,{children:"控制中奖概率的代码如下所示："}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:"function getRandomIndex() {\r\n  const weights = [0, 1, 2, 3, 4, 100]\r\n  const random = Math.floor(Math.random() * 100)\r\n  const newWeights = weights.concat(random)\r\n                      .sort((a, b) => a - b)\r\n  const randomIndex = newWeights.indexOf(random)\r\n  return randomIndex\r\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:"我们先给出了一个 weights 数组，又获取了一个 100 以内的随机数 random，并对 random 向下取整"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"random 为 0 的概率是 1%，因为小于 1 的数都被向下取整为 0；"}),"\n",(0,i.jsx)(r.li,{children:"random 为 1 的概率是 1%，因为大于 1 小于 2 的数都被向下取整为 1；"}),"\n",(0,i.jsx)(r.li,{children:"random 为 2 的概率是 1%，因为大于 2 小于 3 的数都被向下取整为 2；"}),"\n",(0,i.jsx)(r.li,{children:"random 为 3 的概率是 1%，因为大于 3 小于 4 的数都被向下取整为 3；"}),"\n",(0,i.jsx)(r.li,{children:"random 为 4 的概率是 1%，因为大于 4 小于 5 的数都被向下取整为 4；"}),"\n",(0,i.jsx)(r.li,{children:"random 大于 5 小于 100 的概率则是 95%。"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"我们把 random 插入到 weights 数组中，再从小到大排序，此时 random 对应的下标就是奖品下标。"}),"\n",(0,i.jsxs)(r.h2,{id:"完整代码",children:["完整代码",(0,i.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#完整代码",children:"#"})]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.a,{href:"https://codepen.io/lijunlin2022/pen/YzMdvEL",target:"_blank",rel:"noopener noreferrer",children:"turntable | codepen"})}),"\n",(0,i.jsxs)(r.h2,{id:"总结",children:["总结",(0,i.jsx)(r.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,i.jsx)(r.p,{children:"本文说明了 H5 如何实现抽奖转盘："}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"转盘的布局：布局时要将转盘拆分为左、右两部分，最后合并为一个转盘。"}),"\n",(0,i.jsx)(r.li,{children:"转盘的旋转：改变转盘容器的旋转角度，可以实现转盘的旋转。加载锁，旋转速度越变越慢可以改善转盘的使用体验。"}),"\n",(0,i.jsx)(r.li,{children:"中奖的概率：权重数组可以控制中奖概率。"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。"})]})}function x(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:r}=Object.assign({},(0,c.ah)(),n.components);return r?(0,i.jsx)(r,{...n,children:(0,i.jsx)(o,{...n})}):o(n)}let g=x;x.__RSPRESS_PAGE_META={},x.__RSPRESS_PAGE_META["blog%2F2024-04-17-lottery-turntable%2Findex.md"]={toc:[{text:"CSS 旋转相关的语法",id:"css-旋转相关的语法",depth:2},{text:"转盘的布局",id:"转盘的布局",depth:2},{text:"有问题的思路",id:"有问题的思路",depth:3},{text:"正确的思路",id:"正确的思路",depth:3},{text:"转盘的旋转",id:"转盘的旋转",depth:2},{text:"旋转的原理",id:"旋转的原理",depth:3},{text:"基础代码",id:"基础代码",depth:3},{text:"改善体验",id:"改善体验",depth:3},{text:"旋转时，按钮不能被再次点击",id:"旋转时按钮不能被再次点击",depth:4},{text:"旋转时，速度需要越来越慢",id:"旋转时速度需要越来越慢",depth:4},{text:"中奖的概率",id:"中奖的概率",depth:2},{text:"完整代码",id:"完整代码",depth:2},{text:"总结",id:"总结",depth:2}],title:"仿拼多多现金大转盘，H5 抽奖转盘如何实现？",frontmatter:{tags:["H5"]}}}}]);