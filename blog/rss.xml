<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>小霖家的混江龙 Blog</title>
        <link>https://lijunlin2022.github.io/blog</link>
        <description>小霖家的混江龙 Blog</description>
        <lastBuildDate>Sat, 21 Sep 2024 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[一个小程序组件埋点的优雅思路]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/09/21/miniprogram-event-tracking</link>
            <guid>https://lijunlin2022.github.io/blog/2024/09/21/miniprogram-event-tracking</guid>
            <pubDate>Sat, 21 Sep 2024 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">mergeMethods</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">target</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> fns</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">keys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">fns</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">forEach</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">typeof</span><span class="token plain"> fns</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'function'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">// 如果是组件，fns 需要包裹在 fns 里</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">target</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">hasOwnProperty</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'methods'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        target</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">methods</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> target</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">methods</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">||</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        target</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">methods</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> fns</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">// 如果是页面，直接混入函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        target</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> fns</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> target</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> mergeMethods </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">require</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'../../../utils/mergeMethods'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> track </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">require</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'../../utils/track'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> config </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token literal-property property">properties</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">commonParams</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Object</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token literal-property property">methods</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">onCompBtnClick</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword" style="color:rgb(0, 0, 255)">this</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">track</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'click'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'comp id'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token literal-property property">btnName</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'组件按钮'</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function maybe-class-name" style="color:rgb(0, 0, 255)">Component</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token function" style="color:rgb(0, 0, 255)">mergeMethods</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> track </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> mergeMethods </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">require</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'../../utils/mergeMethods'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> track </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">require</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'../utils/track'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> config </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token literal-property property">data</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">commonParams</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token literal-property property">channel</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'picture'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token literal-property property">activityId</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'123456'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">onPageBtnClick</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">this</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">track</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'click'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'page id'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token literal-property property">btnName</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'页面按钮'</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function maybe-class-name" style="color:rgb(0, 0, 255)">Page</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token function" style="color:rgb(0, 0, 255)">mergeMethods</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> track </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">button</span><span class="token tag" style="color:rgb(128, 0, 0)"></span><br></span><span class="token-line" style="color:#000000"><span class="token tag" style="color:rgb(128, 0, 0)">  </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">primary</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"></span><br></span><span class="token-line" style="color:#000000"><span class="token tag" style="color:rgb(128, 0, 0)">  </span><span class="token tag special-attr attr-name" style="color:rgb(255, 0, 0)">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag special-attr attr-value value css language-css property" style="color:rgb(128, 0, 0)">margin-top</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css" style="color:rgb(128, 0, 0)"> </span><span class="token tag special-attr attr-value value css language-css number" style="color:rgb(9, 134, 88)">200</span><span class="token tag special-attr attr-value value css language-css unit" style="color:rgb(128, 0, 0)">rpx</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"></span><br></span><span class="token-line" style="color:#000000"><span class="token tag" style="color:rgb(128, 0, 0)">  </span><span class="token tag attr-name namespace" style="color:rgb(255, 0, 0)">bind:</span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">tap</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">onPageBtnClick</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"></span><br></span><span class="token-line" style="color:#000000"><span class="token tag" style="color:rgb(128, 0, 0)"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  页面按钮</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">button</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">comp</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">commonParams</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">{{commonParams}}</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[从快速切换 Tab 说起，先发出的请求后得到结果（请求竞态问题）如何解决？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/07/31/race-conditions</link>
            <guid>https://lijunlin2022.github.io/blog/2024/07/31/race-conditions</guid>
            <pubDate>Wed, 31 Jul 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[开发 H5 的朋友或许都遇到过一个问题。场景如下，页面有一个 Tab，然后 Tab 下方有对应的商品列表：]]></description>
            <content:encoded><![CDATA[<p>开发 H5 的朋友或许都遇到过一个问题。场景如下，页面有一个 Tab，然后 Tab 下方有对应的商品列表：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/cover-a0bc899ec58411baa8b48a86e1ff7e52.gif" width="300" height="200" class="img_ev3q"></p>
<p>我们快速切换 Tab，会偶然发现 Tab 选项的商品不符合预期，比如最终选项是「男装」，但商品却还是「食品」。</p>
<p>这是因为切换 Tab 时，我们会先发送「食品」的请求、再发送了「男装」的请求，但是由于网络速度等原因，接口先返回了「男装」的响应，再返回了「食品」的响应。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/tab-with-error-d4ee9b0bd9455b99c6c95fcbecad1859.png" width="300" height="217" class="img_ev3q"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[从商品海报说起，canvas 文本如何实现溢出截断、溢出显示省略号和自动换行？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/07/15/canvas-fill-text</link>
            <guid>https://lijunlin2022.github.io/blog/2024/07/15/canvas-fill-text</guid>
            <pubDate>Mon, 15 Jul 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[几乎所有电商 App 都有分享商品功能，功能包括分享 H5、小程序、朋友圈，还有一些 App 能生成海报。例如盒马、得物和唯品会：]]></description>
            <content:encoded><![CDATA[<p>几乎所有电商 App 都有分享商品功能，功能包括分享 H5、小程序、朋友圈，还有一些 App 能生成海报。例如盒马、得物和唯品会：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/example-a7e6579f0e25f6d888dc18dbce9156cd.png" width="995" height="516" class="img_ev3q"></p>
<p>现在我们有一件新款爆款 T 恤，需要生成带商品名的海报，你会怎么做呢？</p>
<p>前端同学一般会用 canvas 绘制海报图片、文字，但 canvas 处理文本的能力非常弱，没有原生 API 直接实现溢出截断、溢出显示省略号和自动换行。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/product-497c5bbee0fc9a38330ce126bc42c7ac.png" width="1210" height="461" class="img_ev3q"></p>
<p>本文我会先介绍 canvas 原生处理文本的 API，然后给出函数 <code>fillTruncateText</code>，<code>fillEllipsisText</code> 和 <code>fillWrapText</code>，分别实现 canvas 文本溢出截断、溢出显示省略号和自动换行。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="filltext">fillText<a href="https://lijunlin2022.github.io/blog/2024/07/15/canvas-fill-text#filltext" class="hash-link" aria-label="Direct link to fillText" title="Direct link to fillText">​</a></h2>
<p>canvas 填充文字的 API 为 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/fillText" target="_blank" rel="noopener noreferrer">fillText</a>，它有 4 个参数：</p>
<blockquote>
<ul>
<li>text，需要渲染的文本字符串。</li>
<li>x，填充文本的 x 坐标，单位为像素。</li>
<li>y，填充文本基线的 y 坐标，单位为像素。</li>
<li>maxWidth，填充文本的最大宽度，如果未指定，则文本宽度没有限制。</li>
</ul>
</blockquote>
<p>其中，maxWidth 基本没啥用处，设置它既不能实现溢出截断，也不能实现溢出显示省略号。它会压缩文字，在指定 maxWidth 显示文本。</p>
<p>举例如下，第一行文本未指定 maxWidth，第二行文本指定了 maxWidth：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> canvas </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementById</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"canvas"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> ctx </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getContext</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'2d'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">font</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'16px Arial'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">fillStyle</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'#222426'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> text </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'2024 Trump 川普特朗普新款 T 恤周边'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">fillText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">fillText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">120</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">200</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="data:image/jpeg;base64,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JmCTdhAu7dlTwMDg0DKAjnllkuoHvpJ0uGt1jSLU3JjEu3Hnibb0GfTNAFu+TTbbTtR+1LE00WsA2zTfPIApiLlSctwoJJ9BzQBvWf8AaEl3L4huLBp2kQQ2dpayxuyQ5yXLMwUljg8HgAdeaAL/AIftJ7XT3N1F5M1xcSztHuBKb3JAJHBIGM4JFAGpQAUAFABQAUAFABQAUAFABQAUAFABQBXubG2u5reWePe9rJ5sJ3EbWwRnjrwT1oAsUARxQQwb/JiSPzGLvsUDcx6k+p96AFlhinTZNGki5DbXUEZByDz6EZoADDEZhOY0MoUqH2jcAeSM+nAoAJIYptvmxpJsYOu5QdrDoR70APoAKAIjbW587MEf7/8A1vyD95xj5vXjjmgCG50rTrzyftWn2s/2f/U+bCreX/u5HHQdPSgCwYYjMJzGhlClQ+0bgDyRn04FABJDFNt82NJNjB13KDtYdCPegB9ABQBWbT7Fr4XzWdubsLsE5iXzAvpuxnHtQBIttAlt9mWCNYAuzygg27emMdMe1AD0RIo1jjRURAAqqMAAdABQA6gCOaCG4j8ueJJUyG2uoYZByDg+hANAElADDFG0qymNTIgIVyOQD1AP4D8qAG3FtBeW7291BHPC4w8ciBlYe4PBoAjtdOsbGNI7Szt7dI87FiiVAueuABxmgCm/hbw9I7O+g6YzscszWkZJPqeKALdjpmn6YjJp9jbWiOcssESxhj6nAoAtUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAVbfU9Pu/P+zX1tN9nOJvLlVvKP+1g8dD19KAGjVtNOn/2gNQtTZj/AJePOXy+uPvZx14oAmF3bNaC7W4iNuV3iYONhX13dMe9ADL3ULLToRNfXkFrETtDzyqik+mSaAG2Oq6dqYc6ff212I8BzBMsm3PTODxQBboAKACgCJriJLhLdnxI6s6jB5C4yc/iKAGpe20k6QRzK7yReam3kMmQMg9O4oAjGp2RUsJ1OJ/s5GDkSZxtx1/+tz05oAeb61F8tj56m5ZC/ljkhRjk+nXv1oAfDcRXCu0TbgjsjcEYZTgj86AKsuuaTb2sN1c6la28M/8Aq3nlEYb1A3Y59qAJ3v7REt3adNlywWFwcq5IyMHpyBx60APhuYbjzDE+8ROY3wDww6j3oAbBeW9zZreRSgwMu4OwK4HfOen40AAvLdmgVJlf7QpaIryHAAOQRx3FADre4iuoEnhbfG4yrYIyPxoAoyeJNBhna3l1vTkmVtrRtdIGDehGc5oAvSXEUUkUbvhpm2xjBOTgn+QNABDcw3EkyRPuaB9knBwGwDjPfgigDPfxT4ejdkfXtMV1OGVruMEH0PNAFq11TT74p9jvILkOGKtC4dWCkA4I44yPzoAmt7mG6RnhfeqO0ZOCMMpwRz7igCWgAoAKACgAoAKACgAoAKACgAoAKAGyIskbRtnawIODjg+9AHGaokc8sqafHssLJIdPdlPEhMybkB7hVBB92I9aANNjZW2rard3wCQWTxXKsWICuYypOB1OMD6n1oA57W7uO38MjTb+4i097oTXzQyyhGVS5ZIhzyckZA/umgDvUljnsxLDIskbx7ldDkMCOCD3oA5zT3vHsvDdpbXj20UtoXmKIhZgqpgDcDjr+WfY0ANl1rUV0WzuFuP3sthcTM2xeXVQVPTtmgCCe71ux+1yyay8yWkMFxtNvGN5ckMhwv3Pl4xhueWNAFq0vdVW7F3PfmS3k1KS0Ft5SBQmWCtkDduBHrjHbPNAGrd/8h61/wCvSf8AnHQBi28RnjsYlt4LgvomPKnOEYZj4Pytx/wE0AcmbSMw/aR4d0oDIk84abc+Xt8vbnH2TbjPz+maYjSv4NPt9Yi+1PaxzfZWDWlsk11DBGFj2h4Y9uVPzHlQOR6CkMZFb2lra6rbwW9qrG1kdmXw5NbHa2Tt3M33Rj7pHPQHPQAfaXEWmX7GK+0vSVMkoDT6c9pEf3cXAid1IJ9c8+lABqVqJbbSi+jabeeZZwsHe3lmlYJsJ/1cDlR1XliDn65AGWGmJNZajbHSNMtFMYDMmmTySqrOSMRmGNn5GODgbBx1oAr6fbxwC3v00jTr0BJrhoZNPeyRCNgBXcrBiMDG0DvzmmBb17TUu/EqPcWCR3MgG4x2ZmXdgbiD9jPmAcc7x9VpAb3hrTfs2ozLbXMxttPZ7Uo93NJuO2MqdjMVGMt0A69KANS4/wCRqsf+vOf/ANCioAyvGOnyXs1o0kzpbosu1Ucg+YI3YNjpxt/U0AY2kaXp1trdpLb2FtFIs4w8cKqRy46gelAEcusS2MWnxHUb+yVSXKJdWEauh3jKiVtx5I+9xwcdqANq0n867EF3aMsNxcS/vzdGOaJhFk/6vjp3V+vSgBuiWMcC6VeW9xeAXd1M+17yZ1eIiRlyrOR02nJGaAOvoAKACgAoAKACgAoAKACgAoAKACgBkqGWF4w7RllI3p95c9x70AY9p4ZjttNbTZNSvbmzMXlrDKIhs5zuBRFbdnnJJ5560AJN4XjngRG1O+84XAuHuP3ReR1GF3AoVwBjACjkA9eaALz6Z5+lS6fdXlxciVSrTOEV8H/dUL+lAFwqCm3sRigClbaRb2osdjyH7BCYY9xHIIA546/KOmKAKK+E7QM268vXj8mWGKJnXbCkn3gvy57cZJx9KALVzoVrdx3KSSTAXUUcT7SOAhJGOOvNAFPSfD7QXUt1dTXH/H5NPHbFlMYZiQH4Gc7T0Jxz0zQBoixlfVpryV12eSIYFA5UHlifcnHH+z70AV7XSJbW5tWEqPHb2Bts8gs2V5x6fL60AYA8CTf2Z9nMHhvzvJ2bzo5L7sYzv8zOc/xbffHagDpn0wS3VrPI6kQQPC0ZXIfdtz/6D6d6AKUuhXRstQiW5gL3ECwQARMqxIudu7LMWPzcnjOOgoAhtNC1HT7y7vFuxevIhEEMz+VGjuQZCNqHaDgYHzdDzkmgCK78LTXkemo66XKLO08lxe2ZuV3fLyo3Lj7p5z+FAC2PhV7X7apTSkWdIvLW1sWhj3ozMC8Yf5uSP4hnGKAJoPCqQ2s0ZusyS23kllQhQx++4XceuF4/2e+TQAX+iX11qj3MZgUKDJFKXYP5ny7FI24CjbknJzuPAoAt6bo76XdboZQ8Usf+k7hhnlznf+OWz9F9KALr2cb6hFelm8yKN41APBDFSc/98igCprWm3GpRQpbzRwsjPl5ELABo2XoCM/e9RQBjweFdXt7qO4GsWTmNw+37A65wScZ8046nsaAJpPCs7WzKmqzxF7JLaSKERqspG7JLOjkA7j0GR70AQy+G9Su4c3Ismw7yfZPMcpIWG0q0gAONo/u9ScgjigC7b2WpnVory40uzTaNu5dVmkEYxglIjEEBxxxj60Ab1ABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAFABQAUAf/9k=" width="300" height="150" class="img_ev3q"></p>
<p>可以看到 maxWidth 难堪大用。</p>
<p>既然原生的 fillText 作用有限，我们便需要自己编写一些函数，实现文本溢出截断、溢出显示省略号和自动换行。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="filltruncatetext">fillTruncateText<a href="https://lijunlin2022.github.io/blog/2024/07/15/canvas-fill-text#filltruncatetext" class="hash-link" aria-label="Direct link to fillTruncateText" title="Direct link to fillTruncateText">​</a></h2>
<p>我们先看溢出截断。</p>
<p>要实现溢出截断功能，我们需要用到 canvas 的一个 API <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/measureText" target="_blank" rel="noopener noreferrer">measureText</a>，它可以测量文本并返回一个对象（对象中包含了文本宽度）。</p>
<p>我们可以用 <code>measureText</code> 测量要填充的文本，如果文本宽度小于等于 maxWidth，便正常用 fillText 填充文本；如果文本宽度大于 maxWidth，我们便从文本后方一点一点往前缩短文本，直到文本宽度小于等于 maxWidth。</p>
<p>按此思路实现的 <code>fillTruncateText</code> 函数如下：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">fillTruncateText</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  ctx</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  text</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  x</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  y</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  maxWidth</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  font</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  fillStyle</span><br></span><span class="token-line" style="color:#000000"><span class="token parameter"></span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">font</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> font</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">fillStyle</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> fillStyle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> textWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">measureText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">textWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> maxWidth</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">fillText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> len </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">length</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> sliceText </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> text</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> width </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> textWidth</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">width </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> maxWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> len </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    len </span><span class="token operator" style="color:rgb(0, 0, 0)">-=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    sliceText </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">slice</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    width </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">measureText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">sliceText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">fillText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">sliceText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fillellipsistext">fillEllipsisText<a href="https://lijunlin2022.github.io/blog/2024/07/15/canvas-fill-text#fillellipsistext" class="hash-link" aria-label="Direct link to fillEllipsisText" title="Direct link to fillEllipsisText">​</a></h2>
<p>再看溢出显示省略号。</p>
<p>溢出显示省略号的思路和截断基本一致，如果文本宽度小于等于 maxWidth，便正常用 fillText 填充文本；如果文本宽度大于 maxWidth，我们便从文本后方一点一点往前缩短文本，直到<code>文本宽度 + 省略号宽度 &lt;= maxWidth</code>。</p>
<p>按此思路实现的 <code>fillEllipsisText</code> 如下：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">fillEllipsisText</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  ctx</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  text</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  x</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> </span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  y</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  maxWidth</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  font</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  fillStyle</span><br></span><span class="token-line" style="color:#000000"><span class="token parameter"></span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">font</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> font</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">fillStyle</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> fillStyle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> ellipsis </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'...'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> ellipsisWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">measureText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ellipsis</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> textWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">measureText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">ellipsisWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> textWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> maxWidth</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">fillText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> len </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">length</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> sliceText </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> text</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> width </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> textWidth</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">width </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> ellipsisWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> maxWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> len </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    len </span><span class="token operator" style="color:rgb(0, 0, 0)">-=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    sliceText </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">slice</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    width </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">measureText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">sliceText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">fillText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">sliceText</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">ellipsis</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fillwraptext">fillWrapText<a href="https://lijunlin2022.github.io/blog/2024/07/15/canvas-fill-text#fillwraptext" class="hash-link" aria-label="Direct link to fillWrapText" title="Direct link to fillWrapText">​</a></h2>
<p>最后看文本自动换行。</p>
<p>和溢出截断、溢出显示省略号从后往前缩短文本的思路不同，文本自动换行的思路是从前往后慢慢增加文本，如果文本宽度超过 maxWidth，则开始填充下一行文本。</p>
<p>具体来说：</p>
<ul>
<li>初始时，文本自动换行会先把文本拆分为一个数组 arrText，然后从下标 0 开始，逐个取出数组中的文字，慢慢拼接新的字符串。如果到下标 i 时字符串的宽度已经大于 maxWidth，则先绘制 i 以前的字符。</li>
<li>然后另起一行，这一行的初始字符为 <code>arrText[i]</code>，基线 y 的坐标则为 <code>y + lineHeight</code>。此后又开始逐个从数组中取出文本。直到发现这一行宽度又大于了 maxWidth。</li>
<li>另起一行，如此循环，直到数组 arrText 中的字符已经全部用光。</li>
</ul>
<p>按此思路实现的 <code>fillWrapText</code> 代码如下：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">fillWrapText</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  ctx</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  text</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  x</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  y</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  maxWidth</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  lineHeight</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  font</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  fillStyle</span><br></span><span class="token-line" style="color:#000000"><span class="token parameter"></span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">font</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> font</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">fillStyle</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> fillStyle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> arrText </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">split</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">''</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> line </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> arrText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> testLine </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> line </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> arrText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> testWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">measureText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">testLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">testWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> maxWidth</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">fillText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      line </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> arrText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      y </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> lineHeight</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      line </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> testLine</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">fillText</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="示例代码">示例代码<a href="https://lijunlin2022.github.io/blog/2024/07/15/canvas-fill-text#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 示例代码" title="Direct link to 示例代码">​</a></h2>
<p>光靠文章比较枯燥，我给三个工具写了示例，你可以在 codepen 或者码上掘金上查看：</p>
<ul>
<li>codepen: <a href="https://codepen.io/lijunlin2022/pen/xxoxVaK" target="_blank" rel="noopener noreferrer">https://codepen.io/lijunlin2022/pen/xxoxVaK</a></li>
<li>码上掘金: <a href="https://code.juejin.cn/pen/7391408282185531419" target="_blank" rel="noopener noreferrer">https://code.juejin.cn/pen/7391408282185531419</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/07/15/canvas-fill-text#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文我会先介绍 canvas 原生处理文本的 API，然后给出函数 <code>fillTruncateText</code>，<code>fillEllipsisText</code> 和 <code>fillWrapText</code>，分别实现 canvas 文本溢出截断、溢出显示省略号和自动换行。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考文章">参考文章<a href="https://lijunlin2022.github.io/blog/2024/07/15/canvas-fill-text#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0" class="hash-link" aria-label="Direct link to 参考文章" title="Direct link to 参考文章">​</a></h2>
<ul>
<li><a href="https://www.zhangxinxu.com/wordpress/2018/02/canvas-text-break-line-letter-spacing-vertical/" target="_blank" rel="noopener noreferrer">canvas文本绘制自动换行、字间距、竖排等实现 | 张鑫旭</a></li>
</ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[从拼多多分享商品说起，canvas 绘图如何实现 contain 和 cover 效果？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/07/11/canvas-image</link>
            <guid>https://lijunlin2022.github.io/blog/2024/07/11/canvas-image</guid>
            <pubDate>Thu, 11 Jul 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[我们偶尔会在一些 H5、小程序中，看到分享商品的功能。比如拼多多小程序中，用户可以把商品分享给自己的好友。分享图主要由 2 张图片组成，一张商品图，一张背景图。]]></description>
            <content:encoded><![CDATA[<p>我们偶尔会在一些 H5、小程序中，看到分享商品的功能。比如拼多多小程序中，用户可以把商品分享给自己的好友。分享图主要由 2 张图片组成，一张商品图，一张背景图。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/pdd-05951001c8f3c5fea33fc2268b7cb8fa.jpg" width="400" height="335" class="img_ev3q"></p>
<p>商品图通常由商家自己配置，尺寸会变动，一般是 contain 效果；背景图通常由 UI 提供，尺寸固定，一般是 cover 效果。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/contain-and-cover-4a7b23b6160b59a6dae609cb4712ad56.png" width="765" height="357" class="img_ev3q"></p>
<p>如果使用 css，我们可以给 <code>background-size</code> 设置 <code>contain</code> 和 <code>cover</code>，可惜这类分享图基本由 canvas 绘制而成。canvas 只提供了 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage" target="_blank" rel="noopener noreferrer">drawImage()</a> 绘制图片，无法精准实现 <code>contain</code> 和 <code>cover</code> 效果，于是我实现了 <code>drawContainImage</code> 和 <code>drawCoverImage</code> 两个工具函数。</p>
<p>本文我会先分析 contain 效果的<code>图片宽高比</code>和<code>容器宽高比</code>，并给出 drawContainImage 工具函数；再分析 cover 效果的<code>图片宽高比</code>和<code>容器宽高比</code>，并给出 drawCoverImage 工具函数；最后我会用两个工具函数，绘制如下分享图：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/product-4d5aa81e90ba93d3a1789a936724767c.png" width="400" height="275" class="img_ev3q"></p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="contain-效果">contain 效果<a href="https://lijunlin2022.github.io/blog/2024/07/11/canvas-image#contain-%E6%95%88%E6%9E%9C" class="hash-link" aria-label="Direct link to contain 效果" title="Direct link to contain 效果">​</a></h2>
<p>先来看 contain 效果。contain 效果是「缩放图片以<strong>完全装入</strong>容器」，它会有两种情况：</p>
<ul>
<li>图片宽高比 &lt; 容器宽高比，缩放后图片宽度 &lt; 容器宽度，图片高度 = 容器高度。</li>
<li>图片宽高比 &gt; 容器宽高比，缩放后图片宽度 = 容器宽度，图片高度 &lt; 容器高度。</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/canvas-contain-948b334521d89ebc949cf6598e343a32.png" width="1179" height="572" class="img_ev3q"></p>
<p>不难看出，contain 效果下，图片总是完整展示的，因此我们不必考虑裁剪图片。<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage" target="_blank" rel="noopener noreferrer">drawImage</a> 的 9 个参数中，我们只需要考虑 5 个参数：</p>
<blockquote>
<ul>
<li><code>image</code>，画布图像源。</li>
<li><code>dx</code>，image 的左上角在目标画布上 X 轴坐标。</li>
<li><code>dy</code>，image 的左上角在目标画布上 Y 轴坐标。</li>
<li><code>dw</code>，image 在目标画布上绘制的宽度。</li>
<li><code>dh</code>，image 在目标画布上绘制的高度。</li>
</ul>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="图片宽高比--容器宽高比">图片宽高比 &lt; 容器宽高比<a href="https://lijunlin2022.github.io/blog/2024/07/11/canvas-image#%E5%9B%BE%E7%89%87%E5%AE%BD%E9%AB%98%E6%AF%94--%E5%AE%B9%E5%99%A8%E5%AE%BD%E9%AB%98%E6%AF%94" class="hash-link" aria-label="Direct link to 图片宽高比 < 容器宽高比" title="Direct link to 图片宽高比 < 容器宽高比">​</a></h3>
<p>图片宽高比 &lt; 容器宽高比时，dy，dw 和 dh 可以直观看出来，而 dx 还需要单独计算。如下图所示：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/canvas-contain-imgRatio-le-canvasRatio-b9832b8b9d37b9a4611c8f3070f50654.png" width="637" height="445" class="img_ev3q"></p>
<ul>
<li>dx 是 image 的左上角在目标画布上 X 轴坐标，<code>dx = (width - dw) / 2</code>；</li>
<li>dy 是 image 的左上角在目标画布上 Y 轴坐标，<code>dy = 0</code>；</li>
<li>dw 是 image 在目标画布上绘制的宽度，<code>dw = imgRatio * width</code>；</li>
<li>dh 是 image 在目标画布上绘制的高度，<code>dh = height</code>。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="图片宽高比--容器宽高比-1">图片宽高比 &gt; 容器宽高比<a href="https://lijunlin2022.github.io/blog/2024/07/11/canvas-image#%E5%9B%BE%E7%89%87%E5%AE%BD%E9%AB%98%E6%AF%94--%E5%AE%B9%E5%99%A8%E5%AE%BD%E9%AB%98%E6%AF%94-1" class="hash-link" aria-label="Direct link to 图片宽高比 > 容器宽高比" title="Direct link to 图片宽高比 > 容器宽高比">​</a></h3>
<p>图片宽高比 &gt; 容器宽高比时，dx，dw 和 dh 可以直观看出来，而 dy 还需要单独计算。如下图所示：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/canvas-contain-imgRatio-ge-canvasRatio-0ffe824b46c5c3560244a030006c088b.png" width="669" height="323" class="img_ev3q"></p>
<ul>
<li>dx 是 image 的左上角在目标画布上 X 轴坐标，<code>dx = 0</code>；</li>
<li>dy 是 image 的左上角在目标画布上 Y 轴坐标，<code>dy = (height - dh) / 2</code>；</li>
<li>dw 是 image 在目标画布上绘制的宽度，<code>dw = width</code>；</li>
<li>dh 是 image 在目标画布上绘制的高度，<code>dh = dw / imgRatio</code>。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="drawcontainimage-代码">drawContainImage 代码<a href="https://lijunlin2022.github.io/blog/2024/07/11/canvas-image#drawcontainimage-%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to drawContainImage 代码" title="Direct link to drawContainImage 代码">​</a></h3>
<p>下面是 drawContainImage 的代码，因为 contain 效果一般会留有空白，所以我增加了一个 fillStyle 参数，用来设置空白部分的颜色。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">drawContainImage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  ctx</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> img</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> x</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> y</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> width</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> height</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> fillStyle</span><br></span><span class="token-line" style="color:#000000"><span class="token parameter"></span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">fillStyle</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">fillStyle</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> fillStyle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">fillRect</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> width</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> height</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> boxRatio </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> width </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> height</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> imgRatio </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">height</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> dx </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> dy </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> dw </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> dh </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">imgRatio </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> boxRatio</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    dw </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> imgRatio </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> width</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    dh </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> height</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    dx </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">width </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> dw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    dy </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    dw </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> width</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    dh </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> dw </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> imgRatio</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    dx </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    dy </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">height </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> dh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">drawImage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> dx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> dy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> dw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> dh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cover-效果">cover 效果<a href="https://lijunlin2022.github.io/blog/2024/07/11/canvas-image#cover-%E6%95%88%E6%9E%9C" class="hash-link" aria-label="Direct link to cover 效果" title="Direct link to cover 效果">​</a></h2>
<p>再看 cover 效果，cover 效果是「缩放图片以<strong>完全覆盖</strong>容器」。如下示意图所示，缩放后图片（红色部分）比容器（绿色部分）大。它会有两种情况：</p>
<ul>
<li>图片宽高比 &gt; 容器宽高比，缩放后图片宽度 = 容器宽度，图片高度 &gt; 容器高度。</li>
<li>图片宽高比 &lt; 容器宽高比，缩放后图片宽度 &lt; 容器宽度，图片高度 = 容器高度。</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/canvas-cover-ca100422dfd200338929f170c0f7efda.png" width="957" height="531" class="img_ev3q"></p>
<p>不难看出，contain 效果下，图片总是需要裁剪图片，所以 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage" target="_blank" rel="noopener noreferrer">drawImage</a> 的 9 个参数我们都需要使用：</p>
<blockquote>
<ul>
<li><code>image</code>，画布图像源。</li>
<li><code>sx</code>，image 的矩形（裁剪）选择框的左上角 X 轴坐标。</li>
<li><code>sy</code>，image 的矩形（裁剪）选择框的左上角 Y 轴坐标。</li>
<li><code>sw</code>，image 的矩形（裁剪）选择框的宽度。</li>
<li><code>sh</code>，image的矩形（裁剪）选择框的高度。</li>
<li><code>dx</code>，image 的左上角在目标画布上 X 轴坐标。</li>
<li><code>dy</code>，image 的左上角在目标画布上 Y 轴坐标。</li>
<li><code>dw</code>，image 在目标画布上绘制的宽度。</li>
<li><code>dh</code>，image 在目标画布上绘制的高度。</li>
</ul>
</blockquote>
<p>幸运的是，contain 效果下，dx, dy, dw 和 dh 的取值都是固定的，所以我们需要着重考虑的只有 sx, sy, sw 和 sh 这 4 个参数。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="图片宽高比--容器宽高比-2">图片宽高比 &gt; 容器宽高比<a href="https://lijunlin2022.github.io/blog/2024/07/11/canvas-image#%E5%9B%BE%E7%89%87%E5%AE%BD%E9%AB%98%E6%AF%94--%E5%AE%B9%E5%99%A8%E5%AE%BD%E9%AB%98%E6%AF%94-2" class="hash-link" aria-label="Direct link to 图片宽高比 > 容器宽高比" title="Direct link to 图片宽高比 > 容器宽高比">​</a></h3>
<p>图片宽高比 &gt; 容器宽高比时，sy，sw 和 sh 可以直观看出来，而 sx 还需要单独计算。如下图所示：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/canvas-cover-imgRatio-ge-canvasRatio-4f6a92091f45a1602bcc6d5385fe044b.png" width="647" height="316" class="img_ev3q"></p>
<ul>
<li>sx 是 image 裁剪选择框（绿色部分）的左上角 X 轴坐标，<code>sx = (img.width - sw) / 2</code>；</li>
<li>sy 是 image 裁剪选择框（绿色部分）的左上角 Y 轴坐标，<code>sy = 0</code>；</li>
<li>sw 是 image 裁剪选择框（绿色部分）的宽度，<code>sw = sh * boxRatio</code>；</li>
<li>sh 是 image 裁剪选择框（绿色部分）的高度，<code>sh = img.height</code>。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="图片宽高比--容器宽高比-3">图片宽高比 &lt; 容器宽高比<a href="https://lijunlin2022.github.io/blog/2024/07/11/canvas-image#%E5%9B%BE%E7%89%87%E5%AE%BD%E9%AB%98%E6%AF%94--%E5%AE%B9%E5%99%A8%E5%AE%BD%E9%AB%98%E6%AF%94-3" class="hash-link" aria-label="Direct link to 图片宽高比 < 容器宽高比" title="Direct link to 图片宽高比 < 容器宽高比">​</a></h3>
<p>图片宽高比 &lt; 容器宽高比时，sx, sw 和 sh 可以直观看出来，而 sy 还需要单独计算。如下图所示：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/canvas-cover-imgRatio-le-canvasRatio-03ca3495c9f340cb4004d73ec4935a61.png" width="467" height="316" class="img_ev3q"></p>
<ul>
<li>sx 是 image 裁剪选择框（绿色部分）的左上角 X 轴坐标，<code>sx = 0</code>；</li>
<li>sy 是 image 裁剪选择框（绿色部分）的左上角 Y 轴坐标，<code>sy = (img.height - sh) / 2</code>；</li>
<li>sw 是 image 裁剪选择框（绿色部分）的宽度，<code>sw = img.width</code>；</li>
<li>sh 是 image 裁剪选择框（绿色部分）的高度，<code>sh = sw / boxRatio</code>。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="drawcoverimage-代码">drawCoverImage 代码<a href="https://lijunlin2022.github.io/blog/2024/07/11/canvas-image#drawcoverimage-%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to drawCoverImage 代码" title="Direct link to drawCoverImage 代码">​</a></h3>
<p>下面是 drawCoverImage 的代码，因为 cover 效果不会留空白，所以不需要 fillStyle 参数。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">drawCoverImage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#000000"><span class="token parameter">  ctx</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> img</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> x</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> y</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> width</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> height</span><br></span><span class="token-line" style="color:#000000"><span class="token parameter"></span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> boxRatio </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> width </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> height</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> imgRatio </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">height</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> sx </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> sy </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> sw </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> sh </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">imgRatio </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> boxRatio</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    sw </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    sh </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> sw </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> boxRatio</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    sx </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    sy </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    sh </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">height</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    sw </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> sh </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> boxRatio</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    sx </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> sw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    sy </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ctx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">drawImage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> sx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> sy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> sw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> width</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> height</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="完整代码">完整代码<a href="https://lijunlin2022.github.io/blog/2024/07/11/canvas-image#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 完整代码" title="Direct link to 完整代码">​</a></h2>
<p>完整代码可以在码上掘金上查看：<a href="https://code.juejin.cn/pen/7388885726391992371" target="_blank" rel="noopener noreferrer">https://code.juejin.cn/pen/7388885726391992371</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/07/11/canvas-image#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文我分析了 contain 效果、cover 效果的<code>图片宽高比</code>和<code>容器宽高比</code>关系，并给出 drawContainImage 和 drawCoverImage 工具函数，最后用两个工具函数，绘制了一个商品分享图。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考文章">参考文章<a href="https://lijunlin2022.github.io/blog/2024/07/11/canvas-image#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0" class="hash-link" aria-label="Direct link to 参考文章" title="Direct link to 参考文章">​</a></h2>
<ul>
<li><a href="https://www.cnblogs.com/AIonTheRoad/p/14063041.html" target="_blank" rel="noopener noreferrer">canvas drawImage 绘图实现 contain 和 cover 的效果</a></li>
<li><a href="https://developer.aliyun.com/article/916087" target="_blank" rel="noopener noreferrer">在容器内显示图片的五种方案：contain、cover、fill、none、scale-down</a></li>
</ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[仿今日头条，H5 循环播放的通知栏如何实现？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/05/26/loop-notice</link>
            <guid>https://lijunlin2022.github.io/blog/2024/05/26/loop-notice</guid>
            <pubDate>Sun, 26 May 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[我们在各大 App 活动页面，经常会看到循环播放的通知栏。比如春节期间，我就在今日头条 App 中看到了如下通知：「春节期间，部分商品受物流影响延迟发货，请耐心等待，祝你新春快乐！」。]]></description>
            <content:encoded><![CDATA[<p>我们在各大 App 活动页面，经常会看到循环播放的通知栏。比如春节期间，我就在今日头条 App 中看到了如下通知：「春节期间，部分商品受物流影响延迟发货，请耐心等待，祝你新春快乐！」。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/toutiao-7c71bddb58a2a3df165ed6697dc32e57.gif" width="360" height="74" class="img_ev3q"></p>
<p>那么，这种循环播放的通知栏如何实现呢？本文我会先介绍它的布局、再介绍它的逻辑，并给出完整的代码。最终我实现的效果如下：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/loop-notice-6e8ad9e14239cc81f04bbee5e6dee51f.gif" width="360" height="60" class="img_ev3q"></p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="布局代码">布局代码<a href="https://lijunlin2022.github.io/blog/2024/05/26/loop-notice#%E5%B8%83%E5%B1%80%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 布局代码" title="Direct link to 布局代码">​</a></h2>
<p>我们先看布局，如下图所示，循环播放的布局不是普通的左中右布局。可以看到，当文字向左移动时，左边的通知 Icon 和右边的留白会把文字挡住一部分。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="360" height="80" class="img_ev3q"></p>
<p>为了实现这样的效果，我们给容器 box 设置一个相对定位，并把 box 中的 HTML 代码分为三部分：</p>
<ul>
<li>第一部分是 content，它包裹着需要循环播放的文字；</li>
<li>第二部分是 left，它是左边的通知 Icon，我们给它设置绝对定位和 <code>left: 0;</code>；</li>
<li>第三部分是 right，它是右边的留白，我们给它设置绝对定位和 <code>right: 0;</code>。</li>
</ul>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">box</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">content</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- ... 省略 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">left</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">🔔</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">right</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token selector class">.box</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">position</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> relative</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">overflow</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hidden</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">/* ... 省略 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token selector class">.left</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">position</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> absolute</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">left</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">/* ... 省略 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token selector class">.right</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">position</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> absolute</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">right</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">/* ... 省略 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>现在我们来看包裹文字的 content。content 内部包裹了三段一模一样的文字 notice，每段 notice 之间还有一个 space 元素作为间距。</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- ... 省略 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">content</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">notice</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">春节期间，部分商品...</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">space</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">notice</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">春节期间，部分商品...</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">space</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">notice</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">春节期间，部分商品...</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- ... 省略 --&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>为什么要放置三段一模一样的文字呢？这和循环播放的逻辑有关。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="逻辑代码">逻辑代码<a href="https://lijunlin2022.github.io/blog/2024/05/26/loop-notice#%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 逻辑代码" title="Direct link to 逻辑代码">​</a></h2>
<p>我们并没有实现真正的循环播放，而是欺骗了用户的视觉。如下图所示：</p>
<ul>
<li>
<p>播放通知时，content 从 0 开始向左移动。</p>
</li>
<li>
<p>向左移动 <code>2 * noticeWidth + spaceWidth</code> 时，继续向左移动便会露馅。因为第 3 段文字后不会有第 4 段文字。</p>
<p>如果我们把 content 向左移动的距离强行从 <code>2 * noticeWidth + spaceWidth</code> 改为 <code>noticeWidth</code>，不难看出，用户在 box 可视区域内看到的情况基本一致的。</p>
<p>然后 content 继续向左移动，向左移动的距离大于等于 <code>2 * noticeWidth + spaceWidth</code> 时，就把距离重新设为 <code>noticeWidth</code>。循环往复，就能欺骗用户视觉，让用户认为 content 能无休无止向左移动。</p>
</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/no-overflow-with-comment-fa7243d8c7538c8dfeb1a86d19de0f14.png" width="970" height="329" class="img_ev3q"></p>
<p>欺骗视觉的代码如下：</p>
<ul>
<li>我们通过修改 translateX，让 content 不断地向左移动，每次向左移动 1.5px；</li>
<li>当 <code>translateX &gt;= noticeWidth * 2 + spaceWidth</code> 时，我们又会把 translateX 强制设为 <code>noticeWidth</code>；</li>
<li>为了保证移动动画更丝滑，我们并没有采用 setInterval，而是使用 requestAnimationFrame。</li>
</ul>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> content </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementById</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"content"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> notice </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementsByClassName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"notice"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> space </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementsByClassName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"space"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> noticeWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> notice</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">offsetWidth</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> spaceWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> space</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">offsetWidth</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> translateX </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">move</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  translateX </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1.5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">translateX </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token plain"> noticeWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> spaceWidth</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    translateX </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> noticeWidth</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transform</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)">translateX(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation operator" style="color:rgb(0, 0, 0)">-</span><span class="token template-string interpolation">translateX</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">px)</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">requestAnimationFrame</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">move</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">move</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="完整代码">完整代码<a href="https://lijunlin2022.github.io/blog/2024/05/26/loop-notice#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 完整代码" title="Direct link to 完整代码">​</a></h2>
<p>完整代码如下，你可以在 codepen 或者码上掘金上查看。</p>
<ul>
<li>codepen: <a href="https://codepen.io/lijunlin2022/pen/rNgMrwg" target="_blank" rel="noopener noreferrer">https://codepen.io/lijunlin2022/pen/rNgMrwg</a></li>
<li>码上掘金: <a href="https://code.juejin.cn/pen/7373131233506623538" target="_blank" rel="noopener noreferrer">https://code.juejin.cn/pen/7373131233506623538</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/05/26/loop-notice#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文我介绍了如何用 H5 实现循环播放的通知栏：</p>
<ul>
<li>布局方面，我们需要用绝对定位的通知 Icon、留白挡住循环文字的左侧和右侧；此外，循环播放的文字我们额外复制 2 份。</li>
<li>逻辑方面，通知栏向左移动 <code>2 * noticeWidth + spaceWidth</code> 后，我们需要强制把通知栏向左移动的距离从 <code>2 * noticeWidth + spaceWidth</code> 变为 <code>noticeWidth</code>，以此来欺骗用户视觉。</li>
</ul>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[仿微信读书，H5 翻转卡片如何实现？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/05/17/reversible-card</link>
            <guid>https://lijunlin2022.github.io/blog/2024/05/17/reversible-card</guid>
            <pubDate>Fri, 17 May 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[我最近刷微信读书时，留意到它的推荐卡片会翻转，这个效果该怎么做呢？]]></description>
            <content:encoded><![CDATA[<p>我最近刷微信读书时，留意到它的推荐卡片会翻转，这个效果该怎么做呢？</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/wx-e4d3a173d60823453cb18e60944ed949.gif" width="374" height="430" class="img_ev3q"></p>
<p>本文我会先介绍翻转卡片的布局、动画，再并给出完整代码，最后做一个总结。最终效果如下：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/card-7d0c3580100e25dd8730ec35b9f31dc8.gif" width="374" height="310" class="img_ev3q"></p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="布局代码">布局代码<a href="https://lijunlin2022.github.io/blog/2024/05/17/reversible-card#%E5%B8%83%E5%B1%80%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 布局代码" title="Direct link to 布局代码">​</a></h2>
<p>我们先看布局，实现翻转卡片需要要把两个元素背靠背贴在一起，就像汉堡包的面饼中间不夹蔬菜、肉饼一样。</p>
<p>代码如下，有一个盒子 box 里面装着两个元素 front 的 back，front 用来做卡片的正面，back 用来做卡片的背面。</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">style</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css selector class">.box</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">position</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> relative</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css comment" style="color:rgb(0, 128, 0)">/* ... 省略 */</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css selector id">#front</span><span class="token style language-css selector punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token style language-css selector"> </span><span class="token style language-css selector id">#back</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">position</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> absolute</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">top</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css number" style="color:rgb(9, 134, 88)">0</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">bottom</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css number" style="color:rgb(9, 134, 88)">0</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">left</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css number" style="color:rgb(9, 134, 88)">0</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">right</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css number" style="color:rgb(9, 134, 88)">0</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">backface-visibility</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> hidden</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css comment" style="color:rgb(0, 128, 0)">/* ... 省略 */</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css selector id">#back</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">transform</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css function" style="color:rgb(0, 0, 255)">rotateY</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css number" style="color:rgb(9, 134, 88)">-180</span><span class="token style language-css unit">deg</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css comment" style="color:rgb(0, 128, 0)">/* ... 省略 */</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">style</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">box</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">front</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">back</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">btn</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">翻转</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>box 是相对定位，而 front，back 则是绝对定位，这意味着 front 和 back 是重叠的。</p>
<p>我们让 back 绕着 Y 轴逆时针旋转了 180 度 —— <code>rotateY(-180deg)</code>，并给 front 和 back 都设置了背面不可见属性 —— <code>backface-visibility: hidden;</code> 属性，便实现了卡片的背靠背效果。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="逻辑代码">逻辑代码<a href="https://lijunlin2022.github.io/blog/2024/05/17/reversible-card#%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 逻辑代码" title="Direct link to 逻辑代码">​</a></h2>
<p>当点击按钮旋转时，我们每次都让 front 和 back 旋转 180 度。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> front </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementById</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'front'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> back </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementById</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'back'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> btn </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementById</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'btn'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> frontRotateY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> backRotateY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">180</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">btn</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'click'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  frontRotateY </span><span class="token operator" style="color:rgb(0, 0, 0)">-=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">180</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  backRotateY </span><span class="token operator" style="color:rgb(0, 0, 0)">-=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">180</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  front</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transform</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)">rotateY(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">frontRotateY</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">deg)</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  back</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transform</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)">rotateY(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">backRotateY</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">deg)</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此外，我们还需要给 front 和 end 添加过渡效果：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token selector id">#front</span><span class="token selector punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token selector"> </span><span class="token selector id">#back</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">/* ... 省略 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">transition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0.5</span><span class="token unit">s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这样当卡片每次旋转时，都能够有相关动画。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="完整代码">完整代码<a href="https://lijunlin2022.github.io/blog/2024/05/17/reversible-card#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 完整代码" title="Direct link to 完整代码">​</a></h2>
<p>完整代码如下，你可以在 codepen 或者码上掘金上查看。</p>
<p>codepen: <a href="https://codepen.io/lijunlin2022/pen/yLrJMZL" target="_blank" rel="noopener noreferrer">https://codepen.io/lijunlin2022/pen/yLrJMZL</a></p>
<p>码上掘金: <a href="https://code.juejin.cn/pen/7370534206583898150" target="_blank" rel="noopener noreferrer">https://code.juejin.cn/pen/7370534206583898150</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/05/17/reversible-card#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文首先介绍了翻转卡片的布局：两个元素 front、back 先通过绝对定位重叠，再让 back 绕 Y 轴旋转 180 度，实现 front 和 back 背对背的效果；</p>
<p>然后介绍了翻转卡片的动画：每次需要旋转时，都让 front 和 back 绕着 Y 轴旋转 180 度。</p>
<p>最终实现了类似微信读书推荐卡片的翻转效果。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[仿物美超市，H5 列表滚动回弹效果如何实现？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/05/07/springback</link>
            <guid>https://lijunlin2022.github.io/blog/2024/05/07/springback</guid>
            <pubDate>Tue, 07 May 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[最近有朋友问我，多点 App（物美超市的 App）商品列表的上拉回弹效果，用 H5 怎么实现？他知道 iOS 的 H5 原生滚动有回弹效果，Android 的 H5 没有，希望 Android 能和 iOS 表现一致。]]></description>
            <content:encoded><![CDATA[<p>最近有朋友问我，多点 App（物美超市的 App）商品列表的上拉回弹效果，用 H5 怎么实现？他知道 iOS 的 H5 原生滚动有回弹效果，Android 的 H5 没有，希望 Android 能和 iOS 表现一致。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/duodian-f283466561c12d21bc22e94ec8100dc0.gif" width="360" height="252" class="img_ev3q"></p>
<p>思索过后，我发现这已经不是普通的原生滚动了，必须要出重拳，得用 CSS 的 translate 模拟一套滚动。</p>
<p>我实现了下拉/上拉滚动回弹，效果如下：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/springback-a96a289647b43c6dab8eb5db6a69364a.gif" width="297" height="395" class="img_ev3q"></p>
<p>本文我会先介绍基础的 translate 模拟滚动，再逐步完善代码，最后做一个总结、并推荐一个工具库。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="基础代码">基础代码<a href="https://lijunlin2022.github.io/blog/2024/05/07/springback#%E5%9F%BA%E7%A1%80%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 基础代码" title="Direct link to 基础代码">​</a></h2>
<p>我们不准备用原生滚动，那么就需要给能滚动的容器添加 <code>overflow: hidden;</code>，基础布局代码如下：</p>
<p>外层的 box 是容器，它被设置了 <code>overflow: hidden</code>。内层的 content 是需要滚动的内容，包裹着三部分：下拉提示（pulldown ↓）、列表和上拉提示（pullup ↑）。</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">style</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css selector id">#box</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">height</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css number" style="color:rgb(9, 134, 88)">100</span><span class="token style language-css unit">vh</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">overflow</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> hidden</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">style</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">box</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">content</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">tip</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">pulldown ↓</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">ul</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">li</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">0</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">li</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">li</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">1</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">li</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">&lt;!-- ...省略 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">li</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">19</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">li</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">ul</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">tip</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">pullup ↑</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>基础逻辑代码如下：</p>
<ul>
<li>我们在用户手指刚触摸屏幕时（touchstart），记住了手指的开始位置 startY；</li>
<li>用户手指移动时（touchmove），我们用手指当前的位置（currentY），减去手指开始的位置，得到手指移动的距离（diffY），并实时赋值给 content 的 translateY，这样就实现手指上滑/下滑多少距离，content 就上滑/下滑多少距离；</li>
<li>用户停止触摸屏幕时（touchend），我们记住 content 现在移动的位置（lastY）。用户下次滚动 content 时会在 lastY 的基础上继续滚动。</li>
</ul>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> content </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementById</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'content'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> startY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> lastY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> diffY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'touchstart'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  startY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">touches</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">clientY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'touchmove'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> currentY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">touches</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">clientY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  diffY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">floor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">currentY </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> startY</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transform</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)">translateY(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">lastY </span><span class="token template-string interpolation operator" style="color:rgb(0, 0, 0)">+</span><span class="token template-string interpolation"> diffY</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">px)</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'touchend'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  lastY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> lastY </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> diffY</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transform</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)">translateY(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">lastY</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">px)</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>效果如下：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/basic-8b7f5b4efa9ef7eba41963e3d4174cea.gif" width="297" height="395" class="img_ev3q"></p>
<p>可以看到，基础代码有个很明显的缺陷。content 很容易被完全移动到 box 外，box 内部便只能看到一片空白。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="设置下拉上拉的最终值">设置下拉/上拉的最终值<a href="https://lijunlin2022.github.io/blog/2024/05/07/springback#%E8%AE%BE%E7%BD%AE%E4%B8%8B%E6%8B%89%E4%B8%8A%E6%8B%89%E7%9A%84%E6%9C%80%E7%BB%88%E5%80%BC" class="hash-link" aria-label="Direct link to 设置下拉/上拉的最终值" title="Direct link to 设置下拉/上拉的最终值">​</a></h2>
<p>为了解决 content 可以移动到 box 之外的缺陷，我们可以在用户手指离开屏幕时，对 content 的最终值做一个判断。</p>
<p>改动代码如下：</p>
<ul>
<li>
<p>我们计算了 content 能上拉的最大距离（maxTranslateY），它是 content 自身的高度减去 box 的高度。（如果 content 的高度小于等于 box 的高度，根本无法上拉滚动）。</p>
</li>
<li>
<p>用户下拉时（diffY &gt; 0），如果最终 content 的位置（lastY + diffY）不是负数，说明 content 顶部已经离开了 box 的上边界。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="300" height="250" class="img_ev3q"></p>
<p>用户放手时，我们需要让 content 顶部重新贴着 box 的上边界，于是设置 lastY = 0，并设置了 content 的 translateY 为 0px。</p>
</li>
<li>
<p>用户上拉时（diffY &lt; 0 时），如果 content 的位置（lastY + diffY） 超过了上拉的最大距离（lastY + diffY &lt; -maxTranslateY），说明 content 的底部已经离开了 box 的下边界。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="300" height="250" class="img_ev3q"></p>
<p>用户放手时，我们需要让 content 底部重新贴着 box 的下边界，于是设置 lastY = -maxTranslateY，并设置了 content 的 translateY 为 <code>${-maxTranslateY}px</code>。</p>
</li>
</ul>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> box </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementById</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'box'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> content </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementById</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'content'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> startY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> lastY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> diffY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> maxTranslateY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">clientHeight</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">clientHeight</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// ... 省略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'touchend'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">diffY </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">lastY </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> diffY </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      lastY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transform</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'translateY(0px)'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transition</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'all .3s ease-out'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">diffY </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">lastY </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> diffY </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">maxTranslateY</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      lastY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">maxTranslateY</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transform</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)">translateY(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation operator" style="color:rgb(0, 0, 0)">-</span><span class="token template-string interpolation">maxTranslateY</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">px)</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transition</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'all .3s ease-out'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  lastY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> lastY </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> diffY</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transform</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)">translateY(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">lastY</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">px)</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transition</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'all .3s ease-out'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>效果如下：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/basic-limit-fd516202336e5ad691cd3b2cef6e897e.gif" width="297" height="395" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="设置下拉上拉的限制">设置下拉/上拉的限制<a href="https://lijunlin2022.github.io/blog/2024/05/07/springback#%E8%AE%BE%E7%BD%AE%E4%B8%8B%E6%8B%89%E4%B8%8A%E6%8B%89%E7%9A%84%E9%99%90%E5%88%B6" class="hash-link" aria-label="Direct link to 设置下拉/上拉的限制" title="Direct link to 设置下拉/上拉的限制">​</a></h2>
<p>虽然现在我们下拉、上拉 content 时，最终 content 肯定不会再超出 box 边界。但这样的效果并不美观，一般来说，下拉、上拉的距离都会有一个限制，现在我们就来添加这个限制。</p>
<p>改动代码如下：</p>
<ul>
<li>
<p>我们首先定义了下拉和上拉的限制距离 buffer，这个值可以按照个人喜好定，我这里把它定位 10vh （window.innerHeight / 10）只是觉得这个距离比较美观。</p>
</li>
<li>
<p>用户下拉时（diffY &gt; 0），content 的顶部最多只能离开 box 的顶部 buffer 大小的距离，也就是 lastY 最大为 buffer，diffY 的值就变为了 buffer - lastY。</p>
</li>
<li>
<p>用户上拉时（diffY &lt; 0），content 的位置最多为 -(maxTranslateY + buffer)，diffY 的值就变了 -(maxTranslateY + buffer) - lastY。</p>
</li>
</ul>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">// ...省略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> buffer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">floor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token dom variable" style="color:rgb(9, 134, 88)">window</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">innerHeight</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// ...省略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'touchmove'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> currentY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">touches</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">clientY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  diffY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">floor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">currentY </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> startY</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">diffY </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">lastY </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> diffY </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      diffY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> buffer </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> lastY</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">diffY </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">lastY </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> diffY </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">maxTranslateY </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      diffY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">maxTranslateY </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> lastY</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transform</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)">translateY(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">lastY </span><span class="token template-string interpolation operator" style="color:rgb(0, 0, 0)">+</span><span class="token template-string interpolation"> diffY</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">px)</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transition</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// ... 省略</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>有了限制后，效果美观多了：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/springback-a96a289647b43c6dab8eb5db6a69364a.gif" width="297" height="395" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="完整代码">完整代码<a href="https://lijunlin2022.github.io/blog/2024/05/07/springback#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 完整代码" title="Direct link to 完整代码">​</a></h2>
<p>完整代码如下，你可以在 codepen 或者码上掘金上查看。<strong>需要注意，代码只考虑了移动端场景，如果你是电脑访问，需要 F12 打开手机模拟器查看。</strong></p>
<ul>
<li>
<p>codepen: <a href="https://codepen.io/lijunlin2022/pen/KKYYOdg" target="_blank" rel="noopener noreferrer">https://codepen.io/lijunlin2022/pen/KKYYOdg</a></p>
</li>
<li>
<p>码上掘金：<a href="https://code.juejin.cn/pen/7368096483704307738" target="_blank" rel="noopener noreferrer">https://code.juejin.cn/pen/7368096483704307738</a></p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结与推荐">总结与推荐<a href="https://lijunlin2022.github.io/blog/2024/05/07/springback#%E6%80%BB%E7%BB%93%E4%B8%8E%E6%8E%A8%E8%8D%90" class="hash-link" aria-label="Direct link to 总结与推荐" title="Direct link to 总结与推荐">​</a></h2>
<p>本文我介绍了如何用 css 的 translate 模拟滚动，在基础代码上，我设置了下拉/上拉的最终值，下拉/上拉的限制，得到了一个可以回弹的滚动列表。</p>
<p>不过，自己用 css 的 translate 模拟滚动时，考虑各种距离实在繁琐。如果有朋友想在生产环境使用，推荐 <a href="https://better-scroll.github.io/docs/zh-CN/guide/" target="_blank" rel="noopener noreferrer">better-scroll</a> 这个插件，它和本文原理类似，也是利用 translate 模拟了一套滚动。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[仿拼多多现金大转盘，H5 抽奖转盘如何实现？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable</link>
            <guid>https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable</guid>
            <pubDate>Wed, 17 Apr 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[电商应用中我们常常看到抽奖转盘活动，比如拼多多的「抽奖大转盘」：点击中央的抽奖按钮，转盘开始旋转，一段时间后指针停止在奖品上。]]></description>
            <content:encoded><![CDATA[<p>电商应用中我们常常看到抽奖转盘活动，比如拼多多的「抽奖大转盘」：点击中央的抽奖按钮，转盘开始旋转，一段时间后指针停止在奖品上。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/pdd-e4f1f45453508c0e0e0b79c84220fc29.gif" width="360" height="314" class="img_ev3q"></p>
<p>这个效果如果用 H5 应该怎么实现呢？</p>
<p>本文我会先说明如何实现转盘布局，再介绍如何让转盘旋转，接着解释如何控制中奖概率，最后给出完整的代码，并做一个总结。最终效果如下：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/lottery-turntable-7e2b90447235212ae0bf9dc9cba8e063.gif" width="360" height="314" class="img_ev3q"></p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="css-旋转相关的语法">CSS 旋转相关的语法<a href="https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable#css-%E6%97%8B%E8%BD%AC%E7%9B%B8%E5%85%B3%E7%9A%84%E8%AF%AD%E6%B3%95" class="hash-link" aria-label="Direct link to CSS 旋转相关的语法" title="Direct link to CSS 旋转相关的语法">​</a></h2>
<p>实现转盘布局之前，我们先来复习 CSS 与旋转有关的语法。</p>
<ul>
<li><code>transform</code> 的 <code>rotate()</code> 函数可以控制旋转角度。比如 <code>transform: rotate(60deg);</code> 是顺时针旋转 60 度，<code>transform: rotate(-60deg);</code> 是逆时针旋转 60 度。</li>
<li><code>transform-origin</code> 可以控制旋转中心。比如 <code>transform-origin: right bottom;</code> 是以元素右下角为旋转中心。</li>
</ul>
<p>举个例子，下面代码中 item0 和 item1 两个矩形以自己的右下角为中心，逆时针旋转了 0 度和 60 度。</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">style</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css selector class">.item0</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    ...</span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">transform-origin</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> right bottom</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">transform</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css function" style="color:rgb(0, 0, 255)">rotate</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css number" style="color:rgb(9, 134, 88)">-0</span><span class="token style language-css unit">deg</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css selector class">.item1</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    ...</span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">transform-origin</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> right bottom</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">transform</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css function" style="color:rgb(0, 0, 255)">rotate</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css number" style="color:rgb(9, 134, 88)">-60</span><span class="token style language-css unit">deg</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">style</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">box</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item0</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item1</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWgAAAEsCAIAAABhTr74AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AABBSSURBVHic7d3nkxT3ncfxzwbSsgvskuOCEAIJJLFIQkgWyhIglSxZgbLL5Tv7zhdcd766c7nsOvvMP3V1NS0ry8phmpxzjsuyxN1J96BBErDL7m+nu78d3q9nsqXpjx/o7Z6e+TENtVpNAOCi0XoAgPQhHACcEQ4AzggHAGeEA4AzwgHAGeEA4IxwAHBGOAA4IxwAnBEOAM4IBwBnhAOAM8IBwBnhAOCMcABwRjgAOCMcAJwRDgDOCAcAZ4QDgDPCAcAZ4QDgjHAAcEY4ADhrth5wR//3v9q9y3oEBvHIo3pitfUI2Eh2OCSdPm29AMCteKsCwBnhAOCMcABwRjgAOCMcAJwRDgDOCAcAZ4QDgDPCAcAZ4QDgjHAAcEY4ADgjHACcEQ4AzggHAGeEA4AzwgHAGeEA4IxwAHBGOAA4IxwAnBEOAM4IBwBnhAOAM8IBwBnhAOCMcABwRjgAOCMcAJwRDgDOCAcAZ4QDgDPCAcAZ4QDgjHAAcEY4ADgjHACcEQ4AzggHAGeEA4AzwgHAGeEA4IxwAHBGOAA4IxwAnBEOAM4IBwBnhAOAM8IBwBnhAOCMcABwRjgAOCMcAJwRDgDOCAcAZ4QDgDPCAcAZ4QDgjHAAcEY4ADgjHACcEQ4AzggHAGeEA4AzwgHAGeEA4IxwAHCWxXCMr6qjbD0CyLJm6wER6ChrTE1tVZ1vUm+T9RoggzJ3xzGpojE1SRpV07SyZpc0rmq9CciabIWjUbe+SRlX1eySppXVXDPaBGRQtsLRUR74f9CEijr71V6Jew+QURkKx5iaJg2ehgZpclnz+tXKOxegXhkKx3A+SRld04ySZpauPwcBMCJZ+VSltarxw76VGF/V+H5daFJ3s3j7ArjLyh3HCL64MbGizr47vbsBMIhMhKO9otEjeuvRKE0pa26/w90KgCyEo7lW7/dEx9Q0s6QZpRHWB8if9Iejo6KGMF6ntap5/ZpcDufVgExL+cPRcVVNCPUhRXtFbVV181114E5SfscRxXe6mmuaVtacklp48AEMLM3haKtE+O/22KpmlTS9rFE8+ABuleZwdET/SWpbRZ39cVwISJXUhqMjxnuBjrI6+9VGPoDr0hmOUbW47wJG1TS9rFkljeXBB5DST1Ws3ju0VNVSVW+TuptU5mNb5FcK7zhaqsbvGjikj9xLYTiS8KiSQ/rIt7SFY2IlQU8ZOKSPvErVM46GZNxu3CI4pN/TpO5mJaZpQKRSFY6OspqS+v/tk258V/0C31VH9qXnrcroWtKfRzbVNJVD+siF9IQjLb+xxCF95EBKwjG+mrLPLzikj0xLyTOOtNxu3IJD+sioNNxxfPfjbGnUzA/KIYMSH46muv9kwCTgB+WQLYkPR0cl+RuHa0JF8zmkjyxI9r+UpV5NzNy/ZtcP6fPOBSmW7HBc2m+9IBqjappe4pA+0ivBn6rsL6rvrPWIKAWH9C80qbtJFT62RZok+I7D96wXxGJiRZ39/KAc0iWp4dj0jnpOWY+IS/CDchzSR3okMhyXe1QsWI+IHYf0kR6JfMZRLKia11t3DukjDZIXjpN7tfsL6xHWOKSPZEveW5ViPp6JDik4pM8PyiGREhaO3V/qxB7rEUly/QflSvygHBIlSeGoVfPyEayrtqo6OaSPBEnSM46ip0vd1iMSjEP6SIzE3HFcOKONb1uPSDwO6SMZEhMOP39f3BgxDunDWjLCcXSH9n1rPSJt+EE52ElGOHgmOjL8oByMJCAcOz7R6YPWI9Is+K76rJLG8s4FMbH+VKXUl8djKVFoqaqln0P6iIf1HYdf0LVLxhuyhEP6iIVpOLqPacsHlgMyKTikzw/KIUqm4eBYSnT4QTlEye4Zx6HNOrTZ7Oo50VpVK4f0ET67cHC7ERsO6SNsRm9Vtnyg7mM2l84nDukjVBbhuHaJL5jbuH5Iv8whfdTJIhzFgkp9BtdFoK2izv4s/LAm7MT+jOP0Qe34JO6L4nYdNx58XOTBB5zFfsfBsZTkGFXTdA7pYyTiDce+b3V0R6xXxJA4pA938YaDZ6KJxSF9uIgxHBvf1oUz8V0Orjikj2GLKxyXuvnGVzrwg3IYhrg+VfE91fj/sfTgB+VwR7HccZzYo91fxnEhhGtSRfP7OKSP28USDt6kpBeH9DGQ6MOx6wud3Bv5VRApDunjZhGHo1rhI9jsaK1qHj8oBynyh6PFgi73RHsJxOy7H5RDjkV5x9FzSpveifD1YSX4Qbn2UdY7YCbKcHAsJcMWPqylq6xHwExk4TiyXfuLUb04zK1Ya70AliILB89EM6xrjSZMtR4BS9GEY/vHOnM4kleGudYOda2zHgFjEYSj/yrf+MqyFevUwOexeRdBOHxPfZfDf1kkwcxFWrTSegTshR2Oc0e19cOQXxPJsYI3KZDCDwdvUjJs8WOasdB6BBIh1HAc3KTDW8J8QSRHYzPPRPGdUMNR5CPY7FqxVuMnWo9AUoQXjs3v6fyJ0F4NiTJpuh58wXoEEiSkcFzt5QvmWcabFNwspHAUPZX7w3kpJM3cpbqry3oEkiWMcJw6oJ2fhvA6SCaOpeA2YYSDYykZdt+TmjLPegQSp+5w7P1ax3aFsQTJM3oc3/jCgOoOB89EM2zFOo1psR6BJKovHL6n3rMhLUHCTJ6jpU9Zj0BC1RGOi+f4gnmW8SYFg6sjHL4n8YflZ9SC5Zq3zHoEkmuk4Ti+W3u+CnUJkqSLj2BxJyMNB8dSMuyB59Q+03oEEm1E4dj1mU7tD3sJkqFlAk83MCT3cFRKPBPNsq51auIHUzAE93AUPV25EMESJMD0BVryuPUIpIBjOHpOavO70SxBAvAmBcPjGA6eiWbY3Y9o1mLrEUgHl3Ac3qoDGyNbAmvcbmDYXMLBsZQM61qrtsnWI5Aaww7Hto909kiUS2CnbTK3G3AyvHD0XeF2I8uoBhwNLxy+p74rES+BkVmLdfcj1iOQMsMIx9kj2vZR9EtghD8ZEO6GEQ4+gs2wJY9r+l3WI5A+Q4XjgK8j22JZgtg1jeJ3DzAyQ4WDYykZtmKdWiZYj0Aq3TEcm95Vz8m4liBe7TP0wHPWI5BWg4fjygV+9yDLeJOCOgwejmJBlXKMSxCjecu0YLn1CKTYIOE4uU+7Po93CWLEN75Qn0HCwfdEM2zpU5o8x3oE0m2gcOz5Ssd3x74EsRjTwu0G6ndbOGo1bjeybMU6jR5nPQKpd1s4fE8Xz1ksQfSmzNN9T1qPQBbcHI7es9xuZBnHUhCSm8PBFzcy7K4uzV1qPQIZ8YNwHNupvd/YLUHE+MYXwvODcHAsJcMefEGTpluPQHbcCMfOT3X6gOkSRGb8RJ5uIFyNklTu5w/dyLKudWpsth6BTGmUpObReuNPWvqU9RhEYMZCLX7MegSypqFWq33/V2ePyC/oMH9yT4as+3fNWmQ9AllzczgCB3wVPf4kjixYtFJP/tx6BDJooHAENr0rn5P1adbQoPUb1NphvQMZNHg4JF25oGKB8/VpteIlda2xHoFsumM4Aif3yfc4L5syE6bqrf+xHoHMGkY4Anu+4vxbmjz9Cy182HoEMmvY4dCNE/ecgku+2Uu09jfWI5BlLuEI9J6VX+BUS6K98l+aNt96BLLMPRyBYztV9PiWehLd+4Qef8t6BDJupOEI7PxUxYKuXgxvD+rTPFrrN2hcm/UOZFx94dCNcy5b3g9pD+qz8lXd/6z1CGRf3eEInD+uoqeDm0J4KYxYxyz95I/WI5ALIYUjcGiLfE/njob2gnDy3D9q/gPWI5ALoYYjsPVD+QX1Xwv5ZXFnnffr+V9bj0BeRBAOSdcuyy9o+9/Cf2UM5id/UMds6xHIi2jCEThzSL6nI9ujen18Z9kzevQ16xHIkSjDEdhfVLGgC6ejvUqejW3V+g0aNcZ6B3Ik+nAENv1VRU/VShzXypvH39S9q61HIF/iCoeky+dV9LT7i5gulxNTO/Xj31mPQO7EGI7Aib3yPZ3YE+tFM2zNv2rOvdYjkDuxhyOw+0v5BV06b3DpLFn4kJ7+O+sRyCOjcEiqVuUXtPGvNlfPhjf/rInTrEcgj+zCEbhwWr6nfd9abkip5S/qoZetRyCnrMMROLpDxYLOHLLekR6t7Xprgxobh/47gQgkIxyBHX9T0dO1S9Y70mD1z3TPKusRyK8khUNS6ZqKnrZ+YL0j2WberZd+az0CuZawcAS6j6no6dBm6x1J9dJvNfNu6xHItUSGI3Bws/yCuo9b70iYe1Zp9c+sRyDvEhyOwJb35Xsq9VnvSIbGJq3/i8a3W+9A3iU+HJKuXpTvaccn1jsS4KGXtfxF6xFAKsIROH1QfkFHd1rvsDNxmt78s/UIQEpTOAL7vlHRU+8Z6x0Wnvl73bXCegQgpS8cgY1vq+ipVrXeEaM592nNv1iPAK5LZzgkXepW0dOeL613xOXHv9PUTusRwHWpDUfg+B75BZ3cZ70jYvet1mNvWo8AvpfycAR2fS7f0+Ue6x3RGDVW6zdo7HjrHcD3MhEOSZWyfE+b3rHeEYFHX9OyZ6xHADfJSjgCPafkF7Tft94Rnsmz9dofrEcAt8pWOAJHtsn3dOaw9Y4wPP9rdd5vPQK4VRbDEdj+sYqe+i5b76jD/Af13D9YjwAGkN1wSOq/qqKnbR9a7xip1/+o9lnWI4ABZDocgXNHVSzo8FbrHY7uf1YrX7UeAQwsB+EIHNgo39P5E9Y7hmdcm9ZvUPNo6x3AwHITjsDm9+QXVC5Z7xjKj9ZryY+sRwCDylk4JF3plV/Qzs+sdwxu2gK98p/WI4A7yV84Aqf2y/d0bJf1joGs/Y1mL7EeAdxJXsMR2Pu1ip4unrXe8QMLH9bTv7AeAQwh3+EI+J6KBesRN7z1F02YYj0CGALhkCRdPKdiQXu/Np7RtUYrXjLeAAwD4fiBY7vkezq13+bqrR1av0ENDTZXB1wQjtvs/Ex+QVd6477ukz/XopVxXxQYEcIxkHJJfkGb34vvirPu0bp/i+9yQH0Ix+DOn5Dv6cDGOK718n9oxsI4LgSEgXAM5fBW+Z7OHonwEosf0xM/jfD1gbARjuHZ9pGKBfVfDf+Vm5q1foNaJob/ykBkCMew9V1RsaDtH4f8sg+/ogefD/k1gYgRDkdnD6vo6ci2cF5t0nS98adwXgqIEeEYkf2+/IJ6TtX7Os/+Ugu6whgExIpw1GHTO/I9Vcoj/MfnLtWL/xzqICAmhKM+l3vke9r1+Uj+2Vd/rylzwx4ExIFwhOHkPvmeju92+EeWPqlVb0Q2CIgW4QjPnq9ULOhS99B/5+hxWr9BY1qi3wREgnCEqlaTX5D/9hB/26rXtfSpWAYBkSAcEeg9o6Knfd8M/N9OmatXfx/vICBkhCMyx3aqWNDpg7f+5y/8k+YtM9gDhIdwRGzHJ/I9Xb14/S8XLNezvzIdBISAcESv1Cff05b3Jen1/1b7DOtBQL0IR1y6j2vft3rkFesdQAgIBwBnjdYDAKQP4QDgjHAAcEY4ADgjHACcEQ4AzggHAGeEA4AzwgHAGeEA4IxwAHBGOAA4IxwAnBEOAM4IBwBn/w8w9cjI1zzUygAAAABJRU5ErkJggg==" width="360" height="300" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="转盘的布局">转盘的布局<a href="https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable#%E8%BD%AC%E7%9B%98%E7%9A%84%E5%B8%83%E5%B1%80" class="hash-link" aria-label="Direct link to 转盘的布局" title="Direct link to 转盘的布局">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="有问题的思路">有问题的思路<a href="https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable#%E6%9C%89%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%9D%E8%B7%AF" class="hash-link" aria-label="Direct link to 有问题的思路" title="Direct link to 有问题的思路">​</a></h3>
<p>复习完语法，你可能会想 6 个矩形围着自己右下角旋转，似乎能实现转盘布局。</p>
<p>代码如下，其中 <code>--i</code> 和 <code>--clr</code> 是 CSS 的变量，方便我们计算角度、获取颜色。</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">style</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css selector">...</span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css selector">  </span><span class="token style language-css selector class">.item</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    ...</span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">background-color</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css function" style="color:rgb(0, 0, 255)">var</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">transform-origin</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> right bottom</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">transform</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css function" style="color:rgb(0, 0, 255)">rotate</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css function" style="color:rgb(0, 0, 255)">calc</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css number" style="color:rgb(9, 134, 88)">60</span><span class="token style language-css unit">deg</span><span class="token style language-css"> </span><span class="token style language-css operator" style="color:rgb(0, 0, 0)">*</span><span class="token style language-css"> </span><span class="token style language-css function" style="color:rgb(0, 0, 255)">var</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">style</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">box</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag special-attr attr-name" style="color:rgb(255, 0, 0)">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:rgb(9, 134, 88)">0</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css hexcode color" style="color:rgb(128, 0, 0)">#ff7875</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag special-attr attr-name" style="color:rgb(255, 0, 0)">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:rgb(9, 134, 88)">-1</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css hexcode color" style="color:rgb(128, 0, 0)">#ff9c6e</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag special-attr attr-name" style="color:rgb(255, 0, 0)">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:rgb(9, 134, 88)">-2</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css hexcode color" style="color:rgb(128, 0, 0)">#ffc069</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag special-attr attr-name" style="color:rgb(255, 0, 0)">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:rgb(9, 134, 88)">-3</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css hexcode color" style="color:rgb(128, 0, 0)">#d3f261</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag special-attr attr-name" style="color:rgb(255, 0, 0)">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:rgb(9, 134, 88)">-4</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css hexcode color" style="color:rgb(128, 0, 0)">#95de64</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag special-attr attr-name" style="color:rgb(255, 0, 0)">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:rgb(9, 134, 88)">-5</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css hexcode color" style="color:rgb(128, 0, 0)">#5cdbd3</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>但这种思路是有问题的，如图所示，6 个矩形依次逆时针旋转，会导致第 5 个矩形覆盖在第 0 个矩形上，无法实现转盘布局。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="360" height="360" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="正确的思路">正确的思路<a href="https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable#%E6%AD%A3%E7%A1%AE%E7%9A%84%E6%80%9D%E8%B7%AF" class="hash-link" aria-label="Direct link to 正确的思路" title="Direct link to 正确的思路">​</a></h3>
<p>6 个矩形依次逆时针旋转的思路虽然有问题，但也能给我们一些启发。</p>
<p>我们把 6 个矩形拆成左、右两部分：</p>
<ul>
<li>左边是 3 个矩形，以矩形右下角为中心逆时针旋转 0 度、60 度和 120 度，再加上 <code>overflow: hidden;</code> 就得到左半圆。</li>
<li>右边是 3 个矩形，以矩形左下角为中心顺时针旋转 0 度、60 度和 120 度，再加上 <code>overflow: hidden;</code> 就得到右半圆。</li>
<li>拼接左右两个半圆，就得到一个完整的转盘。</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/rect-to-circle-42f6931d8a45223467c17a451dcbf803.png" width="930" height="390" class="img_ev3q"></p>
<p>关键代码如下：</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">style</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css selector class">.left</span><span class="token style language-css selector"> </span><span class="token style language-css selector class">.item</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    ...</span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">background-color</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css function" style="color:rgb(0, 0, 255)">var</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">transform-origin</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> right bottom</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">transform</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css function" style="color:rgb(0, 0, 255)">rotate</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css function" style="color:rgb(0, 0, 255)">calc</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css number" style="color:rgb(9, 134, 88)">60</span><span class="token style language-css unit">deg</span><span class="token style language-css"> </span><span class="token style language-css operator" style="color:rgb(0, 0, 0)">*</span><span class="token style language-css"> </span><span class="token style language-css function" style="color:rgb(0, 0, 255)">var</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css selector class">.right</span><span class="token style language-css selector"> </span><span class="token style language-css selector class">.item</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    ...</span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">background-color</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css function" style="color:rgb(0, 0, 255)">var</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">transform-origin</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> left bottom</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">transform</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css function" style="color:rgb(0, 0, 255)">rotate</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css function" style="color:rgb(0, 0, 255)">calc</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css number" style="color:rgb(9, 134, 88)">60</span><span class="token style language-css unit">deg</span><span class="token style language-css"> </span><span class="token style language-css operator" style="color:rgb(0, 0, 0)">*</span><span class="token style language-css"> </span><span class="token style language-css function" style="color:rgb(0, 0, 255)">var</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token style language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">style</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">box</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">left</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag special-attr attr-name" style="color:rgb(255, 0, 0)">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:rgb(9, 134, 88)">0</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css hexcode color" style="color:rgb(128, 0, 0)">#ff7875</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag special-attr attr-name" style="color:rgb(255, 0, 0)">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:rgb(9, 134, 88)">-1</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css hexcode color" style="color:rgb(128, 0, 0)">#ff9c6e</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag special-attr attr-name" style="color:rgb(255, 0, 0)">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:rgb(9, 134, 88)">-2</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css hexcode color" style="color:rgb(128, 0, 0)">#ffc069</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">right</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag special-attr attr-name" style="color:rgb(255, 0, 0)">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:rgb(9, 134, 88)">0</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css hexcode color" style="color:rgb(128, 0, 0)">#d3f261</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag special-attr attr-name" style="color:rgb(255, 0, 0)">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:rgb(9, 134, 88)">1</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css hexcode color" style="color:rgb(128, 0, 0)">#95de64</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag special-attr attr-name" style="color:rgb(255, 0, 0)">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--i</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:rgb(9, 134, 88)">2</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value value css language-css variable" style="color:rgb(9, 134, 88)">--clr</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token tag special-attr attr-value value css language-css hexcode color" style="color:rgb(128, 0, 0)">#5cdbd3</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="转盘的旋转">转盘的旋转<a href="https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable#%E8%BD%AC%E7%9B%98%E7%9A%84%E6%97%8B%E8%BD%AC" class="hash-link" aria-label="Direct link to 转盘的旋转" title="Direct link to 转盘的旋转">​</a></h2>
<p>我们已知晓转盘的布局如何实现，至于中央按钮和奖品都可以用绝对定位实现，这里我就不再详细说明。一起来看看如何控制转盘的旋转。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="旋转的原理">旋转的原理<a href="https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable#%E6%97%8B%E8%BD%AC%E7%9A%84%E5%8E%9F%E7%90%86" class="hash-link" aria-label="Direct link to 旋转的原理" title="Direct link to 旋转的原理">​</a></h3>
<p>控制转盘旋转很简单，我们只旋转外层的容器 box 即可。如下图所示，在 Chrome 元素控制台中，我们逐渐增加 <code>transform: rotate(0deg)</code> 的取值，就实现了转盘的顺时针旋转。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/rotate-8bba99e9db1165120d60bfea3ccf4dc6.gif" width="850" height="320" class="img_ev3q"></p>
<p>需要注意的是，当容器 box 旋转时，会带动着中央按钮 btn 一起旋转。为了实现 box 旋转而 btn 保持不变的效果，box 顺时针旋转多少度，我们就需要让中央按钮逆时针旋转多少度。因此后续旋转的 js 代码中，我们会有如下代码：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transform</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)">rotate(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">begin</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">deg)</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// translate(-50%, -50%) 是为了让绝对定位的中央按钮居中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">btn</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transform</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)">translate(-50%, -50%) rotate(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation operator" style="color:rgb(0, 0, 0)">-</span><span class="token template-string interpolation">begin</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">deg)</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="基础代码">基础代码<a href="https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable#%E5%9F%BA%E7%A1%80%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 基础代码" title="Direct link to 基础代码">​</a></h3>
<p>现在我给出基础的旋转代码：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> box </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementById</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'box'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  btn </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementById</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'btn'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">btn</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'click'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> randomIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">parseInt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">randomIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">60</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> timer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(0, 0, 255)">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">angle</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> begin </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> base </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1800</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  timer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">setInterval</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> finalAngle </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> base </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> angle</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">begin </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token plain"> finalAngle</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token function" style="color:rgb(0, 0, 255)">clearInterval</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">timer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transform</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)">rotate(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">begin</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">deg)</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    btn</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">transform</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)">translate(-50%, -50%) rotate(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation operator" style="color:rgb(0, 0, 0)">-</span><span class="token template-string interpolation">begin</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">deg)</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    begin </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>代码主要分为 2 部分，第 1 部分绑定 btn 点击事件，第 2 部分控制 box 和 btn 的旋转。</p>
<p>我们先看第 1 部分，这部分我们会先获取一个 0 ~ 5 的随机下标 randomIndex，利用 randomIndex * 60 来计算旋转的角度（一个奖品扇形区域是 60 度）。之所以要再加上 30 度，是因为我们希望旋转结束之后，指针指向中奖区域的中轴线。</p>
<p>再看第 2 部分，我们设置了 1800 度的基础角度 base（因为 1800 = 360 * 5，也就是至少要旋转 5 圈后才会停止）。又设置了一个计时器，每过 16 秒就旋转 30 度，直到超过目标度数后才停止旋转。</p>
<p>代码的效果如下：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/base-rotate-a69cd6753ddace42e63757261e723f53.gif" width="360" height="314" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="改善体验">改善体验<a href="https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable#%E6%94%B9%E5%96%84%E4%BD%93%E9%AA%8C" class="hash-link" aria-label="Direct link to 改善体验" title="Direct link to 改善体验">​</a></h3>
<p>基础旋转代码虽然实现了效果，但体验还有待改善。主要有两点需要优化。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="旋转时按钮不能被再次点击">旋转时，按钮不能被再次点击<a href="https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable#%E6%97%8B%E8%BD%AC%E6%97%B6%E6%8C%89%E9%92%AE%E4%B8%8D%E8%83%BD%E8%A2%AB%E5%86%8D%E6%AC%A1%E7%82%B9%E5%87%BB" class="hash-link" aria-label="Direct link to 旋转时，按钮不能被再次点击" title="Direct link to 旋转时，按钮不能被再次点击">​</a></h4>
<p>开始旋转时，此时按钮应该不能被再次点击。只有旋转结束后，按钮才能被再次点击，因此我们需要增加一个点击锁 clickLock。关键代码如下：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> clickLock </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">btn</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'click'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">clickLock</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> timer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(0, 0, 255)">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">angle</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  clickLock </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  timer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">setInterval</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">begin </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token plain"> finalAngle</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      clickLock </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token function" style="color:rgb(0, 0, 255)">clearInterval</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">timer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>开始时 clickLock 为 false，转盘旋转时 clickLock 会被置为 true，停止旋转时 clickLock 会被置为 false。这样转盘旋转期间，如果用户继续点击按钮，点击事件会被拦截、不再触发旋转函数 run。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="旋转时速度需要越来越慢">旋转时，速度需要越来越慢<a href="https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable#%E6%97%8B%E8%BD%AC%E6%97%B6%E9%80%9F%E5%BA%A6%E9%9C%80%E8%A6%81%E8%B6%8A%E6%9D%A5%E8%B6%8A%E6%85%A2" class="hash-link" aria-label="Direct link to 旋转时，速度需要越来越慢" title="Direct link to 旋转时，速度需要越来越慢">​</a></h4>
<p>基础代码实现的转盘，转盘旋转的速度是恒定的。当旋转结束时，转盘会瞬间停止，这会让用户感觉很突兀。正常来说，转盘的旋转速度应该越来越慢。</p>
<p>旋转速度越来越慢，可以用旋转的角度越来越小简介实现，越来越小的旋转角度可以用下面的公式计算：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">step = (final - current) * ratio</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>current 是已经旋转的角度。</li>
<li>step 是在 current 基础上，下一次转动需要增加的角度。</li>
<li>ratio 是一个比例。</li>
</ul>
<p>从公式中可以看出，随着 current 越来越大，step 会越来越小，也就是下一次转动的角度会越来越小。</p>
<p>我们把公式写成代码，假设每 16ms 需要旋转一定角度，最终要旋转 1800 度：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> current </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> final </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1800</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> ratio </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> timer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">setInterval</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">current </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token plain"> final</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">clearInterval</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">timer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> step </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">final </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> current</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> ratio</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token console class-name" style="color:rgb(38, 127, 153)">console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">log</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">step</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  current </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain">  </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">ceil</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">step</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此段代码的打印的 step 如下，不难看出 step 变得越来越小了。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="360" height="250" class="img_ev3q"></p>
<p>上述代码可以应用到基础代码中，从而让转盘的旋转速度越来越慢。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="中奖的概率">中奖的概率<a href="https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable#%E4%B8%AD%E5%A5%96%E7%9A%84%E6%A6%82%E7%8E%87" class="hash-link" aria-label="Direct link to 中奖的概率" title="Direct link to 中奖的概率">​</a></h2>
<p>之前旋转角度，我们是先获取了 0 ~ 5 之间的一个随机下标（此下标就是奖品的下标），然后计算了旋转角度。这时每个奖品的中奖概率都是 20%。</p>
<p>但抽奖一般都需要控制中奖的概率，这个该怎么实现呢？</p>
<p>在抽奖转盘中，我们可以利用权重的方式控制抽奖概率。</p>
<p>假设我们有 6 个奖项，需要控制奖品 0 ~ 奖品 4 的中奖概率都是 1%，而奖品 5 的中奖概率是 95%，我们应该如何做呢？</p>
<p>控制中奖概率的代码如下所示：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">getRandomIndex</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> weights </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> random </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">floor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> newWeights </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> weights</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">concat</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">sort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">a</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> b</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> randomIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> newWeights</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">indexOf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> randomIndex</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们先给出了一个 weights 数组，又获取了一个 100 以内的随机数 random，并对 random 向下取整</p>
<ul>
<li>random 为 0 的概率是 1%，因为小于 1 的数都被向下取整为 0；</li>
<li>random 为 1 的概率是 1%，因为大于 1 小于 2 的数都被向下取整为 1；</li>
<li>random 为 2 的概率是 1%，因为大于 2 小于 3 的数都被向下取整为 2；</li>
<li>random 为 3 的概率是 1%，因为大于 3 小于 4 的数都被向下取整为 3；</li>
<li>random 为 4 的概率是 1%，因为大于 4 小于 5 的数都被向下取整为 4；</li>
<li>random 大于 5 小于 100 的概率则是 95%。</li>
</ul>
<p>我们把 random 插入到 weights 数组中，再从小到大排序，此时 random 对应的下标就是奖品下标。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="完整代码">完整代码<a href="https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 完整代码" title="Direct link to 完整代码">​</a></h2>
<p><a href="https://codepen.io/lijunlin2022/pen/YzMdvEL" target="_blank" rel="noopener noreferrer">turntable | codepen</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/04/17/lottery-turntable#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文说明了 H5 如何实现抽奖转盘：</p>
<ul>
<li>转盘的布局：布局时要将转盘拆分为左、右两部分，最后合并为一个转盘。</li>
<li>转盘的旋转：改变转盘容器的旋转角度，可以实现转盘的旋转。加载锁，旋转速度越变越慢可以改善转盘的使用体验。</li>
<li>中奖的概率：权重数组可以控制中奖概率。</li>
</ul>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>]]></content:encoded>
            <category>H5</category>
        </item>
        <item>
            <title><![CDATA[对比小红书与电商三巨头的瀑布流，H5 瀑布流实现方案应该如何选择？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow</link>
            <guid>https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow</guid>
            <pubDate>Mon, 08 Apr 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[瀑布流布局，我们既能在小红书这类图文网站看到，也能在拼多多、京东和淘宝这类电商网站看到。小红书的瀑布流，是利用绝对定位计算高度实现。而电商三巨头的瀑布流，则是利用 Flex 布局实现。]]></description>
            <content:encoded><![CDATA[<p>瀑布流布局，我们既能在小红书这类图文网站看到，也能在拼多多、京东和淘宝这类电商网站看到。小红书的瀑布流，是利用绝对定位计算高度实现。而电商三巨头的瀑布流，则是利用 Flex 布局实现。</p>
<p>那么，同样是瀑布流，两种实现方式的优点、缺点是什么呢？如果想用 H5 实现瀑布流，应该用哪一种方案呢？</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/xiaohongshu-0509fe8ae9d14dbb8742f5cabc65de53.png" width="1912" height="932" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/pdd-jd-taobao-cfe32288d192787b974ca0527a1fb58d.png" width="826" height="514" class="img_ev3q"></p>
<p>本文中，我会首先介绍瀑布流是什么，接着我会介绍小红书瀑布流实现方式，并给出示例代码；然后，我会给出电商三巨头瀑布流实现方式，并给出示例代码；最后，我会做一个两种方案的对比总结。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="瀑布流是什么">瀑布流是什么<a href="https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow#%E7%80%91%E5%B8%83%E6%B5%81%E6%98%AF%E4%BB%80%E4%B9%88" class="hash-link" aria-label="Direct link to 瀑布流是什么" title="Direct link to 瀑布流是什么">​</a></h2>
<p>瀑布流是一种宽度相同，高度不同的卡片布局方式。</p>
<p>如下图所示，传统布局中宽度相同、高度不同的卡片排列在一起时，会出现大量空白。这样既浪费了空间、又不美观。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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yz7Kt8fZPqn07axI4SeA5YDncGuByFx1MDAwNFx1MDAxNFJcdTAwMDB3KXCFPG8+h/O7l25z0awtXHUwMDFi1c6ULq7JsVCzOVxyyZxcdESKc/b9w/L5vFx1MDAwMlYmXHUwMDEyU4owXHUwMDA1OevvXHUwMDAxvlxmYS7UJoKQXHUwMDExXGL3hOD2XHUwMDE5I0RcdTAwMDBIsGA7I9i/XHUwMDE5cjn80/Z7ol+7XCItb3Zbvz9uXHUwMDA0IcyN2CFcdTAwMTgkXHUwMDFiXGJcdTAwMTJcdTAwMGVcdTAwMThcdTAwMDb5vu9cdTAwMWZBwoVcdTAwMTD7OVx1MDAwNTHfOPw/XHUwMDEw5JxRXHUwMDBl4e5cdTAwMDB617jZXHSe72u9h0t1XHUwMDFm/Vx1MDAxZT9xcHf0XHUwMDAwslx1MDAwMoBcYuFDXHUwMDEziIDgXHUwMDE4m1x1MDAwNJBcdTAwMDNcIkhcdTAwMTlcdTAwMTAm2Vx1MDAwZoJs6yloXHUwMDAyRlx1MDAxOWKI78zgVT1cdTAwMDZ1eCsuXGJ8Ji2lusirguNmsPxcdTAwMWNGqLz33lx1MDAxMdRcYlx1MDAxMJNylDudXHUwMDBmgKCJXHUwMDA1p/tBXHUwMDEwbz1cdTAwMDVcdTAwMTGkglGw07vuXG7BUbNRXHUwMDE1Y1B76jaqzmWv3qnbN73jRrD8yXVcdTAwMDSnICOYUf1cdTAwMTT87m+fL1x1MDAxMahfRcnXXHTU9zSoYVx1MDAwNUE71iG1esWjrsF12u6LLIQxZq6cX2y28XSQ/oyTd6pcdTAwMTN0ZJLz69vJ23/yXHUwMDFkXHUwMDA1vCJ9jJSmDQAAAABJRU5ErkJggg==" width="573" height="259" class="img_ev3q"></p>
<p>而瀑布流布局，则可以有效利用空白的空间，实现美观的效果。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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b24vdm5kLmV4Y2FsaWRyYXcranNvbgB7InZlcnNpb24iOiIxIiwiZW5jb2RpbmciOiJic3RyaW5nIiwiY29tcHJlc3NlZCI6dHJ1ZSwiZW5jb2RlZCI6Inic5ZdbT+JAXHUwMDE0gN/9XHUwMDE1pL6ade6d8VHcLOhcdTAwMDaCKCCbjantXHUwMDAwlaGt7XCT+N93WpRCXHJcdTAwMDZcdTAwMTMjJFx1MDAwYskkc+bc5vCd07I4KpUsPY+kdVay5Mx1lO/FztQ6SeVcdTAwMTNcdTAwMTknflx1MDAxOJgjlO2TcFx1MDAxY7uZ5kDrKDk7Pc0tfrjhaGkllVx1MDAxY8lAJ0bvj9mXSotsNSe+l9rabdjoupOG8GK/we+bo9ZDt5eZZkpvycTS1U7QVzI/mlx1MDAxOTlcdTAwMTN8tZ+bPaT2aj/1PT1IZSzXXHUwMDE5SL8/0Fx1MDAwNeHS71lcdKwkiY7DoSyHKozT4MdQpt889IPjXHUwMDBl+3E4XHUwMDBlvJWOjp0giZzY3DXX6/lKNfU8827qZWpjXHUwMDE1YrTfkizIt1mZoP1BIJNkI98wclxcX2dcdTAwMDVcdTAwMDC5NM0wqnpZ6f/mOcXOSFbT2lx1MDAwN2Ol1lx1MDAxZFx1MDAwN96r442DRMpUXHUwMDE5XCJcZjiGlLLVSVx1MDAwZVx1MDAwNIR2UVpcdTAwMGKDXGZcdTAwMGVbYJszY7tS8JNcdTAwMGJcdTAwMDOFzrz2XHUwMDFjlci8rGlcdTAwMGU/c2A28lx1MDAxOEeeszSCNjT+XHUwMDE4QFxi4zyu8oNh0UaF7jCPk0lfTjYp/Fx1MDAwMLA14Fx1MDAwNdx2PyG4ScQsO9xvSTyvP8XT2+d2fVavzGvl1pjOrsihMPO+XHUwMDE30jbja/dftlx1MDAxOf3yXvm4XVx1MDAwMStcdTAwMDKJKUWYgjXtr+G9XGLhmqv9XCK4tcVMxVx1MDAwNGLQZmRnXHUwMDA2u9d9Lvu/m2FHdCuXpFx1MDAxMUxuqneHzSBcdTAwMDS22C+E5Fx1MDAxZIOEXHUwMDAzM9qwYP9cdTAwMDeDXHUwMDA08m1cZlJcIlx1MDAwMLVcdTAwMTHafVxmXHUwMDA2V7jeip7uKp37XHUwMDBidZf8XHUwMDFhPnJwe+hcYvLNOYhstG9cdTAwMDRcdTAwMTFcdTAwMTDc/P5cdTAwMDSQfTKIMYD0e1x1MDAxOFxcQ6w4XHUwMDA3OTMvXCJcdTAwMThCtjOEl1VccqrwRpxcdTAwMTP4RFx1MDAxYUq1UVBcdTAwMDaHXHUwMDBlYWFcdTAwMGVcIlhcZv7tXHUwMDEwXHUwMDFhXGKITTmCaJ9cdTAwMTBcIi4w/lx1MDAxNlxiMd9cbiGCXHUwMDAwckBcdTAwMTDf/WE8qNfKYlxiKo/tWtm76FRbVfe6c9hcdTAwMTBcdTAwMTZfXGKRzfbNICOYUSG+/P/P5+agoEh8XHUwMDFhQbNmTi0niprauDTHSyDNXHUwMDFkfK/pP8tccjfWxJfT8/dlPO5lXHUwMDFm6+hcdTAwMTXrXHUwMDE0XHUwMDFkmea8eDl6+Vx1MDAwN7xcdTAwMWZcdTAwMDbLIn1I/pMZAAAAAElFTkSuQmCC" width="571" height="190" class="img_ev3q"></p>
<p>在开始介绍瀑布流如何实现之前，我们先给出一个工具函数，这个工具函数可以生成长度为 len 的图片数组，且每张图片都是 svg，宽度范围在 300px 到 400px，高度在 250px 到 500px。我们会使用数组中的图片实现瀑布流布局。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">// 随机生成宽度在 300~400，高度在 250~500 的图片</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">getItems</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> items </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> width </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">floor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">400</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">300</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">300</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> height </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">floor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">500</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">250</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">250</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> url </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">      data:image/svg+xml;charset=utf-8,</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">      &lt;svg</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">        xmlns="http://www.w3.org/2000/svg"</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">        width="</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">width</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">"</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">        height="</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">height</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">"</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">        viewBox="0 0 </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">width</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)"> </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">height</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">"</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">      &gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">        &lt;text</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">          x="50%"</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">          y="50%"</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">          dominant-baseline="middle"</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">          text-anchor="middle"</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">          font-size="20"</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">          fill="black"</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">        &gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">          </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">width</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)"> * </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">height</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">        &lt;/text&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">      &lt;/svg&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">    </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    url </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> url</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">replace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token regex regex-source language-regex char-class escape">\r</span><span class="token regex regex-source language-regex char-class escape">\n</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token regex regex-source language-regex quantifier number" style="color:rgb(9, 134, 88)">+</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">g</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">''</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">replace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex char-set class-name" style="color:rgb(38, 127, 153)">\s</span><span class="token regex regex-source language-regex quantifier number" style="color:rgb(9, 134, 88)">+</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">g</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">' '</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">trim</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    items</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">push</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> width</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> height</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> url </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> items</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/getItems-d20f4d99a3d341664a2e198ddb84e177.png" width="800" height="325" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="小红书的瀑布流">小红书的瀑布流<a href="https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow#%E5%B0%8F%E7%BA%A2%E4%B9%A6%E7%9A%84%E7%80%91%E5%B8%83%E6%B5%81" class="hash-link" aria-label="Direct link to 小红书的瀑布流" title="Direct link to 小红书的瀑布流">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理">原理<a href="https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow#%E5%8E%9F%E7%90%86" class="hash-link" aria-label="Direct link to 原理" title="Direct link to 原理">​</a></h3>
<p>假如小红书需要实现左、中、右三列的瀑布流，它会先找高度最低的列放置图片，如果相同高度的列，则按照从左到右的顺序放置。</p>
<p>如下图所示，初始时每一列初始高度都为 0，所以图片应该先放最左侧的列。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="565" height="190" class="img_ev3q"></p>
<p>放完第 0 张图片后，此时中、右两列高度为 0，所以第 1 张图放在中列。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="565" height="190" class="img_ev3q"></p>
<p>放完第 1 张图片后，此时右列高度为 0，是最低的列，所以第 2 张图放在右列。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="565" height="190" class="img_ev3q"></p>
<p>放完第 2 张图片后，此时右列高度最低，所以第 3 张图放在右列。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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7cFgcKKHwG63e3LX6Hd2dg4fMofD4eQTecRisfz8lA5P29raUll+JfmBcCqS7KdgTIyfoDN9D4SRLZIfCAOTwPgJ+mM/BSB9jJ8AACqinwAAKqKfAAAqop8AACqinwAAKqKfAAAqop8AACqinwAAKqKfAAAqop8AACqinwAAKmL+PQghRCwWkx0BAO5BP0EIIVJcagEAMoa9EgBARYnjp+7ubik5AAAYKbGfOA8BAFBBYj/puL41AACTxvknAICK6CcAgIroJwCAiugnAICK6CcAgIroJwCAiugnAICKmH8PQggRCARkRwCAe9BPEIL7sgGoh9/3AAAqop8AACqinwAAKqKfAAAqop8AACqinwAAKqKfAAAqop8AACri/lwIIUQkEpEdAQDuQT9BCCFKS0tlRwCAe/D7HgBARYnjp2g0KiUHAAAjJfaT1+uVkgMAgJES+2n27NlScgAAMBLnnwAAKqKfAAAqop8AACqinwAAKqKfAAAqop8AACqinwAAKqKfAAAqop8AACqinwAAKqKfAAAqop8AACqinwAAKqKfAAAqop8AACqinwAAKqKfAAAqop8AACqinwAAKqKfAAAqop8AACqaMvohTdOcTmfmo3g8nqqqqsx/7hCv12u322V9uhAiFAqZTCZZn65pmsPhkPXpADBa4vjJ5XKxnzIgh8PhcrlkpwCA/8uLx+OyMwAAkIjzTwAAFdFPAAAV0U8AABXRTwAAFdFPAAAV0U8AABXRTwAAFdFPAAAV0U8AABX9D1Wst51lU+EyAAAAAElFTkSuQmCC" width="565" height="190" class="img_ev3q"></p>
<p>放完第 3 张图片后，此时中、右两列高度相同，所以第 4 张图放在中列。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="565" height="190" class="img_ev3q"></p>
<p>放完第 4 张图片后，此时右列高度最低，所以第 5 张图片放在右列。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="565" height="190" class="img_ev3q"></p>
<p>我们可以打开小红书网页版的控制台，在控制台可以检查元素，可以看到它的布局完全符合这个规律。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/xiaohongshu-7e17e73263800e2a75d19637bb5195c5.gif" width="1200" height="800" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="关键代码解释">关键代码解释<a href="https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow#%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E8%A7%A3%E9%87%8A" class="hash-link" aria-label="Direct link to 关键代码解释" title="Direct link to 关键代码解释">​</a></h3>
<p>说完原理，我们现在来看下关键代码，代码整体思路，可以理解为先插入图片，再设置图片位置。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="插入图片">插入图片<a href="https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow#%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87" class="hash-link" aria-label="Direct link to 插入图片" title="Direct link to 插入图片">​</a></h4>
<p>先看基础布局，布局非常简单，就是一个定位为 relative 的盒子元素。之后我们会在盒子中元素中一张张插入图片，每一个图片的定位都是 absolute。</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">style</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css selector">...</span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css selector">  </span><span class="token style language-css selector id">#box</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">position</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> relative</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css selector id">#box</span><span class="token style language-css selector"> img</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">position</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> absolute</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">object-fit</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> cover</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">    </span><span class="token style language-css property">background-color</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token style language-css"> </span><span class="token style language-css hexcode color">#eee</span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  </span><span class="token style language-css punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css">  ...</span><br></span><span class="token-line" style="color:#000000"><span class="token style language-css"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">style</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">box</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>插入图片的 JavaScript 代码如下，入参 items 可以前文提到的工具函数 <code>getItems()</code> 生成。至于 imgWidth 则是每一列的宽度，我们可以自行指定。</p>
<p>我们在 <code>getItems()</code> 中生成了宽高不一的图片，当图片实际显示在屏幕上时，它们的宽度都会缩写为 imgWidth，因此我们也要将它们的高度等比例缩放。</p>
<p>我们的做法就是计算出 imgWidth 与每一张图片 width 的比例 ratio，然后用每一张图片的 height * ratio 获得等比例缩放的高度。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">// 加入图片元素</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">createImgs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">items</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> imgWidth</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> items</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> url</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token literal-property property">width</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> w</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token literal-property property">height</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> h </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> items</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> img </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">createElement</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'img'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> ratio </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> imgWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> w</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> imgHeight </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">floor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">h </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> ratio</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> imgWidth</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> imgHeight</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> url</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">appendChild</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="设置图片位置">设置图片位置<a href="https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow#%E8%AE%BE%E7%BD%AE%E5%9B%BE%E7%89%87%E4%BD%8D%E7%BD%AE" class="hash-link" aria-label="Direct link to 设置图片位置" title="Direct link to 设置图片位置">​</a></h4>
<p>设置图片位置之前，我们需要知道瀑布流被分为几列，以及每一列的间隙。</p>
<p>如下图所示，瀑布流的列数 <code>colNumber = Math.floor(boxWidth / imgWidth)</code>，间隙的列数则是 <code>colNumber - 1</code>。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABEQAAAERCAIAAAD9nOWXAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AABMkSURBVHic7d3PTlRZAsDhU4DaMz2j5j6AFTPxGt6AxEBcUDsIPIEkUrOqsDMVN4QQNp2KO1OrLkz0CTDFDhZGYsIbEG+nY+ABbtTJxNgIzKKgoKC0dcAuDn7fSg6XwzG5oep3/1Xhw4cPe3t7u7u729vbf/zxR6FQKBQK/f39AU7h6tWrp9yL9vb23r59e1brgbbT75y7u7vv3r07q/VA27Vr1/r6+k4zw87Ozvv3789qPdB2/fr1QqFwmhnsnJzezs7O3t7e3t7e5cuXL1261NfXVygUBvb29j59+vTx48ednZ3Lly/3epEAAADHtY9Ffvz4cXt7+6effhoYGOj79OnThw8f+vr6lAwAAHDOXb58eWBg4MOHDzs7O33b29u7u7unPHUIAADwl9nd3f3jjz/6tre3r1y50uvFAAAAfK0rV65sb2/3OScDAADESMwAAADxKRQKfZ7CDAAARKe/v9+ZGQAAID59p/xwLgAAgF4RMwAAQJTEDAAAECUxAwAAREnMAAAAURIzAABAlMQMAAAQJTEDAABEScwAAABREjMAAECUxAwAABAlMQMAAERJzAAAAFESMwAAQJTEDAAAECUxAwAAREnMAAAAURIzAABAlMQMAAAQJTEDAABEScwAAABREjMAAECUxAwAABAlMQMAAERJzAAAAFESMwAAQJTEDAAAECUxAwAAREnMAAAAURIzAABAlMQMAAAQJTEDAABEScwAAABREjMAAECUxAwAABAlMQMAAERJzAAAAFESMwAAQJTEDAAAECUxAwAAREnMAAAAURIzAABAlMQMAAAQJTEDAABEScwAAABREjMAAECUxAwAABAlMQMAAERJzAAAAFESMwAAQJTEDAAAECUxAwAAREnMAAAAURIzAABAlMQMAAAQJTEDAABEScwAAABREjMAAECUxAwAABAlMQMAAERJzAAAAFESMwAAQJTEDAAAECUxAwAAREnMAAAAURIzAABAlMQMAAAQJTEDAABEScwAAABREjMAAECUxAwAABAlMQMAAERJzAAAAFESMwAAQJTEDAAAECUxAwAAREnMAAAAURIzAABAlMQM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" width="1092" height="273" class="img_ev3q"></p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">// 计算会有多少列，以及每列的间隙</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">getColumnInfo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">imgWidth</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> boxWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">clientWidth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> colNumber </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">floor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">boxWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> imgWidth</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 列的数量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> spaceNumber </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> colNumber </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> leftSpace </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> boxWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> colNumber </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> imgWidth</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> colSpace </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">parseFloat</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">leftSpace </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> spaceNumber</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">toFixed</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    colSpace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    colNumber</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接下来，我们需要设置每一张图片的位置。因为图片定位是 absolute，所以如果要设置位置，我们需要知道每一张图片到顶部的距离 top，以及到左侧的距离 left。</p>
<p><code>setPosition()</code> 函数有四个入参：</p>
<ul>
<li><code>items</code> 代表图片数组，也就是之前提到的工具函数 <code>getItems()</code> 的结果。</li>
<li><code>colNumber</code> 代表瀑布流有几列，之前 <code>getColumnsInfo()</code> 结果中包含这个结果。</li>
<li><code>colSpace</code> 代表瀑布流列与列之间的间隙，之前的 <code>getColumnsInfo()</code> 结果中也包含这个结果。</li>
<li><code>rolSpace</code> 代表瀑布流行与行之间的间隙，这个间隙我们可以自行设置，我们也设置 <code>rolSpace</code> 等于 <code>colSpace</code>。</li>
</ul>
<p>我们在瀑布流原理一节已经知道，设置瀑布流图片时，要找到瀑布流高度最低的列放置图片，如果相同高度的列，则按照从左到右的顺序放置。为此，在 <code>setPosition()</code> 函数中，我们设置了一个长度为 colNumber 的数组，数组保留了一行瀑布流图片的 top 的数组。</p>
<p>需要注意的是，我们这里用 <code>Math.min.apply(null, nextTops)</code> 找出最低 top 的下标。</p>
<p>每摆放一个图片，nextTops 都会更新对应下标的 top 值。下一行图片的 top 值，就是本行图片的 top + 本行图片的高度 + 行之间的间隙。至于 left 值，则是（图片本身的宽度 + 列之间的间隙）* 下标。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">// 设置每张图片的位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">setPosition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">items</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> colNumber</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> colSpace</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> rowSpace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">// 数组长度为列数，每一项代表下一行的图片的 top 值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> nextTops </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Array</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">colNumber</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">fill</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> items</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> img </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">children</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> top </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">min</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">apply</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword null nil" style="color:rgb(0, 0, 255)">null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> nextTops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">top</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> top </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'px'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> index </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> nextTops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">indexOf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">top</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    nextTops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">index</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> nextTops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">index</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> rowSpace</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> left </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> index </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> colSpace </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> index </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">left</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> left </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'px'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> max </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">max</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">apply</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword null nil" style="color:rgb(0, 0, 255)">null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> nextTops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> max </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'px'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="重新设置位置">重新设置位置<a href="https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow#%E9%87%8D%E6%96%B0%E8%AE%BE%E7%BD%AE%E4%BD%8D%E7%BD%AE" class="hash-link" aria-label="Direct link to 重新设置位置" title="Direct link to 重新设置位置">​</a></h4>
<p>我们可以把设置位置的函数封装为 <code>init()</code> 函数，并给页面宽高变化的事件绑定上 <code>init()</code> 函数，这样就能实现当窗口变化时，瀑布流也重新改变的效果。</p>
<p>我们实现的瀑布流效果如下：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/waterfall-absolute-1f496b0ee830997cfb8e407b85ac4c11.gif" width="1464" height="815" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="完整代码">完整代码<a href="https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 完整代码" title="Direct link to 完整代码">​</a></h3>
<p><a href="https://codepen.io/lijunlin2022/pen/ZEZjrza" target="_blank" rel="noopener noreferrer">absolute-waterfall | codepen</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="电商三巨头的瀑布流">电商三巨头的瀑布流<a href="https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow#%E7%94%B5%E5%95%86%E4%B8%89%E5%B7%A8%E5%A4%B4%E7%9A%84%E7%80%91%E5%B8%83%E6%B5%81" class="hash-link" aria-label="Direct link to 电商三巨头的瀑布流" title="Direct link to 电商三巨头的瀑布流">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理-1">原理<a href="https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow#%E5%8E%9F%E7%90%86-1" class="hash-link" aria-label="Direct link to 原理" title="Direct link to 原理">​</a></h3>
<p>电商三巨头中，我们以京东首页为例。我们也是需要找到瀑布流中高度最低的一例，然后把图片放置到这一列中。不同的是，小红书的绝对定位布局中，瀑布流的列只是一个概念，并没有实际的 Dom 元素；而京东的瀑布流的列，则是一个实际的 Dom 元素。</p>
<p>当列变为 Dom 元素之后，我们便不再需要计算 top 和 left 值，只需要知道目前那一列比较低，就把图片元素插入到哪一列中。</p>
<p>我们可以打开京东网站的控制台，并检查它瀑布流的元素：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/jd-90d6958ace63854b7e678f2ff8ca389f.gif" width="1200" height="800" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="关键代码解释-1">关键代码解释<a href="https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow#%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E8%A7%A3%E9%87%8A-1" class="hash-link" aria-label="Direct link to 关键代码解释" title="Direct link to 关键代码解释">​</a></h3>
<p>之前我们提到，小红书的关键代码可以认为是「为先插入图片，再设置图片位置」。而京东的关键代码则可以理解为「先算出图片要插入的列，再插入图片」。</p>
<p>和小红书的关键代码类似，我们先是让图片的高度做了一个等比例的缩放。</p>
<p>为了确认图片应该插入到左右哪一列中，我们分别设置了 leftHeight、rightHeight。如果左列较低，就把图片插入到左列，并更新左列的高度；如果右列较低，就把图片插入到右列，并更新右列的高度。如此循环往复，就实现了双列的瀑布流。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">createImgs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">items</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> imgWidth</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> rowSpace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> leftHeight </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    rightHeight </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> items</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token literal-property property">width</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> w</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token literal-property property">height</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> h</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> url </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> items</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> img </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">createElement</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'img'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> ratio </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> imgWidth </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> w</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> imgHeight </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">floor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">h </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> ratio</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> imgWidth</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> imgHeight</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> url</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">leftHeight </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> rightHeight</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      leftHeight </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> leftHeight </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> imgHeight </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> rowSpace</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      leftBox</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">appendChild</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      rightHeight </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> rightHeight </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> imgHeight </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> rowSpace</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      rightBox</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">appendChild</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>双列瀑布流可以结合我之前的文章 <a href="https://juejin.cn/post/7341329626357973029" target="_blank" rel="noopener noreferrer">H5 上滑加载（触底加载）如何实现</a>，得到如下效果。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/waterfall-flex-a3f91d328ad4558a5447836a1dfec213.gif" width="1200" height="800" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="完整代码-1">完整代码<a href="https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-1" class="hash-link" aria-label="Direct link to 完整代码" title="Direct link to 完整代码">​</a></h3>
<p><a href="https://codepen.io/lijunlin2022/pen/vYMadxY" target="_blank" rel="noopener noreferrer">flex-waterfall | codepen</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="对比总结">对比总结<a href="https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow#%E5%AF%B9%E6%AF%94%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 对比总结" title="Direct link to 对比总结">​</a></h2>
<p>现在我们对小红书的瀑布流和电商三巨头的瀑布流做一个对比总结：</p>
<table><thead><tr><th></th><th>小红书</th><th>拼多多、京东、淘宝</th></tr></thead><tbody><tr><td>实现方式</td><td>绝对定位</td><td>Flex 布局</td></tr><tr><td>计算量</td><td>大</td><td>小</td></tr><tr><td>复杂程度</td><td>高</td><td>低</td></tr><tr><td>列数是否可以改变</td><td>是</td><td>否</td></tr></tbody></table>
<p>如果瀑布流的列数不会改变，那么推荐使用 Flex 布局，它的计算量更小、复杂程度更低；如果瀑布流的列数需要改变，那么推荐使用绝对定位实现。</p>
<p>通常来说，C 端 H5 总是会保留两列，用 Flex 布局更合适。但是有部分产品会推出单双列切换的功能，此时用绝对定位方式会更好。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/04/08/waterfall-flow#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文我们介绍了小红书和电商三巨头（拼多多、京东、淘宝）的瀑布流实现方案，并给出了两种实现瀑布流的代码，最后我们做了一个对比，无论是实现计算量还是难度，Flex 布局均比较简单。但是 Flex 布局无法实现列数切换的情况。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[仿百亿补贴，H5 中图片先模糊后清晰的效果如何实现？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/03/23/ten-billion-subsidy-load-img</link>
            <guid>https://lijunlin2022.github.io/blog/2024/03/23/ten-billion-subsidy-load-img</guid>
            <pubDate>Sat, 23 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[逛过拼多多百亿补贴的同学，可能有一个体会，那就是图片加载非常快，很多图片瞬间就出现了，这是为什么呢？]]></description>
            <content:encoded><![CDATA[<p>逛过拼多多百亿补贴的同学，可能有一个体会，那就是图片加载非常快，很多图片瞬间就出现了，这是为什么呢？</p>
<p>答案是：<strong>百亿补贴先加载了一张模糊小图、再加载了一张清晰大图</strong>。用户很难感知到模糊到清晰的过程，误以为图片加载很快。</p>
<p>接下来我会先给出证据、再分析原理、提供关键代码，之后给百亿补贴的方法做扩展、补充，最后做一个简单总结。</p>
<p>当然，图片优化是涉及知识很琐碎、广泛，<strong>先模糊小图后清晰大图只是其中一种手段，百亿补贴肯定还使用了其他技术。</strong> 如果朋友你想了解更多相关手段，可以点赞关注我。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="证据">证据<a href="https://lijunlin2022.github.io/blog/2024/03/23/ten-billion-subsidy-load-img#%E8%AF%81%E6%8D%AE" class="hash-link" aria-label="Direct link to 证据" title="Direct link to 证据">​</a></h2>
<p>我们可以有三个证据，可以证明：百亿补贴是先加载模糊小图，再加载清晰大图。</p>
<p>第一个证据：我们可以在控制台把网络调整成 Slow 3G，然后强制刷新浏览器，可以看到拼多多的图片，存在一个模糊到清晰的过程。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/Slow-3G-809a0d6428dc8008c0d8a54116f8cc90.png" width="400" height="200" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/pdd-load-555770405aded11264890eab2a7f854f.gif" width="375" height="200" class="img_ev3q"></p>
<p>第二个证据：我们在控制台查看网络请求，可以看到请求中有一张小商品图、一张大商品图。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/product-a2b7df38be78e424c03c20561bae4352.png" width="1120" height="700" class="img_ev3q"></p>
<p>第三个证据：我们在控制台找到图片元素，可以看到图片元素是一个 a 标签包裹着一个 img 标签。其中 a 标签的 background-image 是模糊小图链接，img 标签的 src 是清晰大图链接。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/pdd-console-eae9a68911c3645ff19987e1acb891b4.png" width="900" height="230" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="原理及代码">原理及代码<a href="https://lijunlin2022.github.io/blog/2024/03/23/ten-billion-subsidy-load-img#%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 原理及代码" title="Direct link to 原理及代码">​</a></h2>
<p>要想知道先模糊、后清晰的原理，我们得先看一张 img 标签是如何加载图片的，如下所示：开始时 img 占据的区域为空白，随着图片的逐步加载，空白部分被慢慢填充。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/avatar-load-ecabe8d4415ea0eba801ee48f880b797.gif" width="375" height="338" class="img_ev3q"></p>
<p>准确地说，<strong>img 标签占据的区域，不是「空白」而是「透明」</strong>。这意味着，我们只需要给 img 标签设置一张模糊小图链接，给 img 标签的 src 设置清晰大图链接，当大图慢慢加载时，清晰图片会一步步遮挡住模糊图片，从而实现模糊到清晰的效果。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/avatar-blur-to-clear-6975f39d29bbc190f5fd49d1d3df60eb.gif" width="375" height="338" class="img_ev3q"></p>
<p>关键代码如下，非常简单：</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">box</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">a</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">small-img</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">img</span><span class="token tag" style="color:rgb(128, 0, 0)"></span><br></span><span class="token-line" style="color:#000000"><span class="token tag" style="color:rgb(128, 0, 0)">      </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">large-img</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"></span><br></span><span class="token-line" style="color:#000000"><span class="token tag" style="color:rgb(128, 0, 0)">      </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">src</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">大图链接</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"></span><br></span><span class="token-line" style="color:#000000"><span class="token tag" style="color:rgb(128, 0, 0)">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">a</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token selector class">.box</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">position</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> relative</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token selector class">.small-img</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">position</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> absolute</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">background-image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token url function" style="color:rgb(0, 0, 255)">url</span><span class="token url punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token url string url" style="color:rgb(163, 21, 21)">"小图链接"</span><span class="token url punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">background-size</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cover</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">background-position</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> unset</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token selector class">.large-img</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">width</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ...</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">height</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ...</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>获取小图链接也很简单，现在各大云服务商基本都提供了方法。比如 <a href="https://help.aliyun.com/zh/oss/user-guide/resize-images-4?spm=a2c4g.11186623.0.0.1acf21edXNFC2F" target="_blank" rel="noopener noreferrer">阿里云</a> 只需要在图片 CDN 链接后面拼接一些参数，就可以得到图片缩放的小图。</p>
<ul>
<li>缩放前：<a href="https://oss-console-img-demo-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/example.jpg" target="_blank" rel="noopener noreferrer">https://oss-console-img-demo-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/example.jpg</a></li>
<li>缩放后：<a href="https://oss-console-img-demo-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/example.jpg?x-oss-process=image/resize,w_100,m_lfit" target="_blank" rel="noopener noreferrer">https://oss-console-img-demo-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/example.jpg?x-oss-process=image/resize,w_100,m_lfit</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="更进一步加模糊滤镜">更进一步，加模糊滤镜<a href="https://lijunlin2022.github.io/blog/2024/03/23/ten-billion-subsidy-load-img#%E6%9B%B4%E8%BF%9B%E4%B8%80%E6%AD%A5%E5%8A%A0%E6%A8%A1%E7%B3%8A%E6%BB%A4%E9%95%9C" class="hash-link" aria-label="Direct link to 更进一步，加模糊滤镜" title="Direct link to 更进一步，加模糊滤镜">​</a></h2>
<p>百亿补贴的做法，对于电商活动 H5 已经足够。但更讲究氛围感的 H5，也许会觉得百亿补贴的效果很粗糙。针对这种 H5，我们可以更进一步，给小图加上模糊滤镜，等到大图加载完成时再去除模糊滤镜，并增加 transition 的过渡效果，就得到如下效果：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/blur-20-to-0-07ff519e171be0ebfa1eb178a289f21c.gif" width="375" height="338" class="img_ev3q"></p>
<p>关键代码为：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token selector class">.small-img</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">filter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">blur</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">transition</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> all </span><span class="token number" style="color:rgb(9, 134, 88)">.5</span><span class="token unit">s</span><span class="token plain"> ease-in-out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token selector class">.loaded</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">filter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">blur</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> small </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">querySelector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'.small-img'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> large </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">querySelector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'.large-img'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">large</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(0, 0, 255)">onload</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  small</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">classList</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'loaded'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/03/23/ten-billion-subsidy-load-img#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文分析了百亿补贴图片加载非常快的主要原因：先加载模糊小图，再加载清晰大图。并给出了关键证据，以及实现原理和代码。最后在百亿补贴方法的基础上，增加模糊滤镜，实现了更有氛围感的效果。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>]]></content:encoded>
            <category>H5</category>
        </item>
        <item>
            <title><![CDATA[H5、小程序能用 webp 图片吗？如何判断环境是否支持？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported</link>
            <guid>https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported</guid>
            <pubDate>Sun, 10 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[最近我在做 H5、小程序的性能优化，其中一项优化是把 H5、小程序的 jpg、png 图片转换为 webp 图片，这是因为相比 jpg、png，webp 体积更小、传输速度更快。]]></description>
            <content:encoded><![CDATA[<p>最近我在做 H5、小程序的性能优化，其中一项优化是把 H5、小程序的 jpg、png 图片转换为 webp 图片，这是因为相比 jpg、png，webp 体积更小、传输速度更快。</p>
<p>转换方法很简单，现在各大云服务商基本都提供了方法。比如 <a href="https://cloud.tencent.com/document/product/436/60453" target="_blank" rel="noopener noreferrer">腾讯云</a> 只需要在图片 CDN 链接后面拼接一些参数：</p>
<ul>
<li>转换前：<a href="https://example-1258125638.cos.ap-shanghai.myqcloud.com/sample.png" target="_blank" rel="noopener noreferrer">https://example-1258125638.cos.ap-shanghai.myqcloud.com/sample.png</a></li>
<li>转换后：<a href="http://example-1258125638.cos.ap-shanghai.myqcloud.com/sample.png?imageMogr2/format/webp" target="_blank" rel="noopener noreferrer">http://example-1258125638.cos.ap-shanghai.myqcloud.com/sample.png?imageMogr2/format/webp</a></li>
</ul>
<p>不过我还是遇到了些小麻烦，从 <a href="https://caniuse.com/?search=webp" target="_blank" rel="noopener noreferrer">can I use</a> 查询发现，目前还有少部分浏览器不支持 webp。所以在 H5、小程序使用 webp 格式图片时，我需要做一些兼容。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/can-i-use-webp-65be8d4e5f7ebcff89d5bc2be33036eb.png" width="1370" height="730" class="img_ev3q"></p>
<p>一番研究后，我知道了判断环境是否支持 webp 的几种办法。对这些办法的优劣，我也有自己的观点，于是我便整理了这篇文章。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="todataurlimagewebp">toDataURL('image/webp')<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#todataurlimagewebp" class="hash-link" aria-label="Direct link to toDataURL('image/webp')" title="Direct link to toDataURL('image/webp')">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="代码">代码<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 代码" title="Direct link to 代码">​</a></h3>
<p>第一种 H5 的判断方法，其实是判断 H5 能不能利用 canvas 的 <code>toDataURL()</code> API 得到一张 webp 图片。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">isWebpSupported</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">createElement</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'canvas'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">toDataURL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'image/webp'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">indexOf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'data:image/webp'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">===</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理">原理<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#%E5%8E%9F%E7%90%86" class="hash-link" aria-label="Direct link to 原理" title="Direct link to 原理">​</a></h3>
<p>这种方法原理是啥呢？我们可以继续在 <a href="https://caniuse.com/?search=webp" target="_blank" rel="noopener noreferrer">Can I use</a> 查询 <code>toDataURL('image/webp')</code> 的兼容性。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/can-i-use-toDataURL-0737cd2f1564acdfd4dc40f7cd9d097b.png" width="1370" height="530" class="img_ev3q"></p>
<p>可以看到，<strong>兼容 <code>toDataURL('image/webp')</code> 的浏览器、是兼容 webp 浏览器的子集。</strong></p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/toDataURL-abfeced3aeb71b89b5cd92e51251382c.png" width="417" height="170" class="img_ev3q"></p>
<p>换句话说，这是一种「宁杀错一百，也不放过一个」的方法。举 Safari 浏览器为例子，它其实是可以展示 webp 图片的，但它会被这种 <code>toDataURL('image/webp')</code> 方法误伤。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/safari-958dd39ed7715445f3ffa5839476b22b.jpg" width="330" height="230" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="优缺点">优缺点<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#%E4%BC%98%E7%BC%BA%E7%82%B9" class="hash-link" aria-label="Direct link to 优缺点" title="Direct link to 优缺点">​</a></h3>
<p>这种方法的优缺点如下:</p>
<ul>
<li>优点：代码短小，且方法是同步的，不影响首屏性能。</li>
<li>缺点：误伤性太高，iOS 的 Safari 浏览器被全部误伤。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="微信小程序能用吗">微信小程序能用吗<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%83%BD%E7%94%A8%E5%90%97" class="hash-link" aria-label="Direct link to 微信小程序能用吗" title="Direct link to 微信小程序能用吗">​</a></h3>
<p>这种判断方法微信小程序可以使用吗？很遗憾不可以。</p>
<p>我们之所以用 <code>toDataURL('image/webp')</code> 判断 H5 能不能使用 webp，前提是我们知道 <strong>兼容 <code>toDataURL('image/webp')</code> 的浏览器、是兼容 webp 浏览器的子集</strong>。</p>
<p>但我在微信官方文档中，没有看到类似 canvas 的 <a href="https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Canvas.toDataURL.html" target="_blank" rel="noopener noreferrer">toDataURL('image/webp')</a> 是 webp 子集的描述。基于此，我判断微信小程序不能用这个方法。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="加载一张-webp-图片试试看会不会出错">加载一张 webp 图片试试，看会不会出错<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#%E5%8A%A0%E8%BD%BD%E4%B8%80%E5%BC%A0-webp-%E5%9B%BE%E7%89%87%E8%AF%95%E8%AF%95%E7%9C%8B%E4%BC%9A%E4%B8%8D%E4%BC%9A%E5%87%BA%E9%94%99" class="hash-link" aria-label="Direct link to 加载一张 webp 图片试试，看会不会出错" title="Direct link to 加载一张 webp 图片试试，看会不会出错">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="代码-1">代码<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#%E4%BB%A3%E7%A0%81-1" class="hash-link" aria-label="Direct link to 代码" title="Direct link to 代码">​</a></h3>
<p>第二种 H5 的判断方法，是直接异步加载一张 webp 格式的图片。如果加载成功，证明环境能支持 webp；如果加载失败，证明环境不支持 webp。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">isWebpSupported</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token maybe-class-name">Image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Promise</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">resolve</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Promise</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">resolve</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> img </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(0, 0, 255)">onload</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token function" style="color:rgb(0, 0, 255)">resolve</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(0, 0, 255)">onerror</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token function" style="color:rgb(0, 0, 255)">resolve</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理-1">原理<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#%E5%8E%9F%E7%90%86-1" class="hash-link" aria-label="Direct link to 原理" title="Direct link to 原理">​</a></h3>
<p>这种方法来源于 <a href="https://developers.google.com/speed/webp/faq?hl=zh-cn#in_your_own_javascript" target="_blank" rel="noopener noreferrer">Google 官方文档</a>，webp 其实支持四个功能，无损压缩、有损压缩、透明度和动画，每个功能对应了一张 webp 图片：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">checkWebpFeature</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">feature</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> kTestImages </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">lossy</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">lossless</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA=="</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">alpha</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA=="</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token literal-property property">animation</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> img </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(0, 0, 255)">onload</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">callback</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">feature</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(0, 0, 255)">onerror</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">callback</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">feature</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  img</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"data:image/webp;base64,"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> kTestImages</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">feature</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果对四种功能都进行判断的话，代码会变得很臃肿。所以实际开发中，基本只选择一张 webp 的图片。</p>
<p>从 <a href="https://caniuse.com/?search=webp" target="_blank" rel="noopener noreferrer">Can I use</a> 查询结果来看，浏览器要么是先支持 webp 的有损压缩，再支持 webp 的无损压缩、透明度和动画；要么是有损压缩、无损压缩、透明度和动画一起支持。因此，我们往往选择一张支持动画的 webp 图片，用它去试探浏览器是否支持 webp 格式。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="优缺点-1">优缺点<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#%E4%BC%98%E7%BC%BA%E7%82%B9-1" class="hash-link" aria-label="Direct link to 优缺点" title="Direct link to 优缺点">​</a></h3>
<ul>
<li>优点：基本不会误伤；</li>
<li>缺点：异步加载，可能无法及时转换图片链接、影响首屏性能。如果 H5 不选择 CSR，而选择 SSR，则无法使用此方法。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="微信小程序能用吗-1">微信小程序能用吗<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%83%BD%E7%94%A8%E5%90%97-1" class="hash-link" aria-label="Direct link to 微信小程序能用吗" title="Direct link to 微信小程序能用吗">​</a></h3>
<p>这种方法小程序可以用吗？理论上可以，但不推荐使用。</p>
<p>微信官方文档上虽然提到了 <a href="https://developers.weixin.qq.com/minigame/dev/api/render/image/wx.createImage.html" target="_blank" rel="noopener noreferrer">createImage</a> 方法，但我实际测试发现，这个方法竟然没了 (* ￣︿￣)。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/createImage-6306f0937520db614460a7364e32e263.jpg" width="1100" height="320" class="img_ev3q"></p>
<p>我们使用此方法，就必须在 wxml 中手动写一个 <code>image</code> 标签，再给它绑定 <code>onload</code> 和 <code>onerror</code> 事件。这意味着：</p>
<ul>
<li>如果我们把这个标签放到自己封装的 WebpImage 组件中，WebpImage 被多次使用后，小程序页面会多出很多额外的节点。</li>
<li>如果我们把这个标签放到页面上（比如 index 页面），就需要给每一个用户可能直接访问的页面都加上这个标签。也会出现很多额外的节点。</li>
</ul>
<p>因此不推荐使用。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="直接判断版本">直接判断版本<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#%E7%9B%B4%E6%8E%A5%E5%88%A4%E6%96%AD%E7%89%88%E6%9C%AC" class="hash-link" aria-label="Direct link to 直接判断版本" title="Direct link to 直接判断版本">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="代码-2">代码<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#%E4%BB%A3%E7%A0%81-2" class="hash-link" aria-label="Direct link to 代码" title="Direct link to 代码">​</a></h3>
<p>第三种方法，就是直接判断版本号，Android 版本大于 4.2.0，iOS 大于 14.0.0 时，认为 webp 可用。</p>
<p>H5 通过 ua 获取系统版本号的文章很多，我们这里给出小程序的代码。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">isWebpSuported</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> system</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token maybe-class-name">SDKVersion</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> wx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getSystemInfoSync</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">sysName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> sysVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">system </span><span class="token operator" style="color:rgb(0, 0, 0)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">''</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">split</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">' '</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token function" style="color:rgb(0, 0, 255)">compareVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token maybe-class-name">SDKVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'2.9.0'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      sysName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">toUpperCase</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'ANDROID'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token function" style="color:rgb(0, 0, 255)">compareVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">sysVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'4.2.0'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      sysName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">toUpperCase</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'IOS'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token function" style="color:rgb(0, 0, 255)">compareVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">sysVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'14.0.0'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理-2">原理<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#%E5%8E%9F%E7%90%86-2" class="hash-link" aria-label="Direct link to 原理" title="Direct link to 原理">​</a></h3>
<p>我们已经通过 <a href="https://caniuse.com/?search=webp" target="_blank" rel="noopener noreferrer">Can I use</a> 知道：</p>
<ul>
<li>Android 4.2.0 以下，iOS 14 以下的浏览器不支持 webp。</li>
</ul>
<p>又从 <a href="https://developers.weixin.qq.com/miniprogram/dev/component/image.html#WebView-%E7%89%B9%E6%9C%89%E5%B1%9E%E6%80%A7" target="_blank" rel="noopener noreferrer">微信小程序 image 组件文档</a> 里知道：</p>
<ul>
<li>基础库版本 &gt;= 2.9.0 支持 webp。</li>
</ul>
<p>那么干脆把所有条件都做一个组合，就得到了上述代码，其中 <code>compareVersion()</code> 是 <a href="https://developers.weixin.qq.com/ebook?action=get_post_info&amp;volumn=1&amp;lang=zh_CN&amp;book=miniprogram&amp;docid=000288319f40c0eb00860cd135100a" target="_blank" rel="noopener noreferrer">微信官方文档</a> 中比较版本号的代码。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="优缺点-2">优缺点<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#%E4%BC%98%E7%BC%BA%E7%82%B9-2" class="hash-link" aria-label="Direct link to 优缺点" title="Direct link to 优缺点">​</a></h3>
<ul>
<li>优点：同步判断、不影响首屏性能；误伤范围小；且 CSR 和 SSR 可用。</li>
<li>缺点：无明显缺点。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文介绍了 H5、小程序使用 webp 格式图片时，判断环境是否支持的方法。</p>
<ul>
<li>方法一：利用 <code>toDataURL('image/webp')</code> 判断。H5 支持，但是会误伤大部分浏览器；小程序不支持。</li>
<li>方法二：利用一张小体积的 webp 图片试探。H5 CSR 时支持，但因为方法是异步的、可能影响首屏性能；H5 SSR 时不支持；小程序支持，但实现不优雅。</li>
<li>方法三：<strong>利用版本号判断。H5 和浏览器均支持，是最佳实现方案。</strong></li>
</ul>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[百亿补贴为什么用 H5？H5 未来会如何发展？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy</link>
            <guid>https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy</guid>
            <pubDate>Sun, 03 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[23 年 11 月末，拼多多市值超过了阿里。我想写一篇文章《百亿补贴为什么用 H5》，没有动笔；24 年新年，我想写一篇《新的一年，H5 会如何发展》，也没有动笔。]]></description>
            <content:encoded><![CDATA[<p>23 年 11 月末，拼多多市值超过了阿里。我想写一篇文章《百亿补贴为什么用 H5》，没有动笔；24 年新年，我想写一篇《新的一年，H5 会如何发展》，也没有动笔。</p>
<p>眼看着灵感就要烂在手里，我决定把两篇文章合为一篇，与大家分享。当然，这些分析预测只是个人观点，如果你有不同的意见，欢迎在评论区讨论交流。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="百亿补贴为什么用-h5">百亿补贴为什么用 H5<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#%E7%99%BE%E4%BA%BF%E8%A1%A5%E8%B4%B4%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8-h5" class="hash-link" aria-label="Direct link to 百亿补贴为什么用 H5" title="Direct link to 百亿补贴为什么用 H5">​</a></h2>
<p>我们在 Android 手机开发者模式下，开启显示布局边界，可以看到「百亿补贴」是一个完整大框，说明「百亿补贴」在 App 内是 H5；拷贝分享链接，在浏览器打开，可以看到资源中有 react 名字的 js 文件，说明「百亿补贴」技术栈大概率是 React。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/pdd-stack-97a1b5678ebd6b6ca3f9d6a1aaf9e55d.png" width="847" height="520" class="img_ev3q"></p>
<p>不只是拼多多，我特地确认了，京东、淘宝的的「百亿补贴」技术栈也是 H5。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/pdd-jd-taobao-37ac80a21ebc73953a05d1df69596f68.png" width="727" height="518" class="img_ev3q"></p>
<p>那么，为什么电商巨头会在「百亿补贴」这种重要活动上选择 H5 呢？用 H5 有什么好处呢？</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="h5-技术已经成熟">H5 技术已经成熟<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#h5-%E6%8A%80%E6%9C%AF%E5%B7%B2%E7%BB%8F%E6%88%90%E7%86%9F" class="hash-link" aria-label="Direct link to H5 技术已经成熟" title="Direct link to H5 技术已经成熟">​</a></h3>
<p>第一个原因，也是最基础的原因，就是 H5 技术已经成熟，能够完整地实现功能。具体来说：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="浏览器兼容性不断提高">浏览器兼容性不断提高<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7%E4%B8%8D%E6%96%AD%E6%8F%90%E9%AB%98" class="hash-link" aria-label="Direct link to 浏览器兼容性不断提高" title="Direct link to 浏览器兼容性不断提高">​</a></h4>
<p>自 2008 年 HTML5 草案发布以来，截止 2014 年，HTML5 已有 18 年历史。18 年间，主流浏览器对 HTML5、CSS3 和 JavaScript 的标准语法兼容性一直持续改进，22 年微软更是亲手盖上了 IE 棺材板。虽然 Safari（iOS 浏览器）的兼容性仍然备受诟病，但总体来说兼容成本已经变得可以接受。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="主流框架已经成熟">主流框架已经成熟<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E5%B7%B2%E7%BB%8F%E6%88%90%E7%86%9F" class="hash-link" aria-label="Direct link to 主流框架已经成熟" title="Direct link to 主流框架已经成熟">​</a></h4>
<p>前端最主流的两大框架 Vue 和 React 已经成熟。它们的成熟体现在多个方面：</p>
<ul>
<li>从时间的角度看，截止 2024 年，React 已经发布了 11 年，而 Vue 已经发布了 10 年。经过多年的发展，前端开发者已经非常熟悉 React 和 Vue，能熟练地应用它们进行开发。</li>
<li>从语法的角度看，自 React16.8 发布 Hooks，以及 Vue3 发布 Composition API 以来，两大框架语法基本稳定，不再有大的变化。前端开发者可以更加专注于业务逻辑，无需过多担心框架语法的变动。</li>
<li>从未来发展方向看，React 目前致力于推广 React Server Component <sup><a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#user-content-fn-1-8d2659" id="user-content-fnref-1-8d2659" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>；Vue 则在尝试着无 VDom 的 Vapor 方向，并计划利用 Rust 重写 Vite <sup><a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#user-content-fn-2-8d2659" id="user-content-fnref-2-8d2659" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>。这表明旧领域不再有大的颠覆，两大框架已经正寻求新的发展领域。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="混合开发已经成熟">混合开发已经成熟<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#%E6%B7%B7%E5%90%88%E5%BC%80%E5%8F%91%E5%B7%B2%E7%BB%8F%E6%88%90%E7%86%9F" class="hash-link" aria-label="Direct link to 混合开发已经成熟" title="Direct link to 混合开发已经成熟">​</a></h4>
<p>混合开发是指将原生开发（Android 和 iOS）和 Web 开发结合起来的一种技术。简而言之，它将 H5 嵌入到移动应用内部运行。近些年，业界对混合开发的优势和缺陷已经有清晰的认识，并针对其缺陷进行了相应的优化。具体来说：</p>
<ul>
<li>混合开发的优势包括开发速度快、一套代码适配 Android 和 iOS，以及实现代码的热更新。这意味着程序员能更快地编写跨平台应用，及时更新应用、修复缺陷；</li>
<li>混合开发的缺陷则是性能较差、加载受限于网络。针对这个缺陷，各大 App、以及云服务商如阿里云 <sup><a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#user-content-fn-3-8d2659" id="user-content-fnref-3-8d2659" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup> 和腾讯云 <sup><a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#user-content-fn-4-8d2659" id="user-content-fnref-4-8d2659" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup> 都推出了自己的离线包方案。离线包方案可以将网页的静态资源（如 HTML、CSS、JS、图片等）缓存到本地，用户访问 H5 页面时，可以直接读取本地的离线资源，从而提升页面的加载速度。可以说，接入离线包后，H5 不再有致命缺陷。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="前端基建工具已经成熟">前端基建工具已经成熟<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#%E5%89%8D%E7%AB%AF%E5%9F%BA%E5%BB%BA%E5%B7%A5%E5%85%B7%E5%B7%B2%E7%BB%8F%E6%88%90%E7%86%9F" class="hash-link" aria-label="Direct link to 前端基建工具已经成熟" title="Direct link to 前端基建工具已经成熟">​</a></h4>
<p>近些年来，业界最火的技术话题之一，就是用 Rust 替代前端基建，包括：用 Rust 替代 Webpack 的 Rspack；用 Rust 替代 Babel 的 SWC；用 Rust 替代 Eslint 的 OxcLint 等等。</p>
<p>前端开发者对基建工具抱怨，已经从「这工具能不能用」，转变为「这工具好不好用」。这种「甜蜜的烦恼」，只有基建工具成熟后才会出现。</p>
<p><strong>综上所述，浏览器的兼容性提升、主流框架的成熟、混合开发的发展和前端基建工具的完善，使 H5 完全有能力承载「百亿补贴」业务。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="h5-开发成本低">H5 开发成本低<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#h5-%E5%BC%80%E5%8F%91%E6%88%90%E6%9C%AC%E4%BD%8E" class="hash-link" aria-label="Direct link to H5 开发成本低" title="Direct link to H5 开��发成本低">​</a></h3>
<p>前文我们已经了解到，成熟的技术让 H5 可以实现「百亿补贴」的功能。现在我们介绍另一个原因——H5 开发成本低。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="百亿补贴需要多个-h5">「百亿补贴」需要多个 H5<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#%E7%99%BE%E4%BA%BF%E8%A1%A5%E8%B4%B4%E9%9C%80%E8%A6%81%E5%A4%9A%E4%B8%AA-h5" class="hash-link" aria-label="Direct link to 「百亿补贴」需要多个 H5" title="Direct link to 「百亿补贴」需要多个 H5">​</a></h4>
<p>「百亿补贴」的方式，是一个常住的 H5，搭配上多个流动的 H5。（「常住」和「流动」是我借鉴「常住人口」和「流动人口」造的词）</p>
<ul>
<li>
<p>常住 H5 链接保持不变。站外投放的链接基本都是常住 H5 的，站内首页入口链接也是常住 H5 的，这样方便用户二次访问。</p>
</li>
<li>
<p>流动 H5 链接位于常住 H5 的不同位置，比如头图、侧边栏等。时间不同、用户不同、算法不同，流动 H5 的链接都会不同，流动 H5 可以区分用户，方便分发流量。</p>
<p>具体来看，拼多多至少有三个流量的分发点，第一个是可点击的头图，第二个是列表上方的活动模块，第三个是右侧浮动的侧边栏，三者可以投放不同的链接。最近就分别投放 3.8 女神节链接、新人链接和品牌链接：</p>
</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/pdd-activity-1ed1254be7ab141b7332d32dc0a334de.png" width="717" height="520" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="百亿补贴需要及时更新">「百亿补贴」需要及时更新<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#%E7%99%BE%E4%BA%BF%E8%A1%A5%E8%B4%B4%E9%9C%80%E8%A6%81%E5%8F%8A%E6%97%B6%E6%9B%B4%E6%96%B0" class="hash-link" aria-label="Direct link to 「百亿补贴」需要及时更新" title="Direct link to 「百亿补贴」需要及时更新">​</a></h4>
<p>不难想到，每到一个节日、每换一个品牌，「百亿补贴」就需要更新一次。</p>
<p>有时还需要为一些品牌定制化 H5 代码。如果使用其他技术栈，排期跟进通常会比较困难，但是使用 H5 就能够快速迭代并上线。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="h5-投放成本低">H5 投放成本低<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#h5-%E6%8A%95%E6%94%BE%E6%88%90%E6%9C%AC%E4%BD%8E" class="hash-link" aria-label="Direct link to H5 投放成本低" title="Direct link to H5 投放成本低">​</a></h3>
<p>我们已经「百亿补贴」使用 H5 技术栈的两个原因，现在来看第三个原因——H5 适合投放。</p>
<p>拼多多的崛起过程中，投放到其他 App 的链接功不可没。早期它通过微信等社交平台「砍一刀」的模式，低成本地吸引了大量用户。如今，它通过投放「百亿补贴」策略留住用户。</p>
<p>H5 的独特之处，在于它能够灵活地在多个平台上进行投放，其他技术栈很难有这样的灵活性。即使是今天，抖音、Bilibili 和小红书等其他 App 中，「百亿补贴」的 H5 链接也随处可见。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/pdd-advertisement-74c8d804db4013db2788ea794a5713ca.png" width="739" height="517" class="img_ev3q"></p>
<p>拼多多更是将 H5 这种灵活性发挥到极致，只要你有「百亿补贴」的链接，你甚至可以在微信、飞书、支付宝等地方直接查看「百亿补贴」 H5 页面。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/wechat-flybook-alipay-059f18ab40791acd041db426d5358594.png" width="723" height="519" class="img_ev3q"></p>
<p><strong>综上所述，能开发、能快速开发、且开发完成后能大量投放，是「百亿补贴」青睐 H5 的原因。</strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="h5-未来会如何发展">H5 未来会如何发展<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#h5-%E6%9C%AA%E6%9D%A5%E4%BC%9A%E5%A6%82%E4%BD%95%E5%8F%91%E5%B1%95" class="hash-link" aria-label="Direct link to H5 未来会如何发展" title="Direct link to H5 未来会如何发展">​</a></h2>
<p>了解「百亿补贴」选择 H5 的原因后，我们来看看电商巨头对 H5 未来发展的影响。我认为有三个影响：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="h5-数量膨胀定制化要求苛刻">H5 数量膨胀，定制化要求苛刻<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#h5-%E6%95%B0%E9%87%8F%E8%86%A8%E8%83%80%E5%AE%9A%E5%88%B6%E5%8C%96%E8%A6%81%E6%B1%82%E8%8B%9B%E5%88%BB" class="hash-link" aria-label="Direct link to H5 数量膨胀，定制化要求苛刻" title="Direct link to H5 数量膨胀，定制化要求苛刻">​</a></h3>
<p>C 端用户黏性相对较低，换一个 App 的成本微不足道。近年 C 端市场增长缓慢，企业重点从获取更多的新客变成留住更多的老客，很难容忍用户丢失。因此其他企业投放活动 H5 时，企业必须也投放活动 H5，电商活动 H5 就变得越来越多。</p>
<p>这个膨胀的趋势不仅仅存在于互联网巨头的 App 中，中小型应用也不例外，甚至像 12306、中国移动、招商银行这种工具性极强的应用也无法幸免。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/12306-yidong-zhaoshang-c8021ad5da3a4c3d9dc25a569d8e646f.png" width="722" height="517" class="img_ev3q"></p>
<p>随着市场的竞争加剧，定制化要求也变得越来越苛刻，目的是让消费者区分各种活动。用互联网黑话来说，就是「建立用户心智」。在可预见的未来，尽管电商活动 H5 结构基本相同，但是它们的外观将变得千差万别、极具个性。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/fluid-98332da26036496ea2748e01f698992b.png" width="735" height="516" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ssr-比例增加csr-占据主流">SSR 比例增加，CSR 占据主流<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#ssr-%E6%AF%94%E4%BE%8B%E5%A2%9E%E5%8A%A0csr-%E5%8D%A0%E6%8D%AE%E4%B8%BB%E6%B5%81" class="hash-link" aria-label="Direct link to SSR 比例增加，CSR 占据主流" title="Direct link to SSR 比例增加，CSR 占据主流">​</a></h3>
<p>在各家 H5 数量膨胀、竞争激烈的情况下，一定会有企业为提升 H5 的秒开率接入 SSR，因此 SSR 的比例会增加。</p>
<p>但我认为 CSR 依然会是主流，主要是因为两个原因：</p>
<ol>
<li>SSR 需要额外的服务器费用，包括服务器的维护、扩容等。这对于中小型公司来说是一个负担。</li>
<li>SSR 对程序员技术水平要求比 CSR 更高。SSR 需要程序员考虑更多的问题，例如内存泄露。使用 CSR 在用户设备上发生内存泄露，影响有限；但是如果在服务器上发生内存泄露，则是会占用公司的服务器内存，增加额外的成本和风险。</li>
</ol>
<p>因此，收益丰厚、技术雄厚的公司更愿意使用 SSR。没有金刚钻别揽瓷器活，总不能向老板汇报结果时，告诉老板「虽然您亏钱了，但是 SSR 真的很酷」。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="monorepo-比例会上升类-shadcn-ui-组件库也许会兴起">Monorepo 比例会上升，类 Shadcn UI 组件库也许会兴起<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#monorepo-%E6%AF%94%E4%BE%8B%E4%BC%9A%E4%B8%8A%E5%8D%87%E7%B1%BB-shadcn-ui-%E7%BB%84%E4%BB%B6%E5%BA%93%E4%B9%9F%E8%AE%B8%E4%BC%9A%E5%85%B4%E8%B5%B7" class="hash-link" aria-label="Direct link to Monorepo 比例会上升，类 Shadcn UI 组件库也许会兴起" title="Direct link to Monorepo 比例会上升，类 Shadcn UI 组件库也许会兴起">​</a></h3>
<p>如前所述，H5 的数量膨胀，代码复用就会被着重关注。我猜测更多企业会选择 Monorepo 管理方式。所谓 Monorepo，简单来说，就是将原本应该放到多个仓库的代码放入一个仓库，让它们共享相同的版本控制。这样可以降低代码复用成本。</p>
<p>定制化要求苛刻，我猜测社区中类似 Shadcn UI 的 H5 组件库或许会兴起。现有的 H5 组件库样式太单一，即使是 Shadcn UI，也很难满足国内 H5 的定制化需求。然而，Shadcn UI 的基本思路——「把源码下载到项目」，是解决定制化组件难复用的问题的好思路。因此，我认为类似 Shadcn 的 H5 组件库可能会逐渐兴起。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文介绍了我认为「百亿补贴」会选用 H5 的三大原因：</p>
<ul>
<li>H5 技术已经成熟</li>
<li>H5 开发成本低</li>
<li>H5 投放成本低</li>
</ul>
<p>以及电商巨头对 H5 产生的三个影响：</p>
<ul>
<li>数量膨胀，定制化要求苛刻</li>
<li>SSR 比例增加，CSR 占据主流</li>
<li>Monorepo 比例增加，类 Shadcn UI 组件库也许会兴起</li>
</ul>
<p>总而言之，H5 开发会越来越专业，对程序员要求会越来越高。至于这种情况是好是坏，仁者见仁智者见智，欢迎大家在评论区沟通交流。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-1-8d2659">
<p><a href="https://juejin.cn/post/7340926094614511626" target="_blank" rel="noopener noreferrer">11 岁的 React 正迎来自己口碑的拐点</a> <a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#user-content-fnref-1-8d2659" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-2-8d2659">
<p><a href="https://juejin.cn/post/7342384485696520246" target="_blank" rel="noopener noreferrer">Rust! 无VDom! 尤雨溪解析 Vue.js 2024 新特性</a> <a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#user-content-fnref-2-8d2659" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-3-8d2659">
<p><a href="https://help.aliyun.com/document_detail/178947.html" target="_blank" rel="noopener noreferrer">离线包 | 阿里云</a> <a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#user-content-fnref-3-8d2659" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-4-8d2659">
<p><a href="https://cloud.tencent.com/document/product/1034/64737" target="_blank" rel="noopener noreferrer">离线包 | 腾讯云</a> <a href="https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy#user-content-fnref-4-8d2659" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content:encoded>
            <category>H5</category>
        </item>
        <item>
            <title><![CDATA[H5 上滑加载（触底加载）如何实现？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/03/02/pull-up</link>
            <guid>https://lijunlin2022.github.io/blog/2024/03/02/pull-up</guid>
            <pubDate>Sat, 02 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[上滑加载（触底加载）是 H5 常见的功能，今天我们来看下如何实现。]]></description>
            <content:encoded><![CDATA[<p>上滑加载（触底加载）是 H5 常见的功能，今天我们来看下如何实现。</p>
<p>效果如下：分页请求开始前，列表滚动，加载动画出现在屏幕中；分页请求过程中，加载动画一直旋转；分页请求完成后，列表底部插入了新节点，加载动画被挤出屏幕。</p>
<p>如此循环往复，直到分页请求无法返回更多数据，列表底部展示「没有更多了」提示，加载动画隐藏。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/pull-up-545b9e657517f84454b7eb7967019e52.gif" width="300" height="300" class="img_ev3q"></p>
<p>首先我会讲解上滑加载的原理，并简单说明 IntersectionObserver 的用法；接着我会给出上滑加载的关键布局代码、逻辑代码，接着我会介绍上滑加载需要注意的三个问题，最后我会再做个简单的总结。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="上滑加载的原理">上滑加载的原理<a href="https://lijunlin2022.github.io/blog/2024/03/02/pull-up#%E4%B8%8A%E6%BB%91%E5%8A%A0%E8%BD%BD%E7%9A%84%E5%8E%9F%E7%90%86" class="hash-link" aria-label="Direct link to 上滑加载的原理" title="Direct link to 上滑加载的原理">​</a></h2>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/principle-a0a906272ff7eed401986e3ce0b9c46c.png" width="521" height="354" class="img_ev3q"></p>
<p>如图所示，蓝色矩形代表视口，绿色矩形代表包裹列表和动画的容器，金黄色矩形代表列表，橙色则代表加载动画。</p>
<p>最开始时，加载动画处于视口下方；当用户滚动列表到达底部时，加载动画就进入了视口，此时可以请求列表下一页数据，请求成功后新节点插入到列表底部，新节点把动画挤出了视口。</p>
<p>也就是说，想实现加载更多，关键就是监听加载动画有没有进入视口内部。我们可以使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver" target="_blank" rel="noopener noreferrer">IntersectionObserver</a> 这个 API 监听动画有没有进入视口。</p>
<p><code>IntersectionObserver</code> 使用方法如下，我们首先创建了一个监听器 observer，再用这个监听器去监视元素 element。当 <a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserverEntry/isIntersecting" target="_blank" rel="noopener noreferrer">entry.isIntersecting</a> 为 true 时，说明 element 已经进入视口。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">// 创建监听器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> observer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">IntersectionObserver</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token parameter">entry</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">entry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">isIntersecting</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(38, 127, 153)">console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">log</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'进入视口'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 开始监听</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">observer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">observe</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">element</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="上滑加载关键代码">上滑加载关键代码<a href="https://lijunlin2022.github.io/blog/2024/03/02/pull-up#%E4%B8%8A%E6%BB%91%E5%8A%A0%E8%BD%BD%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 上滑加载关键代码" title="Direct link to 上滑加载关键代码">​</a></h2>
<p>知道原理后，现在我们来看实现上滑加载的关键代码，首先是布局代码：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="布局代码">布局代码<a href="https://lijunlin2022.github.io/blog/2024/03/02/pull-up#%E5%B8%83%E5%B1%80%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 布局代码" title="Direct link to 布局代码">​</a></h3>
<p>布局代码和原理图相互对应，box 是包裹列表和加载动画的容器、list 有 5 个子元素、list 下方则是加载动画的容器。</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">box</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">list</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">0</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">1</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">3</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">item</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">4</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">loader-box</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">loader</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">nothing</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">hidden</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">没有更多了~</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>列表布局很基础，我们主要看动画。loader-box 中的 loader 是纯 CSS 的加载动画。我们利用 border 画出的一个圆形边框，左、上、右边框是浅灰色，下边框是深灰色：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXIAAABGCAIAAABe2ohRAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAARCSURBVHic7dw7TyJdHIDxAwMzA4OCIRMSDIkUJlpqYWNhYW/tp/DDSE9tbW9hYWOhnZpYYDAUhBABh8sMt7cYc14WVxflqOzO86uOZPjnFJsnc2EnNB6PBQCoE/7pDQD415AVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIpFfnoDWHSe53U6nV6v1+/3B4PBeDwOhUKRSCQajZqmGY/HdV3/6T1isYR48z7e4jhOq9Xq9XrvH2aa5vLyciKR+J5dYfGRFfyG53n1er3b7c7+lVgslk6nOXOBICt47fn5uVarTX5iWZZlWYZhaJoWDodHo9FwOHRdt91ut9vtySNt215aWvre/WLhkBX8olqtTpYilUolk0lN0946fjgcNpvNRqMhP7EsK5PJfO0usdjICv43eZ6i67pt24ZhzPJF13VrtZrnef6fnLMEHA+Y8cLzPNkUTdOy2eyMTRFCGIaRzWblSc1kYhBAZAUv6vW6v9B1PZfLhcMf+7cRDodzuZy8ZSunIYDICoQQwnEc+dzHtu2PNsUXDodt2/bX3W7XcRxl+8NfhaxACCFarZa/SKVSs1/7vGYYRiqVmpqJoCErEJ7nyd+8JZPJOafJCb1ejzsswURWIDqdjr+wLOudZ8kz0jTNsqypyQgUsgIhT1VkDuYk5/zxh//4J5EViH6/7y/muasySc6RkxEoZAViMBj4i/mvgKbmyMkIFLICIX9p/bnnyq/JOfyGO5jICkQoFPIXo9FIyUA5R05GoJAViEjk5W1ew+FQyUA5R05GoJAViGg06i9c11UyUM6RkxEoZAXCNE1/MfXylE+Tc+RkBApZgYjH4/6i3W7Pfx00HA5lVuRkBApZgdB1XZ5WNJvNOafJCaZp8g7KYCIrEEKI5eVlf9FoNOa5w+K6rnxTnJyJoCErEEKIRCIRi8X8da1W+9yT5tFoJF8EFYvFeBd/YJEVvEin0/7C87ybm5uP/ufjqW/JaQggsoIX/strhRCNRqNYLBYKhXK5PON3y+VyoVAoFov+FZBt29xVCTJekY1fPDw8HB8fyz/39/f39vbeuZxxHOf8/Pzs7Ex+cnR0tLa29qWbxIIjK5h2eXl5cnIy+cnW1tbm5mYul1tZWdF13fO8p6enx8fH29vb6+vrySMPDw93dna+d79YOGQFv1GpVE5PT+/v72f/yvr6+sHBwerq6tftCn8LsoI3XV1dXVxclEql9w/L5/O7u7vb29vfsyssPrKCP6hUKnd3d6VSqVqtNpvNwWAQiUSSyWQmk8nn8xsbG5yhYApZAaAYD5gBKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWACj2H3/xd/JlnTeYAAAAAElFTkSuQmCC" width="370" height="70" class="img_ev3q"></p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token selector id">#loader</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">width</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">height</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">border</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token unit">px</span><span class="token plain"> solid </span><span class="token hexcode color">#ddd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">border-radius</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">50</span><span class="token unit">%</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">border-bottom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token unit">px</span><span class="token plain"> solid </span><span class="token hexcode color">#717171</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">transform</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">rotate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token unit">deg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们给 loader 元素增加一个动画，让它从 0 度到 360 度无限旋转，就实现了加载动画：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/loading-59f020712949ecfce9a3f0e497716437.gif" width="370" height="70" class="img_ev3q"></p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token selector id">#loader</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">animation</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> loading </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token unit">s</span><span class="token plain"> linear infinite</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token atrule rule">@keyframes</span><span class="token atrule"> loading</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token selector">from</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token property">transform</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">rotate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token unit">deg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token selector">to</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token property">transform</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">rotate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">360</span><span class="token unit">deg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>loader 也是我们真正需要监听是否进入视口的元素。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="逻辑代码">逻辑代码<a href="https://lijunlin2022.github.io/blog/2024/03/02/pull-up#%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 逻辑代码" title="Direct link to 逻辑代码">​</a></h3>
<p>关键逻辑代码4和原理中一致，我们只需要监听到动画 loader 进入视口，就直接调用 pullUp 函数。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> loader </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementById</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'loader'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> observer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">IntersectionObserver</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token parameter">entry</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">entry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">isIntersecting</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">pullUp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token literal-property property">root</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(0, 0, 255)">null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token literal-property property">rootMargin</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'0px'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token literal-property property">threshold</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">observer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">observe</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">loader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="上滑加载的两个注意点">上滑加载的两个注意点<a href="https://lijunlin2022.github.io/blog/2024/03/02/pull-up#%E4%B8%8A%E6%BB%91%E5%8A%A0%E8%BD%BD%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%B3%A8%E6%84%8F%E7%82%B9" class="hash-link" aria-label="Direct link to 上滑加载的两个注意点" title="Direct link to 上滑加载的两个注意点">​</a></h2>
<p>实现上滑加载，我们除了关键完布局代码、逻辑代码外，还有三个点需要注意：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="加载锁">加载锁<a href="https://lijunlin2022.github.io/blog/2024/03/02/pull-up#%E5%8A%A0%E8%BD%BD%E9%94%81" class="hash-link" aria-label="Direct link to 加载锁" title="Direct link to 加载锁">​</a></h3>
<p>第一点，前一次上滑加载未完成之前，不应该再次触发上滑加载。</p>
<p>为此，我们需要创建一个加载锁变量 loadLock，数据加载前先把 loadLock 赋值为 true，数据加载完成后再把 loadLock 赋值为 false。如果 loadLock 一直为 true，就说明前一次加载未完成，我们需要直接 return 结束 pullUp 函数。</p>
<p>代码如下：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> loadLock </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">pullUp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">loadLock</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">loadData</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">loadData</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  loadLock </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">setTimeout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    loadLock </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">LOADING_TIME</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="没有更多数据">没有更多数据<a href="https://lijunlin2022.github.io/blog/2024/03/02/pull-up#%E6%B2%A1%E6%9C%89%E6%9B%B4%E5%A4%9A%E6%95%B0%E6%8D%AE" class="hash-link" aria-label="Direct link to 没有更多数据" title="Direct link to 没有更多数据">​</a></h3>
<p>第二点，需要考虑没有更多数据的情况。上滑加载请求的数据是分页的，一定有请求结束的情况。请求结束时，我们需要给用户一些提示。</p>
<p>我们可以设置一个 hasMore 变量。hasMore 为 true 表示时候有更多数据，为 false 时表示数据了，应该隐藏加载动画，展示「没有更多了」提示。</p>
<p>代码如下，我限制了分页数据最多只有 LIST_LIMIT_CNT 条：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> hasMore </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">pullUp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain">hasMore</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token method function property-access" style="color:rgb(0, 0, 255)">loadData</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">loadData</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token method function property-access" style="color:rgb(0, 0, 255)">setTimeout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">len </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">LIST_LIMIT_CNT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      loader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'hidden'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      nothing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      hasMore </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">LOADING_TIME</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="请求失败">请求失败<a href="https://lijunlin2022.github.io/blog/2024/03/02/pull-up#%E8%AF%B7%E6%B1%82%E5%A4%B1%E8%B4%A5" class="hash-link" aria-label="Direct link to 请求失败" title="Direct link to 请求失败">​</a></h3>
<p>第三点，需要考虑请求失败的情况。我们无法保证服务器一直运转正常，很可能列表前一次分页请求还成功，后一次分页请求就失败了。</p>
<p>这种情况有两种常见交互：</p>
<ul>
<li>直接展示「请求出错了」，让用户点击重试。</li>
<li>继续展示加载动画，重新请求服务器数据。</li>
</ul>
<p>因为请求失败不好模拟，所以 Demo 中只实现了加载锁和没有更多数据的情况，你可以根据自己的需要改写 Demo。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="示例代码">示例代码<a href="https://lijunlin2022.github.io/blog/2024/03/02/pull-up#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 示例代码" title="Direct link to 示例代码">​</a></h2>
<p><a href="https://codepen.io/lijunlin2022/pen/OJrJePE" target="_blank" rel="noopener noreferrer">上滑加载、触底加载 | codepen</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/03/02/pull-up#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文讲解了上滑加载的原理——利用 IntersectionObserver 监听加载动画是否进入视口，如果动画进入则请求下一页数据。此外，本文还说明了上滑加载需要注意的三个点：加载锁、没有更多数据和请求失败。</p>]]></content:encoded>
            <category>H5</category>
        </item>
        <item>
            <title><![CDATA[H5 下拉刷新如何实现？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/02/28/pull-down</link>
            <guid>https://lijunlin2022.github.io/blog/2024/02/28/pull-down</guid>
            <pubDate>Wed, 28 Feb 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[最近我需要做一个下拉刷新的功能，实现功能后我发现，它需要处理的情况还蛮多，于是我整理了这篇文章。]]></description>
            <content:encoded><![CDATA[<p>最近我需要做一个下拉刷新的功能，实现功能后我发现，它需要处理的情况还蛮多，于是我整理了这篇文章。</p>
<p>下图是我实现的效果，分为三步：开始下拉时，屏幕顶部会出现加载动画；加载过程中，屏幕顶部高度保持不变；加载完成后，加载动画隐藏。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/pull-down-d0902603eabaf6a641e714d72d3423af.gif" width="375" height="300" class="img_ev3q"></p>
<p>首先我会讲解下拉的原理、根据原理写出初始代码；然后我会说明代码存在的缺陷、解决缺陷并做些额外优化；最后我会给出完整代码，并做一个总结。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="下�拉的原理">下拉的原理<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E4%B8%8B%E6%8B%89%E7%9A%84%E5%8E%9F%E7%90%86" class="hash-link" aria-label="Direct link to 下拉的原理" title="Direct link to 下拉的原理">​</a></h2>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/prinple-3d0cdb4f933453745a24ede90364918e.png" width="825" height="359" class="img_ev3q"></p>
<p>如图所示，蓝色框代表视口，绿色框代表容器，橙色框代表加载动画。最开始时，加载动画处于视口外；开始下拉之后，容器向下移动，加载动画从上方进入视口；结束下拉后，容器又开始向上移动，加载动画也从上方退出视口。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="下拉基础代码">下拉基础代码<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E4%B8%8B%E6%8B%89%E5%9F%BA%E7%A1%80%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 下拉基础代码" title="Direct link to 下拉基础代码">​</a></h2>
<p>知道原理，我们现在开始写代码，首先是布局的代码：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="布局代码">布局代码<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E5%B8%83%E5%B1%80%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 布局代码" title="Direct link to 布局代码">​</a></h3>
<p>我们把 box 元素当作容器，把 loader-box，loader-box + loading 元素当作动画，至于 h1 元素不需要关注，我们只把它当作操作提示。</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">box</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">loader-box</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">loading</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">h1</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">下拉刷新 ↓</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">h1</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>loader-box 的高度是 80px，按上一节原理中的分析，初始时我们需要让 loader-box 位于视口上方，因此 CSS 代码中我们需要把它的位置向上移动 80px。</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token selector class">.loader-box</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">position</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> relative</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">top</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">-80</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">height</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>loader-box 中的 loader 是纯 CSS 的加载动画。我们利用 border 画出的一个圆形边框，左、上、右边框是浅灰色，下边框是深灰色：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXIAAABGCAIAAABe2ohRAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAARCSURBVHic7dw7TyJdHIDxAwMzA4OCIRMSDIkUJlpqYWNhYW/tp/DDSE9tbW9hYWOhnZpYYDAUhBABh8sMt7cYc14WVxflqOzO86uOZPjnFJsnc2EnNB6PBQCoE/7pDQD415AVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIpFfnoDWHSe53U6nV6v1+/3B4PBeDwOhUKRSCQajZqmGY/HdV3/6T1isYR48z7e4jhOq9Xq9XrvH2aa5vLyciKR+J5dYfGRFfyG53n1er3b7c7+lVgslk6nOXOBICt47fn5uVarTX5iWZZlWYZhaJoWDodHo9FwOHRdt91ut9vtySNt215aWvre/WLhkBX8olqtTpYilUolk0lN0946fjgcNpvNRqMhP7EsK5PJfO0usdjICv43eZ6i67pt24ZhzPJF13VrtZrnef6fnLMEHA+Y8cLzPNkUTdOy2eyMTRFCGIaRzWblSc1kYhBAZAUv6vW6v9B1PZfLhcMf+7cRDodzuZy8ZSunIYDICoQQwnEc+dzHtu2PNsUXDodt2/bX3W7XcRxl+8NfhaxACCFarZa/SKVSs1/7vGYYRiqVmpqJoCErEJ7nyd+8JZPJOafJCb1ejzsswURWIDqdjr+wLOudZ8kz0jTNsqypyQgUsgIhT1VkDuYk5/zxh//4J5EViH6/7y/muasySc6RkxEoZAViMBj4i/mvgKbmyMkIFLICIX9p/bnnyq/JOfyGO5jICkQoFPIXo9FIyUA5R05GoJAViEjk5W1ew+FQyUA5R05GoJAViGg06i9c11UyUM6RkxEoZAXCNE1/MfXylE+Tc+RkBApZgYjH4/6i3W7Pfx00HA5lVuRkBApZgdB1XZ5WNJvNOafJCaZp8g7KYCIrEEKI5eVlf9FoNOa5w+K6rnxTnJyJoCErEEKIRCIRi8X8da1W+9yT5tFoJF8EFYvFeBd/YJEVvEin0/7C87ybm5uP/ufjqW/JaQggsoIX/strhRCNRqNYLBYKhXK5PON3y+VyoVAoFov+FZBt29xVCTJekY1fPDw8HB8fyz/39/f39vbeuZxxHOf8/Pzs7Ex+cnR0tLa29qWbxIIjK5h2eXl5cnIy+cnW1tbm5mYul1tZWdF13fO8p6enx8fH29vb6+vrySMPDw93dna+d79YOGQFv1GpVE5PT+/v72f/yvr6+sHBwerq6tftCn8LsoI3XV1dXVxclEql9w/L5/O7u7vb29vfsyssPrKCP6hUKnd3d6VSqVqtNpvNwWAQiUSSyWQmk8nn8xsbG5yhYApZAaAYD5gBKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWACj2H3/xd/JlnTeYAAAAAElFTkSuQmCC" width="370" height="70" class="img_ev3q"></p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token selector id">#loader</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">width</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">height</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">border</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token unit">px</span><span class="token plain"> solid </span><span class="token hexcode color">#ddd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">border-radius</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">50</span><span class="token unit">%</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">border-bottom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token unit">px</span><span class="token plain"> solid </span><span class="token hexcode color">#717171</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">transform</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">rotate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token unit">deg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>开始刷新时，我们给 loader 元素增加一个动画，让它从 0 度到 360 度无限旋转，就实现了加载动画：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/loading-59f020712949ecfce9a3f0e497716437.gif" width="370" height="70" class="img_ev3q"></p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token selector id">#loader</span><span class="token selector class">.loading</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">animation</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> loading </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token unit">s</span><span class="token plain"> linear infinite</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token atrule rule">@keyframes</span><span class="token atrule"> loading</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token selector">from</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token property">transform</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">rotate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token unit">deg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token selector">to</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token property">transform</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">rotate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">360</span><span class="token unit">deg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="逻辑代码">逻辑代码<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 逻辑代码" title="Direct link to 逻辑代码">​</a></h3>
<p>看完布局代码，我们再看逻辑代码。逻辑代码中，我们要监听用户的手指滑动、实现下拉手势。我们需要用到三个事件：</p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/touchstart_event" target="_blank" rel="noopener noreferrer">touchstart</a> 代表触摸开始；</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/touchmove_event" target="_blank" rel="noopener noreferrer">touchmove</a> 代表触摸移动；</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/touchend_event" target="_blank" rel="noopener noreferrer">touchend</a> 代表触摸结束。</li>
</ul>
<p>从 <code>touchstart</code> 和 <code>touchmove</code> 事件中我们可以获取手指的坐标，比如 <code>event.touches[0].clientX</code> 是手指相对视口左边缘的 X 坐标，<code>event.touches[0].clientY</code> 是手指相对视口上边缘的 Y 坐标；从 <code>touchend</code> 事件中我们则无法获得 <code>clientX</code> 和 <code>clientY</code>。</p>
<p>我们可以先记录用户手指 touchstart 的 clientY 作为开始坐标，记录用户最后一次触发 touchmove 的 clientY 作为结束坐标，二者相减就得到手指移动的距离 distanceY。</p>
<p>设置手指移动多少距离，容器就移动多少距离，就得到了我们的逻辑代码：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> box </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementById</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'box'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> loader </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">getElementById</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'loader'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> startY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> endY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> distanceY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">start</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  startY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">touches</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">clientY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">move</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  endY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">  e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">touches</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">clientY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  distanceY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> endY </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> startY</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">    transform: translateY(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">distanceY</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">px);</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">    transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">  </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">end</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">setTimeout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">      transform: translateY(0);</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">      transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">    </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    loader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'loading'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'touchstart'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> start</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'touchmove'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> move</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'touchend'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> end</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>逻辑代码实现一个简陋的下拉效果，当然现在还有很多缺陷。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/pull-down-basic-6faa20d78630983a6bfdeb81a7e3e7a1.gif" width="375" height="400" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简陋下拉效果的-6-个缺陷">简陋下拉效果的 6 个缺陷<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E7%AE%80%E9%99%8B%E4%B8%8B%E6%8B%89%E6%95%88%E6%9E%9C%E7%9A%84-6-%E4%B8%AA%E7%BC%BA%E9%99%B7" class="hash-link" aria-label="Direct link to 简陋下拉效果的 6 个缺陷" title="Direct link to 简陋下拉效果的 6 个缺陷">​</a></h2>
<p>之前我们实现了简陋的下拉效果，它还需要解决 6 个缺陷，才能算一个完善的功能。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="没有最小最大距离限制">没有最小、最大距离限制<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E6%B2%A1%E6%9C%89%E6%9C%80%E5%B0%8F%E6%9C%80%E5%A4%A7%E8%B7%9D%E7%A6%BB%E9%99%90%E5%88%B6" class="hash-link" aria-label="Direct link to 没有最小、最大距离限制" title="Direct link to 没有最小、最大距离限制">​</a></h3>
<p>第一个缺陷是，下拉没有做最小、最大距离的限制。</p>
<p>通常来说，我们下拉屏幕时，距离太小应该不能触发刷新，距离太大也不行，下滑到一定距离后，就应该无法继续下滑。</p>
<p>因此我们可以给下拉设置最小距离限制 <code>DISTANCE_Y_MIN_LIMIT</code>、最大距离限制 <code>DISTANCE_Y_MAX_LIMIT</code>。如果 touchend 中发现下拉距离小于最小距离，直接不触发加载；如果 touchmove 中下拉距离超过最大距离，页面只向下移动最大距离。</p>
<p>解决缺陷关键代码如下：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">DISTANCE_Y_MAX_LIMIT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">150</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token constant" style="color:rgb(129, 31, 63)">DISTANCE_Y_MIN_LIMIT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">move</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  endY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">  e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">touches</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">clientY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  distanceY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> endY </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> startY</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">distanceY </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">DISTANCE_Y_LIMIT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    distanceY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">DISTANCE_Y_LIMIT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">    transform: translateY(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">distanceY</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string string" style="color:rgb(163, 21, 21)">px);</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">    transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">  </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">end</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">distanceY </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">DISTANCE_Y_MIN_LIMIT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">      transform: translateY(0px);</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">      transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">    </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="加载动画没有停留在视口顶部">加载动画没有停留在视口顶部<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB%E6%B2%A1%E6%9C%89%E5%81%9C%E7%95%99%E5%9C%A8%E8%A7%86%E5%8F%A3%E9%A1%B6%E9%83%A8" class="hash-link" aria-label="Direct link to 加载动画没有停留在视口顶部" title="Direct link to 加载动画没有停留在视口顶部">​</a></h3>
<p>第二个缺陷是，下拉没有让加载动画停留在视口顶部。</p>
<p>我们可以把 end 函数加以改造，在数据还没有加载完成时（用 setTimeout 模拟的），让加载动画 style 的 <code>translateY</code> 一直是 80px，<code>translateY(80px)</code> 可以和 初始 CSS 的 <code>top: -80px;</code> 相互抵消，让动画在未刷新完成前停留在视口顶部。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">end</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">    transform: translateY(80px);</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">    transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">  </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  loader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'loading'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">setTimeout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">      transform: translateY(0px);</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">      transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">    </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    loader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="重复触发">重复触发<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E9%87%8D%E5%A4%8D%E8%A7%A6%E5%8F%91" class="hash-link" aria-label="Direct link to 重复触发" title="Direct link to 重复触发">​</a></h3>
<p>第三个缺陷是，下拉可以重复触发。</p>
<p>正常来说，如果我们已经下拉过，数据正在加载中时，我们不能继续下拉。</p>
<p>我们可以增加一个加载锁 loadLock。当加载锁开启时，start，move 和 end 事件都不会触发。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> loadLock </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">start</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">loadLock</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">move</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">loadLock</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">end</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">loadLock</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token method function property-access" style="color:rgb(0, 0, 255)">setTimeout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    loadLock </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="没有限制方向">没有限制方向<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E6%B2%A1%E6%9C%89%E9%99%90%E5%88%B6%E6%96%B9%E5%90%91" class="hash-link" aria-label="Direct link to 没有限制方向" title="Direct link to 没有限制方向">​</a></h3>
<p>第四个缺陷是，没有限制方向。</p>
<p>目前我们的代码，用户上拉也能触发。我们可以增加判断，当 <code>endY - startY</code> 小于 0 时，阻止 <code>touchmove</code> 和 <code>touchend</code> 的逻辑。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">move</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">endY </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> startY </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">end</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">endY </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> startY </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>你可能会疑惑，为什么我宁愿写多个判断拦截，也不取消监听事件。这是因为<strong>一旦取消监听事件，我们需要考虑在一个合适的时间重新监听</strong>，这会把问题变得更复杂。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="没有阻止原生滚动">没有阻止原生滚动<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E6%B2%A1%E6%9C%89%E9%98%BB%E6%AD%A2%E5%8E%9F%E7%94%9F%E6%BB%9A%E5%8A%A8" class="hash-link" aria-label="Direct link to 没有阻止原生滚动" title="Direct link to 没有阻止原生滚动">​</a></h3>
<p>第五个缺陷时，我们在加载数据时没有阻止原生滚动。</p>
<p>虽然我们已经阻止了重复下拉，touchmove 和 touchend 事件被拦截了，但是 H5 原生滚动还能用。</p>
<p>我们可以在刷新时给 body 设置一个 <code>overflow: hidden;</code> 属性，刷新结束后清除 <code>overflow: hidden</code>，这样就可以阻止原生滚动。</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token selector">body</span><span class="token selector class">.overflowHidden</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">overflow</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hidden</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> body </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">body</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">end</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">    transform: translateY(80px);</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">    transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">  </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  loader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'loading'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  body</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'overflowHidden'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">setTimeout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">      transform: translateY(0px);</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">      transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:#000000"><span class="token template-string string" style="color:rgb(163, 21, 21)">    </span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    loader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    body</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="没有阻止-ios-橡皮筋效果">没有阻止 iOS 橡皮筋效果<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E6%B2%A1%E6%9C%89%E9%98%BB%E6%AD%A2-ios-%E6%A9%A1%E7%9A%AE%E7%AD%8B%E6%95%88%E6%9E%9C" class="hash-link" aria-label="Direct link to 没有阻止 iOS 橡皮筋效果" title="Direct link to 没有阻止 iOS 橡皮筋效果">​</a></h3>
<p>第 6 个缺陷是，没有阻止 iOS 的橡皮筋效果。</p>
<p>iOS 浏览器默认滑动时有一个橡皮筋效果，我们需要阻止它，避免影响我们的下拉手势。阻止方式就是给监听器设置 <code>passive: false</code>。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">addTouchEvent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'touchstart'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> start</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token literal-property property">passive</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'touchmove'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> move</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token literal-property property">passive</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  box</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'touchend'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> end</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token literal-property property">passive</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">addTouchEvent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>解决完 6 个缺陷后，我们已经得到无缺陷的下拉刷新功能，但离丝滑的下拉刷新还有一段距离。我们还可以做一些优化，让下拉刷新更完善。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="优化">优化<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E4%BC%98%E5%8C%96" class="hash-link" aria-label="Direct link to 优化" title="Direct link to 优化">​</a></h2>
<p>我们可以做两个优化，第一个优化是添加阻尼效果：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="增加阻尼效果">增加阻尼效果<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E5%A2%9E%E5%8A%A0%E9%98%BB%E5%B0%BC%E6%95%88%E6%9E%9C" class="hash-link" aria-label="Direct link to 增加阻尼效果" title="Direct link to 增加阻尼效果">​</a></h3>
<p>所谓阻尼效果，就是下拉过程我们可以感受到一股阻力的存在，虽然我们下拉力度是一样的，但距离的增加速度变慢了。用物理术语表示的话，就是加速度变小了。</p>
<p>体现到代码上，我们可以设置一个百分比，百分比会随着下拉距离增加而减少，把百分比乘以距离当作最后的距离。</p>
<p>代码中百分比 <code>percent</code> 设为 <code>(100 - distanceY * 0.5) / 100</code>，当 <code>distanceY</code> 越来越大时，百分比 <code>percent</code> 越来越小，最后再把 <code>distanceY * percent</code> 赋值给 <code>distanceY</code>。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">move</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  distanceY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> endY </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> startY</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">let</span><span class="token plain"> percent </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> distanceY </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0.5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  percent </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">max</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0.5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> percent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  distanceY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> distanceY </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> percent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">distanceY </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">DISTANCE_Y_MAX_LIMIT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    distanceY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">DISTANCE_Y_MAX_LIMIT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用角度判断用户下拉意图">利用角度判断用户下拉意图<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E5%88%A9%E7%94%A8%E8%A7%92%E5%BA%A6%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E4%B8%8B%E6%8B%89%E6%84%8F%E5%9B%BE" class="hash-link" aria-label="Direct link to 利用角度判断用户下拉意图" title="Direct link to 利用角度判断用户下拉意图">​</a></h3>
<p>第二个优化是利用角度判断用户下拉意图。</p>
<p>下图展示了两种用户下拉的情况，β 角度比 α 角度小，角度越小用户下拉意图越明显、误触的可能性更小。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/intension-ca2abc541478c6c325dbdefc86a23347.png" width="419" height="218" class="img_ev3q"></p>
<p>我们可以利用反三角函数求出角度来判断下拉意图。</p>
<p>JavaScript 中，反正切函数是 <code>Math.atan()</code>，需要注意的是，反正切函数算出的是弧度，我们还需要将它乘以 <code>180 / π</code> 才能获取角度。</p>
<p>下面的代码中，我们做了一个限制，只有角度小于 40 时，我们才认为用户的真实意图是想要下拉刷新。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">DEG_LIMIT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">move</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  distanceY </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> endY </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> startY</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  distanceX </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> endX </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> startX</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> deg </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">atan</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">abs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">distanceX</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> distanceY</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">180</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(38, 127, 153)">Math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token constant" style="color:rgb(129, 31, 63)">PI</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">deg </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(129, 31, 63)">DEG_LIMIT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">startY</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> startX</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">endY</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> endX</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B" class="hash-link" aria-label="Direct link to 代码示例" title="Direct link to 代码示例">​</a></h2>
<p>你可以在 <a href="https://codepen.io/lijunlin2022/pen/xxBeZrr" target="_blank" rel="noopener noreferrer">codepen</a> 中查看效果，web 端需要按 F12 用手机浏览器打开。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/codepen-e2041fa61db85726248b0f00185ce00d.gif" width="370" height="600" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/02/28/pull-down#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文讲解了下拉的原理、并根据原理写出初始代码。在初始代码的基础上，我解决了 6 个缺陷、做了 2 个优化，实现了一个完善的下拉刷新效果。</p>]]></content:encoded>
            <category>H5</category>
        </item>
        <item>
            <title><![CDATA[H5、小程序中四个反向圆角的图片如何实现？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius</link>
            <guid>https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius</guid>
            <pubDate>Mon, 19 Feb 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[最近我逛热风小程序（一个卖鞋的小程序）时，发现了一个奇特的图片样式。图片的四个圆角是反向的，和常规图片不一样。]]></description>
            <content:encoded><![CDATA[<p>最近我逛热风小程序（一个卖鞋的小程序）时，发现了一个奇特的图片样式。图片的四个圆角是反向的，和常规图片不一样。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/hotwind-bb8f55e418bb66ea394b1dba36f345f3.jpg" width="300" height="417" class="img_ev3q"></p>
<p>思索一番后，我发现想实现这个效果，需要的 CSS 知识还挺多，于是整理这篇文章。</p>
<p>下面我会先介绍如何实现四个反向圆角的矩形，再介绍如何把特殊矩形作为遮罩、得到和热风小程序的图片效果。接着，我会给出完整的代码，最后，我会给做一个简单的总结。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何实现四个反向圆角的矩形">如何实现四个反向圆角的矩形<a href="https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%9B%9B%E4%B8%AA%E5%8F%8D%E5%90%91%E5%9C%86%E8%A7%92%E7%9A%84%E7%9F%A9%E5%BD%A2" class="hash-link" aria-label="Direct link to 如何实现四个反向圆角的矩形" title="Direct link to 如何实现四个反向圆角的矩形">​</a></h2>
<p>不难想到，四个反向圆角的矩形，就是四个边角都被圆遮挡的矩形。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAO4AAACuCAYAAAAxtjFOAAAAAXNSR0IArs4c6QAAIABJREFUeF7tnQn0DtUbxx8isqcoS1FKm1RKWaJFpbInFSFKKyFF2VIRWSrtWVOKtAklLVqoJKEdLShrixaUJPqfzz1n/uftPT/emXlnu7/3ec55z7vNzL3znfnOvfdZC/z777//iooioAhYhUABJa5V10s7qwgYBJS4eiMoAhYioMS18KJplxUBJa7eA4qAhQgocS28aNplRUCJq/eAImAhAkpcCy+adlkRUOLqPaAIWIhArMTdsWOH/PXXX+Y1ZswYWbFihWzatElOOeUU6dq1q7z88suya9cuA2vnzp0thFe7bCMCHTp0kJUrV8ovv/wiFStWlDp16sjBBx8sW7ZskeLFi0vZsmXl4osvjvXUQifu9u3b5e2335bFixcbYn7//ffy008/yZFHHilLliyRggULSoECBQwIO3fuNETde++9pVy5crJ27Vrz/3PPPScnnnhirEBp47mBwPLly6Vnz56ydetWKVSokBxyyCGGxL/++qshrjOQVK5cWRo3bixt27aVww8/PHJwQiPu119/LY899pghXfXq1aV06dLyxx9/GOIWK1ZMOHFOuFSpUuaJxpOsVq1asm7dOvnyyy/l9ddfN/sWLlzYPOGuuuoqHXUjvz1yo8HNmzfLE088IS+++KKsX7/eEJbBg/v2mGOOkUqVKkndunXliCOOkJdeekn22WcfefLJJ+W9994TPIbZrk+fPnLaaadFBljgxGX6O2DAAHn++eelfPny8uOPP8rll19uTuj444+X4447zgDhRn7//Xd58803ZfTo0Yb0RYsWlf79+8t5553nZnfdRhHYIwJTpkyRhx56yMzsGCCqVasmbdq0kdq1a5v71I1A5Pvuu09WrVplRue7775batas6WbXrLYJlLjPPPOM3HHHHfLnn39Kq1atzOvUU0/NqoPOzhMnTpShQ4dKyZIlpXnz5nL77bcHclw9SO4hwL3DbI77lNneFVdcIWeeeWZWQHz88cfSr18/WbZsmZx++ulmthmmBEbca665Rl555RVp2rSp3HPPPVKkSJHA+71mzRoZNGiQfPHFF2bUfvjhh+XAAw8MvB09YP5EgNGVF7qU9u3by8CBAwM/0Tlz5kjfvn1NG4zEZ5xxRuBtcMBAiHvuuefKd999J/fff7+cffbZoXQ09aC0M3bsWClRooR5sh111FGht6kN2IvAN998I9dff72geGrXrp3ceeedoZ8My8O5c+fKddddJzfffHPg7WVFXBbmDRo0EDTH77zzjlE6RSUzZ86U7t27G6XX1KlT5eijj46qaW3HIgRee+016datm5kBTpgwQU4++eTIev/ggw/KyJEj5cILLzRr3yAlK+I2bNhQ/v77b3n//feN2SZq4WHRqVMn2W+//WTGjBmulV5R91PbiweBN954Q66++mo54IADzMO9SpUqkXdk+vTpcsMNNxi77/DhwwNr3zdxURCx5lywYIHR9sYlaJ0xFaGSnz17dlzd0HYThgBKIu5RZmQvvPCCcaCIS1DaYi7q3bu3cSwKQnwR96abbjI2L0gTJyAOAE8//bRZt7Rs2VIGDx4cBC56DMsRQNeCLwH3KWbIuAWLyLhx44w3YBDLOs/ExQuK6SkdYaGfFLn11lvl2WeflUceecSo41VyFwHWlZMnTzZaY+yySRHWusxSFy5cmHWXPBMX10OeGACTNGHNjUvau+++m7SuaX8iQgDNcZMmTYyTDsqhpAncoX88XLIRT8TFcP3UU08ZOyqeJkmTjz76SC655BLjucWsQCX3EMA+y33AqMb6NmmC+RInpU8//dQ4E/kV18TF9IOvJoTAQySpghbxww8/lKVLlya1i9qvkBD4/PPPjbceU+SOHTuG1Er2h8WnmagjNN1+xTVx7733XuOpxII/yUJUB76izA4Iz1LJHQRwesD1kKizJAtKXaevZcqU8dVV18TFpxNC4LGUdMH3lAfMvHnzkt5V7V9ACOAEhAcdFg+8lZIu9erVM4EMKFP9iCviEoqHzyVmFyInki64X6KoYp2jvsxJv1rB9I+wPPzYifkmJC/pguKMGSwhrH7EFXFxFRs2bJjg82mL8IDBlofZSiX/I4ANH8Fua4sQBkhoIbG+XsUVcZl6Em/I3NwWwc0M7eJbb70VSpedrB1BHzyM44ZxTM47rOP6wZSMKr169TJedLZI/fr1hSmzH9OQK+ISq0i2CvJC2SI8ZLp06WLseZiu0l9Mp/iNd16kJjnooIP+/530OgRW45zO/7zvtddexieb99294sQHzb9Tw83LZ7YlUQHniB2ckDQnjVBen/f0X177gy0ZTlL/c47xzz//SF4v/nd+T//s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L3i2ncZpXnn2g9rq43xrXHUwMDA3nf5ccjqYhG6PtTNcdTAwMWLGz8Eq5TFBXHUwMDE0U3hpYpiz0bPRTa+s9lDhKU5cdTAwMTRcdTAwMTWKU0aFXHUwMDA054et66GZ4kJqJV9cdTAwMDSV8axcdTAwMTXWaPx1RciDgW1VJ5JhXHUwMDFjz2YyXHSfMjknaFeC3Vx1MDAxOcqcqmFcdTAwMTZcdTAwMDZTXHUwMDE4qFwiXHUwMDFhXHUwMDE0kZRxKl7kcZT0XHUwMDE31cVpp+/4qVdcdTAwMWbX58GdsrTl79NTe+xfd2VcdTAwMWJub/1+K1xutlxc8l66KI6jrJjJ6rSoinqGUKxoXTtg80XFZHJNXHUwMDE5MG6AS6bgVU1AeJpyzaimSuC3el1cdTAwMTKQXHUwMDFlXHUwMDE2SylcdTAwMDApXHUwMDE0XGLB4T+ofVx1MDAwNJZufa1K+3xcdTAwMGVNT7BSgZnFXlx1MDAxM6+mXHUwMDBmXG65XFxcXHxcdTAwMWVJjIDhXHUwMDAwTLxlJC2CO+fHa3SlmW28XHUwMDBmoruUSlx1MDAxN53iy6KjgHNIU1wi4Fxy0U2b5OA+XHK2tvcmJ8fbh1x1MDAwN/uHxchcdTAwMTc+X1x1MDAxNWKWXHLchd50aipcdTAwMDWccVx1MDAwZitMXHQoXHUwMDA2Ws4m4zN66HP6+5lig7EgjTM4fsPMVUZq+Fx1MDAwMnC1WlxuLraykVxcyzdzXHUwMDFiXHUwMDAz22mFrYvR78uszO7Gt+lg73LFuVx1MDAxNYR7Qlx1MDAwYlxyQlLDXHUwMDE5hTluq99cdTAwMTStXGZcdTAwMDKlXHUwMDEwbSlBri63jDJcZkB89mx/XHUwMDE3tVpcdTAwMDOoL6BWmWXUaqCYP/JmZn3/VFxmbv385HR3e+fqqjcpXHUwMDA3J51cdTAwMTVnXHUwMDE2jPFk9Vx1MDAxNi9cYsNcdTAwMTddtjBrqfFAaGaActxD6SrPWlx1MDAwMHw9XHUwMDE331x1MDAwYq1R+Efh3dDivVbaXGay7KxElSieXCKMMUThWXRv59Q0R5FcdTAwMWT/Wp7gtadGqJCzlc9cdTAwMGaPa4//XHUwMDAwvOmSvyJ9O2MXiQAAAABJRU5ErkJggg==" width="238" height="174" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="径向渐变">径向渐变<a href="https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius#%E5%BE%84%E5%90%91%E6%B8%90%E5%8F%98" class="hash-link" aria-label="Direct link to 径向渐变" title="Direct link to 径向渐变">​</a></h3>
<p>知道圆遮挡矩形的原理后，我们最容易想到的办法是 —— 先用 50% 的 border-radius 得到圆，再改变圆形的定位去遮挡矩形。</p>
<p>不过这种方法需要多个元素，并不优雅，我将介绍另一种更巧妙的办法。</p>
<p>我们需要先了解一个 CSS 函数 —— <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/gradient/radial-gradient" target="_blank" rel="noopener noreferrer">radial-gradient</a>。<code>radial-gradient</code> 中文名称是径向渐变，它可以指定渐变的中心、形状、颜色和结束位置。语法如下：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">/*</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"> * 形状 at 位置</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"> * 渐变颜色 渐变位置</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"> * ...</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"> * 渐变颜色 渐变位置</span><br></span><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token property">background-image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">radial-gradient</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    circle at center</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token hexcode color">#ddd</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用径向渐变在矩形中心画圆">利用径向渐变在矩形中心画圆<a href="https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius#%E5%88%A9%E7%94%A8%E5%BE%84%E5%90%91%E6%B8%90%E5%8F%98%E5%9C%A8%E7%9F%A9%E5%BD%A2%E4%B8%AD%E5%BF%83%E7%94%BB%E5%9C%86" class="hash-link" aria-label="Direct link to 利用径向渐变在矩形中心画圆" title="Direct link to 利用径向渐变在矩形中心画圆">​</a></h3>
<p>光看语法比较抽象，我们用代码写一个实际的例子。如图所示，我们要在矩形中心画圆：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAKgSURBVHic7d0xjqNAFEXR7pZXwv7XxFaYoJMJxtLI9QuCe05oGURw9VQJ9vd1XV/Q8PP0A8B95E6I3AmROyFyJ0TuhMidELkTIndC5E6I3Al5Dd7rPM/Bu8Gv4zimbmXdCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRPyevoBQo7j+Ofn53ne/CRZct/rXeLvviP9reS+y/+E/u4q0W/i7L7FZ61PXc471n3YVKlmfgfrPml8lc38LLmP2ZSm4gfJfcbWKBU/Re6EyH3ADetr4EfIfdVtISp+ndwJkfuSmxfXwC+SOyFyJ0TuhMj9c4+cpB3fV8idELkTIndC5E6I3AmROyFyJ0Tun3vkRVJvr66QOyFyJ0TuhMh9yc0naQf3RXInRO6rbltc075O7gNuCFHrI+ROiNxnbF1f0z5F7mM2Ran1QXKfNJ6m1mf5ffdhv4Guv1Eq9B2s+xaLsWp9E+u+y2czL/St5L7X3/n6o8nHyf0+sn6cszshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3Qr6v63r6GeAm1p0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTsgfDN5bAxRkJjUAAAAASUVORK5CYII=" width="250" height="175" class="img_ev3q"></p>
<p>下面是关键代码：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token property">background</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">radial-gradient</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  circle at center</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token hexcode color">#ddd</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其中：</p>
<ul>
<li><code>radial-gradient</code> 函数用于创建渐变效果。</li>
<li><code>circle at center</code> 指定了圆形渐变，并且渐变的中心在矩形的中心。</li>
<li><code>transparent 0</code> 指定了第一个渐变颜色为透明，位置是从中心开始。</li>
<li><code>transparent 20px</code> 指定了第二个渐变颜色也为透明，位置距离中心 20px。</li>
<li><code>#ddd 20px</code> 指定了第三个渐变颜色为淡灰色，位置距离中心 20px，第三个渐变颜色之后的颜色都是淡灰色。</li>
</ul>
<p>通过 <code>radial-gradient</code>，我们成功让矩形中心、半径为 20px 的圆变透明，超过半径 20px 的地方颜色都变为灰色，这样看起来就是矩形中心有一个圆。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="矩形左上角画圆">矩形左上角画圆<a href="https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius#%E7%9F%A9%E5%BD%A2%E5%B7%A6%E4%B8%8A%E8%A7%92%E7%94%BB%E5%9C%86" class="hash-link" aria-label="Direct link to 矩形左上角画圆" title="Direct link to 矩形左上角画圆">​</a></h3>
<p>不难想到，只要我们把圆的中心从矩形中心移动到矩形的左上角，就可以让圆挡住矩形左上角，得到一个反向圆角。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAI8SURBVHic7dvBbcNQDAXBOEgl6r8mt6Lcc7bIH+xMAQYPiwcJkF/3fX9Bw/f2ATBH7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5E/KzfcBf7/d7+wROcV3XZ3/QuhMid0LkTojcCTkrd++pPOqs3OFRcidE7oQclLsHd552UO7wtFNyN+0MOCV3GHBE7qadGfu5a50x+7nDmOXcTTuTNnPXOsPWctc683Zy1zorpv+rKnQWja671tk1tO5C5wSP5y50zvFI7hLnTJ/JXd/8Cz4iIETuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkT8rrve/sGGGLdCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXIn5BfOJjFpiYWsbgAAAABJRU5ErkJggg==" width="250" height="175" class="img_ev3q"></p>
<p>关键代码如下，我们可以把 <code>circle at center</code> 改写为 <code>circle at left top</code>：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token property">background</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">radial-gradient</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  circle at left top</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token hexcode color">#ddd</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="矩形四个角画圆">矩形四个角画圆<a href="https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius#%E7%9F%A9%E5%BD%A2%E5%9B%9B%E4%B8%AA%E8%A7%92%E7%94%BB%E5%9C%86" class="hash-link" aria-label="Direct link to 矩形四个角画圆" title="Direct link to 矩形四个角画圆">​</a></h3>
<p>我们已经知道 <code>radial-gradient</code> 如何实现 1 个反向圆角，接下来再看如何实现 4 个反向圆角。继续之前的思路，我们很容易想到给 <code>background</code> 设置多个反向渐变。</p>
<p>多个渐变之间可以用逗号分隔、且它们会按照声明的顺序依次堆叠。于是我们会写出如下关键代码：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token property">background</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">radial-gradient</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  circle at left top</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token hexcode color">#ddd</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">/* ... */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">radial-gradient</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  circle at right bottom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token hexcode color">#ddd</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>遗憾的是，上述代码运行后我们看不到四个反向圆角，而是看到一个矩形。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAICSURBVHic7dRBDcRADATBzemQLH9MoeKQWCWPrgIw8qPla2YWNPy+PgDeI3dC5E6I3AmROyFyJ0TuhMidELkTIndC5E7I/+zcfd9nB2Gttfc+suO7EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTsh18x8fQO8xHcnRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRPyAAPJClley2IJAAAAAElFTkSuQmCC" width="250" height="175" class="img_ev3q"></p>
<p>这是因为四个矩形互相堆叠，反而把反向圆角给遮住了。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/overlay-38bca1bd2f7fb7268edd14b71e969a8b.png" width="1052" height="398" class="img_ev3q"></p>
<p>遮挡怎么解决呢？我们可以分四步来解决。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="设置背景宽度和高度">设置背景宽度和高度<a href="https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius#%E8%AE%BE%E7%BD%AE%E8%83%8C%E6%99%AF%E5%AE%BD%E5%BA%A6%E5%92%8C%E9%AB%98%E5%BA%A6" class="hash-link" aria-label="Direct link to 设置背景宽度和高度" title="Direct link to 设置背景宽度和高度">​</a></h4>
<p>我们先单独看一个径向渐变。</p>
<p>第一步是设置 <code>background-size: 50% 50%;</code>，它设置了背景图像的大小是容器宽度和高度的 50%。代码运行后效果如下：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAALaSURBVHic7dvBiRtBFEVR2zgS5R+TUpEXXnn3UVdXNb7nBCDE+5diBmZ+fj6fH9Dw6/QXgH3kTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCfl9+gv84/1+n/4K93q9Xqs+ylZf8LoTIndC5E6I3Al5UO7//e9eC9nqOw/KHe4md0LkTshTcvfD6JytvvaU3GGDR+TuuZqz1RWPyB32OJ+752rOVhcdzt395mx13fnXHbY5mbvnas5WSxzL3f3mbLXKmdzdb85WCx3I3f3mbLXW1v9Vdbw5W91h3+vufnO2usmO193x5mx1q3tzd7w5W22wPndnm7PVZgtyd7M5W53ljwgIkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJ+X39I16v1/UP+ev9fq/6qGey1Vled0LkTojcCZE7IQ/K3e9ec7b6zoNyh7vJnRC5E/KU3P0wOmerrz0ld9jgEbl7ruZsdcUjcoc9zufuuZqz1UWHc3e/OVtdd/51h21O5u65mrPVEsdyd785W61yJnf3m7PVQgdyd785W6214H9V5xxvzlZ32Pe6u9+crW6y43V3vDlb3ere3B1vzlYbrM/d2eZstdmC3N1szlZn+SMCQuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3Qn5+Pp/T3wE28boTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3An5A0pZr4c4hE/7AAAAAElFTkSuQmCC" width="250" height="175" class="img_ev3q"></p>
<p>可以看到左上角有反向圆角的矩形重复出现了四次。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="设置不允许重复">设置不允许重复<a href="https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius#%E8%AE%BE%E7%BD%AE%E4%B8%8D%E5%85%81%E8%AE%B8%E9%87%8D%E5%A4%8D" class="hash-link" aria-label="Direct link to 设置不允许重复" title="Direct link to 设置不允许重复">​</a></h4>
<p>第二步是设置 <code>background-repeat: no-repeat;</code>。我们需要去除第一步中出现的重复。代码运行后效果如下：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAI8SURBVHic7dvBTcRQEAVBFhGJ849pUzFHAoCd+UtXRTCH1pMt2Y/7vj+g4XP7AJgjd0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTsjX9gE/ns/n9gmvdV3X9gl11p0QuRMid0LkTsgpuf/791ROcEruMEDuhMidkCNy9+DOjCNyhxn7uZt2xuznDmOWczftTNrMXesM8zBDyFrupp15O7lrnRULuWudLdO5a51Fc/+qCp11Q+uudU7w8nUXOud4Ye5C5zR/nLvEOdlvc9c3b8RHBITInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oQ87vvevgGGWHdC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidkG+cmzFp2FWm9gAAAABJRU5ErkJggg==" width="250" height="175" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="给每个径向渐变设置位置">给每个径向渐变设置位置<a href="https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius#%E7%BB%99%E6%AF%8F%E4%B8%AA%E5%BE%84%E5%90%91%E6%B8%90%E5%8F%98%E8%AE%BE%E7%BD%AE%E4%BD%8D%E7%BD%AE" class="hash-link" aria-label="Direct link to 给每个径向渐变设置位置" title="Direct link to 给每个径向渐变设置位置">​</a></h4>
<p>第三步是设置不允许重复时，应该保留的背景图像位置。</p>
<p>第一步中左上角是反向圆角的矩形出现了四次，第二步不允许重复时默认保留了左上角的矩形。事实上我们可以选择保留四个矩形中的任何一个，比如我们可以选择保留右下角的矩形。</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token property">background</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">radial-gradient</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    circle at left top</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token hexcode color">#ddd</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  right bottom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>代码运行后效果如下：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAI5SURBVHic7dvLbYRAFEVBj+VIyD8mUmnnwK/pOVUBoLc4uoIFnzHGDzT8zj4AniN3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJ+Zt9AMft+z77hHtt23btA607IXInRO6EyJ0Qua/q679T7yB3QuROiNwJkfuSvLgfI3dC5L4e036Y3AmR+2JM+xlyX4nWT5I7IXJfhmk/T+5r0Pol5L4ArV9F7m+n9Qv5V/W9hH456/5SWr+DdX8dod9H7i8i9LvJfTKJP0nuT9P3RD5VCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCfmMMWbfAA+x7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJ+Qc2cDFpbtRegwAAAABJRU5ErkJggg==" width="250" height="175" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="组合前三个步骤">组合前三个步骤<a href="https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius#%E7%BB%84%E5%90%88%E5%89%8D%E4%B8%89%E4%B8%AA%E6%AD%A5%E9%AA%A4" class="hash-link" aria-label="Direct link to 组合前三个步骤" title="Direct link to 组合前三个步骤">​</a></h4>
<p>第四步是组合前三个步骤的语法。</p>
<p>看完第三步后，一个很自然的想法，就是用四个渐变分别形成四个特殊矩形，然后把四个特殊矩形分别放在左上、右上、左下和右下角，最后得到有四个反向圆角的矩形。</p>
<p>关键代码如下,为了区分四个径向渐变，我给左上、右上、左下、右下分别设置了红、绿、蓝、黄四种颜色：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token property">background</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">radial-gradient</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      circle at left top</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">red</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    left top</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">radial-gradient</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      circle at right top</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">green</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    right top</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">radial-gradient</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      circle at left bottom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">blue</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    left bottom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">radial-gradient</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      circle at right bottom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">yellow</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    right bottom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token property">background-repeat</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> no-repeat</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token property">background-size</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">50</span><span class="token unit">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">50</span><span class="token unit">%</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>代码运行效果如下：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAL8SURBVHic7dvBattQEEDRqOS/2365sjAEJ6QkFElv0D1nZwhCzlwGybK3fd9foOHX6hOA68idELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndCXlefwFe2bfUZnGv7s/oMTrb/Hvq9Q9udELkTIndC5E7IvNzvfp9asP0dOsR5ucNp5E6I3AkZlrsL97uYefk+LHc406TcrfZ7GbjgJ+UOJxuTu9V+R9MW/IzctX5fo4qfkTtcYkDuVvvdzVnwq3PXesOQ4pfmrvWSCcWvy13rPcuLX/FbVaGHPYpf9WPWy7e71lm35i/c7kLnyZI1f0nuQucfLo7+tNwlzo89X9ucmv5xueubI3y6rD+2/tWPmeBCcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTsh277vxxxoO+QwCfvun/Vzx/T5YLsTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkT8nrUgfb9w8ttO+rA1Ozf/8n/Oiz3T57rlz7fOTHxZ2fl/uyRvuj5ykWhP1yR+4Po+ejS0B+uvlXdF7xHBlrTwXXb/Z0137Zy4S37INKaT1o89ZWfuys+Zv28Fz9mUnzGiEmvf6qq+IApM16fO1xmRO4W/K0Nmu6I3F8Uf1uz5jold7jAoNwt+NsZN9FBucPZZuVuwd/IxFnOyh1OJXdC5E7IuNxdvt/C0CmOyx3OI3dC5E6I3AnZdveGZNjuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkT8gYhBlGCFXtaiAAAAABJRU5ErkJggg==" width="250" height="175" class="img_ev3q"></p>
<p>不难想到，只要把红、绿、蓝、黄都换为灰色，就可以得到一个全灰、有四个反向圆角的矩形。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAK2SURBVHic7dxRittAEEBBOeQkuv+ZdBXnwyEsJIGFtaYneVUHEBL93Ayy8eP5fB7Q8G36BmAduRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCfk+fQPHcRzXdU3fAjc6z3P6Fn6y3QmROyFyJ2Q+dwf3/94+I57PHZaROyFyJ2Q4931Oddxqk0Hb7oRM5r7JJ541dhj3WO47PDyLjQ/dYYaQmdzHP+VMmR39QO5ajxsMYHXuWueYy+Cx7B+Ahc7vFv8UftF21zp/tDiM27e70PmMNWv+ltwlzlfcl/7bcpc4d3hv+r5mIkTuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndCHs/n8+0Xva7r7dek4zzPm658S+4fSZ/PuC/xj27P/UX0/M2a0F8Wnd1XPhL/kMVhLNruv1jzvIxswNVvZqx5jrkMBl5EKj5uMICZ9+6Kz5odva+ZCBnL3YIPGh/65HYff3hW2mHcDjOEDOe+wyeeBTYZtO1OiNwJkTsh87lvcqrjPvuMeD53WEbuhMidkNW/d4dBtjshcidE7oTInRC5EyJ3QuROiNwJkTshcifkBy9dajmu7XAKAAAAAElFTkSuQmCC" width="250" height="175" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="把背景改写为遮罩">把背景改写为遮罩<a href="https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius#%E6%8A%8A%E8%83%8C%E6%99%AF%E6%94%B9%E5%86%99%E4%B8%BA%E9%81%AE%E7%BD%A9" class="hash-link" aria-label="Direct link to 把背景改写为遮罩" title="Direct link to 把背景改写为遮罩">​</a></h3>
<p>知道四个反向圆角的矩形如何实现后，我们可以：</p>
<ul>
<li>把 <code>background-size</code> 改写为 <code>mask-size</code>；</li>
<li>把 <code>background-repeat</code> 改写为 <code>mask-repeat</code>;</li>
<li>把 <code>background</code> 改写为 <code>mask</code>；</li>
</ul>
<p>这样就可以得到四个反向圆角的矩形遮罩。</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token property">mask</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">radial-gradient</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      circle at left top</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token hexcode color">#ddd</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    left top</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">radial-gradient</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      circle at right top</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">red</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    right top</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">radial-gradient</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      circle at left bottom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">red</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    left bottom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:rgb(0, 0, 255)">radial-gradient</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      circle at right bottom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token color">red</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    right bottom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token property">mask-size</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">50</span><span class="token unit">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">50</span><span class="token unit">%</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token property">mask-repeat</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> no-repeat</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们可以把四个反向圆角的矩形覆盖在一张背景图片上，就得到了和热风小程序一样的效果：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/rect3-52ca0bfb5ae660b4ca302ba0e3597ace.png" width="250" height="175" class="img_ev3q"></p>
<p>需要注意的是，部分手机浏览器不支持 mask 语法，所以我们有必要再设置一份 <code>-webkit-mask</code>、<code>-webkit-mask-size</code> 和 <code>-webkit-mask-repeat</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a href="https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B" class="hash-link" aria-label="Direct link to 代码示例" title="Direct link to 代码示例">​</a></h2>
<p><a href="https://codepen.io/lijunlin2022/pen/GReBjEO" target="_blank" rel="noopener noreferrer">四个反向圆角的图片 | codepen</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文我们介绍了如何实现四个反向圆角的图片。</p>
<p>我们可以利用径向渐变，实现四个反向圆角的矩形。然后我们把这个矩形作为遮罩，覆盖在背景图片上，这样就实现了四个反向圆角的图片。</p>]]></content:encoded>
            <category>H5</category>
            <category>小程序</category>
        </item>
        <item>
            <title><![CDATA[H5、小程序高度变化的轮播图如何实现？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/02/16/variable-height-swiper</link>
            <guid>https://lijunlin2022.github.io/blog/2024/02/16/variable-height-swiper</guid>
            <pubDate>Fri, 16 Feb 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[高度固定的轮播图，你肯定经常看到、并知道怎么实现，但高度变化的轮播图呢？]]></description>
            <content:encoded><![CDATA[<p>高度固定的轮播图，你肯定经常看到、并知道怎么实现，但高度变化的轮播图呢？</p>
<p>下面是 Keep 的课程轮播，可以看到 9 号的视频数量是少于 10 号和 11 号的，所以 9 号的视频列表的高度比 10、11 号低。当播放到 9 号课程时，下方的主题课程模块会往上移动，填充 9 号视频列表下方的空白。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/keep-b7e0b29a6e81ced1d2390b3204705ca6.gif" width="360" height="630" class="img_ev3q"></p>
<p>如果你也想实现高度变化的轮播，看完这篇文章，你一定有所收获。我会先解释高度变化的原理，然后说明关键实现，最后再给出原生 H5 和小程序的示例代码。代码效果如下：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/variable-height-swiper-90e1390ffefc0e6be0044976ba1a3cbd.gif" width="500" height="250" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="高度变化的原理">高度变化的原理<a href="https://lijunlin2022.github.io/blog/2024/02/16/variable-height-swiper#%E9%AB%98%E5%BA%A6%E5%8F%98%E5%8C%96%E7%9A%84%E5%8E%9F%E7%90%86" class="hash-link" aria-label="Direct link to 高度变化的原理" title="Direct link to 高度变化的原理">​</a></h2>
<p>如果我们使用 flex 布局实现轮播图 Swiper，那么轮播图的整体高度，将会是最高一项的高度。</p>
<p>如下图，虚线框代表 Swiper，Swiper 的每项都是 List。如果播放到某个 List，这个 List 就是红色。可以看到，只要轮播图播放到较矮项，就会在较矮项底部留下大量空白。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/principle-1-fb3ced1de74b5899b23fdf8904e77dd1.png" width="1192" height="399" class="img_ev3q"></p>
<p>要想实现高度变化、且不留下空白的轮播图，原理很简单。我们只需要在轮播切换时，先获取即将播放的 List 高度，再把它的高度设置给 Swiper。</p>
<p>如下图，播放到某个 List，Swiper 的高度就变为这个 List 的高度。我们还可以给 Swiper 设置 <code>overflow: hidden;</code>，把找出 Swiper 范围的元素都给隐藏掉。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/principle-2-9a8e1652449cf610aa006a5a177887da.png" width="1192" height="381" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="关键代码实现">关键代码实现<a href="https://lijunlin2022.github.io/blog/2024/02/16/variable-height-swiper#%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" class="hash-link" aria-label="Direct link to 关键代码实现" title="Direct link to 关键代码实现">​</a></h2>
<p>聊完原理，我们来看代码，代码非常简单粗暴。</p>
<p>我们为每个 List 都设置了一个 id，利用 id 获取 List 的高度再设置到 Swiper 元素的 style 上。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">updateSwiperHeight</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">currentIndex</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> height </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(9, 134, 88)">document</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token method function property-access" style="color:rgb(0, 0, 255)">querySelector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token template-string string" style="color:rgb(163, 21, 21)">#item-box-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">${</span><span class="token template-string interpolation">currentIndex</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token template-string template-punctuation string" style="color:rgb(163, 21, 21)">`</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">offsetHeight</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  swiper</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> height </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'px'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  swiper</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token property-access">overflow</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'hidden'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a href="https://lijunlin2022.github.io/blog/2024/02/16/variable-height-swiper#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B" class="hash-link" aria-label="Direct link to 代码示例" title="Direct link to 代码示例">​</a></h2>
<p>现在来看 H5 和小程序的代码示例，为了突出重点，我并没有实现左右滑动，而是用点击切换近似替代：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="h5">H5<a href="https://lijunlin2022.github.io/blog/2024/02/16/variable-height-swiper#h5" class="hash-link" aria-label="Direct link to H5" title="Direct link to H5">​</a></h3>
<p><a href="https://codepen.io/lijunlin2022/pen/qBLxNzQ" target="_blank" rel="noopener noreferrer">高度变化的轮播图 | codepen</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="小程序">小程序<a href="https://lijunlin2022.github.io/blog/2024/02/16/variable-height-swiper#%E5%B0%8F%E7%A8%8B%E5%BA%8F" class="hash-link" aria-label="Direct link to 小程序" title="Direct link to 小程序">​</a></h3>
<p><a href="https://developers.weixin.qq.com/s/ct5irIm37eOg" target="_blank" rel="noopener noreferrer">高度变化的轮播图 | 小程序</a></p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li>小程序有原生的 swiper 组件，我们可以给 swiper 直接增加一个 style，在 style 中改变 swiper 的高度。</li>
<li>小程序没有 <code>querySelector()</code>，可以用 <code>createSelectorQuery()</code> 替代。</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="额�外提醒">额外提醒<a href="https://lijunlin2022.github.io/blog/2024/02/16/variable-height-swiper#%E9%A2%9D%E5%A4%96%E6%8F%90%E9%86%92" class="hash-link" aria-label="Direct link to 额外提醒" title="Direct link to 额外提醒">​</a></h2>
<p>高度变化的轮播图非常少见，你需要仔细斟酌什么时候用它。</p>
<p>如果你不需要左右滑动，那么选择 Tab + 卡片更适合。比如 12306 的选项卡，高度就是不等的：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/12306-df8f855fabba3e55a1da2b06c3094e38.gif" width="360" height="206" class="img_ev3q"></p>
<p>如果轮播每一项轮播都是长列表，且随着用户上拉屏幕，列表加载的数据还会变多。<strong>这种轮播通常还是固定高度（100vh）的轮播</strong>。</p>
<p>它在拼多多、淘宝、京东上很常见。你需要注意，<strong>这种轮播每一项需要自带滚动条，否则处理列表滚动条会变得非常麻烦</strong>。因为这种轮播往往要求记住用户在每个列表滚动的位置，如果轮播共用滚动条，左右切换会有一个很明显的闪烁。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/pdd-332fa0c169a8ad77979376b8c3b0bf63.gif" width="360" height="432" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/02/16/variable-height-swiper#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文我们介绍了高度变化的轮播图实现原理——先获取对应轮播项的高度，再改变轮播图的整体高度。之后我们给出了 H5 和小程序的代码示例。</p>]]></content:encoded>
            <category>H5</category>
            <category>小程序</category>
        </item>
        <item>
            <title><![CDATA[H5 蛟龙闹海动画如何实现（不引用图片）？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/02/09/dragon-troubles-the-sea</link>
            <guid>https://lijunlin2022.github.io/blog/2024/02/09/dragon-troubles-the-sea</guid>
            <pubDate>Fri, 09 Feb 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[龙年要到了，祝大家在新的一年里，如龙腾飞、事业有成；如龙入海、财源广进。]]></description>
            <content:encoded><![CDATA[<p>龙年要到了，祝大家在新的一年里，如龙腾飞、事业有成；如龙入海、财源广进。</p>
<p>我使用 HTML 和 CSS 实现了一个蛟龙闹海效果。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/dragon-troubles-the-sea-18929469c29a363415e7691624af93bb.gif" width="360" height="356" class="img_ev3q"></p>
<p>它很简略，但是代码中我没有引用图片，我是怎么做的呢？</p>
<p>下面我会从下往上、依次解释如何实现海浪、龙和云朵，接着我会给出整体代码，最后，我会做一个简单总结。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="海浪如何实现">海浪如何实现<a href="https://lijunlin2022.github.io/blog/2024/02/09/dragon-troubles-the-sea#%E6%B5%B7%E6%B5%AA%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0" class="hash-link" aria-label="Direct link to 海浪如何实现" title="Direct link to 海浪如何实现">​</a></h2>
<p>我使用 2 个不同 border-radius 圆角的正方形实现了海浪效果。首先，我实现了一个圆形和两个圆角正方形，然后把两个圆角正方形移动到圆形的底部。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="330" height="440" class="img_ev3q"></p>
<p>然后，我给圆角正方形添加旋转动画，</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/sea-bb3436a41d93d2e65fcfe093ea43f8ec.gif" width="330" height="440" class="img_ev3q"></p>
<p>之后给圆形添加 <code>overflow: hidden;</code>，就可以得到海浪效果。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/wave-af164e3d438cc03cf847e1f59b8ddc12.gif" width="360" height="360" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="龙如何实现">龙如何实现<a href="https://lijunlin2022.github.io/blog/2024/02/09/dragon-troubles-the-sea#%E9%BE%99%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0" class="hash-link" aria-label="Direct link to 龙如何实现" title="Direct link to 龙如何实现">​</a></h2>
<p>再看下龙如何实现，我使用 <code>clip-path</code> 实现了龙的效果。</p>
<p><code>clip-path</code> 是 CSS 一个属性，可以裁剪元素。裁剪区域内的显示，区域外的隐藏。可以利用 <code>ploygon()</code> 定义多个顶点，连接好后就成为了多边形。</p>
<p>我裁剪了 10 个多边形，组合成了龙。其中 1 个 8 边形是龙头、1 个 4 边形是眼睛、2 个 5 边形是龙角、4 个 4 边形是鬃毛，还有 1 个 12 边形是脖子、1 个 12 边形是肚子。</p>
<p>不过，以我的设计经验，肯定是没办法轻松裁剪出这些多边形的，我使用了 <a href="https://www.jiangweishan.com/tool/clippy/" target="_blank" rel="noopener noreferrer">clippy</a> 这个工具，这个工具可以像描图一样把多边形裁剪出来。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/clippy-dragon-a6c91554129e590806f5988be1843651.jpg" width="479" height="567" class="img_ev3q"></p>
<p>理论上裁剪得越精细，多边形数量越多，描边的龙就越像。这是纯粹的体力活，我这里偷个懒，只裁剪出大概的形状。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="云朵如何实现">云朵如何实现<a href="https://lijunlin2022.github.io/blog/2024/02/09/dragon-troubles-the-sea#%E4%BA%91%E6%9C%B5%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0" class="hash-link" aria-label="Direct link to 云朵��如何实现" title="Direct link to 云朵如何实现">​</a></h2>
<p>实现了龙，我们再看下云朵如何实现，我使用 6 个圆重叠形成了云朵。</p>
<p>简单画 6 个圆，如下所示：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/cloud-border-e23e28fb9c8d580bda3ce3c005acce7c.png" width="328" height="211" class="img_ev3q"></p>
<p>只要将这些圆的边框全部变透明，再填充上颜色，就可以得到一朵云。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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MWmiKL1LXHUwMDBl/apgP1x1MDAxYZ9Sd1x1MDAxMVx1MDAxY5ZcdTAwMTWLXG5rN1xyR/7a8K/CNlWj65GHxs0gKG1gKYzhVLF6ooFL0vbgUVx1MDAxY1WcScGEoljLWiDM3iNfeWVz4tosaPJcXDo2ath74nWR+O6jXHUwMDEyKKKw9oxgZVx1MDAxYrM2jOZtXHUwMDFkXHUwMDFie/Nmnb2NsO5/y2pcdTAwMTNcdTAwMWM8XHUwMDBm+Vd0XHUwMDE0OOFSXHUwMDEzXHUwMDAyL1xi77F34o9cdTAwMDN+flx1MDAxMNrlkU3jXHUwMDE1jN27XHUwMDBmIXSFo+f98diynDiCYlNyxVx1MDAxNbZU03JVy1xu7ShcIkBTYYDpjdk/1Vxcf6Dz11x1MDAxMFODUVx1MDAxOGRyN63TJnpjhec8U8O52Fx1MDAwNc/EbOPZYHJcdFWCvVx1MDAxOOdze5lcdTAwMWVcdTAwMWSNj1x1MDAwYs1cdTAwMGb+sdmluT1cdTAwMWRMu44zKKSEcso0M0SyXHUwMDE2zkQ4XHUwMDA2kC9KmWSG6lx1MDAwZeNcZlRcdTAwMGIpgEnoXCLPlDC6XHUwMDBinpncxjNcYqkpxVq/XHUwMDFj6OvBzfBwNVx1MDAxZd35s/2vIH9eecsr2XGgXHUwMDA1V44hmHLNJVx1MDAxN1xc61x1MDAxNtDgXHUwMDE4JrRcdTAwMDbJmdjEvYNAa8RZKUK7uEEzXHUwMDAxfFx1MDAxN1x1MDAxN1x1MDAwZb31vlx1MDAwMVx1MDAxY0BJLfnL71x1MDAxYunQ+zJcdTAwMWF/OL2ZL+HfM6WhuPaPO84z19RcdTAwMDFFtWTYvuWTt4DmjqFM4UGOUONcdTAwMGXIO0y0knieXG5cdTAwMDWsg0BcdTAwMGLMLN9cdTAwMDHQQMl2ovFcdTAwMTg2+lx1MDAxNVx1MDAxYnRcdTAwMDHjz1x1MDAwYrKfXHUwMDBlP1xyP1x1MDAxZp+OrtW7b6nqONCSXHUwMDEy5IhQXHJ4fZZaPOVcdTAwMTkkcYBcYq1cYlx1MDAwN42TqsM442GLXHUwMDFkKYXq4lx1MDAwNo2/muyCZ7L1fbesI5XyNVfoxdm7Qn85W1xcXFwu525cdTAwMDHJ4PrjJOo40LjnOkhy+UqoOVGsdePA+4jiRlx1MDAxMcYlXHUwMDAwwVx1MDAwM73DRFx1MDAwYkqUXHUwMDE0XHUwMDE0VFx1MDAwN4HmXHUwMDE0wLxcdTAwMWFofFZG+26SnORosnZcckNcdTAwMGL9k/AueGKmf1x1MDAxM1x1MDAwNsv9/0n6pPr099b+lyhcdTAwMDZVnFx1MDAwZntcdTAwMGb/XHUwMDAxVeRcdTAwMGaoIn2UVJbwAAAAAElFTkSuQmCC" width="328" height="211" class="img_ev3q"></p>
<p>我没有创建 6 个 div 元素然后叠加，而是使用了 box-shadow 来实现。box-shadow 最多有五个参数。</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">/* x 偏移量 | y 偏移量 | 阴影模糊半径 | 阴影扩散半径 | 阴影颜色 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token property">box-shadow</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token unit">px</span><span class="token plain"> </span><span class="token color function" style="color:rgb(0, 0, 255)">rgba</span><span class="token color punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token color number" style="color:rgb(9, 134, 88)">0</span><span class="token color punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token color"> </span><span class="token color number" style="color:rgb(9, 134, 88)">0</span><span class="token color punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token color"> </span><span class="token color number" style="color:rgb(9, 134, 88)">0</span><span class="token color punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token color"> </span><span class="token color number" style="color:rgb(9, 134, 88)">0.2</span><span class="token color punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>不需要阴影模糊半径和阴影扩散半径，只需要设置 x 偏移量和 y 偏移量，就可以实现圆形的偏移：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token property">box-shadow</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token hexcode color">#ddd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">-5</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token hexcode color">#ddd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token hexcode color">#ddd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token hexcode color">#ddd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token hexcode color">#ddd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="示例代码">示例代码<a href="https://lijunlin2022.github.io/blog/2024/02/09/dragon-troubles-the-sea#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 示例代码" title="Direct link to 示例代码">​</a></h2>
<p>现在，我们看完整代码：</p>
<p><a href="https://codepen.io/lijunlin2022/pen/abQewmE" target="_blank" rel="noopener noreferrer">蛟龙闹海 | codepen</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/02/09/dragon-troubles-the-sea#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文我们利用 HTML 和 CSS 实现了一个蛟龙闹海效果。其中：</p>
<ol>
<li>海浪，可以使用两个旋转的圆角正方形实现。</li>
<li>龙，可以使用 clip-path 裁剪多边形，再拼接多边形实现。</li>
<li>云朵，不需要创建多个元素，可以使用 box-shadow 并设置多组值实现。</li>
</ol>]]></content:encoded>
            <category>H5</category>
        </item>
        <item>
            <title><![CDATA[H5、小程序商品加入购物车的抛物线动画如何实现？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/02/03/parabolic-animation</link>
            <guid>https://lijunlin2022.github.io/blog/2024/02/03/parabolic-animation</guid>
            <pubDate>Sat, 03 Feb 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[电商类 H5、小程序把商品加入到购物车时，常常有一个抛物线动画。比如麦当劳小程序，当你点击加购按钮时，会看到有一个小汉堡从卡片汉堡上抛出，然后掉落到购物袋里。]]></description>
            <content:encoded><![CDATA[<p>电商类 H5、小程序把商品加入到购物车时，常常有一个抛物线动画。比如麦当劳小程序，当你点击加购按钮时，会看到有一个小汉堡从卡片汉堡上抛出，然后掉落到购物袋里。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/mcdonald's-5dcfebd6a789333baa3a92525104909b.gif" width="360" height="322" class="img_ev3q"></p>
<p>这种动画该怎么做呢？如果你也想实现它，看完这篇文章，你一定有所收获。我会先说明抛物线动画的原理，再解释实现它的关键代码，最后给出完整的代码示例。代码效果如下：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/parabola-ffdb0153f578a3f8179d299102c98cf0.gif" width="300" height="300" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="抛物线动画的原理">抛物线动画的原理<a href="https://lijunlin2022.github.io/blog/2024/02/03/parabolic-animation#%E6%8A%9B%E7%89%A9%E7%BA%BF%E5%8A%A8%E7%94%BB%E7%9A%84%E5%8E%9F%E7%90%86" class="hash-link" aria-label="Direct link to 抛物线动画的原理" title="Direct link to 抛物线动画的原理">​</a></h2>
<p>高中物理告诉我们，平抛运动、斜抛运动可以分解为水平方向的匀速直线运动、竖直方向自由落体运动（匀加速直线运动）。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/principle-2c15f4011484c80f4eb9ba952266e216.png" width="437" height="284" class="img_ev3q"></p>
<p>同理，我们可以把抛物线动画分解为水平的匀速动画、竖直的匀加速动画。</p>
<p>水平匀速动画很容易实现，直接 <code>animation-timing-function</code> 取值 <code>linear</code> 就行。</p>
<p>竖直的匀加速直线运动，严格实现非常困难，我们可以近似实现。因为匀加速直线运动，速度是越来越快的，所以我们可以用一个先慢后快的动画替代，你可能立刻就想到给 <code>animation-timing-function</code> 设置 <code>ease-in</code>。不过 <code>ease-in</code> 先慢后快的效果不是很明显。针对这个问题，张鑫旭大佬提供了一个贝塞尔曲线 <code>cubic-bezier(0.55, 0, 0.85, 0.36);</code><sup><a href="https://lijunlin2022.github.io/blog/2024/02/03/parabolic-animation#user-content-fn-1-29919e" id="user-content-fnref-1-29919e" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>。当然，你也可以用 <a href="https://cubic-bezier.com/" target="_blank" rel="noopener noreferrer">cubic-bezier</a> 自己调一个先慢后快的贝塞尔曲线。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="关键代码实现">关键代码实现<a href="https://lijunlin2022.github.io/blog/2024/02/03/parabolic-animation#%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" class="hash-link" aria-label="Direct link to 关键代码实现" title="Direct link to 关键代码实现">​</a></h2>
<p>我们把代码分为两部分，第一部分是布局代码、第二部分是动画代码。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="布局代码">布局代码<a href="https://lijunlin2022.github.io/blog/2024/02/03/parabolic-animation#%E5%B8%83%E5%B1%80%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 布局代码" title="Direct link to 布局代码">​</a></h3>
<p>首先是 HTML 代码，代码非常简单。下图中小球代表商品、长方形代表购物车。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAIAAAD2HxkiAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAATdSURBVHic7d0hbyJ5HIBh9nKi6ci6+ioMokmDwaNq95vsV1qLwmOaJogaVH1dJQ2uJ5psNnvJ3pQtee9un0cxA/PLmDcDk/CfT6+vrxOg80d9AvC7EyHE/qxPAP4Pdrvd4+Pj09PT8/Pzy8vLZDI5Pz+/uLi4vLy8urqaTqc/OfaT34RwtMPhsNls7u/v9/v9Tz42DMPNzc1isTg7O/v7uyKEI2232/V6/fP8vjcMw3K5vL6+/mG/COEYq9Xq7u7uiAPn8/nt7e33e0QI7/b169eHh4ejD5/NZp8/f/626e4ovM9qtfqVAieTycPDw2q1+rYpQniH7XZ73LfQH9zd3W2327fXIoSxDofDer3+qGnr9fpwOExECONtNpvx90L/0X6/32w2ExHCePf396cYKEIYZbfbfeBl8M1+v9/tdiKEUR4fH080VoQwytPT04nGihBGeX5+PtFYEcIob/+NOMVYEUJMhDDK+fn5icaKEEa5uLg40VgRwiiXl5cnGitCGOXq6upEY0UIo0yn02EYPnbmMAzT6VSEMNbNzc0pBooQxlosFh94MRyGYbFYTEQI452dnS2Xy4+atlwu3xZfEyG8w/X19Xw+//U58/n827JrIoT3ub29nc1mvzJhNpt9v+Ca1dbgGJY8hJ7Ff6FnGXz4t/BAGPgPc3cUYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIIfbpy5cv9TnAb82VEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihNhfcFfVlwNUNc8AAAAASUVORK5CYII=" width="300" height="300" class="img_ev3q"></p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">ball-box</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">ball</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag" style="color:rgb(128, 0, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 0, 0)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(4, 81, 165)">=</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag attr-value" style="color:rgb(128, 0, 0)">cart</span><span class="token tag attr-value punctuation" style="color:rgb(4, 81, 165)">"</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&lt;/</span><span class="token tag" style="color:rgb(128, 0, 0)">div</span><span class="token tag punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>你可能比较好奇，小球用一个 ball 元素就可以实现，为什么我要用 ball 和 ball-box 两个元素呢？因为 animation <strong>只能给一个元素定义一个动画效果</strong>，而我们需要给小球添加两个动画效果。于是我们将动画分解，给 ball-box 添加水平运动的动画，给 ball 添加竖直运动的动画。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="动画代码">动画代码<a href="https://lijunlin2022.github.io/blog/2024/02/03/parabolic-animation#%E5%8A%A8%E7%94%BB%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="Direct link to 动画代码" title="Direct link to 动画代码">​</a></h3>
<p>再看动画代码，moveX 是水平运动动画，moveY 是竖直动画，动画时间均为 1s。为了让效果更加明显，我还特意将动画设置成无限循环的动画。</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token selector class">.ball-box</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">/* ... */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">animation</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> moveX </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token unit">s</span><span class="token plain"> linear infinite</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token selector class">.ball</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">/* ... */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">animation</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> moveY </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token unit">s</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cubic-bezier</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0.55</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0.85</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0.36</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> infinite</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token atrule rule">@keyframes</span><span class="token atrule"> moveX</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token selector">to</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">transform</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">translateX</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">-250</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token atrule rule">@keyframes</span><span class="token atrule"> moveY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token selector">to</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">transform</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">translateY</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">250</span><span class="token unit">px</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a href="https://lijunlin2022.github.io/blog/2024/02/03/parabolic-animation#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B" class="hash-link" aria-label="Direct link to 代码示例" title="Direct link to 代码示例">​</a></h2>
<p><a href="https://codepen.io/lijunlin2022/pen/NWoLgyV" target="_blank" rel="noopener noreferrer">抛物线动画 | codepen</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/02/03/parabolic-animation#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文我们介绍了抛物线动画的实现方法，我们可以将抛物线动画拆分为水平匀速直线动画和竖直从慢变快的动画，水平动画我们可以使用 linear 来实现，竖直动画我们可以使用一个先慢后快的贝塞尔曲线替代。设置动画时，我们还需要注意，一个元素只能设置一个动画。</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="https://lijunlin2022.github.io/blog/2024/02/03/parabolic-animation#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-1-29919e">
<p><a href="https://www.zhangxinxu.com/wordpress/2018/08/css-css3-%e6%8a%9b%e7%89%a9%e7%ba%bf%e5%8a%a8%e7%94%bb/" target="_blank" rel="noopener noreferrer">这回试试使用CSS实现抛物线运动效果 | 张鑫旭</a> <a href="https://lijunlin2022.github.io/blog/2024/02/03/parabolic-animation#user-content-fnref-1-29919e" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content:encoded>
            <category>H5</category>
            <category>小程序</category>
        </item>
        <item>
            <title><![CDATA[H5 离线包放入 HTML 后降级方案如何设计？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback</link>
            <guid>https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback</guid>
            <pubDate>Sat, 27 Jan 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[离线包是移动端 H5 常见的性能优化方案。开发者们或多或少都接触过离线包。francecil 大佬还总结了离线包是否要放入 HTML 的两种决策，以及决策的优缺点： ：]]></description>
            <content:encoded><![CDATA[<p>离线包是移动端 H5 常见的性能优化方案。开发者们或多或少都接触过离线包。francecil 大佬还总结了离线包是否要放入 HTML 的两种决策，以及决策的优缺点： <sup><a href="https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback#user-content-fn-1-086d77" id="user-content-fnref-1-086d77" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>：</p>
<ul>
<li>放入 HTML（缓存优先）：更好的性能，但更新不及时。</li>
<li>不放入 HTML（网络优先）：实时更新，但性能较差，可能会加载失败。</li>
</ul>
<p>我选择把 HTML 放入离线包，这意味着 H5 出现线上故障时，没有办法及时修复。因此，我必须额外设计一套降级方案，保证离线包发生故障时能够快速降级。</p>
<p>如果你也为离线包的降级而烦恼，看了这篇文章，你一定有所收获。我会从离线包的机制说起，解释离线包放入 HTML 后为什么更新不及时，然后我会介绍自己设计的降级方案，最后我会对这个方案做一个总结。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="离线包的生效机制">离线包的生效机制<a href="https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback#%E7%A6%BB%E7%BA%BF%E5%8C%85%E7%9A%84%E7%94%9F%E6%95%88%E6%9C%BA%E5%88%B6" class="hash-link" aria-label="Direct link to 离线包的生效机制" title="Direct link to 离线包的生效机制">​</a></h2>
<p>为什么离线包放入 HTML 后更新不及时？为了回答这个问题，我们必须先知道它是如何生效的。</p>
<p>离线包首先会把 HTML、CSS 和 JS 等资源文件打包成一个压缩包，并预先下载到 App 本地，解压到缓存中。当用户访问 H5 时，Webview 开始加载资源的 URL 并发出资源请求，App 会拦截这些请求。</p>
<ul>
<li>如果缓存中有满足请求的资源，App 会使用缓存资源；</li>
<li>如果缓存中没有满足请求的资源，App 会使用线上资源。</li>
</ul>
<!-- -->
<p>什么时候叫缓存资源满足请求呢？就是缓存文件名字和请求文件名字一致。</p>
<ul>
<li>如果我们在离线包里放入 HTML，由于 HTML 文件不会轻易改变，即使线上资源有更新，App 也会优先使用缓存资源；</li>
<li>如果我们不放入 HTML，由于 CSS 和 JS 文件名的哈希会改变，所以线上资源有更新时，App 内 HTML、CSS 和 JS 都会使用线上资源。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="我设计的降级方案">我设计的降级方案<a href="https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback#%E6%88%91%E8%AE%BE%E8%AE%A1%E7%9A%84%E9%99%8D%E7%BA%A7%E6%96%B9%E6%A1%88" class="hash-link" aria-label="Direct link to 我设计的降级方案" title="Direct link to 我设计的降级方案">​</a></h2>
<p>上一节我们已经知道，HTML 文件名没有变化，离线包就不会失效。我们可以利用跳转间接改变文件名。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用跳转降级离线包">利用跳转降级离线包<a href="https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback#%E5%88%A9%E7%94%A8%E8%B7%B3%E8%BD%AC%E9%99%8D%E7%BA%A7%E7%A6%BB%E7%BA%BF%E5%8C%85" class="hash-link" aria-label="Direct link to 利用跳转降级离线包" title="Direct link to 利用跳转降级离线包">​</a></h3>
<p>首先，我们需要准备两个内容一样的 HTML，一个是 index.html，另一个是 index-online.html。</p>
<ul>
<li>index.html 会放入离线包；</li>
<li>index-online.html 不会放入离线包。</li>
</ul>
<p>然后，我们会设计一个开关，控制 index.html 是否要跳转。</p>
<ul>
<li>开关开启时，index.html 会跳转到 index-online.html；</li>
<li>开关关闭时，index.html 保持原始逻辑。</li>
</ul>
<p>这样发生线上故障时，我们可以回滚线上的 H5 页面，此时 index-online.html 恢复正常，而缓存在用户 App 本地的 index.html 还有问题。</p>
<p>我们开启开关后，离线的 index.html 直接跳转到已经恢复正常的 index-online.html，就实现了离线包的降级。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用版本大小设计开关">利用版本大小设计开关<a href="https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback#%E5%88%A9%E7%94%A8%E7%89%88%E6%9C%AC%E5%A4%A7%E5%B0%8F%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%85%B3" class="hash-link" aria-label="Direct link to 利用版本大小设计开关" title="Direct link to 利用版本大小设计开关">​</a></h3>
<p>上一小节，我们提到降级方案需要一个开关，设计这个开关，我们需要考虑两个问题：</p>
<ul>
<li>离线包有 n 个版本，有时多个版本均存在问题。比如 1.0.0 离线包没有问题，1.0.1 和 1.0.2 都有问题，我们需要保证开关能够降级多个版本。</li>
</ul>
<!-- -->
<ul>
<li>我们会发布修复的离线包，比如我们会在 1.0.3 修复问题。开关打开后，不能把修复版本降级。</li>
</ul>
<!-- -->
<p>怎么设计呢？我这里采取最简单粗暴的思路，把离线包本身的版本 H5_VERSION 和要降级的版本 rollbackVersion 做一个比较。</p>
<ul>
<li><code>H5_VERSION &lt;= rollbackVersion</code>，相当于打开降级开关。</li>
<li><code>H5_VERSION &gt; rollbackVersion</code>，相当于关闭降级开关。</li>
</ul>
<p>继续使用之前的例子，1.0.2 是出现问题的最高版本，我们可以把 rollbackVersion 设置为 1.0.2，<code>&lt;= 1.0.2</code> 全部降级。这样虽然会误伤 1.0.0 版本，但能既满足降级多个有问题的版本，又满足不降级修复版本。</p>
<!-- -->
<p>发生下一次故障时，我们再更新 rollbackVersion，比如 1.0.4 发生了故障，我们把 rollbackVersion 设置为 1.0.4，<code>&lt;= 1.0.4</code> 全部降级。</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用-localstorage-延迟开关生效时间">利用 localStorage 延迟开关生效时间<a href="https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback#%E5%88%A9%E7%94%A8-localstorage-%E5%BB%B6%E8%BF%9F%E5%BC%80%E5%85%B3%E7%94%9F%E6%95%88%E6%97%B6%E9%97%B4" class="hash-link" aria-label="Direct link to 利用 localStorage 延迟开关生效时间" title="Direct link to 利用 localStorage 延迟开关生效时间">​</a></h3>
<p>上一节我们介绍了如何设计开关。需要注意的是，我们不能一发现开关打开、就立即跳转，这会中断用户正常的操作。（比如用户正在浏览页面，突然页面跳转）</p>
<p>我们等开关打开后，在 localStorage 中存储一下代表打开的标识，等到用户下次进入页面时，发现有打开标识再跳转到 index-online.html。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="流程图">流程图<a href="https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback#%E6%B5%81%E7%A8%8B%E5%9B%BE" class="hash-link" aria-label="Direct link to 流程图" title="Direct link to 流程图">​</a></h3>
<p>考虑完上面三个问题后，我们就可以设计一个比较完善的降级方案了，它的流程图如下：</p>
<!-- -->
<ol>
<li>用户一进入页面，会先获取 localStorage 中的 needRollback 开关标识。</li>
<li>如果 needRollback 标识打开，则跳转 index-online.html 实现降级。（注：<strong>index-online.html 中不能继续判断 needRollback，否则会无限跳转</strong>）</li>
<li>如果 needRollback 标识没有打开，则继续获取 H5 本身的版本号，以及接口下发的 rollbackVersion。</li>
<li>如果 <code>H5_VERSION &lt;= rollbackVersion</code>，则在 localStorage 把 needRollback 设置为 1。</li>
<li>如果 <code>H5_VERSION &gt; rollbackVersion</code>，则删除 localStorage 中的 needRollback 标识。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文介绍了一种离线包放入 HTML 的降级方案，它主要有三个特点：</p>
<ol>
<li>利用从离线化的 index.html 跳转到线上的 index-online.html 实现降级。</li>
<li>利用离线包版本 <code>H5_VERSION &lt;= rollbackVersion</code> 做开关，判断是否需要降级。</li>
<li>利用 localStorage 中设置 needRollback 标识，延迟开关作用时间。</li>
</ol>
<p>这种方案是离线包放入 HTML 后，一种成本较低的降级方案。它会在降级时误伤低版本的离线包，以损耗性能为代价，保障质量。</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-1-086d77">
<p><a href="https://juejin.cn/post/7254549436625256506" target="_blank" rel="noopener noreferrer">HTML 放入离线包？你需要了解的离线策略</a> <a href="https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback#user-content-fnref-1-086d77" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content:encoded>
            <category>H5</category>
        </item>
        <item>
            <title><![CDATA[取余和取模如何区分与应用？]]></title>
            <link>https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo</link>
            <guid>https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo</guid>
            <pubDate>Thu, 18 Jan 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[取余（remainer）和取模（modulo），很多书籍没有说明它们的区别、也没有说明它们的应用场景。比如《JavaScript 高级程序设计（第 4 版）》直接说：]]></description>
            <content:encoded><![CDATA[<p>取余（remainer）和取模（modulo），很多书籍没有说明它们的区别、也没有说明它们的应用场景。比如《JavaScript 高级程序设计（第 4 版）》直接说：</p>
<blockquote>
<p>取模（余数）操作符由一个百分比符号（%）表示。</p>
</blockquote>
<p>但实际上，两个概念并不完全一致。严格来说，JavaScript 中的 % 是取余，而不是取模。</p>
<p>有读者可能认为，没必要区分取余和取模。但我想说，区分取余和取模，能帮助你写出更优雅的代码。</p>
<p>以掘金的创作话题轮播为例，它带有灰色进度条，当你左滑或右滑时，话题对应的圆点会变长。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/loop-progress-361cbdaa09df0a2b8828cfde31837b86.gif" width="360" height="160" class="img_ev3q"></p>
<p>假如让你来实现灰色进度条，需要计算左滑后的下标（prevIndex）和右滑后的下标（nextIndex），你会怎么做呢？</p>
<ul>
<li>要是你完全不理解取余和取模，为了兼顾左滑、右滑的边界情况，你可能会这样写：</li>
</ul>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> prevIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> currentIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  len </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  currentIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> nextIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> currentIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> len </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  currentIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>要是你只理解取余，不理解取模，你可能会这样写：</li>
</ul>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> prevIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">currentIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">%</span><span class="token plain"> len </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">currentIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> len </span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  currentIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> nextIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">currentIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">%</span><span class="token plain"> len</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>要是你既理解取余，又理解取模，你可以写出更优雅的代码：（mod 不是 JavaScript 原生函数，需要额外实现）</li>
</ul>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> prevIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">mod</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">currentIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> nextIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">mod</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">currentIndex </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果你想知道取余和取模的区别和应用、以及 mod 函数如何实现，看完这篇文章，你一定有所收获。</p>
<p>我会先给出取余和取模的计算方式，再用四个例子解释计算方式，接着我会谈一谈什么时候该取余，什么时候该取模，最后我会介绍 JavaScript 中 2 种实现 mod 函数的方法。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="计算方式">计算方式<a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#%E8%AE%A1%E7%AE%97%E6%96%B9%E5%BC%8F" class="hash-link" aria-label="Direct link to 计算方式" title="Direct link to 计算方式">​</a></h2>
<p>余数和模的计算方式如下图：</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/rem-mod-2c38a1d8bb58f287e17be6f49afd065f.png" width="549" height="240" class="img_ev3q"></p>
<p>其中 fix 代表向 0 取整，而 floor 代表向负无穷取整。你可能并不理解什么叫作「向 0 取整」，什么叫作「向负无穷取整」，先不要着急，在例子中我会详细讲解。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="例子">例子<a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#%E4%BE%8B%E5%AD%90" class="hash-link" aria-label="Direct link to 例子" title="Direct link to 例子">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-除以-2">5 除以 2<a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#5-%E9%99%A4%E4%BB%A5-2" class="hash-link" aria-label="Direct link to 5 除以 2" title="Direct link to 5 除以 2">​</a></h3>
<p>把 x = 5，y = 2 代入公式后，你需要计算的是 <code>fix(2.5)</code> 和 <code>floor(2.5)</code>。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/5rem2-eaf9d6d5c4a728663909bb9ee86692b0.png" width="1073" height="340" class="img_ev3q"></p>
<p>你可以画出一个右箭头，代表从负无穷指向正无穷的数轴。</p>
<p>找到 2.5 的位置，可以发现 0 和负无穷都在 2.5 的左边。对 2.5 来说，向 0 取整和向负无穷取整，都是往左边取。</p>
<p>所以 <code>fix(2.5) = 2</code>， <code>floor(2.5) = 2</code>，把它们代入公式，得到余数和模都是 1。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-5-除以-2">-5 除以 2<a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#-5-%E9%99%A4%E4%BB%A5-2" class="hash-link" aria-label="Direct link to -5 除以 2" title="Direct link to -5 除以 2">​</a></h3>
<p>再看 -5 除以 2，继续代入公式画数轴，你需要计算的是 <code>fix(-2.5)</code> 和 <code>floor(-2.5)</code>。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/-5rem2-53288a254cdbc643bddb862ae87b36b2.png" width="1108" height="340" class="img_ev3q"></p>
<p>找到 -2.5 的位置，可以看到 0 在 -2.5 的右边，而负无穷在 -2.5 的左边。此时向 0 取整就是取 -2.5 右边的整数，向负无穷取整就是取 -2.5 左边的整数。</p>
<p>所以 <code>fix(-2.5) = -2</code>，<code>floor(-2.5) = -3</code>。把它们代入公式，得到余数为 -1，模为 1。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-除以--2">5 除以 -2<a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#5-%E9%99%A4%E4%BB%A5--2" class="hash-link" aria-label="Direct link to 5 除以 -2" title="Direct link to 5 除以 -2">​</a></h3>
<p>继续看 5 除以 -2，你需要计算的是 <code>fix(-2.5)</code> 和 <code>floor(-2.5)</code>。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/5rem-2-3453464000c456b8803ace66d8f8ae1d.png" width="1150" height="340" class="img_ev3q"></p>
<p>之前已经知道 <code>fix(-2.5) = -2</code>，<code>floor(-2.5) = -3</code>，把它们代入公式，得到余数为 1，模为 -1。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-5-除以--2">-5 除以 -2<a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#-5-%E9%99%A4%E4%BB%A5--2" class="hash-link" aria-label="Direct link to -5 除以 -2" title="Direct link to -5 除以 -2">​</a></h3>
<p>最后看 -5 除以 -2，你需要计算的是 <code>fix(2.5)</code> 和 <code>floor(2.5)</code>。</p>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/-5rem-2-2a83ef03a3605cf1724a149d42be255e.png" width="1206" height="340" class="img_ev3q"></p>
<p>之前已经知道 <code>fix(2.5) = 2</code>，<code>floor(2.5) = 2</code>，把它们代入公示后得到余数和模都是 -1。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="余数和模的区别">余数和模的区别<a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#%E4%BD%99%E6%95%B0%E5%92%8C%E6%A8%A1%E7%9A%84%E5%8C%BA%E5%88%AB" class="hash-link" aria-label="Direct link to 余数和模的区别" title="Direct link to 余数和模的区别">​</a></h2>
<p>观察上面的 4 个例子，不难发现，取余和取模的结果，和 x 和 y 的正负号有关。</p>
<ul>
<li>当 x 和 y 同为正数、或者同为负数时，x rem y 和 x mod y 的结果一样。</li>
<li>当 x 和 y 符号不一致时，x rem y 和 x mod y 的结果不一样。rem 计算结果符号和 x 一样，mod 计算结果和 y 一样。</li>
</ul>
<p>实际应用中，y 一般都是正数，因此只需要考虑 x 符号的正负。</p>
<ul>
<li>
<p>当 x 为正数时，此时取余数和取模结果一致，因此最好使用 JavaScript 的 % 运算符。</p>
<p>例如你想访问数组中的某个元素，又担心下标超出数组的范围，你可以先求下标除以数组长度的余数，把余数作为新下标。</p>
</li>
<li>
<p>当 x 可能为正数也可能为负数时，此时可以实现一个 mod 函数。</p>
<p>例如我在文章开头举的例子，prevIndex 可能是一个负数，你可以直接求 prevIndex 除以轮播长度的模。</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="实现取模函数">实现取模函数<a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#%E5%AE%9E%E7%8E%B0%E5%8F%96%E6%A8%A1%E5%87%BD%E6%95%B0" class="hash-link" aria-label="Direct link to 实现取模函数" title="Direct link to 实现取模函数">​</a></h2>
<p>取模函数，我知道的有两种实现方法，一种是偏重工程，另一种偏重学术。两者有什么区别呢？</p>
<p>之前提到过，实际应用中，x mod y 时，y 一般是正数。</p>
<ul>
<li><strong>工程方法追求简单实用，只考虑 y 为正数的情况。</strong></li>
</ul>
<p>它的写法简单易懂，先求 x 除以 y 的余数，如果结果为负数，就给结果再加上一个 y，保证结果始终为正数。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">mod</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">x</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> res </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(0, 0, 0)">%</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> res </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">?</span><span class="token plain"> res </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> res</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/verify-func-1-22f300a8c214d9052d9e9c7383c62c20.png" width="350" height="400" class="img_ev3q"></p>
<p>Ant Design Mobile Swiper <sup><a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#user-content-fn-1-41eb80" id="user-content-fnref-1-41eb80" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup> 源码用的就是这种方法。</p>
<ul>
<li><strong>学术方法追求逻辑严密，既会考虑 y 为正数，也会考虑 y 为负数。</strong></li>
</ul>
<p>它的写法如下，我不清楚怎么证明，但代入数字计算，可以验证结果正确。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">mod</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token parameter">x</span><span class="token parameter punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token parameter"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(0, 0, 0)">%</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">%</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="https://lijunlin2022.github.io/assets/images/verify-func-2-8187a575a8cac5a1bb7c5e36a513e7e7.png" width="350" height="400" class="img_ev3q"></p>
<p>MDN <sup><a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#user-content-fn-2-41eb80" id="user-content-fnref-2-41eb80" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup> 和 stackoverflow <sup><a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#user-content-fn-3-41eb80" id="user-content-fnref-3-41eb80" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup> 推荐的就是这种方法。</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-1-41eb80">
<p><a href="https://github.com/ant-design/ant-design-mobile/blob/master/src/components/swiper/swiper.tsx" target="_blank" rel="noopener noreferrer">ant-design-mobile | github</a> <a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#user-content-fnref-1-41eb80" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-2-41eb80">
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Remainder" target="_blank" rel="noopener noreferrer">remainder | mdn</a> <a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#user-content-fnref-2-41eb80" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-3-41eb80">
<p><a href="https://stackoverflow.com/questions/4467539/javascript-modulo-gives-a-negative-result-for-negative-numbers/17323608#17323608" target="_blank" rel="noopener noreferrer">JavaScript % (modulo) gives a negative result for negative numbers | stackoverflow</a> <a href="https://lijunlin2022.github.io/blog/2024/01/18/remainder-and-modulo#user-content-fnref-3-41eb80" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section>]]></content:encoded>
        </item>
    </channel>
</rss>