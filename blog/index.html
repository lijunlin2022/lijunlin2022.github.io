<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.0">
<title data-rh="true">Blog | 小霖家的混江龙</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://lijunlin2022.github.io/blog"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="google-site-verification" content="z1w9iBabIBZmBrBiQPn3K-e8msiNRO_hR9O3oWhdcok"><meta data-rh="true" property="og:title" content="Blog | 小霖家的混江龙"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/logo.png"><link data-rh="true" rel="canonical" href="https://lijunlin2022.github.io/blog"><link data-rh="true" rel="alternate" href="https://lijunlin2022.github.io/blog" hreflang="en"><link data-rh="true" rel="alternate" href="https://lijunlin2022.github.io/blog" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"Blog","@id":"https://lijunlin2022.github.io/blog","mainEntityOfPage":"https://lijunlin2022.github.io/blog","headline":"Blog","description":"Blog","blogPost":[{"@type":"BlogPosting","@id":"https://lijunlin2022.github.io/blog/2024/03/23/ten-billion-subsidy-load-img","mainEntityOfPage":"https://lijunlin2022.github.io/blog/2024/03/23/ten-billion-subsidy-load-img","url":"https://lijunlin2022.github.io/blog/2024/03/23/ten-billion-subsidy-load-img","headline":"仿百亿补贴，H5 中图片先模糊后清晰的效果如何实现","name":"仿百亿补贴，H5 中图片先模糊后清晰的效果如何实现","description":"逛过拼多多百亿补贴的同学，可能有一个体会，那就是图片加载非常快，很多图片瞬间就出现了，这是为什么呢？","datePublished":"2024-03-23T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported","mainEntityOfPage":"https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported","url":"https://lijunlin2022.github.io/blog/2024/03/10/is-webp-supported","headline":"H5、小程序能用 webp 图片吗？如何判断环境是否支持？","name":"H5、小程序能用 webp 图片吗？如何判断环境是否支持？","description":"最近我在做 H5、小程序的性能优化，其中一项优化是把 H5、小程序的 jpg、png 图片转换为 webp 图片，这是因为相比 jpg、png，webp 体积更小、传输速度更快。","datePublished":"2024-03-10T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy","mainEntityOfPage":"https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy","url":"https://lijunlin2022.github.io/blog/2024/03/03/ten-billion-subsidy","headline":"百亿补贴为什么用 H5？H5 未来会如何发展？","name":"百亿补贴为什么用 H5？H5 未来会如何发展？","description":"23 年 11 月末，拼多多市值超过了阿里。我想写一篇文章《百亿补贴为什么用 H5》，没有动笔；24 年新年，我想写一篇《新的一年，H5 会如何发展》，也没有动笔。","datePublished":"2024-03-03T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://lijunlin2022.github.io/blog/2024/03/02/pull-up","mainEntityOfPage":"https://lijunlin2022.github.io/blog/2024/03/02/pull-up","url":"https://lijunlin2022.github.io/blog/2024/03/02/pull-up","headline":"H5 上滑加载（触底加载）如何实现","name":"H5 上滑加载（触底加载）如何实现","description":"上滑加载（触底加载）是 H5 常见的功能，今天我们来看下如何实现。","datePublished":"2024-03-02T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://lijunlin2022.github.io/blog/2024/02/28/pull-down","mainEntityOfPage":"https://lijunlin2022.github.io/blog/2024/02/28/pull-down","url":"https://lijunlin2022.github.io/blog/2024/02/28/pull-down","headline":"H5 下拉刷新如何实现","name":"H5 下拉刷新如何实现","description":"最近我需要做一个下拉刷新的功能，实现功能后我发现，它需要处理的情况还蛮多，于是我整理了这篇文章。","datePublished":"2024-02-28T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius","mainEntityOfPage":"https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius","url":"https://lijunlin2022.github.io/blog/2024/02/19/reverse-border-radius","headline":"H5、小程序中四个反向圆角的图片如何实现","name":"H5、小程序中四个反向圆角的图片如何实现","description":"最近我逛热风小程序（一个卖鞋的小程序）时，发现了一个奇特的图片样式。图片的四个圆角是反向的，和常规图片不一样。","datePublished":"2024-02-19T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://lijunlin2022.github.io/blog/2024/02/16/variable-height-swiper","mainEntityOfPage":"https://lijunlin2022.github.io/blog/2024/02/16/variable-height-swiper","url":"https://lijunlin2022.github.io/blog/2024/02/16/variable-height-swiper","headline":"H5、小程序高度变化的轮播图如何实现","name":"H5、小程序高度变化的轮播图如何实现","description":"高度固定的轮播图，你肯定经常看到、并知道怎么实现，但高度变化的轮播图呢？","datePublished":"2024-02-16T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://lijunlin2022.github.io/blog/2024/02/09/dragon-troubles-the-sea","mainEntityOfPage":"https://lijunlin2022.github.io/blog/2024/02/09/dragon-troubles-the-sea","url":"https://lijunlin2022.github.io/blog/2024/02/09/dragon-troubles-the-sea","headline":"H5 蛟龙闹海动画如何实现（不引用图片）","name":"H5 蛟龙闹海动画如何实现（不引用图片）","description":"龙年要到了，祝大家在新的一年里，如龙腾飞、事业有成；如龙入海、财源广进。","datePublished":"2024-02-09T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://lijunlin2022.github.io/blog/2024/02/03/parabolic-animation","mainEntityOfPage":"https://lijunlin2022.github.io/blog/2024/02/03/parabolic-animation","url":"https://lijunlin2022.github.io/blog/2024/02/03/parabolic-animation","headline":"H5、小程序商品加入购物车的抛物线动画如何实现","name":"H5、小程序商品加入购物车的抛物线动画如何实现","description":"电商类 H5、小程序把商品加入到购物车时，常常有一个抛物线动画。比如麦当劳小程序，当你点击加购按钮时，会看到有一个小汉堡从卡片汉堡上抛出，然后掉落到购物袋里。","datePublished":"2024-02-03T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback","mainEntityOfPage":"https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback","url":"https://lijunlin2022.github.io/blog/2024/01/27/offline-package-rollback","headline":"H5 离线包放入 HTML 后降级方案如何设计","name":"H5 离线包放入 HTML 后降级方案如何设计","description":"离线包是移动端 H5 常见的性能优化方案。开发者们或多或少都接触过离线包。francecil 大佬还总结了离线包是否要放入 HTML 的两种决策，以及决策的优缺点： ：","datePublished":"2024-01-27T00:00:00.000Z","author":[],"keywords":[]}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="小霖家的混江龙 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="小霖家的混江龙 Atom Feed">




<link rel="alternate" type="application/rss+xml" href="/life/rss.xml" title="小霖家的混江龙 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/life/atom.xml" title="小霖家的混江龙 Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/novel/rss.xml" title="小霖家的混江龙 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/novel/atom.xml" title="小霖家的混江龙 Atom Feed"><link rel="stylesheet" href="/assets/css/styles.2680c9e4.css">
<script src="/assets/js/runtime~main.f5cbad64.js" defer="defer"></script>
<script src="/assets/js/main.68855bc0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">小霖家的混江龙</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">技术博客</a><a class="navbar__item navbar__link" href="/docs/html/layout-visual-and-ideal-viewport">技术笔记</a><a class="navbar__item navbar__link" href="/life">生活</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/lijunlin2022" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/03/23/ten-billion-subsidy-load-img">仿百亿补贴，H5 中图片先模糊后清晰的效果如何实现</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/03/10/is-webp-supported">H5、小程序能用 webp 图片吗？如何判断环境是否支持？</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/03/03/ten-billion-subsidy">百亿补贴为什么用 H5？H5 未来会如何发展？</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/03/02/pull-up">H5 上滑加载（触底加载）如何实现</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/02/28/pull-down">H5 下拉刷新如何实现</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/02/19/reverse-border-radius">H5、小程序中四个反向圆角的图片如何实现</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/02/16/variable-height-swiper">H5、小程序高度变化的轮播图如何实现</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/02/09/dragon-troubles-the-sea">H5 蛟龙闹海动画如何实现（不引用图片）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/02/03/parabolic-animation">H5、小程序商品加入购物车的抛物线动画如何实现</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/01/27/offline-package-rollback">H5 离线包放入 HTML 后降级方案如何设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/01/18/remainder-and-modulo">取余和取模如何区分与应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/12/14/loop-swiper">H5 不复制元素的循环轮播图如何实现——取模</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/07/30/tab-scroll-to-center">H5、小程序 Tab 如何滚动居中</a></li></ul></nav></aside><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/2024/03/23/ten-billion-subsidy-load-img">仿百亿补贴，H5 中图片先模糊后清晰的效果如何实现</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-03-23T00:00:00.000Z">March 23, 2024</time> · <!-- -->5 min read</div></header><div class="markdown"><p>逛过拼多多百亿补贴的同学，可能有一个体会，那就是图片加载非常快，很多图片瞬间就出现了，这是为什么呢？</p>
<p>答案是：<strong>百亿补贴先加载了一张模糊小图、再加载了一张清晰大图</strong>。用户很难感知到模糊到清晰的过程，误以为图片加载很快。</p>
<p>接下来我会先给出证据、再分析原理、提供关键代码，之后给百亿补贴的方法做扩展、补充，最后做一个简单总结。</p>
<p>当然，图片优化是涉 及知识很琐碎、广泛，<strong>先模糊小图后清晰大图只是其中一种手段，百亿补贴肯定还使用了其他技术。</strong> 如果朋友你想了解更多相关手段，可以点赞关注我。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="证据">证据<a href="#证据" class="hash-link" aria-label="Direct link to 证据" title="Direct link to 证据">​</a></h2>
<p>我们可以有三个证据，可以证明：百亿补贴是先加载模糊小图，再加载清晰大图。</p>
<p>第一个证据：我们可以在控制台把网络调整成 Slow 3G，然后强制刷新浏览器，可以看到拼多多的图片，存在一个模糊到清晰的过程。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Slow-3G-809a0d6428dc8008c0d8a54116f8cc90.png" width="400" height="200" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/pdd-load-555770405aded11264890eab2a7f854f.gif" width="375" height="200" class="img_ev3q"></p>
<p>第二个证据：我们在控制台查看网络请求，可以看到请求中有一张小商品图、一张大商品图。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/product-a2b7df38be78e424c03c20561bae4352.png" width="1120" height="700" class="img_ev3q"></p>
<p>第三个证据：我们在控制台找到图片元素，可以看到图片元素是一个 a 标签包裹着一个 img 标签。其中 a 标签的 background-image 是模糊小图链接，img 标签的 src 是清晰大图链接。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/pdd-console-eae9a68911c3645ff19987e1acb891b4.png" width="900" height="230" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="原理及代码">原理及代码<a href="#原理及代码" class="hash-link" aria-label="Direct link to 原理及代码" title="Direct link to 原理及代码">​</a></h2>
<p>要想知道先模糊、后清晰的原理，我们得先看一张 img 标签是如何加载图片的，如下所示：开始时 img 占据的区域为空白，随着图片的逐步加载，空白部分被慢慢填充。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/avatar-load-ecabe8d4415ea0eba801ee48f880b797.gif" width="375" height="338" class="img_ev3q"></p>
<p>准确地说，<strong>img 标签占据的区域，不是「空白」而是「透明」</strong>。这意味着，我们只需要给 img 标签设置一张模糊小图链接，给 img 标签的 src 设置清晰大图链接，当大图慢慢加载时，清晰图片会一步步遮挡住模糊图片，从而实现模糊到清晰的效果。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/avatar-blur-to-clear-6975f39d29bbc190f5fd49d1d3df60eb.gif" width="375" height="338" class="img_ev3q"></p>
<p>关键代码如下，非常简单：</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">box</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">a</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">small-img</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">img</span><span class="token tag" style="color:hsl(5, 74%, 59%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token tag" style="color:hsl(5, 74%, 59%)">      </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">large-img</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token tag" style="color:hsl(5, 74%, 59%)">      </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">src</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">大图链接</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token tag" style="color:hsl(5, 74%, 59%)">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">a</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token selector class" style="color:hsl(119, 34%, 47%)">.box</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">position</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> relative</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token selector class" style="color:hsl(119, 34%, 47%)">.small-img</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">position</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> absolute</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">background-image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token url function" style="color:hsl(221, 87%, 60%)">url</span><span class="token url punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token url string url" style="color:hsl(198, 99%, 37%)">&quot;小图链接&quot;</span><span class="token url punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">background-size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> cover</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">background-position</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> unset</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token selector class" style="color:hsl(119, 34%, 47%)">.large-img</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">width</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ...</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">height</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ...</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>获取小图链接也很简单，现在各大云服务商基本都提供了方法。比如 <a href="https://help.aliyun.com/zh/oss/user-guide/resize-images-4?spm=a2c4g.11186623.0.0.1acf21edXNFC2F" target="_blank" rel="noopener noreferrer">阿里云</a> 只需要在图片 CDN 链接后面拼接一些参数，就可以得到图片缩放的小图。</p>
<ul>
<li>缩放前：<a href="https://oss-console-img-demo-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/example.jpg" target="_blank" rel="noopener noreferrer">https://oss-console-img-demo-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/example.jpg</a></li>
<li>缩放后：<a href="https://oss-console-img-demo-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/example.jpg?x-oss-process=image/resize,w_100,m_lfit" target="_blank" rel="noopener noreferrer">https://oss-console-img-demo-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/example.jpg?x-oss-process=image/resize,w_100,m_lfit</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="更进一步加模糊滤镜">更进一步，加模糊滤镜<a href="#更进一步加模糊滤镜" class="hash-link" aria-label="Direct link to 更进一步，加模糊滤镜" title="Direct link to 更进一步，加模糊滤镜">​</a></h2>
<p>百亿补贴的做法，对于电商活动 H5 已经足够。但更讲究氛围感的 H5，也许会觉得百亿补贴的效果很粗糙。针对这种 H5，我们可以更进一步，给小图加上模糊滤镜，等到大图加载完成时再去除模糊滤镜，并增加 transition 的过渡效果，就得到如下效果：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/blur-20-to-0-07ff519e171be0ebfa1eb178a289f21c.gif" width="375" height="338" class="img_ev3q"></p>
<p>关键代码为：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token selector class" style="color:hsl(119, 34%, 47%)">.small-img</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">filter</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">blur</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">transition</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> all </span><span class="token number" style="color:hsl(35, 99%, 36%)">.5</span><span class="token unit">s</span><span class="token plain"> ease-in-out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token selector class" style="color:hsl(119, 34%, 47%)">.loaded</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">filter</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">blur</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> small </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:hsl(221, 87%, 60%)">document</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">querySelector</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;.small-img&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> large </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:hsl(221, 87%, 60%)">document</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">querySelector</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;.large-img&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">large</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method-variable function-variable method function property-access" style="color:hsl(221, 87%, 60%)">onload</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  small</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">classList</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">add</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;loaded&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文分析了百亿补贴图片加载非常快的主要原因：先加载模糊小图，再加载清晰大图。并给出了关键证据，以及实现原理和代码。最后在百亿补贴方法的基础上，增加模糊滤镜，实现了更有氛围感的效果。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/h-5">H5</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/2024/03/10/is-webp-supported">H5、小程序能用 webp 图片吗？如何判断环境是否支持？</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-03-10T00:00:00.000Z">March 10, 2024</time> · <!-- -->9 min read</div></header><div class="markdown"><p>最近我在做 H5、小程序的性能优化，其中一项优化是把 H5、小程序的 jpg、png 图片转换为 webp 图片，这是因为相比 jpg、png，webp 体积更小、传输速度更快。</p>
<p>转换方法很简单，现在各大云服务商基本都提供了方法。比如 <a href="https://cloud.tencent.com/document/product/436/60453" target="_blank" rel="noopener noreferrer">腾讯云</a> 只需要在图片 CDN 链接后面拼接一些参数：</p>
<ul>
<li>转换前：<a href="https://example-1258125638.cos.ap-shanghai.myqcloud.com/sample.png" target="_blank" rel="noopener noreferrer">https://example-1258125638.cos.ap-shanghai.myqcloud.com/sample.png</a></li>
<li>转换后：<a href="http://example-1258125638.cos.ap-shanghai.myqcloud.com/sample.png?imageMogr2/format/webp" target="_blank" rel="noopener noreferrer">http://example-1258125638.cos.ap-shanghai.myqcloud.com/sample.png?imageMogr2/format/webp</a></li>
</ul>
<p>不过我还是遇到了些小麻烦，从 <a href="https://caniuse.com/?search=webp" target="_blank" rel="noopener noreferrer">can I use</a> 查询发现，目前还有少部分浏览器不支持 webp。所以在 H5、小程序使用 webp 格式图片时，我需要做一些兼容。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/can-i-use-webp-65be8d4e5f7ebcff89d5bc2be33036eb.png" width="1370" height="730" class="img_ev3q"></p>
<p>一番研究后，我知道了判断环境是否支持 webp 的几种办法。对这些办法的优劣，我也有自己的观点，于是我便整理了这篇文章。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="todataurlimagewebp">toDataURL(&#x27;image/webp&#x27;)<a href="#todataurlimagewebp" class="hash-link" aria-label="Direct link to toDataURL(&#x27;image/webp&#x27;)" title="Direct link to toDataURL(&#x27;image/webp&#x27;)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="代码">代码<a href="#代码" class="hash-link" aria-label="Direct link to 代码" title="Direct link to 代码">​</a></h3>
<p>第一种 H5 的判断方法，其实是判断 H5 能不能利用 canvas 的 <code>toDataURL()</code> API 得到一张 webp 图片。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">isWebpSupported</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token dom variable" style="color:hsl(221, 87%, 60%)">document</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">createElement</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;canvas&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">toDataURL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;image/webp&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">indexOf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;data:image/webp&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">===</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理">原理<a href="#原理" class="hash-link" aria-label="Direct link to 原理" title="Direct link to 原理">​</a></h3>
<p>这种方法原理是啥呢？我们可以继续在 <a href="https://caniuse.com/?search=webp" target="_blank" rel="noopener noreferrer">Can I use</a> 查询 <code>toDataURL(&#x27;image/webp&#x27;)</code> 的兼容性。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/can-i-use-toDataURL-0737cd2f1564acdfd4dc40f7cd9d097b.png" width="1370" height="530" class="img_ev3q"></p>
<p>可以看到，<strong>兼容 <code>toDataURL(&#x27;image/webp&#x27;)</code> 的浏览器、是兼容 webp 浏览器的子集。</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/toDataURL-abfeced3aeb71b89b5cd92e51251382c.png" width="417" height="170" class="img_ev3q"></p>
<p>换句话说，这是一种「宁杀错一百，也不放过一个」的方法。举 Safari 浏览器为例子，它其实是可以展示 webp 图片的，但它会被这种 <code>toDataURL(&#x27;image/webp&#x27;)</code> 方法误伤。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/safari-958dd39ed7715445f3ffa5839476b22b.jpg" width="330" height="230" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="优缺点">优缺点<a href="#优缺点" class="hash-link" aria-label="Direct link to 优缺点" title="Direct link to 优缺点">​</a></h3>
<p>这种方法的优缺点如下:</p>
<ul>
<li>优点：代码短小，且方法是同步的，不影响首屏性能。</li>
<li>缺点：误伤性太高，iOS 的 Safari 浏览器被全部误伤。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="微信小程序能用吗">微信小程序能用吗<a href="#微信小程序能用吗" class="hash-link" aria-label="Direct link to 微信小程序能用吗" title="Direct link to 微信小程序能用吗">​</a></h3>
<p>这种判断方法微信小程序可以使用吗？很遗憾不可以。</p>
<p>我们之所以用 <code>toDataURL(&#x27;image/webp&#x27;)</code> 判断 H5 能不能使用 webp，前提是我们知道 <strong>兼容 <code>toDataURL(&#x27;image/webp&#x27;)</code> 的浏览器、是兼容 webp 浏览器的子集</strong>。</p>
<p>但我在微信官方文档中，没有看到类似 canvas 的 <a href="https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Canvas.toDataURL.html" target="_blank" rel="noopener noreferrer">toDataURL(&#x27;image/webp&#x27;)</a> 是 webp 子集的描述。基于此，我判断微信小程序不能用这个方法。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="加载一张-webp-图片试试看会不会出错">加载一张 webp 图片试试，看会不会出错<a href="#加载一张-webp-图片试试看会不会出错" class="hash-link" aria-label="Direct link to 加载一张 webp 图片试试，看会不会出错" title="Direct link to 加载一张 webp 图片试试，看会不会出错">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="代码-1">代码<a href="#代码-1" class="hash-link" aria-label="Direct link to 代码" title="Direct link to 代码">​</a></h3>
<p>第二种 H5 的判断方法，是直接异步加载一张 webp 格式的图片。如果加载成功，证明环境能支持 webp；如果加载失败，证明环境不支持 webp。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">isWebpSupported</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token maybe-class-name">Image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:hsl(35, 99%, 36%)">Promise</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">resolve</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">Promise</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token parameter">resolve</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:hsl(221, 87%, 60%)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> img </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">Image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    img</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method-variable function-variable method function property-access" style="color:hsl(221, 87%, 60%)">onload</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token function" style="color:hsl(221, 87%, 60%)">resolve</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    img</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method-variable function-variable method function property-access" style="color:hsl(221, 87%, 60%)">onerror</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token function" style="color:hsl(221, 87%, 60%)">resolve</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    img</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理-1">原理<a href="#原理-1" class="hash-link" aria-label="Direct link to 原理" title="Direct link to 原理">​</a></h3>
<p>这种方法来源于 <a href="https://developers.google.com/speed/webp/faq?hl=zh-cn#in_your_own_javascript" target="_blank" rel="noopener noreferrer">Google 官方文档</a>，webp 其实支持四个功能，无损压缩、有损压缩、透明度和动画，每个功能对应了一张 webp 图片：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">checkWebpFeature</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token parameter">feature</span><span class="token parameter punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> kTestImages </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token literal-property property" style="color:hsl(5, 74%, 59%)">lossy</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token literal-property property" style="color:hsl(5, 74%, 59%)">lossless</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token literal-property property" style="color:hsl(5, 74%, 59%)">alpha</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token literal-property property" style="color:hsl(5, 74%, 59%)">animation</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> img </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">Image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  img</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method-variable function-variable method function property-access" style="color:hsl(221, 87%, 60%)">onload</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> result </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">width</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">callback</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feature</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  img</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method-variable function-variable method function property-access" style="color:hsl(221, 87%, 60%)">onerror</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">callback</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feature</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  img</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;data:image/webp;base64,&quot;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> kTestImages</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">feature</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果对四种功能都进行判断的话，代码会变得很臃肿。所以实际开发中，基本只选择一张 webp 的图片。</p>
<p>从 <a href="https://caniuse.com/?search=webp" target="_blank" rel="noopener noreferrer">Can I use</a> 查询结果来看，浏览器要么是先支持 webp 的有损压缩，再支持 webp 的无损压缩、透明度和动画；要么是有损压缩、无损压缩、透明度和动画一起支持。因此，我们往往选择一张支持动画的 webp 图片，用它去试探浏览器是否支持 webp 格式。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="优缺点-1">优缺点<a href="#优缺点-1" class="hash-link" aria-label="Direct link to 优缺点" title="Direct link to 优缺点">​</a></h3>
<ul>
<li>优点：基本不会误伤；</li>
<li>缺点：异步加载，可能无法及时转换图片链接、影响首屏性能。如果 H5 不选择 CSR，而选择 SSR，则无法使用此方法。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="微信小程序能用吗-1">微信小程序能用吗<a href="#微信小程序能用吗-1" class="hash-link" aria-label="Direct link to 微信小程序能用吗" title="Direct link to 微信小程序能用吗">​</a></h3>
<p>这种方法小程序可以用吗？理论上可以，但不推荐使用。</p>
<p>微信官方文档上虽然提到了 <a href="https://developers.weixin.qq.com/minigame/dev/api/render/image/wx.createImage.html" target="_blank" rel="noopener noreferrer">createImage</a> 方法，但我实际测试发现，这个方法竟然没了 (* ￣︿￣)。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/createImage-6306f0937520db614460a7364e32e263.jpg" width="1100" height="320" class="img_ev3q"></p>
<p>我们使用此方法，就必须在 wxml 中手动写一个 <code>image</code> 标签，再给它绑定 <code>onload</code> 和 <code>onerror</code> 事件。这意味着：</p>
<ul>
<li>如果我们把这个标签放到自己封装的 WebpImage 组件中，WebpImage 被多次使用后，小程序页面会多出很多额外的节点。</li>
<li>如果我们把这个标签放到页面上（比如 index 页面），就需要给每一个用户可能直接访问的页面都加上这个标签。也会出现很多额外的节点。</li>
</ul>
<p>因此不推荐使用。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="直接判断版本">直接判断版本<a href="#直接判断版本" class="hash-link" aria-label="Direct link to 直接判断版本" title="Direct link to 直接判断版本">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="代码-2">代码<a href="#代码-2" class="hash-link" aria-label="Direct link to 代码" title="Direct link to 代码">​</a></h3>
<p>第三种方法，就是直接判断版本号，Android 版本大于 4.2.0，iOS 大于 14.0.0 时，认为 webp 可用。</p>
<p>H5 通过 ua 获取系统版本号的文章很多，我们这里给出小程序的代码。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">isWebpSuported</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> system</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token maybe-class-name">SDKVersion</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> wx</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">getSystemInfoSync</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">sysName</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> sysVersion</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">system </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">split</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27; &#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">compareVersion</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token maybe-class-name">SDKVersion</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;2.9.0&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      sysName</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">toUpperCase</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">===</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;ANDROID&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token function" style="color:hsl(221, 87%, 60%)">compareVersion</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sysVersion</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;4.2.0&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      sysName</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">toUpperCase</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">===</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;IOS&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token function" style="color:hsl(221, 87%, 60%)">compareVersion</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sysVersion</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;14.0.0&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="原理-2">原理<a href="#原理-2" class="hash-link" aria-label="Direct link to 原理" title="Direct link to 原理">​</a></h3>
<p>我们已经通过 <a href="https://caniuse.com/?search=webp" target="_blank" rel="noopener noreferrer">Can I use</a> 知道：</p>
<ul>
<li>Android 4.2.0 以下，iOS 14 以下的浏览器不支持 webp。</li>
</ul>
<p>又从 <a href="https://developers.weixin.qq.com/miniprogram/dev/component/image.html#WebView-%E7%89%B9%E6%9C%89%E5%B1%9E%E6%80%A7" target="_blank" rel="noopener noreferrer">微信小程序 image 组件文档</a> 里知道：</p>
<ul>
<li>基础库版本 &gt;= 2.9.0 支持 webp。</li>
</ul>
<p>那么干脆把所有条件都做一个组合，就得到了上述代码，其中 <code>compareVersion()</code> 是 <a href="https://developers.weixin.qq.com/ebook?action=get_post_info&amp;volumn=1&amp;lang=zh_CN&amp;book=miniprogram&amp;docid=000288319f40c0eb00860cd135100a" target="_blank" rel="noopener noreferrer">微信官方文档</a> 中比较版本号的代码。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="优缺点-2">优缺点<a href="#优缺点-2" class="hash-link" aria-label="Direct link to 优缺点" title="Direct link to 优缺点">​</a></h3>
<ul>
<li>优点：同步判断、不影响首屏性能；误伤范围小；且 CSR 和 SSR 可用。</li>
<li>缺点：无明显缺点。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文介绍了 H5、小程序使用 webp 格式图片时，判断环境是否支持的方法。</p>
<ul>
<li>方法一：利用 <code>toDataURL(&#x27;image/webp&#x27;)</code> 判断。H5 支持，但是会误伤大部分浏览器；小程序不支持。</li>
<li>方法二：利用一张小体积的 webp 图片试探。H5 CSR 时支持，但因为方法是异步的、可能影响首屏性能；H5 SSR 时不支持；小程序支持，但实现不优雅。</li>
<li>方法三：<strong>利用版本号判断。H5 和浏览器均支持，是最佳实现方案。</strong></li>
</ul>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p></div></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/2024/03/03/ten-billion-subsidy">百亿补贴为什么用 H5？H5 未来会如何发展？</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-03-03T00:00:00.000Z">March 3, 2024</time> · <!-- -->15 min read</div></header><div class="markdown"><p>23 年 11 月末，拼多多市值超过了阿里。我想写一篇文章《百亿补贴为什么用 H5》，没有动笔；24 年新年，我想写一篇《新的一年，H5 会如何发展》，也没有动笔。</p>
<p>眼看着灵感就要烂在手里，我决定把两篇文章合为一篇，与大家分享。当然，这些分析预测只是个人观点，如果你有不同的意见，欢迎在评论区讨论交流。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="百亿补贴为什么用-h5">百亿补贴为什么用 H5<a href="#百亿补贴为什么用-h5" class="hash-link" aria-label="Direct link to 百亿补贴为什么用 H5" title="Direct link to 百亿补贴为什么用 H5">​</a></h2>
<p>我们在 Android 手机开发者模式下，开启显示布局边界，可以看到「百亿补贴」是一个完整大框，说明「百亿补贴」在 App 内是 H5；拷贝分享链接，在浏览器打开，可以看到资源中有 react 名字的 js 文件，说明「百亿补贴」技术栈大概率是 React。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/pdd-stack-97a1b5678ebd6b6ca3f9d6a1aaf9e55d.png" width="847" height="520" class="img_ev3q"></p>
<p>不只是拼多多，我特地确认了，京东、淘宝的的「百亿补贴」技术栈也是 H5。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/pdd-jd-taobao-37ac80a21ebc73953a05d1df69596f68.png" width="727" height="518" class="img_ev3q"></p>
<p>那么，为什么电商巨头会在「百亿补贴」这种重要活动上选择 H5 呢？用 H5 有什么好处呢？</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="h5-技术已经成熟">H5 技术已经成熟<a href="#h5-技术已经成熟" class="hash-link" aria-label="Direct link to H5 技术已经成熟" title="Direct link to H5 技术已经成熟">​</a></h3>
<p>第一个原因，也是最基础的原因，就是 H5 技术已经成熟，能够完整地实现功能。具体来说：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="浏览器兼容性不断提高">浏览器兼容性不断提高<a href="#浏览器兼容性不断提高" class="hash-link" aria-label="Direct link to 浏览器兼容性不断提高" title="Direct link to 浏览器兼容性不断提高">​</a></h4>
<p>自 2008 年 HTML5 草案发布以来，截止 2014 年，HTML5 已有 18 年历史。18 年间，主流浏览器对 HTML5、CSS3 和 JavaScript 的标准语法兼容性一直持续改进，22 年微软更是亲手  盖上了 IE 棺材板。虽然 Safari（iOS 浏览器）的兼容性仍然备受诟病，但总体来说兼容成本已经变得可以接受。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="主流框架已经成熟">主流框架已经成熟<a href="#主流框架已经成熟" class="hash-link" aria-label="Direct link to 主流框架已经成熟" title="Direct link to 主流框架已经成熟">​</a></h4>
<p>前端最主流的两大框架 Vue 和 React 已经成熟。它们的成熟体现在多个方面：</p>
<ul>
<li>从时间的角度看，截止 2024 年，React 已经发布了 11 年，而 Vue 已经发布了 10 年。经过多年的发展，前端开发者已经非常熟悉 React 和 Vue，能熟练地应用它们进行开发。</li>
<li>从语法的角度看，自 React16.8 发布 Hooks，以及 Vue3 发布 Composition API 以来，两大框架语法基本稳定，不再有大的变化。前端开发者可以更加专注于业务逻辑，无需过多担心框架语法的变动。</li>
<li>从未来发展方向看，React 目前致力于推广 React Server Component <sup><a href="#user-content-fn-1-8d2659" id="user-content-fnref-1-8d2659" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>；Vue 则在尝试着无 VDom 的 Vapor 方向，并计划利用 Rust 重写 Vite <sup><a href="#user-content-fn-2-8d2659" id="user-content-fnref-2-8d2659" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>。这表明旧领域不再有大的颠覆，两大框架已经正寻求新的发展领域。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="混合开发已经成熟">混合开发已经成熟<a href="#混合开发已经成熟" class="hash-link" aria-label="Direct link to 混合开发已经成熟" title="Direct link to 混合开发已经成熟">​</a></h4>
<p>混合开发是指将原生开发（Android 和 iOS）和 Web 开发结合起来的一种技术。简而言之，它将 H5 嵌入到移动应用内部运行。近些年，业界对混合开发的优势 和缺陷已经有清晰的认识，并针对其缺陷进行了相应的优化。具体来说：</p>
<ul>
<li>混合开发的优势包括开发速度快、一套代码适配 Android 和 iOS，以及实现代码的热更新。这意味着程序员能更快地编写跨平台应用，及时更新应用、修复缺陷；</li>
<li>混合开发的缺陷则是性能较差、加载受限于网络。针对这个缺陷，各大 App、以及云服务商如阿里云 <sup><a href="#user-content-fn-3-8d2659" id="user-content-fnref-3-8d2659" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup> 和腾讯云 <sup><a href="#user-content-fn-4-8d2659" id="user-content-fnref-4-8d2659" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup> 都推出了自己的离线包方案。离线包方案可以将网页的静态资源（如 HTML、CSS、JS、图片等）缓存到本地，用户访问 H5 页面时，可以直接读取本地的离线资源，从而提升页面的加载速度。可以说，接入离线包后，H5 不再有致命缺陷。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="前端基建工具已经成熟">前端基建工具已经成熟<a href="#前端基建工具已经成熟" class="hash-link" aria-label="Direct link to 前端基建工具已经成熟" title="Direct link to 前端基建工具已经成熟">​</a></h4>
<p>近些年来，业界最火的技术话题之一，就是用 Rust 替代前端基建，包括：用 Rust 替代 Webpack 的 Rspack；用 Rust 替代 Babel 的 SWC；用 Rust 替代 Eslint 的 OxcLint 等等。</p>
<p>前端开发者对基建工具抱怨，已经从「这工具能不能用」，转变为「这工具好不好用」。这种「甜蜜的烦恼」，只有基建工具成熟后才会出现。</p>
<p><strong>综上所述，浏览器的兼容性提升、主流框架的成熟、混合开发的发展和前端基建工具的完善，使 H5 完全有能力承载「百亿补贴」业务。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="h5-开发成本低">H5 开发成本低<a href="#h5-开发成本低" class="hash-link" aria-label="Direct link to H5 开发成本低" title="Direct link to H5 开发成本低">​</a></h3>
<p>前文我们已经了解到，成熟的技术让 H5 可以实现「百亿补贴」的功能。现在我们介绍另一个原因——H5 开发成本低。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="百亿补贴需要多个-h5">「百亿补贴」需要多个 H5<a href="#百亿补贴需要多个-h5" class="hash-link" aria-label="Direct link to 「百亿补贴」需要多个 H5" title="Direct link to 「百亿补贴」需要多个 H5">​</a></h4>
<p>「百亿补贴」的方式，是一个常住的 H5，搭配上多个流动的 H5。（「常住」和「流动」是我借鉴「常住人口」和「流动人口」造的词）</p>
<ul>
<li>
<p>常住 H5 链接保持不变。站外投放的链接基本都是常住 H5 的，站内首页入口链接也是常住 H5 的，这样方便用户二次访问。</p>
</li>
<li>
<p>流动 H5 链接位于常住 H5 的不同位置，比如头图、侧边栏等。时间不同、用户不同、算法不同，流动 H5 的链接都会不同，流动 H5 可以区分用户，方便分发流量。</p>
<p>具体来看，拼多多至少有三个流量的分发点，第一个是可点击的头图，第二个是列表上方的活动模块，第三个是右侧浮动的侧边栏，三者可以投放不同的链接。最近就分别投放 3.8 女神节链接、新人链接和品牌链接：</p>
</li>
</ul>
<p><img decoding="async" loading="lazy" src="/assets/images/pdd-activity-1ed1254be7ab141b7332d32dc0a334de.png" width="717" height="520" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="百亿补贴需要及时更新">「百亿补贴」需要及时更新<a href="#百亿补贴需要及时更新" class="hash-link" aria-label="Direct link to 「百亿补贴」需要及时更新" title="Direct link to 「百亿补贴」需要及时更新">​</a></h4>
<p>不难想到，每到  一个节日、每换一个品牌，「百亿补贴」就需要更新一次。</p>
<p>有时还需要为一些品牌定制化 H5 代码。如果使用其他技术栈，排期跟进通常会比较困难，但是使用 H5 就能够快速迭代并上线。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="h5-投放成本低">H5 投放成本低<a href="#h5-投放成本低" class="hash-link" aria-label="Direct link to H5 投放成本低" title="Direct link to H5 投放成本低">​</a></h3>
<p>我们已经「百亿补贴」使用 H5 技术栈的两个原因，现在来看第三个原因——H5 适合投放。</p>
<p>拼多多的崛起过程中，投放到其他 App 的链接功不可没。早期它通过微信等社交平台「砍一刀」的模式，低成本地吸引了大量用户。如今，它通过投放「百亿补贴」策略留住用户。</p>
<p>H5 的独特之处，在于它能够灵活地在多个平台上进行投放，其他技术栈很难有这样的灵活性。即使是今天，抖音、Bilibili 和小红书等其他 App 中，「百亿补贴」的 H5 链接也随处可见。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/pdd-advertisement-74c8d804db4013db2788ea794a5713ca.png" width="739" height="517" class="img_ev3q"></p>
<p>拼多多更是将 H5 这种灵活性发挥到极致，只要你有「百亿补贴」的链接，你甚至可以在微信、飞书、支付宝等地方直接查看「百亿补贴」 H5 页面。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/wechat-flybook-alipay-059f18ab40791acd041db426d5358594.png" width="723" height="519" class="img_ev3q"></p>
<p><strong>综上所述，能开发、能快速开发、且开发完成后能大量投放，是「百亿补贴」青睐 H5 的原因。</strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="h5-未来会如何发展">H5 未来会如何发展<a href="#h5-未来会如何发展" class="hash-link" aria-label="Direct link to H5 未来会如何发展" title="Direct link to H5 未来会如何  发展">​</a></h2>
<p>了解「百亿补贴」选择 H5 的原因后，我们来看看电商巨头对 H5 未来发展的影响。我认为有三个影响：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="h5-数量膨胀定制化要求苛刻">H5 数量膨胀，定制化要求苛刻<a href="#h5-数量膨胀定制化要求苛刻" class="hash-link" aria-label="Direct link to H5 数量膨胀，定制化要求苛刻" title="Direct link to H5 数量膨胀，定制化要求苛刻">​</a></h3>
<p>C 端用户黏性相对较低，换一个 App 的成本微不足道。近年 C 端市场增长缓慢，企业重点从获取更多的新客变成留住更多的老客，很难容忍用户丢失。因此其他企业投放活动 H5 时，企业必须也投放活动 H5，电商活动 H5 就变得越来越多。</p>
<p>这个膨胀的趋势不仅仅存在于互联网巨头的 App 中，中小型应用也不例外，甚至像 12306、中国移动、招商银行这种工具性极强的应用也无法幸免。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/12306-yidong-zhaoshang-c8021ad5da3a4c3d9dc25a569d8e646f.png" width="722" height="517" class="img_ev3q"></p>
<p>随着市场的竞争加剧，定制化要求也变得越来越苛刻，目的是让消费者区分各种活动。用互联网黑话来说，就是「建立用户心智」。在可预见的未来，尽管电商活动 H5 结构基本相同，但是它们的外观将变得千差万别、极具个性。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/fluid-98332da26036496ea2748e01f698992b.png" width="735" height="516" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ssr-比例增加csr-占据主流">SSR 比例增加，CSR 占据主流<a href="#ssr-比例增加csr-占据主流" class="hash-link" aria-label="Direct link to SSR 比例增加，CSR 占据主流" title="Direct link to SSR 比例增加，CSR 占据主流">​</a></h3>
<p>在各家 H5 数量膨胀、竞争激烈的情况下，一定会有企业为提 升 H5 的秒开率接入 SSR，因此 SSR 的比例会增加。</p>
<p>但我认为 CSR 依然会是主流，主要是因为两个原因：</p>
<ol>
<li>SSR 需要额外的服务器费用，包括服务器的维护、扩容等。这对于中小型公司来说是一个负担。</li>
<li>SSR 对程序员技术水平要求比 CSR 更高。SSR 需要程序员考虑更多的问题，例如内存泄露。使用 CSR 在用户设备上发生内存泄露，影响有限；但是如果在服务器上发生内存泄露，则是会占用公司的服务器内存，增加额外的成本和风险。</li>
</ol>
<p>因此，收益丰厚、技术雄厚的公司更愿意使用 SSR。没有金刚钻别揽瓷器活，总不能向老板汇报结果时，告诉老板「虽然您亏钱了，但是 SSR 真的很酷」。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="monorepo-比例会上升类-shadcn-ui-组件库也许会兴起">Monorepo 比例会上升，类 Shadcn UI 组件库也许会兴起<a href="#monorepo-比例会上升类-shadcn-ui-组件库也许会兴起" class="hash-link" aria-label="Direct link to Monorepo 比例会上升，类 Shadcn UI 组件库也许会兴起" title="Direct link to Monorepo 比例会上升，类 Shadcn UI 组件库也许会兴起">​</a></h3>
<p>如前所述，H5 的数量膨胀，代码复用就会被着重关注。我猜测更多企业会选择 Monorepo 管理方式。所谓 Monorepo，简单来说，就是将原本应该放到多个仓库的代码放入一个仓库，让它们共享相同的版本控制。这样可以降低代码复用成本。</p>
<p>定制化要求苛刻，我猜测社区中类似 Shadcn UI 的 H5 组件库或许会兴起。现有的 H5 组件库样式太单一，即使是 Shadcn UI，也很难满足国内 H5 的定制化需求。然而，Shadcn UI 的基本思路——「把源码下载到项目」，是解决定制化组件难复用的问题的好思路。因此，我认为类似 Shadcn 的 H5 组件库可能会逐渐兴起。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文介绍了我认为「百亿补贴」会选用 H5 的三大原因：</p>
<ul>
<li>H5 技术已经成熟</li>
<li>H5 开发成本低</li>
<li>H5 投放成本低</li>
</ul>
<p>以及电商巨头对 H5 产生的三个影响：</p>
<ul>
<li>数量膨胀，定制化要求苛刻</li>
<li>SSR 比例增加，CSR 占据主流</li>
<li>Monorepo 比例增加，类 Shadcn UI 组件库也许会兴起</li>
</ul>
<p>总而言之，H5 开发会越来越专业，对程序员要求会越来越高。至于这种情况是好是坏，仁者见仁智者见智，欢迎大家在评论区沟通交流。</p>
<p>拳打 H5，脚踢小程序。我是「小霖家的混江龙」，关注我，带你了解更多实用的 H5、小程序武学。</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-1-8d2659">
<p><a href="https://juejin.cn/post/7340926094614511626" target="_blank" rel="noopener noreferrer">11 岁的 React 正迎来自己口碑的拐点</a> <a href="#user-content-fnref-1-8d2659" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-2-8d2659">
<p><a href="https://juejin.cn/post/7342384485696520246" target="_blank" rel="noopener noreferrer">Rust! 无VDom! 尤雨溪解析 Vue.js 2024 新特性</a> <a href="#user-content-fnref-2-8d2659" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-3-8d2659">
<p><a href="https://help.aliyun.com/document_detail/178947.html" target="_blank" rel="noopener noreferrer">离线包 | 阿里云</a> <a href="#user-content-fnref-3-8d2659" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-4-8d2659">
<p><a href="https://cloud.tencent.com/document/product/1034/64737" target="_blank" rel="noopener noreferrer">离线包 | 腾讯云</a> <a href="#user-content-fnref-4-8d2659" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/h-5">H5</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/2024/03/02/pull-up">H5 上滑加载（触底加载）如何实现</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-03-02T00:00:00.000Z">March 2, 2024</time> · <!-- -->7 min read</div></header><div class="markdown"><p>上滑加载（触底加载）是 H5 常见的功能，今天我们来看下如何实现。</p>
<p>效果如下：分页请求开始前，列表滚动，加载动画出现在屏幕中；分页请求过程中，加载动画一直旋转；分页请求完成后，列表底部插入了新节点，加载动画被挤出屏幕。</p>
<p>如此循环往复，直到分页请求无法返回更多数据，列表底部展示「没有更多了」提示，加载动画隐藏。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/pull-up-545b9e657517f84454b7eb7967019e52.gif" width="300" height="300" class="img_ev3q"></p>
<p>首先我会讲解上滑加载的原理，并简单说明 IntersectionObserver 的用法；接着我会给出上滑加载的关键布局代码、逻辑代码，接着我会介绍上滑加载需要注意的三个问题，最后我会再做个简单的总结。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="上滑加载的原理">上滑加载的原理<a href="#上滑加载的原理" class="hash-link" aria-label="Direct link to 上滑  加载的原理" title="Direct link to 上滑加载的原理">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/principle-a0a906272ff7eed401986e3ce0b9c46c.png" width="521" height="354" class="img_ev3q"></p>
<p>如图所示，蓝色矩形代表视口，绿色矩形代表包裹列表和动画的容器，金黄色矩形代表列表，橙色则代表加载动画。</p>
<p>最开始时，加载动画处于视口下方；当用户滚动列表到达底部时，加载动画就进入了视口，此时可以请求列表下一页数据，请求成功后新节点插入到列表底部，新节点把动画挤出了视口。</p>
<p>也就是说，想实现加载更多，关键就是监听加载动画有没有进入视口内部。我们可以使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver" target="_blank" rel="noopener noreferrer">IntersectionObserver</a> 这个 API 监听动画有没有进入视口。</p>
<p><code>IntersectionObserver</code> 使用方法如下，我们首先创建了一个监听器 observer，再用这个监听器去监视元素 element。当 <a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserverEntry/isIntersecting" target="_blank" rel="noopener noreferrer">entry.isIntersecting</a> 为 true 时，说明 element 已经进入视口。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)">// 创建监听器</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> observer </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">IntersectionObserver</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token parameter punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token parameter">entry</span><span class="token parameter punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:hsl(221, 87%, 60%)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">entry</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">isIntersecting</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token console class-name" style="color:hsl(35, 99%, 36%)">console</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">log</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;进入视口&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">// 开始监听</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">observer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">observe</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">element</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="上滑加载关键代码">上滑加载关键代码<a href="#上滑加载关键代码" class="hash-link" aria-label="Direct link to 上滑加载关键代码" title="Direct link to 上滑加载关键代码">​</a></h2>
<p>知道原理后，现在我们来看实现上滑加载的关键代码，首先是布局代码：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="布局代码">布局代码<a href="#布局代码" class="hash-link" aria-label="Direct link to 布局代码" title="Direct link to 布局代码">​</a></h3>
<p>布局代码和原理图相互对应，box 是包裹列表和加载动画的容器、list 有 5 个子元素、list 下方则是加载动画的容器。</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">box</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">list</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">item</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">0</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">item</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">1</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">item</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">item</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">3</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">item</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">4</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">loader-box</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">loader</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">nothing</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">hidden</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">没有更多了~</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>列表布局很基础，我们主要看动画。loader-box 中的 loader 是纯 CSS 的加载动画。我们利用 border 画出的一个圆形边框，左、上、右边框是浅灰色，下边框是深灰色：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXIAAABGCAIAAABe2ohRAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAARCSURBVHic7dw7TyJdHIDxAwMzA4OCIRMSDIkUJlpqYWNhYW/tp/DDSE9tbW9hYWOhnZpYYDAUhBABh8sMt7cYc14WVxflqOzO86uOZPjnFJsnc2EnNB6PBQCoE/7pDQD415AVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIpFfnoDWHSe53U6nV6v1+/3B4PBeDwOhUKRSCQajZqmGY/HdV3/6T1isYR48z7e4jhOq9Xq9XrvH2aa5vLyciKR+J5dYfGRFfyG53n1er3b7c7+lVgslk6nOXOBICt47fn5uVarTX5iWZZlWYZhaJoWDodHo9FwOHRdt91ut9vtySNt215aWvre/WLhkBX8olqtTpYilUolk0lN0946fjgcNpvNRqMhP7EsK5PJfO0usdjICv43eZ6i67pt24ZhzPJF13VrtZrnef6fnLMEHA+Y8cLzPNkUTdOy2eyMTRFCGIaRzWblSc1kYhBAZAUv6vW6v9B1PZfLhcMf+7cRDodzuZy8ZSunIYDICoQQwnEc+dzHtu2PNsUXDodt2/bX3W7XcRxl+8NfhaxACCFarZa/SKVSs1/7vGYYRiqVmpqJoCErEJ7nyd+8JZPJOafJCb1ejzsswURWIDqdjr+wLOudZ8kz0jTNsqypyQgUsgIhT1VkDuYk5/zxh//4J5EViH6/7y/muasySc6RkxEoZAViMBj4i/mvgKbmyMkIFLICIX9p/bnnyq/JOfyGO5jICkQoFPIXo9FIyUA5R05GoJAViEjk5W1ew+FQyUA5R05GoJAViGg06i9c11UyUM6RkxEoZAXCNE1/MfXylE+Tc+RkBApZgYjH4/6i3W7Pfx00HA5lVuRkBApZgdB1XZ5WNJvNOafJCaZp8g7KYCIrEEKI5eVlf9FoNOa5w+K6rnxTnJyJoCErEEKIRCIRi8X8da1W+9yT5tFoJF8EFYvFeBd/YJEVvEin0/7C87ybm5uP/ufjqW/JaQggsoIX/strhRCNRqNYLBYKhXK5PON3y+VyoVAoFov+FZBt29xVCTJekY1fPDw8HB8fyz/39/f39vbeuZxxHOf8/Pzs7Ex+cnR0tLa29qWbxIIjK5h2eXl5cnIy+cnW1tbm5mYul1tZWdF13fO8p6enx8fH29vb6+vrySMPDw93dna+d79YOGQFv1GpVE5PT+/v72f/yvr6+sHBwerq6tftCn8LsoI3XV1dXVxclEql9w/L5/O7u7vb29vfsyssPrKCP6hUKnd3d6VSqVqtNpvNwWAQiUSSyWQmk8nn8xsbG5yhYApZAaAYD5gBKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWACj2H3/xd/JlnTeYAAAAAElFTkSuQmCC" width="370" height="70" class="img_ev3q"></p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token selector id" style="color:hsl(119, 34%, 47%)">#loader</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">width</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">25</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">height</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">25</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">border</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token unit">px</span><span class="token plain"> solid </span><span class="token hexcode color">#ddd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">border-radius</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token unit">%</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">border-bottom</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token unit">px</span><span class="token plain"> solid </span><span class="token hexcode color">#717171</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">transform</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rotate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token unit">deg</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们给 loader 元素增加一个动画，让它从 0 度到 360 度无限旋转，就实现了加载动画：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/loading-59f020712949ecfce9a3f0e497716437.gif" width="370" height="70" class="img_ev3q"></p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token selector id" style="color:hsl(119, 34%, 47%)">#loader</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">animation</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> loading </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token unit">s</span><span class="token plain"> linear infinite</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token atrule rule" style="color:hsl(35, 99%, 36%)">@keyframes</span><span class="token atrule" style="color:hsl(35, 99%, 36%)"> loading</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token selector" style="color:hsl(119, 34%, 47%)">from</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token property" style="color:hsl(5, 74%, 59%)">transform</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rotate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token unit">deg</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token selector" style="color:hsl(119, 34%, 47%)">to</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token property" style="color:hsl(5, 74%, 59%)">transform</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rotate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">360</span><span class="token unit">deg</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>loader 也是我们真正需要监听是否进入视口的元素。</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="逻辑代码">逻辑代码<a href="#逻辑代码" class="hash-link" aria-label="Direct link to 逻辑代码" title="Direct link to 逻辑代码">​</a></h3>
<p>关键逻辑代码4和原理中一致，我们只需要监听到动画 loader 进入视口，就直接调用 pullUp 函数。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> loader </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:hsl(221, 87%, 60%)">document</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">getElementById</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;loader&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> observer </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">IntersectionObserver</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token parameter punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token parameter">entry</span><span class="token parameter punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:hsl(221, 87%, 60%)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">entry</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">isIntersecting</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">pullUp</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token literal-property property" style="color:hsl(5, 74%, 59%)">root</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(301, 63%, 40%)">null</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token literal-property property" style="color:hsl(5, 74%, 59%)">rootMargin</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;0px&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token literal-property property" style="color:hsl(5, 74%, 59%)">threshold</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">observer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">observe</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="上滑加载的两个注意点">上滑加载的两个注意点<a href="#上滑加载的两个注意点" class="hash-link" aria-label="Direct link to 上滑加载的两个注意点" title="Direct link to 上滑加载的两个注意点">​</a></h2>
<p>实现上滑加载，我们除了关键完布局代码、逻辑代码外，还有三个点需要注意：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="加载锁">加载锁<a href="#加载锁" class="hash-link" aria-label="Direct link to 加载锁" title="Direct link to 加载锁">​</a></h3>
<p>第一点，前一次上滑加载未完成之前，不应该再次触发上滑加载。</p>
<p>为此，我们需要创建一个加载锁变量 loadLock，数据加载前先把 loadLock 赋值为 true，数据加载完成后再把 loadLock 赋值为 false。如果 loadLock 一直为 true，就说明前一次加载未完成，我们需要直接 return 结束 pullUp 函数。</p>
<p>代码如下：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">let</span><span class="token plain"> loadLock </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">pullUp</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">loadLock</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">loadData</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">loadData</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  loadLock </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">setTimeout</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:hsl(221, 87%, 60%)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    loadLock </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token constant" style="color:hsl(35, 99%, 36%)">LOADING_TIME</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="没有更多数据">没有更多数据<a href="#没有更多数据" class="hash-link" aria-label="Direct link to 没有更多数据" title="Direct link to 没有更多数据">​</a></h3>
<p>第二点，需要考虑没有更多数据的情况。上滑加载请求的数据是分页的，一定有请求结束的情况。请求结束时，我们需要给用户一些提示。</p>
<p>我们可以设置一个 hasMore 变量。hasMore 为 true 表示时候有更多数据，为 false 时表示数据了，应该隐藏加载动画，展示「没有更多了」提示。</p>
<p>代码如下，我限制了分页数据最多只有 LIST_LIMIT_CNT 条：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">let</span><span class="token plain"> hasMore </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">pullUp</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">hasMore</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">loadData</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">loadData</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">setTimeout</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:hsl(221, 87%, 60%)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">len </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(35, 99%, 36%)">LIST_LIMIT_CNT</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;hidden&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      nothing</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      hasMore </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token constant" style="color:hsl(35, 99%, 36%)">LOADING_TIME</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="请求失败">请求失败<a href="#请求失败" class="hash-link" aria-label="Direct link to 请求失败" title="Direct link to 请求失败">​</a></h3>
<p>第三点，需要考虑请求失败的情况。我们无法保证服务器一直运转正常，很可能列表前一次分页请求还成功，后一次分页请求就失败了。</p>
<p>这种情况有两种常见交互：</p>
<ul>
<li>直接展示「请求出错了」，让用户点击重试。</li>
<li>继续展示加载动画，重新请求服务器数据。</li>
</ul>
<p>因为请求失败不好模拟，所以 Demo 中只实现了加载锁和没有更多数据的情况，你可以根据自己的需要改写 Demo。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="示例代码">示例代码<a href="#示例代码" class="hash-link" aria-label="Direct link to 示例代码" title="Direct link to 示例代码">​</a></h2>
<p><a href="https://codepen.io/lijunlin2022/pen/OJrJePE" target="_blank" rel="noopener noreferrer">上滑加载、触底加载 | codepen</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文讲解了上滑加载的原理——利用 IntersectionObserver 监听加载动画是否进入视口，如果动画进入则请求下一页数据。此外，本文还说明了上滑加载需要注意的三个点：加载锁、没有更多数据和请求失败。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/h-5">H5</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/2024/02/28/pull-down">H5 下拉刷新如何实现</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-02-28T00:00:00.000Z">February 28, 2024</time> · <!-- -->13 min read</div></header><div class="markdown"><p>最近我需要做一个下拉刷新的功能，实现功能后我发现，它需要处理的情况还蛮多，于是我整理了这篇文章。</p>
<p>下图是我实现的效果，分为三步：开始下拉时，屏幕顶部会出现加载动画；加载过程中，屏幕顶部高度保持不变；加载 完成后，加载动画隐藏。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/pull-down-d0902603eabaf6a641e714d72d3423af.gif" width="375" height="300" class="img_ev3q"></p>
<p>首先我会讲解下拉的原理、根据原理写出初始代码；然后我会说明代码存在的缺陷、解决缺陷并做些额外优化；最后我会给出完整代码，并做一个总结。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="下拉的原理">下拉的原理<a href="#下拉的原理" class="hash-link" aria-label="Direct link to 下拉的原理" title="Direct link to 下拉的原理">​</a></h2>
<p><img decoding="async" loading="lazy" src="/assets/images/prinple-3d0cdb4f933453745a24ede90364918e.png" width="825" height="359" class="img_ev3q"></p>
<p>如图所示，蓝色框代表视口，绿色框代表容器，橙色框代表加载动画。最开始时，加载动画处于视口外；开始下拉之后，容器向下移动，加载动画从上方进入视口；结束下拉后，容器又开始向上移动，加载动画也从上方退出视口。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="下拉基础代码">下拉基础代码<a href="#下拉基础代码" class="hash-link" aria-label="Direct link to 下拉基础代码" title="Direct link to 下拉基础代码">​</a></h2>
<p>知道原理，我们现在开始写代码，首先是布局的代码：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="布局代码">布局代码<a href="#布局代码" class="hash-link" aria-label="Direct link to 布局代码" title="Direct link to 布局代码">​</a></h3>
<p>我们把 box 元素当作容器，把 loader-box，loader-box + loading 元素当作动画，至于 h1 元素不需要关注，我们只把它当作操作提示。</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">box</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">loader-box</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">loading</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">h1</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">下拉刷新 ↓</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">h1</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>loader-box 的高度是 80px，按上一节原理中的分析，初始时我们需要让 loader-box 位于视口上方，因此 CSS 代码中我们需要把它的位置向上移动 80px。</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token selector class" style="color:hsl(119, 34%, 47%)">.loader-box</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">position</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> relative</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">top</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">-80</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">height</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">80</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>loader-box 中的 loader 是纯 CSS 的加载动画。我们利用 border 画出的一个圆形边框，左、上、右边框是浅灰色，下边框是深灰色：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXIAAABGCAIAAABe2ohRAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAARCSURBVHic7dw7TyJdHIDxAwMzA4OCIRMSDIkUJlpqYWNhYW/tp/DDSE9tbW9hYWOhnZpYYDAUhBABh8sMt7cYc14WVxflqOzO86uOZPjnFJsnc2EnNB6PBQCoE/7pDQD415AVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIqRFQCKkRUAipEVAIpFfnoDWHSe53U6nV6v1+/3B4PBeDwOhUKRSCQajZqmGY/HdV3/6T1isYR48z7e4jhOq9Xq9XrvH2aa5vLyciKR+J5dYfGRFfyG53n1er3b7c7+lVgslk6nOXOBICt47fn5uVarTX5iWZZlWYZhaJoWDodHo9FwOHRdt91ut9vtySNt215aWvre/WLhkBX8olqtTpYilUolk0lN0946fjgcNpvNRqMhP7EsK5PJfO0usdjICv43eZ6i67pt24ZhzPJF13VrtZrnef6fnLMEHA+Y8cLzPNkUTdOy2eyMTRFCGIaRzWblSc1kYhBAZAUv6vW6v9B1PZfLhcMf+7cRDodzuZy8ZSunIYDICoQQwnEc+dzHtu2PNsUXDodt2/bX3W7XcRxl+8NfhaxACCFarZa/SKVSs1/7vGYYRiqVmpqJoCErEJ7nyd+8JZPJOafJCb1ejzsswURWIDqdjr+wLOudZ8kz0jTNsqypyQgUsgIhT1VkDuYk5/zxh//4J5EViH6/7y/muasySc6RkxEoZAViMBj4i/mvgKbmyMkIFLICIX9p/bnnyq/JOfyGO5jICkQoFPIXo9FIyUA5R05GoJAViEjk5W1ew+FQyUA5R05GoJAViGg06i9c11UyUM6RkxEoZAXCNE1/MfXylE+Tc+RkBApZgYjH4/6i3W7Pfx00HA5lVuRkBApZgdB1XZ5WNJvNOafJCaZp8g7KYCIrEEKI5eVlf9FoNOa5w+K6rnxTnJyJoCErEEKIRCIRi8X8da1W+9yT5tFoJF8EFYvFeBd/YJEVvEin0/7C87ybm5uP/ufjqW/JaQggsoIX/strhRCNRqNYLBYKhXK5PON3y+VyoVAoFov+FZBt29xVCTJekY1fPDw8HB8fyz/39/f39vbeuZxxHOf8/Pzs7Ex+cnR0tLa29qWbxIIjK5h2eXl5cnIy+cnW1tbm5mYul1tZWdF13fO8p6enx8fH29vb6+vrySMPDw93dna+d79YOGQFv1GpVE5PT+/v72f/yvr6+sHBwerq6tftCn8LsoI3XV1dXVxclEql9w/L5/O7u7vb29vfsyssPrKCP6hUKnd3d6VSqVqtNpvNwWAQiUSSyWQmk8nn8xsbG5yhYApZAaAYD5gBKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWAChGVgAoRlYAKEZWACj2H3/xd/JlnTeYAAAAAElFTkSuQmCC" width="370" height="70" class="img_ev3q"></p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token selector id" style="color:hsl(119, 34%, 47%)">#loader</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">width</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">25</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">height</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">25</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">border</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token unit">px</span><span class="token plain"> solid </span><span class="token hexcode color">#ddd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">border-radius</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token unit">%</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">border-bottom</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token unit">px</span><span class="token plain"> solid </span><span class="token hexcode color">#717171</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">transform</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rotate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token unit">deg</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>开始刷新时，我们给 loader 元素增加一个动画，让它从 0 度到 360 度无限旋转，就实现了加载动画：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/loading-59f020712949ecfce9a3f0e497716437.gif" width="370" height="70" class="img_ev3q"></p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token selector id" style="color:hsl(119, 34%, 47%)">#loader</span><span class="token selector class" style="color:hsl(119, 34%, 47%)">.loading</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">animation</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> loading </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token unit">s</span><span class="token plain"> linear infinite</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token atrule rule" style="color:hsl(35, 99%, 36%)">@keyframes</span><span class="token atrule" style="color:hsl(35, 99%, 36%)"> loading</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token selector" style="color:hsl(119, 34%, 47%)">from</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token property" style="color:hsl(5, 74%, 59%)">transform</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rotate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token unit">deg</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token selector" style="color:hsl(119, 34%, 47%)">to</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token property" style="color:hsl(5, 74%, 59%)">transform</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rotate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">360</span><span class="token unit">deg</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="逻辑代码">逻辑代码<a href="#逻辑代码" class="hash-link" aria-label="Direct link to 逻辑代码" title="Direct link to 逻辑代码">​</a></h3>
<p>看完布局代码，我们再看逻辑代码。逻辑代码中，我们要监听用户的手指滑动、实现下拉手势。我们需要用到三个事件：</p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/touchstart_event" target="_blank" rel="noopener noreferrer">touchstart</a> 代表触摸开始；</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/touchmove_event" target="_blank" rel="noopener noreferrer">touchmove</a> 代表触摸移动；</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/touchend_event" target="_blank" rel="noopener noreferrer">touchend</a> 代表触摸结束。</li>
</ul>
<p>从 <code>touchstart</code> 和 <code>touchmove</code> 事件中我们可以获取手指的坐标，比如 <code>event.touches[0].clientX</code> 是手指相对视口左边缘的 X 坐标，<code>event.touches[0].clientY</code> 是手指相对视口上边缘的 Y 坐标；从 <code>touchend</code> 事件中我们则无法获得 <code>clientX</code> 和 <code>clientY</code>。</p>
<p>我们可以先记录用户手指 touchstart 的 clientY 作为开始坐标，记录用户最后一次触发 touchmove 的 clientY 作为结束坐标，二者相减就得到手指移动的距离 distanceY。</p>
<p>设置手指移动多少距离，容器就移动多少距离，就得到了我们的逻辑代码：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> box </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:hsl(221, 87%, 60%)">document</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">getElementById</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;box&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> loader </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:hsl(221, 87%, 60%)">document</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">getElementById</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;loader&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">let</span><span class="token plain"> startY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> endY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> distanceY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">start</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  startY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">touches</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">clientY</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">move</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  endY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">  e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">touches</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">clientY</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  distanceY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> endY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> startY</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  box</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token template-string string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">    transform: translateY(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token template-string interpolation">distanceY</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token template-string string" style="color:hsl(119, 34%, 47%)">px);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">    transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">  </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">end</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">setTimeout</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:hsl(221, 87%, 60%)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    box</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token template-string string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">      transform: translateY(0);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">      transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">    </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;loading&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1000</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">box</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">addEventListener</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;touchstart&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> start</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">box</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">addEventListener</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;touchmove&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> move</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">box</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">addEventListener</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;touchend&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> end</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>逻辑代码实现一个简陋的下拉效果，当然现在还有很多缺陷。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/pull-down-basic-6faa20d78630983a6bfdeb81a7e3e7a1.gif" width="375" height="400" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简陋下拉效果的-6- 个缺陷">简陋下拉效果的 6 个缺陷<a href="#简陋下拉效果的-6-个缺陷" class="hash-link" aria-label="Direct link to 简陋下拉效果的 6 个缺陷" title="Direct link to 简陋下拉效果的 6 个缺陷">​</a></h2>
<p>之前我们实现了简陋的下拉效果，它还需要解决 6 个缺陷，才能算一个完善的功能。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="没有最小最大距离限制">没有最小、最大距离限制<a href="#没有最小最大距离限制" class="hash-link" aria-label="Direct link to 没有最小、最大距离限制" title="Direct link to 没有最小、最大距离限制">​</a></h3>
<p>第一个缺陷是，下拉没有做最小、最大距离的限制。</p>
<p>通常来说，我们下拉屏幕时，距离太小应该不能触发刷新，距离太大也不行，下滑到一定距离后，就应该无法继续下滑。</p>
<p>因此我们可以给下拉设置最小距离限制 <code>DISTANCE_Y_MIN_LIMIT</code>、最大距离限制 <code>DISTANCE_Y_MAX_LIMIT</code>。如果 touchend 中发现下拉距离小于最小距离，直接不触发加载；如果 touchmove 中下拉距离超过最大距离，页面只向下移动最大距离。</p>
<p>解决缺陷关键代码如下：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> </span><span class="token constant" style="color:hsl(35, 99%, 36%)">DISTANCE_Y_MAX_LIMIT</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">150</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token constant" style="color:hsl(35, 99%, 36%)">DISTANCE_Y_MIN_LIMIT</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">move</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  endY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">  e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">touches</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">clientY</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  distanceY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> endY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> startY</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">distanceY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token constant" style="color:hsl(35, 99%, 36%)">DISTANCE_Y_LIMIT</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    distanceY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(35, 99%, 36%)">DISTANCE_Y_LIMIT</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  box</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token template-string string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">    transform: translateY(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token template-string interpolation">distanceY</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token template-string string" style="color:hsl(119, 34%, 47%)">px);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">    transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">  </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">end</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">distanceY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> </span><span class="token constant" style="color:hsl(35, 99%, 36%)">DISTANCE_Y_MIN_LIMIT</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    box</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token template-string string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">      transform: translateY(0px);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">      transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">    </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="加载动画没有停留在视口顶部">加载动画没有停留在视口顶部<a href="#加载动画没有停留在视口顶部" class="hash-link" aria-label="Direct link to 加载动画没有停留在视口顶部" title="Direct link to 加载动画没有停留在视口顶部">​</a></h3>
<p>第二个缺陷是，下拉没有让加载动画停留在视口顶部。</p>
<p>我们可以把 end 函数加以改造，在数据还没有加载完成时（用 setTimeout 模拟的），让加载动画 style 的 <code>translateY</code> 一直是 80px，<code>translateY(80px)</code> 可以和 初始 CSS 的 <code>top: -80px;</code> 相互抵消，让动画在未刷新完成前 停留在视口顶部。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">end</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  box</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token template-string string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">    transform: translateY(80px);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">    transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">  </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;loading&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">setTimeout</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:hsl(221, 87%, 60%)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    box</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token template-string string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">      transform: translateY(0px);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">      transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">    </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1000</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="重复触发">重复触发<a href="#重复触发" class="hash-link" aria-label="Direct link to 重复触发" title="Direct link to 重复触发">​</a></h3>
<p>第三个缺陷是，下拉可以重复触发。</p>
<p>正常来说，如果我们已经下拉过，数据正在加载中时，我们不能继续下拉。</p>
<p>我们可以增加一个加载锁 loadLock。当加载锁开启时，start，move 和 end 事件都不会触发。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">let</span><span class="token plain"> loadLock </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">start</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">loadLock</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">move</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">loadLock</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">end</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">loadLock</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">setTimeout</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:hsl(221, 87%, 60%)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    loadLock </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1000</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="没有限制方向">没有限制方向<a href="#没有限制方向" class="hash-link" aria-label="Direct link to 没有限制方向" title="Direct link to 没有限制方向">​</a></h3>
<p>第四个缺陷是，没有限制方向。</p>
<p>目前我们的代码，用户上拉也能触发。我们可以增加判断，当 <code>endY - startY</code> 小于 0 时，阻止 <code>touchmove</code> 和 <code>touchend</code> 的逻辑。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">move</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">endY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> startY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">end</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">endY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> startY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>你可能会疑惑，为什么我宁愿写多个判断拦截，也不取消监听事件。这是因为<strong>一旦取消监听事件，我们需要考虑在一个合适的时间重新监听</strong>，这会把问题变得更复杂。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="没有阻止原生滚动">没有阻止原生滚动<a href="#没有阻止原生滚动" class="hash-link" aria-label="Direct link to 没有阻止原生滚动" title="Direct link to 没有阻止原生滚动">​</a></h3>
<p>第五个缺陷时，我们在加载数据时没有阻止原生滚动。</p>
<p>虽然我们已经阻止了重复下拉，touchmove 和 touchend 事件 被拦截了，但是 H5 原生滚动还能用。</p>
<p>我们可以在刷新时给 body 设置一个 <code>overflow: hidden;</code> 属性，刷新结束后清除 <code>overflow: hidden</code>，这样就可以阻止原生滚动。</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token selector" style="color:hsl(119, 34%, 47%)">body</span><span class="token selector class" style="color:hsl(119, 34%, 47%)">.overflowHidden</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">overflow</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> hidden</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> body </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:hsl(221, 87%, 60%)">document</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">body</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">end</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  box</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token template-string string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">    transform: translateY(80px);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">    transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">  </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;loading&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  body</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;overflowHidden&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">setTimeout</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:hsl(221, 87%, 60%)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    box</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">style</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token template-string string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">      transform: translateY(0px);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">      transition: all 0.3s linear;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token template-string string" style="color:hsl(119, 34%, 47%)">    </span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    body</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">className</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1000</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="没有阻止-ios-橡皮筋效果">没有阻止 iOS 橡皮筋效果<a href="#没有阻止-ios-橡皮筋效果" class="hash-link" aria-label="Direct link to 没有阻止 iOS 橡皮筋效果" title="Direct link to 没有阻止 iOS 橡皮筋效果">​</a></h3>
<p>第 6 个缺陷是，没有阻止 iOS 的橡皮筋效果。</p>
<p>iOS 浏览器默认滑动时有一个橡皮筋效果，我们需要阻止它，避免影响我们的下拉手势。阻止方式就是给监听器设置 <code>passive: false</code>。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">addTouchEvent</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  box</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">addEventListener</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;touchstart&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> start</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:hsl(5, 74%, 59%)">passive</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  box</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">addEventListener</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;touchmove&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> move</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:hsl(5, 74%, 59%)">passive</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  box</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">addEventListener</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;touchend&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> end</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:hsl(5, 74%, 59%)">passive</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">addTouchEvent</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>解决完 6 个缺陷后，我们已经得到无缺陷的下拉刷新功能，但离丝滑的下拉刷新还有一段距离。我们还可以做一些优化，让下拉刷新更完善。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="优化">优化<a href="#优化" class="hash-link" aria-label="Direct link to 优化" title="Direct link to 优化">​</a></h2>
<p>我们可以做两个优化，第一个优化是添加阻尼效果：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="增加阻尼效果">增加阻尼效果<a href="#增加阻尼效果" class="hash-link" aria-label="Direct link to 增加阻尼效果" title="Direct link to 增加阻尼效果">​</a></h3>
<p>所谓阻尼效果，就是下拉过程我们可以感受到一股阻力的存在，虽然我们下拉力度是一样的，但距离的增加速度变慢了。用物理术语表示的话，就是加速度变小了。</p>
<p>体现到代码上，我们可以设置一个百分比，百分比会随着下拉距离增加而减少，把百分比乘以距离当作最后的距离。</p>
<p>代码中百分比 <code>percent</code> 设为 <code>(100 - distanceY * 0.5) / 100</code>，当 <code>distanceY</code> 越来越大时，百分比 <code>percent</code> 越来越小，最后再把 <code>distanceY * percent</code> 赋值给 <code>distanceY</code>。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">move</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  distanceY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> endY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> startY</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">let</span><span class="token plain"> percent </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> distanceY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  percent </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:hsl(35, 99%, 36%)">Math</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">max</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> percent</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  distanceY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> distanceY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> percent</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">distanceY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token constant" style="color:hsl(35, 99%, 36%)">DISTANCE_Y_MAX_LIMIT</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    distanceY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(35, 99%, 36%)">DISTANCE_Y_MAX_LIMIT</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用角度判断用户下拉意图">利用角度判断用户下拉意图<a href="#利用角度判断用户下拉意图" class="hash-link" aria-label="Direct link to 利用角度判断用户下拉意图" title="Direct link to 利用角度判断用户下拉意图">​</a></h3>
<p>第二个优化是利 用角度判断用户下拉意图。</p>
<p>下图展示了两种用户下拉的情况，β 角度比 α 角度小，角度越小用户下拉意图越明显、误触的可能性更小。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/intension-ca2abc541478c6c325dbdefc86a23347.png" width="419" height="218" class="img_ev3q"></p>
<p>我们可以利用反三角函数求出角度来判断下拉意图。</p>
<p>JavaScript 中，反正切函数是 <code>Math.atan()</code>，需要注意的是，反正切函数算出的是弧度，我们还需要将它乘以 <code>180 / π</code> 才能获取角度。</p>
<p>下面的代码中，我们做了一个限制，只有角度小于 40 时，我们才认为用户的真实意图是想要下拉刷新。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> </span><span class="token constant" style="color:hsl(35, 99%, 36%)">DEG_LIMIT</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">move</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  distanceY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> endY </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> startY</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  distanceX </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> endX </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> startX</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> deg </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:hsl(35, 99%, 36%)">Math</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">atan</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token known-class-name class-name" style="color:hsl(35, 99%, 36%)">Math</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">abs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">distanceX</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> distanceY</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">180</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:hsl(35, 99%, 36%)">Math</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token constant" style="color:hsl(35, 99%, 36%)">PI</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">deg </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token constant" style="color:hsl(35, 99%, 36%)">DEG_LIMIT</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">startY</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> startX</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">endY</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> endX</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token spread operator" style="color:hsl(221, 87%, 60%)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a href="#代码示例" class="hash-link" aria-label="Direct link to 代码示例" title="Direct link to 代码示例">​</a></h2>
<p>你可以在 <a href="https://codepen.io/lijunlin2022/pen/xxBeZrr" target="_blank" rel="noopener noreferrer">codepen</a> 中查看效果，web 端需要按 F12 用手机浏览器打开。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/codepen-e2041fa61db85726248b0f00185ce00d.gif" width="370" height="600" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文讲解了下拉的原理、并根据原理写出初始代码。在初始代码的基础上，我解决了 6 个缺陷、做了 2 个优化，实现了一个完善的下拉刷新效果。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/h-5">H5</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/2024/02/19/reverse-border-radius">H5、小程序中四个反向圆角的图片如何实现</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-02-19T00:00:00.000Z">February 19, 2024</time> · <!-- -->9 min read</div></header><div class="markdown"><p>最近我逛热风小程序（一个卖鞋的小程序）时，发现了一个奇特的图片样式。图片的四个圆角是反向的，和常规图片不一样。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/hotwind-bb8f55e418bb66ea394b1dba36f345f3.jpg" width="300" height="417" class="img_ev3q"></p>
<p>思索一番后，我发现想实现这个效果，需要的 CSS 知识还挺多，于是整理这篇文章。</p>
<p>下面我会先介绍如何实现四个反向圆角的矩形，再介绍如何把特殊矩形作为遮罩、得到和热风小程序的图片效果。接着，我会给出完整的代码，最后，我会给做一个简单的总结。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何实现四个反向圆角的矩形">如何实现四个反向圆角的矩形<a href="#如何实现四个反向圆角的矩形" class="hash-link" aria-label="Direct link to 如何实现四个反向圆角的矩形" title="Direct link to 如何实现四个反向圆角的矩形">​</a></h2>
<p>不难想到，四个反向圆角的矩形，就是四个边角都被圆遮挡的矩形。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAO4AAACuCAYAAAAxtjFOAAAAAXNSR0IArs4c6QAAIABJREFUeF7tnQn0DtUbxx8isqcoS1FKm1RKWaJFpbInFSFKKyFF2VIRWSrtWVOKtAklLVqoJKEdLShrixaUJPqfzz1n/uftPT/emXlnu7/3ec55z7vNzL3znfnOvfdZC/z777//iooioAhYhUABJa5V10s7qwgYBJS4eiMoAhYioMS18KJplxUBJa7eA4qAhQgocS28aNplRUCJq/eAImAhAkpcCy+adlkRUOLqPaAIWIhArMTdsWOH/PXXX+Y1ZswYWbFihWzatElOOeUU6dq1q7z88suya9cuA2vnzp0thFe7bCMCHTp0kJUrV8ovv/wiFStWlDp16sjBBx8sW7ZskeLFi0vZsmXl4osvjvXUQifu9u3b5e2335bFixcbYn7//ffy008/yZFHHilLliyRggULSoECBQwIO3fuNETde++9pVy5crJ27Vrz/3PPPScnnnhirEBp47mBwPLly6Vnz56ydetWKVSokBxyyCGGxL/++qshrjOQVK5cWRo3bixt27aVww8/PHJwQiPu119/LY899pghXfXq1aV06dLyxx9/GOIWK1ZMOHFOuFSpUuaJxpOsVq1asm7dOvnyyy/l9ddfN/sWLlzYPOGuuuoqHXUjvz1yo8HNmzfLE088IS+++KKsX7/eEJbBg/v2mGOOkUqVKkndunXliCOOkJdeekn22WcfefLJJ+W9994TPIbZrk+fPnLaaadFBljgxGX6O2DAAHn++eelfPny8uOPP8rll19uTuj444+X4447zgDhRn7//Xd58803ZfTo0Yb0RYsWlf79+8t5553nZnfdRhHYIwJTpkyRhx56yMzsGCCqVasmbdq0kdq1a5v71I1A5Pvuu09WrVplRue7775batas6WbXrLYJlLjPPPOM3HHHHfLnn39Kq1atzOvUU0/NqoPOzhMnTpShQ4dKyZIlpXnz5nL77bcHclw9SO4hwL3DbI77lNneFVdcIWeeeWZWQHz88cfSr18/WbZsmZx++ulmthmmBEbca665Rl555RVp2rSp3HPPPVKkSJHA+71mzRoZNGiQfPHFF2bUfvjhh+XAAw8MvB09YP5EgNGVF7qU9u3by8CBAwM/0Tlz5kjfvn1NG4zEZ5xxRuBtcMBAiHvuuefKd999J/fff7+cffbZoXQ09aC0M3bsWClRooR5sh111FGht6kN2IvAN998I9dff72geGrXrp3ceeedoZ8My8O5c+fKddddJzfffHPg7WVFXBbmDRo0EDTH77zzjlE6RSUzZ86U7t27G6XX1KlT5eijj46qaW3HIgRee+016datm5kBTpgwQU4++eTIev/ggw/KyJEj5cILLzRr3yAlK+I2bNhQ/v77b3n//feN2SZq4WHRqVMn2W+//WTGjBmulV5R91PbiweBN954Q66++mo54IADzMO9SpUqkXdk+vTpcsMNNxi77/DhwwNr3zdxURCx5lywYIHR9sYlaJ0xFaGSnz17dlzd0HYThgBKIu5RZmQvvPCCcaCIS1DaYi7q3bu3cSwKQnwR96abbjI2L0gTJyAOAE8//bRZt7Rs2VIGDx4cBC56DMsRQNeCLwH3KWbIuAWLyLhx44w3YBDLOs/ExQuK6SkdYaGfFLn11lvl2WeflUceecSo41VyFwHWlZMnTzZaY+yySRHWusxSFy5cmHWXPBMX10OeGACTNGHNjUvau+++m7SuaX8iQgDNcZMmTYyTDsqhpAncoX88XLIRT8TFcP3UU08ZOyqeJkmTjz76SC655BLjucWsQCX3EMA+y33AqMb6NmmC+RInpU8//dQ4E/kV18TF9IOvJoTAQySpghbxww8/lKVLlya1i9qvkBD4/PPPjbceU+SOHTuG1Er2h8WnmagjNN1+xTVx7733XuOpxII/yUJUB76izA4Iz1LJHQRwesD1kKizJAtKXaevZcqU8dVV18TFpxNC4LGUdMH3lAfMvHnzkt5V7V9ACOAEhAcdFg+8lZIu9erVM4EMKFP9iCviEoqHzyVmFyInki64X6KoYp2jvsxJv1rB9I+wPPzYifkmJC/pguKMGSwhrH7EFXFxFRs2bJjg82mL8IDBlofZSiX/I4ANH8Fua4sQBkhoIbG+XsUVcZl6Em/I3NwWwc0M7eJbb70VSpedrB1BHzyM44ZxTM47rOP6wZSMKr169TJedLZI/fr1hSmzH9OQK+ISq0i2CvJC2SI8ZLp06WLseZiu0l9Mp/iNd16kJjnooIP+/530OgRW45zO/7zvtddexieb99294sQHzb9Tw83LZ7YlUQHniB2ckDQnjVBen/f0X177gy0ZTlL/c47xzz//SF4v/nd+T//s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L3i2ncZpXnn2g9rq43xrXHUwMDA3nf5ccjqYhG6PtTNcdTAwMWLGz8Eq5TFBXHUwMDE0U3hpYpiz0bPRTa+s9lDhKU5cdTAwMTRcdTAwMTWKU0aFXHUwMDA054et66GZ4kJqJV9cdTAwMDSV8axcdTAwMTXWaPx1RciDgW1VJ5JhXHUwMDFjz2YyXHSfMjknaFeC3Vx1MDAxOcqcqmFcdTAwMTZcdTAwMDZTXHUwMDE4qFwiXHUwMDFhXHUwMDE0kZRxKl7kcZT0XHUwMDE31cVpp+/4qVdcdTAwMWbX58GdsrTl79NTe+xfd2VcdTAwMWJub/1+K1xutlxc8l66KI6jrJjJ6rSoinqGUKxoXTtg80XFZHJNXHUwMDE5MG6AS6bgVU1AeJpyzaimSuC3el1cdTAwMTKQXHUwMDFlXHUwMDE2SylcdTAwMDApXHUwMDE0XGLB4T+ofVx1MDAwNJZufa1K+3xcdTAwMGVNT7BSgZnFXlx1MDAxM6+mXHUwMDBmXG65XFxcXHxcdTAwMWVJjIDhXHUwMDAwTLxlJC2CO+fHa3SlmW28XHUwMDBmoruUSlx1MDAxN53iy6KjgHNIU1wi4Fxy0U2b5OA+XHK2tvcmJ8fbh1x1MDAwN/uHxchcdTAwMTc+X1x1MDAxNWKWXHLchd50aipcdTAwMDWccVx1MDAwZitMXHQoXHUwMDA2Ws4m4zN66HP6+5lig7EgjTM4fsPMVUZq+Fx1MDAwMnC1WlxuLraykVxcyzdzXHUwMDFiXHUwMDAz22mFrYvR78uszO7Gt+lg73LFuVx1MDAxNYR7Qlx1MDAwYlxyQlLDXHUwMDE5hTluq99cdTAwMTStXGZcdTAwMDKlXHUwMDEwbSlBri63jDJcZkB89mx/XHUwMDE3tVpcdTAwMDOoL6BWmWXUaqCYP/JmZn3/VFxmbv385HR3e+fqqjcpXHUwMDA3J51cdTAwMTVnXHUwMDE2jPFk9Vx1MDAxNi9cYsNcdTAwMTddtjBrqfFAaGaActxD6SrPWlx1MDAwMHw9XHUwMDE331x1MDAwYq1R+Efh3dDivVbaXGay7KxElSieXCKMMUThWXRv59Q0R5FcdTAwMWT/Wp7gtadGqJCzlc9cdTAwMGaPa4//XHUwMDAwvOmSvyJ9O2MXiQAAAABJRU5ErkJggg==" width="238" height="174" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="径向渐变">径向渐变<a href="#径向渐变" class="hash-link" aria-label="Direct link to 径向渐变" title="Direct link to 径向渐变">​</a></h3>
<p>知道圆遮挡矩形的原理后，我们最容易想到的办法是 —— 先用 50% 的 border-radius 得到圆，再改变圆形的定位去遮挡矩形。</p>
<p>不过这种方法需要多个元素，并不优雅，我将介绍另一种更巧妙的办法。</p>
<p>我们需要先了解一个 CSS 函数 —— <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/gradient/radial-gradient" target="_blank" rel="noopener noreferrer">radial-gradient</a>。<code>radial-gradient</code> 中文名称是径向渐变，它可以指定渐变的中心、形状、颜色和结束位置。语法如下：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)">/*</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"> * 形状 at 位置</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"> * 渐变颜色 渐变位置</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"> * ...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"> * 渐变颜色 渐变位置</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token property" style="color:hsl(5, 74%, 59%)">background-image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">radial-gradient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    circle at center</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token hexcode color">#ddd</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用径向渐变在矩形中心画圆">利用径向渐变在矩形中心画圆<a href="#利用径向渐变在矩形中心画圆" class="hash-link" aria-label="Direct link to 利用径向渐变在矩形中心画圆" title="Direct link to 利用径向渐变在矩形中心画圆">​</a></h3>
<p>光看语法比较抽象，我们用代码写一个实际的例子。如图所示，我们要在矩形中心画圆：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAKgSURBVHic7d0xjqNAFEXR7pZXwv7XxFaYoJMJxtLI9QuCe05oGURw9VQJ9vd1XV/Q8PP0A8B95E6I3AmROyFyJ0TuhMidELkTIndC5E6I3Al5Dd7rPM/Bu8Gv4zimbmXdCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRPyevoBQo7j+Ofn53ne/CRZct/rXeLvviP9reS+y/+E/u4q0W/i7L7FZ61PXc471n3YVKlmfgfrPml8lc38LLmP2ZSm4gfJfcbWKBU/Re6EyH3ADetr4EfIfdVtISp+ndwJkfuSmxfXwC+SOyFyJ0TuhMj9c4+cpB3fV8idELkTIndC5E6I3AmROyFyJ0Tun3vkRVJvr66QOyFyJ0TuhMh9yc0naQf3RXInRO6rbltc075O7gNuCFHrI+ROiNxnbF1f0z5F7mM2Ran1QXKfNJ6m1mf5ffdhv4Guv1Eq9B2s+xaLsWp9E+u+y2czL/St5L7X3/n6o8nHyf0+sn6cszshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3Qr6v63r6GeAm1p0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTsgfDN5bAxRkJjUAAAAASUVORK5CYII=" width="250" height="175" class="img_ev3q"></p>
<p>下面是关键代码：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token property" style="color:hsl(5, 74%, 59%)">background</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">radial-gradient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  circle at center</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token hexcode color">#ddd</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其中：</p>
<ul>
<li><code>radial-gradient</code> 函数用于创建渐变效果。</li>
<li><code>circle at center</code> 指定了圆形渐变，并且渐变的中心在矩形的中心。</li>
<li><code>transparent 0</code> 指定了第一个渐变颜色为透明，位置是从中心开始。</li>
<li><code>transparent 20px</code> 指定了第二个渐变颜色也为透明，位置距离中心 20px。</li>
<li><code>#ddd 20px</code> 指定了第三个渐变颜色为淡灰色，位置距离中心 20px，第三个渐变颜色之后的颜色都是淡灰色。</li>
</ul>
<p>通过 <code>radial-gradient</code>，我们成功让矩形中心、半径为 20px 的圆变透明，超过半径 20px 的地方颜色都变为灰色，这样看起来就是矩形中心有一个圆。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="矩形左上角画圆">矩形左上角画圆<a href="#矩形左上角画圆" class="hash-link" aria-label="Direct link to 矩形左上角画圆" title="Direct link to 矩形左上角画圆">​</a></h3>
<p>不难想到，只要  我们把圆的中心从矩形中心移动到矩形的左上角，就可以让圆挡住矩形左上角，得到一个反向圆角。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAI8SURBVHic7dvBbcNQDAXBOEgl6r8mt6Lcc7bIH+xMAQYPiwcJkF/3fX9Bw/f2ATBH7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5E/KzfcBf7/d7+wROcV3XZ3/QuhMid0LkTojcCTkrd++pPOqs3OFRcidE7oQclLsHd552UO7wtFNyN+0MOCV3GHBE7qadGfu5a50x+7nDmOXcTTuTNnPXOsPWctc683Zy1zorpv+rKnQWja671tk1tO5C5wSP5y50zvFI7hLnTJ/JXd/8Cz4iIETuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkT8rrve/sGGGLdCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXIn5BfOJjFpiYWsbgAAAABJRU5ErkJggg==" width="250" height="175" class="img_ev3q"></p>
<p>关键代码如下，我们可以把 <code>circle at center</code> 改写为 <code>circle at left top</code>：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token property" style="color:hsl(5, 74%, 59%)">background</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">radial-gradient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  circle at left top</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token hexcode color">#ddd</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="矩形四个角画圆">矩形四个角画圆<a href="#矩形四个角画圆" class="hash-link" aria-label="Direct link to 矩形四个角画圆" title="Direct link to 矩形四个角画圆">​</a></h3>
<p>我们已经知道 <code>radial-gradient</code> 如何实现 1 个反向圆角，接下来再看如何实现 4 个反向圆角。继续之前的思路，我们很容易想到给 <code>background</code> 设置多个反向渐变。</p>
<p>多个渐变之间可以用逗号分隔、且它们会按照声明的顺序依次堆叠。于是我们会写出如下关键代码：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token property" style="color:hsl(5, 74%, 59%)">background</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">radial-gradient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  circle at left top</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token hexcode color">#ddd</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">/* ... */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">radial-gradient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  circle at right bottom</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token hexcode color">#ddd</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>遗憾的是，上述代码运行后我们看不到四个反向圆角，而是看到一个矩形。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAICSURBVHic7dRBDcRADATBzemQLH9MoeKQWCWPrgIw8qPla2YWNPy+PgDeI3dC5E6I3AmROyFyJ0TuhMidELkTIndC5E7I/+zcfd9nB2Gttfc+suO7EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTsh18x8fQO8xHcnRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRPyAAPJClley2IJAAAAAElFTkSuQmCC" width="250" height="175" class="img_ev3q"></p>
<p>这是因为四个矩形互相堆叠，反而把反向圆角给遮住了。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/overlay-38bca1bd2f7fb7268edd14b71e969a8b.png" width="1052" height="398" class="img_ev3q"></p>
<p>遮挡怎么解决呢？我们可以分四步来解决。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="设置背景宽度和高度">设置背景宽度和高度<a href="#设置背景宽度和高度" class="hash-link" aria-label="Direct link to 设置背景宽度和高度" title="Direct link to 设置背景宽度和高度">​</a></h4>
<p>我们先单独看一个径向渐变。</p>
<p>第一步是设置 <code>background-size: 50% 50%;</code>，它设置了背景图像的大小是容器宽度和高度的 50%。代码运行后效果如下：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAALaSURBVHic7dvBiRtBFEVR2zgS5R+TUpEXXnn3UVdXNb7nBCDE+5diBmZ+fj6fH9Dw6/QXgH3kTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCfl9+gv84/1+n/4K93q9Xqs+ylZf8LoTIndC5E6I3Al5UO7//e9eC9nqOw/KHe4md0LkTshTcvfD6JytvvaU3GGDR+TuuZqz1RWPyB32OJ+752rOVhcdzt395mx13fnXHbY5mbvnas5WSxzL3f3mbLXKmdzdb85WCx3I3f3mbLXW1v9Vdbw5W91h3+vufnO2usmO193x5mx1q3tzd7w5W22wPndnm7PVZgtyd7M5W53ljwgIkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJ+X39I16v1/UP+ev9fq/6qGey1Vled0LkTojcCZE7IQ/K3e9ec7b6zoNyh7vJnRC5E/KU3P0wOmerrz0ld9jgEbl7ruZsdcUjcoc9zufuuZqz1UWHc3e/OVtdd/51h21O5u65mrPVEsdyd785W61yJnf3m7PVQgdyd785W6214H9V5xxvzlZ32Pe6u9+crW6y43V3vDlb3ere3B1vzlYbrM/d2eZstdmC3N1szlZn+SMCQuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3Qn5+Pp/T3wE28boTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3An5A0pZr4c4hE/7AAAAAElFTkSuQmCC" width="250" height="175" class="img_ev3q"></p>
<p>可以看到左上角有反向圆角的矩形重复出现了四次。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="设置不允许重复">设置不允许重复<a href="#设置不允许重复" class="hash-link" aria-label="Direct link to 设置不允许重复" title="Direct link to 设置不允许重复">​</a></h4>
<p>第二步是设置 <code>background-repeat: no-repeat;</code>。我们需要去除第一步中出现的重复。代码运行后效果如下：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAI8SURBVHic7dvBTcRQEAVBFhGJ849pUzFHAoCd+UtXRTCH1pMt2Y/7vj+g4XP7AJgjd0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTsjX9gE/ns/n9gmvdV3X9gl11p0QuRMid0LkTsgpuf/791ROcEruMEDuhMidkCNy9+DOjCNyhxn7uZt2xuznDmOWczftTNrMXesM8zBDyFrupp15O7lrnRULuWudLdO5a51Fc/+qCp11Q+uudU7w8nUXOud4Ye5C5zR/nLvEOdlvc9c3b8RHBITInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oQ87vvevgGGWHdC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidkG+cmzFp2FWm9gAAAABJRU5ErkJggg==" width="250" height="175" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="给每个径向渐变设置位置">给每个径向渐变设置位置<a href="#给每个径向渐变设置位置" class="hash-link" aria-label="Direct link to 给每个径向渐变设置位置" title="Direct link to 给每个径向渐变设置位置">​</a></h4>
<p>第三步是设置不允许重复时，应该保留的背景图像位置。</p>
<p>第一步中左上角是反向圆角的矩形出现了四次，第二步不允许重复时默认保留了左上角的矩形。事实上我们可以选择保留四个矩形中的任何一个，比如我们可以选择保留右下角的矩形。</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token property" style="color:hsl(5, 74%, 59%)">background</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">radial-gradient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    circle at left top</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token hexcode color">#ddd</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  right bottom</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>代码运行后效果如下：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAI5SURBVHic7dvLbYRAFEVBj+VIyD8mUmnnwK/pOVUBoLc4uoIFnzHGDzT8zj4AniN3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJ+Zt9AMft+z77hHtt23btA607IXInRO6EyJ0Qua/q679T7yB3QuROiNwJkfuSvLgfI3dC5L4e036Y3AmR+2JM+xlyX4nWT5I7IXJfhmk/T+5r0Pol5L4ArV9F7m+n9Qv5V/W9hH456/5SWr+DdX8dod9H7i8i9LvJfTKJP0nuT9P3RD5VCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCfmMMWbfAA+x7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJ+Qc2cDFpbtRegwAAAABJRU5ErkJggg==" width="250" height="175" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="组合前三个步骤">组合前三个步骤<a href="#组合前三个步骤" class="hash-link" aria-label="Direct link to 组合前三个步骤" title="Direct link to 组合前三个步骤">​</a></h4>
<p>第四步是组合前三个步骤的语法。</p>
<p>看完第三步后，一个很自然的想法，就是用四个渐变分别形成四个特殊矩形，然后把四个特殊矩形分别放在左上、右上、左下和右下角，最后得到有四个反向圆角的矩形。</p>
<p>关键代码如下,为了区分四个径向渐变，我给左上、右上、左下、右下分别设置了红、绿、蓝、黄四种颜色：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token property" style="color:hsl(5, 74%, 59%)">background</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">radial-gradient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      circle at left top</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">red</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    left top</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">radial-gradient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      circle at right top</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">green</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    right top</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">radial-gradient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      circle at left bottom</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">blue</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    left bottom</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">radial-gradient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      circle at right bottom</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">yellow</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    right bottom</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token property" style="color:hsl(5, 74%, 59%)">background-repeat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> no-repeat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token property" style="color:hsl(5, 74%, 59%)">background-size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token unit">%</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token unit">%</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>代码运行效果如下：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAL8SURBVHic7dvBattQEEDRqOS/2365sjAEJ6QkFElv0D1nZwhCzlwGybK3fd9foOHX6hOA68idELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndCXlefwFe2bfUZnGv7s/oMTrb/Hvq9Q9udELkTIndC5E7IvNzvfp9asP0dOsR5ucNp5E6I3AkZlrsL97uYefk+LHc406TcrfZ7GbjgJ+UOJxuTu9V+R9MW/IzctX5fo4qfkTtcYkDuVvvdzVnwq3PXesOQ4pfmrvWSCcWvy13rPcuLX/FbVaGHPYpf9WPWy7e71lm35i/c7kLnyZI1f0nuQucfLo7+tNwlzo89X9ucmv5xueubI3y6rD+2/tWPmeBCcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTshcidE7oTInRC5EyJ3QuROiNwJkTsh277vxxxoO+QwCfvun/Vzx/T5YLsTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkT8nrUgfb9w8ttO+rA1Ozf/8n/Oiz3T57rlz7fOTHxZ2fl/uyRvuj5ykWhP1yR+4Po+ejS0B+uvlXdF7xHBlrTwXXb/Z0137Zy4S37INKaT1o89ZWfuys+Zv28Fz9mUnzGiEmvf6qq+IApM16fO1xmRO4W/K0Nmu6I3F8Uf1uz5jold7jAoNwt+NsZN9FBucPZZuVuwd/IxFnOyh1OJXdC5E7IuNxdvt/C0CmOyx3OI3dC5E6I3AnZdveGZNjuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkT8gYhBlGCFXtaiAAAAABJRU5ErkJggg==" width="250" height="175" class="img_ev3q"></p>
<p>不难想到，只要把红、绿、蓝、黄都换为灰色，就可以得到一个全灰、有四个反向圆角的矩形。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAACvCAIAAABbzVQuAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAK2SURBVHic7dxRittAEEBBOeQkuv+ZdBXnwyEsJIGFtaYneVUHEBL93Ayy8eP5fB7Q8G36BmAduRMid0LkTojcCZE7IXInRO6EyJ0QuRMid0LkTojcCfk+fQPHcRzXdU3fAjc6z3P6Fn6y3QmROyFyJ2Q+dwf3/94+I57PHZaROyFyJ2Q4931Oddxqk0Hb7oRM5r7JJ541dhj3WO47PDyLjQ/dYYaQmdzHP+VMmR39QO5ajxsMYHXuWueYy+Cx7B+Ahc7vFv8UftF21zp/tDiM27e70PmMNWv+ltwlzlfcl/7bcpc4d3hv+r5mIkTuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndC5E6I3AmROyFyJ0TuhMidELkTIndCHs/n8+0Xva7r7dek4zzPm658S+4fSZ/PuC/xj27P/UX0/M2a0F8Wnd1XPhL/kMVhLNruv1jzvIxswNVvZqx5jrkMBl5EKj5uMICZ9+6Kz5odva+ZCBnL3YIPGh/65HYff3hW2mHcDjOEDOe+wyeeBTYZtO1OiNwJkTsh87lvcqrjPvuMeD53WEbuhMidkNW/d4dBtjshcidE7oTInRC5EyJ3QuROiNwJkTshcifkBy9dajmu7XAKAAAAAElFTkSuQmCC" width="250" height="175" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="把背景改写为遮罩">把背景改写为遮罩<a href="#把背景改写为遮罩" class="hash-link" aria-label="Direct link to 把背景改写为遮罩" title="Direct link to 把背景改写为遮罩">​</a></h3>
<p>知道四个反向圆角的矩形如何实现后，我们可以：</p>
<ul>
<li>把 <code>background-size</code> 改写为 <code>mask-size</code>；</li>
<li>把 <code>background-repeat</code> 改写为 <code>mask-repeat</code>;</li>
<li>把 <code>background</code> 改写为 <code>mask</code>；</li>
</ul>
<p>这样就可以得到四个反向圆角的矩形遮罩。</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token property" style="color:hsl(5, 74%, 59%)">mask</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">radial-gradient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      circle at left top</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token hexcode color">#ddd</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    left top</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">radial-gradient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      circle at right top</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">red</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    right top</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">radial-gradient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      circle at left bottom</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">red</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    left bottom</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">radial-gradient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      circle at right bottom</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">transparent</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token color">red</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    right bottom</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token property" style="color:hsl(5, 74%, 59%)">mask-size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token unit">%</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token unit">%</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token property" style="color:hsl(5, 74%, 59%)">mask-repeat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> no-repeat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们可以把四个反向圆角的矩形覆盖在一张背景图片上，就得到了和热风小程序一样的效果：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/rect3-52ca0bfb5ae660b4ca302ba0e3597ace.png" width="250" height="175" class="img_ev3q"></p>
<p>需要注意的是，部分手机浏览器不支持 mask 语法，所以我们有必要再设置一份 <code>-webkit-mask</code>、<code>-webkit-mask-size</code> 和 <code>-webkit-mask-repeat</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a href="#代码示例" class="hash-link" aria-label="Direct link to 代码示例" title="Direct link to 代码示例">​</a></h2>
<p><a href="https://codepen.io/lijunlin2022/pen/GReBjEO" target="_blank" rel="noopener noreferrer">四个反向圆角的图片 | codepen</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文我们介绍了如何实现四个反向圆角的图片。</p>
<p>我们可以利用径向渐变，实现四个反向圆角的矩形。然后我们把这个矩形作为遮罩，覆盖在背景图片上，这样就实现了四个反向圆角的图片。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/h-5">H5</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/小程序">小程序</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/2024/02/16/variable-height-swiper">H5、小程序高度变化的轮播图如何实现</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-02-16T00:00:00.000Z">February 16, 2024</time> · <!-- -->5 min read</div></header><div class="markdown"><p>高度固定的轮播图，你肯定经常看到、并知道怎么实现，但高度变化的轮播图呢？</p>
<p>下面是 Keep 的课程轮播，可以看到 9 号的视频数量是少于 10 号和 11 号的，所以 9 号的视频列表的高度比 10、11 号低。当播放到 9 号课程时，下方的主题课程模块会往上移动，填充 9 号视频列表下方的空白。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/keep-b7e0b29a6e81ced1d2390b3204705ca6.gif" width="360" height="630" class="img_ev3q"></p>
<p>如果你也想实现高度变化的轮播，看完这篇文章，你一定有所收获。我会先解释高度变化的原理，然后说明关键实现，最后再给出原生 H5 和小程序的示例代码。代码效果如下：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/variable-height-swiper-90e1390ffefc0e6be0044976ba1a3cbd.gif" width="500" height="250" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="高度变化的原理">高度变化的原理<a href="#高度变化的原理" class="hash-link" aria-label="Direct link to 高度变化的原理" title="Direct link to 高度变化的原理">​</a></h2>
<p>如果我们使用 flex 布局实现轮播图 Swiper，那么轮播图的整体高度，将会是最高一项的高度。</p>
<p>如下图，虚线框代表 Swiper，Swiper 的每项都是 List。如果播放到某个 List ，这个 List 就是红色。可以看到，只要轮播图播放到较矮项，就会在较矮项底部留下大量空白。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/principle-1-fb3ced1de74b5899b23fdf8904e77dd1.png" width="1192" height="399" class="img_ev3q"></p>
<p>要想实现高度变化、且不留下空白的轮播图，原理很简单。我们只需要在轮播切换时，先获取即将播放的 List 高度，再把它的高度设置给 Swiper。</p>
<p>如下图，播放到某个 List，Swiper 的高度就变为这个 List 的高度。我们还可以给 Swiper 设置 <code>overflow: hidden;</code>，把找出 Swiper 范围的元素都给隐藏掉。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/principle-2-9a8e1652449cf610aa006a5a177887da.png" width="1192" height="381" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="关键代码实现">关键代码实现<a href="#关键代码实现" class="hash-link" aria-label="Direct link to 关键代码实现" title="Direct link to 关键代码实现">​</a></h2>
<p>聊完原理，我们来看代码，代码非常简单粗暴。</p>
<p>我们为每个 List 都设置了一个 id，利用 id 获取 List 的高度再设置到 Swiper 元素的 style 上。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">updateSwiperHeight</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token parameter">currentIndex</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">const</span><span class="token plain"> height </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:hsl(221, 87%, 60%)">document</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token method function property-access" style="color:hsl(221, 87%, 60%)">querySelector</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token template-string string" style="color:hsl(119, 34%, 47%)">#item-box-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token template-string interpolation">currentIndex</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token template-string template-punctuation string" style="color:hsl(119, 34%, 47%)">`</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">offsetHeight</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  swiper</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">height</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> height </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;px&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  swiper</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token property-access">overflow</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;hidden&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a href="#代码示例" class="hash-link" aria-label="Direct link to 代码示例" title="Direct link to 代码示例">​</a></h2>
<p>现在来看 H5 和小程序的代码示例，为了突出重点，我并没有实现左右滑动，而是用点击切换近似替代：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="h5">H5<a href="#h5" class="hash-link" aria-label="Direct link to H5" title="Direct link to H5">​</a></h3>
<p><a href="https://codepen.io/lijunlin2022/pen/qBLxNzQ" target="_blank" rel="noopener noreferrer">高度变化的轮播图 | codepen</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="小程序">小程序<a href="#小程序" class="hash-link" aria-label="Direct link to 小程序" title="Direct link to 小程序">​</a></h3>
<p><a href="https://developers.weixin.qq.com/s/ct5irIm37eOg" target="_blank" rel="noopener noreferrer">高度变化的轮播图 | 小程序</a></p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li>小程序有原生的 swiper 组件，我们可以给 swiper 直接增加一个 style，在 style 中改变 swiper 的高度。</li>
<li>小程序没有 <code>querySelector()</code>，可以用 <code>createSelectorQuery()</code> 替代。</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="额外提醒">额外提醒<a href="#额外提醒" class="hash-link" aria-label="Direct link to 额外提醒" title="Direct link to 额外提醒">​</a></h2>
<p>高度变化的轮播图非常少见，你需要仔细斟酌什么时候用它。</p>
<p>如果你不需要左右滑动，那么选择 Tab + 卡片更适合。比如 12306 的选项卡，高度就是不等的：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/12306-df8f855fabba3e55a1da2b06c3094e38.gif" width="360" height="206" class="img_ev3q"></p>
<p>如果轮播每一项轮播都是长列表，且随着用户上拉屏幕，列表加载的数据还会变多。<strong>这种轮播通常还是固定高度（100vh）的轮播</strong>。</p>
<p>它在拼多多、淘宝、京东上很常见。你需要注意，<strong>这种轮播每一项需要自带滚动条，否则处理列表滚动条会变得非常麻烦</strong>。因为这种轮播往往要求记住用户在每个列表滚动的位置，如果轮播共用滚动条，左右切换会有一个很明显的闪烁。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/pdd-332fa0c169a8ad77979376b8c3b0bf63.gif" width="360" height="432" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文我们介绍了高度变化的轮播图实现原理——先获取对应轮播项的高度，再改变轮播图的整体高度。之后我们给出了 H5 和小程序的代码示例。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/h-5">H5</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/小程序">小程序</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/2024/02/09/dragon-troubles-the-sea">H5 蛟龙闹海动画如何实现（不引用图片）</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-02-09T00:00:00.000Z">February 9, 2024</time> · <!-- -->4 min read</div></header><div class="markdown"><p>龙年要到了，祝大家在新的一年里，如龙腾飞、事业有成；如龙入海、财源广进。</p>
<p>我使用 HTML 和 CSS 实现了一个蛟龙闹海效果。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/dragon-troubles-the-sea-18929469c29a363415e7691624af93bb.gif" width="360" height="356" class="img_ev3q"></p>
<p>它很简略，但是代码中我没有引用图片，我是怎么做的呢？</p>
<p>下面我会从下往上、依次解释如何实现海浪、龙和云朵，接着我会给出整体代码，最后，我会做一个简单总结。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="海浪如何实现">海浪如何实现<a href="#海浪如何实现" class="hash-link" aria-label="Direct link to 海浪如何实现" title="Direct link to 海浪如何实现">​</a></h2>
<p>我使用 2 个不同 border-radius 圆角的正方形实现了海浪效果。首先，我实现了一个圆形和两个圆角正方形，然后把两个圆角正方形移动到圆形的底部。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="330" height="440" class="img_ev3q"></p>
<p>然后，我给圆角正方形添加旋转动画，</p>
<p><img decoding="async" loading="lazy" src="/assets/images/sea-bb3436a41d93d2e65fcfe093ea43f8ec.gif" width="330" height="440" class="img_ev3q"></p>
<p>之后给圆形添加 <code>overflow: hidden;</code>，就可以得到海浪效果。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/wave-af164e3d438cc03cf847e1f59b8ddc12.gif" width="360" height="360" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="龙如何实现">龙如何实现<a href="#龙如何实现" class="hash-link" aria-label="Direct link to 龙如何实现" title="Direct link to 龙如何实现">​</a></h2>
<p>再看下龙如何实现，我使用 <code>clip-path</code> 实现了龙的效果。</p>
<p><code>clip-path</code> 是 CSS 一个属性，可以裁剪元素。裁剪区域内的显示，区域外的隐藏。可以利用 <code>ploygon()</code> 定义多个顶点，连接好后就成为了多边形。</p>
<p>我裁剪了 10 个多边形，组合成了龙。其中 1 个 8 边形是龙头、1 个 4 边形是眼睛、2 个 5 边形是龙角、4 个 4 边形是鬃毛，还有 1 个 12 边形是脖子、1 个 12 边形是肚子。</p>
<p>不过，以我的设计经验，肯定是没办法轻松裁剪出这些多边形的，我使用了 <a href="https://www.jiangweishan.com/tool/clippy/" target="_blank" rel="noopener noreferrer">clippy</a> 这个工具，这个工具可以像描图一样把多边形裁剪出来。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/clippy-dragon-a6c91554129e590806f5988be1843651.jpg" width="479" height="567" class="img_ev3q"></p>
<p>理论上裁剪得越精细，多边形数量越多，描边的龙就越像。这是纯粹的体力活，我这里偷个懒，只裁剪出大概的形状。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="云朵如何实现">云朵如何实现<a href="#云朵如何实现" class="hash-link" aria-label="Direct link to 云朵  如何实现" title="Direct link to 云朵如何实现">​</a></h2>
<p>实现了龙，我们再看下云朵如何实现，我使用 6 个圆重叠形成了云朵。</p>
<p>简单画 6 个圆，如下所示：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/cloud-border-e23e28fb9c8d580bda3ce3c005acce7c.png" width="328" height="211" class="img_ev3q"></p>
<p>只要将这些圆的边框全部变透明，再填充上颜色，就可以得到一朵云。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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MWmiKL1LXHUwMDBl/apgP1x1MDAxYZ9Sd1x1MDAxMVx1MDAxY5ZcdTAwMTWLXG5rN1xyR/7a8K/CNlWj65GHxs0gKG1gKYzhVLF6ooFL0vbgUVx1MDAxY1WcScGEoljLWiDM3iNfeWVz4tosaPJcXDo2ath74nWR+O6jXHUwMDEyKKKw9oxgZVx1MDAxYrM2jOZtXHUwMDFkXHUwMDFie/Nmnb2NsO5/y2pcdTAwMTNcdTAwMWM8XHUwMDBm+Vd0XHUwMDE0OOFSXHUwMDEzXHUwMDAyL1xi77F34o9cdTAwMDN+flx1MDAxMNrlkU3jXHUwMDE1jN27XHUwMDBmIXSFo+f98diynDiCYlNyxVx1MDAxNbZU03JVy1xu7ShcIkBTYYDpjdk/1Vxcf6Dz11x1MDAxMFODUVx1MDAxOGRyN63TJnpjhec8U8O52Fx1MDAwNc/EbOPZYHJcdFWCvVx1MDAxOOdze5lcdTAwMWVcdTAwMWSNj1x1MDAwYs1cdTAwMGb+sdmluT1cdTAwMWRMu44zKKSEcso0M0SyXHUwMDE2zkQ4XHUwMDA2kC9KmWSG6lx1MDAwZeNcZlRcdTAwMGIpgEnoXCLPlDC6XHUwMDBinpncxjNcYqkpxVq/XHUwMDFj6OvBzfBwNVx1MDAxZd35s/2vIH9eecsr2XGgXHUwMDA1V44hmHLNJVx1MDAxN1xc61x1MDAxNtDgXHUwMDE4JrRcdTAwMDbJmdjEvYNAa8RZKUK7uEEzXHUwMDAxfFx1MDAxN1x1MDAxN1x1MDAwZb31vlx1MDAwMVx1MDAxY0BJLfnL71x1MDAxYunQ+zJcdTAwMWF/OL2ZL+HfM6WhuPaPO84z19RcdTAwMDFFtWTYvuWTt4DmjqFM4UGOUONcdTAwMGXIO0y0knieXG5cdTAwMDWsg0BcdTAwMGLMLN9cdTAwMDHQQMl2ovFcdTAwMTg2+lx1MDAxNVx1MDAxYnRcdTAwMDHjz1x1MDAwYrKfXHUwMDBlP1xyP1x1MDAxZp+OrtW7b6nqONCSXHUwMDEy5IhQXHJ4fZZaPOVcdTAwMTkkcYBcYq1cYlx1MDAwN42TqsM442GLXHUwMDFkKYXq4lx1MDAwNo2/muyCZ7L1fbesI5XyNVfoxdm7Qn85W1xcXFwu525cdTAwMDHJ4PrjJOo40LjnOkhy+UqoOVGsdePA+4jiRlx1MDAxMcYlXHUwMDAwwVx1MDAwM73DRFx1MDAwYkqUXHUwMDE0XHUwMDE0VFx1MDAwN4HmXHUwMDE0wLxcdTAwMWFofFZG+26SnORosnZcckNcdTAwMGL9k/AueGKmf1x1MDAxM1x1MDAwNsv9/0n6pPr099b+lyhcdTAwMDZVnFx1MDAwZntcdTAwMGb/XHUwMDAxVeRcdTAwMGaoIn2UVJbwAAAAAElFTkSuQmCC" width="328" height="211" class="img_ev3q"></p>
<p>我没有创建 6 个 div 元素然后叠加，而是使用了 box-shadow 来实现。box-shadow 最多有五个参数。</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)">/* x 偏移量 | y 偏移量 | 阴影模糊半径 | 阴影扩散半径 | 阴影颜色 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token property" style="color:hsl(5, 74%, 59%)">box-shadow</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token unit">px</span><span class="token plain"> </span><span class="token color function" style="color:hsl(221, 87%, 60%)">rgba</span><span class="token color punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token color number" style="color:hsl(35, 99%, 36%)">0</span><span class="token color punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token color"> </span><span class="token color number" style="color:hsl(35, 99%, 36%)">0</span><span class="token color punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token color"> </span><span class="token color number" style="color:hsl(35, 99%, 36%)">0</span><span class="token color punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token color"> </span><span class="token color number" style="color:hsl(35, 99%, 36%)">0.2</span><span class="token color punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>不需要阴影模糊半径和阴影扩散半径，只需要设置 x 偏移量和 y 偏移量，就可以实现圆形的偏移：</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token property" style="color:hsl(5, 74%, 59%)">box-shadow</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">5</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token hexcode color">#ddd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">-5</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token hexcode color">#ddd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">6</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token hexcode color">#ddd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token hexcode color">#ddd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token number" style="color:hsl(35, 99%, 36%)">30</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token hexcode color">#ddd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="示例代码">示例代码<a href="#示例 代码" class="hash-link" aria-label="Direct link to 示例代码" title="Direct link to 示例代码">​</a></h2>
<p>现在，我们看完整代码：</p>
<p><a href="https://codepen.io/lijunlin2022/pen/abQewmE" target="_blank" rel="noopener noreferrer">蛟龙闹海 | codepen</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文我们利用 HTML 和 CSS 实现了一个蛟龙闹海效果。其中：</p>
<ol>
<li>海浪，可以使用两个旋转的圆角正方形实现。</li>
<li>龙，可以使用 clip-path 裁剪多边形，再拼接多边形实现。</li>
<li>云朵，不需要创建多个元素，可以使用 box-shadow 并设置多组值实现。</li>
</ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/h-5">H5</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/2024/02/03/parabolic-animation">H5、小程序商品加入购物车的抛物线动画如何实现</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-02-03T00:00:00.000Z">February 3, 2024</time> · <!-- -->5 min read</div></header><div class="markdown"><p>电商类 H5、小程序把商品加入到购物车时，常常有一个抛物线动画。比如麦当劳小程序，当你点击加购按钮时，会看到有一个小汉堡从卡片汉堡上抛出，然后掉落到购物袋里。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/mcdonald&#x27;s-5dcfebd6a789333baa3a92525104909b.gif" width="360" height="322" class="img_ev3q"></p>
<p>这种动画该怎么做呢？如果你也想实现它，看完这篇文章，你一定有所收获。我会先说明抛物线动画的原理，再解释实现它的关键代码，最后给出完整的代码示例。代码效果  如下：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/parabola-ffdb0153f578a3f8179d299102c98cf0.gif" width="300" height="300" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="抛物线动画的原理">抛物线动画的原理<a href="#抛物线动画的原理" class="hash-link" aria-label="Direct link to 抛物线动画的原理" title="Direct link to 抛物线动画的原理">​</a></h2>
<p>高中物理告诉我们，平抛运动、斜抛运动可以分解为水平方向的匀速直线运动、竖直方向自由落体运动（匀加速直线运动）。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/principle-2c15f4011484c80f4eb9ba952266e216.png" width="437" height="284" class="img_ev3q"></p>
<p>同理，我们可以把抛物线动画分解为水平的匀速动画、竖直的匀加速动画。</p>
<p>水平匀速动画很容易实现，直接 <code>animation-timing-function</code> 取值 <code>linear</code> 就行。</p>
<p>竖直的匀加速直线运动，严格实现非常困难，我们可以近似实现。因为匀加速直线运动，速度是越来越快的，所以我们可以用一个先慢后快的动画替代，你可能立刻就想到给 <code>animation-timing-function</code> 设置 <code>ease-in</code>。不过 <code>ease-in</code> 先慢后快的效果不是很明显。针对这个问题，张鑫旭大佬提供了一个贝塞尔曲线 <code>cubic-bezier(0.55, 0, 0.85, 0.36);</code><sup><a href="#user-content-fn-1-29919e" id="user-content-fnref-1-29919e" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>。当然，你也可以用 <a href="https://cubic-bezier.com/" target="_blank" rel="noopener noreferrer">cubic-bezier</a> 自己调一个先慢后快的贝塞尔曲线。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="关键代码实现">关键代码实现<a href="#关键代码实现" class="hash-link" aria-label="Direct link to 关键代码实现" title="Direct link to 关键代码实现">​</a></h2>
<p>我 们把代码分为两部分，第一部分是布局代码、第二部分是动画代码。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="布局代码">布局代码<a href="#布局代码" class="hash-link" aria-label="Direct link to 布局代码" title="Direct link to 布局代码">​</a></h3>
<p>首先是 HTML 代码，代码非常简单。下图中小球代表商品、长方形代表购物车。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAIAAAD2HxkiAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAATdSURBVHic7d0hbyJ5HIBh9nKi6ci6+ioMokmDwaNq95vsV1qLwmOaJogaVH1dJQ2uJ5psNnvJ3pQtee9un0cxA/PLmDcDk/CfT6+vrxOg80d9AvC7EyHE/qxPAP4Pdrvd4+Pj09PT8/Pzy8vLZDI5Pz+/uLi4vLy8urqaTqc/OfaT34RwtMPhsNls7u/v9/v9Tz42DMPNzc1isTg7O/v7uyKEI2232/V6/fP8vjcMw3K5vL6+/mG/COEYq9Xq7u7uiAPn8/nt7e33e0QI7/b169eHh4ejD5/NZp8/f/626e4ovM9qtfqVAieTycPDw2q1+rYpQniH7XZ73LfQH9zd3W2327fXIoSxDofDer3+qGnr9fpwOExECONtNpvx90L/0X6/32w2ExHCePf396cYKEIYZbfbfeBl8M1+v9/tdiKEUR4fH080VoQwytPT04nGihBGeX5+PtFYEcIob/+NOMVYEUJMhDDK+fn5icaKEEa5uLg40VgRwiiXl5cnGitCGOXq6upEY0UIo0yn02EYPnbmMAzT6VSEMNbNzc0pBooQxlosFh94MRyGYbFYTEQI452dnS2Xy4+atlwu3xZfEyG8w/X19Xw+//U58/n827JrIoT3ub29nc1mvzJhNpt9v+Ca1dbgGJY8hJ7Ff6FnGXz4t/BAGPgPc3cUYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIIfbpy5cv9TnAb82VEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihNhfcFfVlwNUNc8AAAAASUVORK5CYII=" width="300" height="300" class="img_ev3q"></p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">ball-box</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">ball</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">cart</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>你可能比较好奇，小球用一个 ball 元素就可以实现，为什么我要用 ball 和 ball-box 两个元素呢？因为 animation <strong>只能给一个元素定义一个动画效果</strong>，而我们需要给小球添加两个动画效果。于是我们将动画分解，给 ball-box 添加水平运动的动画，给 ball 添加竖直运动的动画。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="动画代码">动画代码<a href="#动画代码" class="hash-link" aria-label="Direct link to 动画代码" title="Direct link to 动画代码">​</a></h3>
<p>再看动画代码，moveX 是水平运动动画，moveY 是竖直动画，动画时间均为 1s。为了让效果更加明显，我还特意将动画设置成无限循环的动画。</p>
<div class="language-css codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-css codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token selector class" style="color:hsl(119, 34%, 47%)">.ball-box</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)">/* ... */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">animation</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> moveX </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token unit">s</span><span class="token plain"> linear infinite</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token selector class" style="color:hsl(119, 34%, 47%)">.ball</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)">/* ... */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">animation</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> moveY </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token unit">s</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">cubic-bezier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">0.55</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.85</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.36</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> infinite</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token atrule rule" style="color:hsl(35, 99%, 36%)">@keyframes</span><span class="token atrule" style="color:hsl(35, 99%, 36%)"> moveX</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token selector" style="color:hsl(119, 34%, 47%)">to</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token property" style="color:hsl(5, 74%, 59%)">transform</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">translateX</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">-250</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token atrule rule" style="color:hsl(35, 99%, 36%)">@keyframes</span><span class="token atrule" style="color:hsl(35, 99%, 36%)"> moveY</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token selector" style="color:hsl(119, 34%, 47%)">to</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token property" style="color:hsl(5, 74%, 59%)">transform</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">translateY</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">250</span><span class="token unit">px</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a href="#代码示例" class="hash-link" aria-label="Direct link to 代码示例" title="Direct link to 代码示例">​</a></h2>
<p><a href="https://codepen.io/lijunlin2022/pen/NWoLgyV" target="_blank" rel="noopener noreferrer">抛物线动画 | codepen</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文我们介绍了抛物线动画的实现方法，我们可以将抛物线动画拆分为水平匀速直线动画和竖直从慢变快的动画，水平动画我们可以使用 linear 来实现，竖直动画我们可以使用一 个先慢后快的贝塞尔曲线替代。设置动画时，我们还需要注意，一个元素只能设置一个动画。</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-1-29919e">
<p><a href="https://www.zhangxinxu.com/wordpress/2018/08/css-css3-%e6%8a%9b%e7%89%a9%e7%ba%bf%e5%8a%a8%e7%94%bb/" target="_blank" rel="noopener noreferrer">这回试试使用CSS实现抛物线运动效果 | 张鑫旭</a> <a href="#user-content-fnref-1-29919e" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/h-5">H5</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/小程序">小程序</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/2024/01/27/offline-package-rollback">H5 离线包放入 HTML 后降级方案如何设计</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-01-27T00:00:00.000Z">January 27, 2024</time> · <!-- -->9 min read</div></header><div class="markdown"><p>离线包是移动端 H5 常见的性能优化方案。开发者们或多或少都接触过离线包。francecil 大佬还总结了离线包是否要放入 HTML 的两种决策，以及决策的优缺点： <sup><a href="#user-content-fn-1-086d77" id="user-content-fnref-1-086d77" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>：</p>
<ul>
<li>放入 HTML（缓存优先）：更好的性能，但更新不及时。</li>
<li>不放入 HTML（网络优先）：实时更新，但性能较差，可能会加载失败。</li>
</ul>
<p>我选择把 HTML 放入离线包，这意味着 H5 出现线上故障时，没有办法及时修复。因此，我必须额外设计一套降级方案，保证离线包发生故障时能够快速降级。</p>
<p>如果你也为离线包的降级而烦恼，看了这篇文章，你一定有所收获。我会从离线包的机制说起，解释离线包放入 HTML 后为什么更新不及时，然后我会介绍自己设计的降级方案，最后我会对这个方案做一个总结。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="离线包的生效机制">离线包的生效机制<a href="#离线包的生效机制" class="hash-link" aria-label="Direct link to 离线包的生效机制" title="Direct link to 离线包的生效机制">​</a></h2>
<p>为什么离线包放入 HTML 后更新不及时？为了回答这个问题，我们必须先知道它是如何生效的。</p>
<p>离线包首先会把 HTML、CSS 和 JS 等资源文件打包成一个压缩包，并预先下载到 App 本地，解压到缓存中。当用户访问 H5 时，Webview 开始加载资源的 URL 并发出资源请求，App 会拦截这些请求。</p>
<ul>
<li>如果缓存中有满足请求的资源，App 会使用缓存资源；</li>
<li>如果缓存中没有满足请求的资源，App 会使用线上资源。</li>
</ul>
<!-- -->
<p>什么时候叫缓存资源满足请求呢？就是缓存文件名字和请求文件名字一致。</p>
<ul>
<li>如果我们在离线包里放入 HTML，由于 HTML 文件不会轻易改变，即使线上资源有更新，App 也会优先使用缓存资源；</li>
<li>如果我们不放入 HTML，由于 CSS 和 JS 文件名的哈希会改变，所以线上资源有更新时，App 内 HTML、CSS 和 JS 都会使用线上资源。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="我设计的降级方案">我设计的降级方案<a href="#我设计的降级方案" class="hash-link" aria-label="Direct link to 我设计的降级方案" title="Direct link to 我设计的降级方案">​</a></h2>
<p>上一节我们已经知道，HTML 文件名没有变化，离线包就不会失效。我们可以利用跳转间接改变文件名。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用跳转降级离线包">利用跳转降级离线包<a href="#利用跳转降级离线包" class="hash-link" aria-label="Direct link to 利用跳转降级离线包" title="Direct link to 利用跳转降级离线包">​</a></h3>
<p>首先，我们需要准备两个内容一样的 HTML，一个是 index.html，另一个是 index-online.html。</p>
<ul>
<li>index.html 会放入离线包；</li>
<li>index-online.html 不会放入离线包。</li>
</ul>
<p>然后，我们会设计一个开关，控制 index.html 是否要跳转。</p>
<ul>
<li>开关开启时，index.html 会跳转到 index-online.html；</li>
<li>开关关闭时，index.html 保持原始逻辑。</li>
</ul>
<p>这样发生线上故障时，我们可以回滚线上的 H5 页面，此时 index-online.html 恢复正常，而缓存在用户 App 本地的 index.html 还有问题。</p>
<p>我们开启开关后，离线的 index.html 直接跳转到已经恢复正常的 index-online.html，就实现了离线包的降级。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用版本大小设计开关">利用版本大小设计开关<a href="#利用版本大小设计开关" class="hash-link" aria-label="Direct link to 利用版本大小设计开关" title="Direct link to 利用版本大小设计开关">​</a></h3>
<p>上一小节，我们提到降级方案需要一个开关，设计这个开关，我们需要考虑两个问题：</p>
<ul>
<li>离线包有 n 个版本，有时多个版本均存在问题。比如 1.0.0 离线包没有问题，1.0.1 和 1.0.2 都有问题，我们需要保证开关能够降级多个版本。</li>
</ul>
<!-- -->
<ul>
<li>我们会发布修复的离线包，比如我们会在 1.0.3 修复问题。开关打开后，不能把修复版本降级。</li>
</ul>
<!-- -->
<p>怎么设计呢？我这里采取最 简单粗暴的思路，把离线包本身的版本 H5_VERSION 和要降级的版本 rollbackVersion 做一个比较。</p>
<ul>
<li><code>H5_VERSION &lt;= rollbackVersion</code>，相当于打开降级开关。</li>
<li><code>H5_VERSION &gt; rollbackVersion</code>，相当于关闭降级开关。</li>
</ul>
<p>继续使用之前的例子，1.0.2 是出现问题的最高版本，我们可以把 rollbackVersion 设置为 1.0.2，<code>&lt;= 1.0.2</code> 全部降级。这样虽然会误伤 1.0.0 版本，但能既满足降级多个有问题的版本，又满足不降级修复版本。</p>
<!-- -->
<p>发生下一次故障时，我们再更新 rollbackVersion，比如 1.0.4 发生了故障，我们把 rollbackVersion 设置为 1.0.4，<code>&lt;= 1.0.4</code> 全部降级。</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="利用-localstorage-延迟开关生效时间">利用 localStorage 延迟开关生效时间<a href="#利用-localstorage-延迟开关生效时间" class="hash-link" aria-label="Direct link to 利用 localStorage 延迟开关生效时间" title="Direct link to 利用 localStorage 延迟开关生效时间">​</a></h3>
<p>上一节我们介绍了如何设计开关。需要注意的是，我们不能一发现开关打开、就立即跳转，这会中断用户正常的操作。（比如用户正在浏览页面，突然页面跳转）</p>
<p>我们等开关打开后，在 localStorage 中存储一下代表打开的标识，等到用户下次进入页面时，发现有打开标识再跳转到 index-online.html。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="流程图">流程图<a href="#流程图" class="hash-link" aria-label="Direct link to 流程图" title="Direct link to 流程图">​</a></h3>
<p>考虑完上面三个问题后，我们就可以设计一个比较完善的降级方案了，它的流程图如下：</p>
<!-- -->
<ol>
<li>用户一进入页面，会先获取 localStorage 中的 needRollback 开关标识。</li>
<li>如果 needRollback 标识打开，则跳转 index-online.html 实现降级。（注：<strong>index-online.html 中不能继续判断 needRollback，否则会无限跳转</strong>）</li>
<li>如果 needRollback 标识没有打开，则继续获取 H5 本身的版本号，以及接口下发的 rollbackVersion。</li>
<li>如果 <code>H5_VERSION &lt;= rollbackVersion</code>，则在 localStorage 把 needRollback 设置为 1。</li>
<li>如果 <code>H5_VERSION &gt; rollbackVersion</code>，则删除 localStorage 中的 needRollback 标识。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文介绍了一种离线包放入 HTML 的降级方案，它主要有三个特点：</p>
<ol>
<li>利用从离线化的 index.html 跳转到线上的 index-online.html 实现降级。</li>
<li>利用离线包版本 <code>H5_VERSION &lt;= rollbackVersion</code> 做开关，判断是否需要降级。</li>
<li>利用 localStorage 中设置 needRollback 标识，延迟开关作用时间。</li>
</ol>
<p>这种方案是离线包放入 HTML 后，一种成本较低的降级方案。它会在降级时误伤低版本的离线包，以损耗性能为代价，保障质量。</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-1-086d77">
<p><a href="https://juejin.cn/post/7254549436625256506" target="_blank" rel="noopener noreferrer">HTML 放入离线包？你需要了解的离线策略</a> <a href="#user-content-fnref-1-086d77" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/h-5">H5</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/page/2"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div></div>
</body>
</html>